\documentclass{lmcs} %%% last changed 2014-08-20

%% mandatory lists of keywords 
%\keywords{dependent type theory, presheaf models, modal type theory, homotopy type theory, parametricity, directed type theory, guarded type theory}

%% read in additional TeX-packages or personal macros here:
%% e.g. \usepackage{tikz}
%\usepackage{libertine}
%\usepackage[libertine]{newtxmath}

%\usepackage[T1]{fontenc}
%\usepackage{lmodern}
	% This is to avoid the error:
	% "! pdfTeX error (font expansion): auto expansion is only possible with scalable fonts."
                     
%\usepackage{amsthm}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{xypic}
\RequirePackage{amssymb}
\usepackage{stmaryrd}
%%\input{myMacros.tex}
%% define non-standard environments BEYOND the ones already supplied 
%% here, for example
\theoremstyle{plain}\newtheorem{satz}[thm]{Satz} %\crefname{satz}{Satz}{S\"atze}
%% Do NOT replace the proclamation environments lready provided by
%% your own.

\allowdisplaybreaks

% --------------------------------------------------
% Get cleveref to work: https://tex.stackexchange.com/a/354706/43137

\newcommand{\renewtheorem}[1]{%
  \expandafter\let\csname #1\endcsname\relax
  \expandafter\let\csname c@#1\endcsname\relax
  \expandafter\let\csname end#1\endcsname\relax
  \newtheorem{#1}%
}

\theoremstyle{plain}

\renewtheorem{thm}{Theorem}[section]
\renewtheorem{cor}[thm]{Corollary}
\renewtheorem{lem}[thm]{Lemma}
\renewtheorem{prop}[thm]{Proposition}
\renewtheorem{asm}[thm]{Assumption}

% the following environments keep the roman font:
\theoremstyle{definition}

\renewtheorem{rem}[thm]{Remark}
\renewtheorem{rems}[thm]{Remarks}
\renewtheorem{exa}[thm]{Example}
\renewtheorem{exas}[thm]{Examples}
\renewtheorem{nota}[thm]{Notation}
\renewtheorem{defi}[thm]{Definition}
\renewtheorem{conv}[thm]{Convention}
\renewtheorem{conj}[thm]{Conjecture}
\renewtheorem{prob}[thm]{Problem}
\renewtheorem{oprob}[thm]{Open Problem}
\renewtheorem{algo}[thm]{Algorithm}
\renewtheorem{obs}[thm]{Observation}
\renewtheorem{qu}[thm]{Question}
\renewtheorem{fact}[thm]{Fact}
\renewtheorem{pty}[thm]{Property}

% --------------------------------------------------

%\newenvironment{proposition}[1][]{\begin{prop}[#1]}{\end{prop}}
%\newenvironment{theorem}[1][]{\begin{thm}[#1]}{\end{thm}}
%\newenvironment{definition}[1][]{\begin{defi}[#1]}{\end{defi}}
%\newenvironment{example}[1][]{\begin{exa}[#1]}{\end{exa}}
%\newenvironment{remark}[1][]{\begin{rem}[#1]}{\end{rem}}
%\newenvironment{notation}[1][]{\begin{nota}[#1]}{\end{nota}}
%\newenvironment{corollary}[1][]{\begin{cor}[#1]}{\end{cor}}
\newenvironment{proposition}[0]{\begin{prop}}{\end{prop}}
\newenvironment{theorem}[0]{\begin{thm}}{\end{thm}}
\newenvironment{definition}[0]{\begin{defi}}{\end{defi}}
\newenvironment{example}[0]{\begin{exa}}{\end{exa}}
\newenvironment{remark}[0]{\begin{rem}}{\end{rem}}
\newenvironment{notation}[0]{\begin{nota}}{\end{nota}}
\newenvironment{corollary}[0]{\begin{cor}}{\end{cor}}

%\def\eg{{\em e.g.}}
%\def\cf{{\em cf.}}

% ---------------------------------------------------------

%\newcommand{\todoi}[1]{\textbf{\textcolor{red}{#1 \qed}}\par\noindent}
%\newcommand{\todo}[1]{\textbf{\textcolor{red}{\footnote{\textcolor{red}{#1}}}}}
%\newcommand{\domii}[1]{\textbf{\textcolor{green!70!black}{Domi: #1 \qed}}\par\noindent}
%\newcommand{\domi}[1]{\textbf{\textcolor{green!70!black}{\footnote{\textcolor{green!70!black}{Domi: #1}}}}}
%\newcommand{\revi}[2]{\textbf{\textcolor{blue}{Rev #1: #2 \qed}}\par\noindent}
%\newcommand{\rev}[2]{\textbf{\textcolor{blue}{\footnote{\textcolor{blue}{Rev #1: #2}}}}}
%\newcommand{\okrev}[2]{\textbf{\textcolor{purple}{\footnote{\textcolor{purple}{OK Rev #1: #2}}}}}
%\newcommand{\oktodo}[1]{\textbf{\textcolor{purple}{\footnote{\textcolor{purple}{#1}}}}}
%\newcommand{\todoi}[1]{}
%\newcommand{\todo}[1]{}
%\newcommand{\domii}[1]{}
%\newcommand{\domi}[1]{}
%\newcommand{\revi}[2]{}
%\newcommand{\rev}[2]{}
%\newcommand{\okrev}[2]{}
%\newcommand{\oktodo}[1]{}

% ---------------------------------------------------------

\usepackage[todos]{../natpt-macros}

% ---------------------------------------------------------

%% due to the dependence on amsart.cls, \begin{document} has to occur
%% BEFORE the title and author information:

\begin{document}

\title[Higher Pro-Arrows: From Semantics towards Syntax of Naturality Pretype Theory]{Higher Pro-Arrows: \\ From Semantics towards Syntax \\ of Naturality Pretype Theory}
%\title[Instructions]{Instructions for Authors\\How to prepare papers
%  for LMCS using \texorpdfstring{\MakeLowercase{\texttt{lmcs.cls}}}{lmcs.cls}\rsuper*\\Version of 
%  2014-02-01}
%\titlecomment{{\lsuper*}OPTIONAL comment concerning the title, \eg, 
%  if a variant or an extended abstract of the paper has appeared elsewhere.}

\author[Andreas Nuyts]{Andreas Nuyts\lmcsorcid{0000-0002-1571-5063}}	%required
\thanks{Andreas Nuyts holds a Postdoctoral Fellowship from the Research Foundation - Flanders (FWO; 1247922N, 12AB225N). This research is partially funded by the Research Fund KU Leuven.}	%optional

\address{DistriNet, KU Leuven, Belgium}	%required
\email{andreas.nuyts@kuleuven.be}  %optional
\urladdr{anuyts.github.io}  %optional
%\email{name1@email1}  %optional

%\author[C.~Name3]{Carla Name3}	%optional
%\address{address 3}	%optional
%\urladdr{name3@url3\quad\rm{(optionally, a web-page can be specified)}}  %optional
%\thanks{thanks 3, optional.}	%optional

%% etc.

%% required for running head on odd and even pages, use suitable
%% abbreviations in case of long titles and many authors:

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% the abstract has to PRECEDE the command \maketitle:
%% be sure not to issue the \maketitle command twice!

\begin{abstract}
\noindent 
In parametric, directed and homotopy type theory, we get preservation of relations, morphisms and equivalences (resp.) for free.
None of these systems is superior to the other: while relations are strictly more general than morphisms and equivalences, we lose computational content when we only consider relations.
Meanwhile, preservation of morphisms is subject to the rather strong condition of functoriality.

We set out to develop a type system where these three properties interact: functions have a modality/variance annotation that expresses how they act on relations, morphisms and equivalences.
%that has all three preservation properties in an interactive manner, so that we can preserve isomorphisms when available, morphisms when functorial, and relations as a last resort.
%We use modalities to keep track of variance of functions.
Such a system should provide us with functoriality, parametricity and naturality proofs for free.
I call such a system Naturality Type Theory (NatTT).

In this first step, I consider Naturality \emph{Pre}type Theory (NatPT):
I defer all formal considerations of fibrancy to future work,
including in particular the specifics of composition of and transport along morphisms.
%
By instantiating parametrized systems such as Multimod(e/al) Type Theory (MTT) and the Modal Transpension System (MTraS), we can moreover separate concerns and only worry about the semantics, leaving syntactic matters to research on MTT and MTraS.
I construct an MTT mode theory with a presheaf model designed to accommodate higher pro-arrow equipments (to be fully defined in future work), which can be invented in three ways: (1) as a higher-dimensional version of pro-arrow equipments, (2) as a heterogenization of Tamsamani and Simpson's model of higher category theory, and (3) as a directification of Degrees of Relatedness.
A twisted prism functor on the base categories models an internal twisted interval in the sense of MTraS.
Finally, I discuss how the matter of fibrancy can be addressed in the future.
\end{abstract}

\maketitle

%\todoi{``In general, the length of the abstract should not exceed 20 lines''}

\section{Old Abstract}
\todoi{Remove this section after it's been fully subsumed in the intro}
In systems with internal parametricity,
relations propagate through type-level functions and are preserved by term-level functions for free.
In homotopy type theory (HoTT), we get preservation of equivalences by all functions for free.
In directed type theory, we get preservation of morphisms by all (covariant) functions for free.
None of these three properties by itself is satisfactory:
HoTT and directed type theory are less general in the sense that equivalences and morphisms give rise to a (graph) relation, but not vice versa.
However, parametricity is less powerful in that relations do not carry the computational information of morphisms.
Finally, directed type theory requires functoriality of the operation we propagate through.

We set out to develop a type system that has all three preservation properties in an interactive manner, so that we can preserve isomorphisms when available, morphisms when functorial, and relations as a last resort.
We use modalities to keep track of variance of functions as we build them.
Such a system should provide us with functoriality (\texttt{fmap}), parametricity and naturality proofs for free. I call such a system Naturality Type Theory (NatTT).
In this first step, I consider Naturality \emph{Pre}type Theory (NatPT):
I defer all formal considerations of fibrancy to future work,
including in particular the specifics of composition of and transport along morphisms.

By instantiating parametrized systems such as Multimod(e/al) Type Theory (MTT) and the Modal Transpension System (MTraS), we can moreover separate concerns and only worry about the presheaf model at every mode, and the modalities that we can model as adjunctions between these presheaf models, leaving syntactic matters to research on MTT and MTraS.
The presheaf models are designed to accommodate higher pro-arrow equipments (some of whose operations are to be specified in future work as part of a fibrancy condition), and can be invented in three ways: (1) as a higher-dimensional version of pro-arrow equipments, (2) as a heterogenization of Tamsamani and Simpson's model of higher category theory, and (3) as a directification of Degrees of Relatedness.

I introduce the 2-poset of polarized reshuffles, a variant of which will serve as the mode theory of NatPT, and build two models of MTT instantiated on this mode theory in presheaves called jet-topic and jet-cubical sets.
The base categories are equipped with twisted prism endofunctors on which we can instantiate MTraS to obtain an internal twisted interval in NatPT.

Lacking a formal treatment of fibrancy as of yet, I use informal and necessarily somewhat speculative discourse to evaluate the viability of NatPT and its models as a basis for NatTT.

\section{Introduction}

\subsection{Category Theory in Functional Programming}
Several decades of functional programming practice in simply, polymorphically and dependently typed programming languages has made it abundantly clear that there is virtue in identifying algebraic and categorical structures in program designs, as these abstractions enable code reuse by relying on abstract libraries for algebra and category theory.\todo{Cite something?}

While the design of Haskell, its libraries and tutorials can create the impression that $\Type$, the category of types and functions, is the \emph{only} category we should care about, it is by now clear that this is absolutely not the case.
To only scratch the surface of this fact:
\begin{itemize}
	\item Pure functional programming languages tend to use monads\todo{Footnote about algebraic effects?} as a mathematical device for allowing non-purity \cite{moggi-monads}, where specific monads only allow for specific forms of side-effects.
	\textbf{Monad morphisms} are then effect reinterpretations, explaining the effects allowed by one monad in terms of the effects allowed by another.\todo{Cite?}
	When monads are being combined using monad transformers\todo{Cite!}, then monad morphisms may arise from \textbf{morphisms of monad transformers}.
	When monads (or transformers) are indexed by other structures (e.g.\ the writer monad $\Writer\,W = W \times \loch$, which allows programs to log messages, is indexed by a monoid of messages $W$), then monad morphisms arise from \textbf{morphisms between such structures}.
	
	\item Inductive data types are now understood as initial algebras $\mu F$ of some polynomial functor (a.k.a.\ container functor) $F$ \cite{containers}, i.e.\ $\mu F$ is the initial object in the \textbf{category of $F$-algebras}.
	The data needed to define a function by recursion on inductive data exactly constitutes an $F$-algebra $A$, with the motive being the carrier and each constructor clause being an algebraic operation.
	The function $f : \mu F \to A$ thus defined is the unique algebra morphism from the initial object $\mu F$, while the $\beta$-rules for $\mu F$ exactly ensure that it is indeed an algebra morphism.
	Dually, codata types are final coalgebras.
	
	\item Optics such as lenses and traversals are bidirectional data accessors which can, e.g., read and update fields of record types (lenses) or entries of traversable functors (traversals).\todo{Cite nLab?}
	Optics themselves have identities and can be composed, \textbf{thus forming categories}, but they also have slick parametric encodings called Van Laarhoven optics\todo{Cite VL? Cite Haskell library?} and profunctor optics\todo{Cite some paper? Cite Haskell library?}, correctness of which relies on parametric/natural quantification over \textbf{categories of (pro)functors with extra structure}.
\end{itemize}

\subsection{Propagation and Preservation for Free}
Beyond library support for category theory, three strains of research seek to provide \emph{language} support for (adaptations of) category theory:
directed type theory, parametricity, and homotopy type theory (HoTT).

\subsubsection{Directed Type Theory}
In Directed Type Theory (DirTT) \cite{2dtt,riehl-shulman-dtt,north-dirhott,weaver-licata-dua,dua-simplicial}, all types $A$ are regarded as categories and typically come equipped natively with an indexed type $\Hom_A(a, b)$ of morphisms from $a : A$ to $b : A$.
Very na\"ively, we could hope for these morphisms to be preserved by \emph{all} functions, meaning that all functions would be covariant functors.
However, as anyone who has ever touched category theory knows, there are many interesting operations that are not a functor at all.
For this reason, all systems for DirTT hitherto developed (to my knowledge), feature one or more of the following internal features to escape this unreasonable requirement:
\begin{itemize}
	\item Non-\covarfib{}\footnote{Most related work speaks of \emph{covariant} types instead of \covarfib{} types, but we prefer to reserve the word `covariant' for the covariant modality.} type families, i.e. type families $\Gamma, x : A \sez T \type$ where a morphism $\vfi : \Hom_A(a, b)$ does \emph{not} give rise to a transport function $\vfi_* : T[a/x] \to T[b/x]$.
	\item A non-directed-univalent universe $\uni{}$ of non-\covarfib{} types, where a morphism of types $P : \Hom_{\uni{}}(A, B)$ does not correspond to a function $f : A \to B$ but behaves more like a profunctor or even just a relation between $A$ and $B$ \cite{riehl-shulman-dtt,weaver-licata-dua,dua-simplicial}.
	Thus, functions to $\uni{}$ can preserve native morphisms without being functorial in the sense of producing functions.
	\item Modal annotations on function types, which express whether functions are co- or contravariant, both, or neither \cite{abel-polarized,2dtt,mathesis,north-dirhott,dua-simplicial}.
\end{itemize}

Progress in DirTT has historically been arduous, so that the subject is currently in a much less advanced state than parametricity and HoTT, for several reasons:

\paragraph{Variance}
First, early on in the development of a directed type system, one is typically forced to make a choice on how to deal with variance: one can either use modal annotations on variables in the context and consider only \covarfib{} types with forward transport w.r.t.\ this modal context, or one can consider various forms of fibrancy w.r.t.\ an unnanotated context.
E.g.\ in 1-category theory:
\begin{itemize}
	\item Grothendieck opfibrations (\covarfib{} types) provide forward transport,
	\item Grothendieck fibrations (\contravarfib{} types) provide backward transport,
	\item isofibrations provide only transport along isomorphisms,
	\item bifibrations provide an adjoint pair of tranpsort functions along every morphism.
\end{itemize}
We could of course have both in a single system and prove, e.g., that opfibrations over $\catC$ correspond to fibrations over $\catC\op$,
but most existing work commits to one approach, creating some divergence in the literature on directed type theory.

\paragraph{Dimension stratification}
Secondly, I believe that the advancement of directed type theory has suffered from the idea that `in dependent type theory, types are just terms, and universes are just big types'.
This idea is of course tremendously helpful in sorting out the structure of judgements, contexts and substitutions for dependent type theory, but it is at odds with a central fact in higher category theory, namely that the collection (universe) of $(n, r)$-categories is an $(n+1, r+1)$-category.
We can of course truncate the dimension of this collection so as to contain it in a bigger version of itself, and regard
\begin{itemize}
	\item the universe of $(0, 0)$-categories (i.e.\ sets) as a $(0, 0)$-category, thus cleanly modelling type theory with a universe in sets,
	\item the universe of $(\infty, 0)$-categories (i.e.\ $\infty$-groupoids) as an $(\infty, 0)$-category, as is done in HoTT,
\end{itemize}
or we can try to study the remarkable fixpoint of $(\infty,\infty)$-categories.

In practice, all prior work on directed type theory (as well as the current) has regarded types as either finite-dimensional categories $(n < \infty)$ or as being directed up to a finite dimension $(r < \infty)$,
and while a directed universe of sets (discrete fibrations/types) is seen in several papers \cite{2dtt,riehl-shulman-dtt,weaver-licata-dua,dua-simplicial},
universes with richer structures than the types they classify do not seem to have been explored yet at higher dimensions.
%the full potential and implications of the richer structure of a universe of finite-dimensional categories (when compared to its elements) have not been explored yet.

This has been particularly limiting in modally annotated systems for 1-dimensional categories, where the literature shows a tendency to couple variance of dependent functions and their codomain in a way that seems detrimental to usability.
For example, Licata and Harper \cite{2dtt} only allow the context $\Gamma, \ctxmodnovar{{\oplus}}{x}{A}$ ($\Gamma$ extended with a covariant variable $x$ of type $A$) to be formed when the type $A$ is a \covarfib{} type w.r.t.\ $\Gamma$ (i.e.\ $\Gamma \sez A \type$), whereas the context $\Gamma, \ctxmodnovar{{\ominus}}{x}{A}$ ($x$ is a contravariant variable) can only be formed when $A$ is \acontravarfib{} type w.r.t.\ $\Gamma$ (i.e.\ $\Gamma\op \sez A \type$).
The consequence is that we can only form a \covarfib{} function type $\Gamma \sez (\ctxmodnovar{{\ominus}}{x}{A}) \to B \type$ (dependent or not) of \emph{contravariant} functions, since $A$ needs to be \contravarfib{} for the function type to be \covarfib{}, and then we can only have contravariant variables of type $A$.

Conversely, North \cite{north-dirhott} allows either context only to be formed when $A$ is transportive w.r.t.\ $\Gamma$ (i.e.\ $\Gamma \sez A \type$).
Both model contexts as categories, types as functors to $\Cat$, and extended contexts as Grothendieck constructions, but the contravariantly extended context is modelled differently:
\begin{align*}
	\interp{\Gamma, \ctxmodnovar{{\ominus}}{x}{A}} &= 
	\paren{ \int_{\interp{\Gamma}\op} \interp{A} }\op & \text{\cite{2dtt}}, \\
	\interp{\Gamma, \ctxmodnovar{{\ominus}}{x}{A}} &= \int_{\interp{\Gamma}} \Op \circ \interp{A} & \text{\cite{north-dirhott}},
\end{align*}
i.e.\ Licata and Harper take the opposite of the total space of $A$, whereas North takes the opposite fibrewise.
Neumann \cite{neumann-modal-sogats} provides the maximally configurable context extension that can be modelled as a Grothendieck construction: his context $\Gamma^u \rhd^v x : A^w$ is parametrized by three bits: ($u$) whether or not we take the opposite of the preceding context, ($v$) whether $A$ is \covarfib{} or \contravarfib{} w.r.t.\ $\Gamma^u$, and ($w$) whether or not we take the opposite of $A$ fibrewise.
However, the fact remains that once the Grothendieck construction is formed, we have a single category that we can only take the opposite of as a whole, toggling all three bits at once.

I argue that this is an artefact of disregarding the fact that $\Cat$ is more than just a category.
Indeed, consider the universal directed type family, $X : \Cat \sez X \type$.
Because we already know what the type family is, the bits $u$ and $v$ in Neumann's context extension are coupled: $X$ is \covarfib{} w.r.t. $\Cat$ and \contravarfib{} w.r.t.\ $\Cat\op$.
Still, this leaves us two bits of freedom, whereas after we form the extended context, these can only be toggled together by taking the opposite of the entire thing.
Concretely, the objects of the extended context will be pointed categories, and the morphisms will consist of a functor between the categories and a `heterogeneous arrow' along it, and we have to commit to whether we want these heterogeneous arrows to point the same way as the functor, or the opposite way.
We can call these laxly and oplaxly point-preserving functors.

However, if we were to model contexts as 2-categories and types as 2-functors to $\Cat$, then it becomes clear that the direction of the arrows \emph{within} a fibre of the type $\Gamma \sez T \type$, is coupled to the direction of the 2-cells in $\Gamma$.
Indeed, the 2-functor $\Op : \Cat\co \to \Cat$ is covariant at level 1, but contravariant at level 2, so the fibrewise opposite type $\Gamma\co \sez T\op \type$ is well-typed only in the 2-opposite context.
This reveals that the Grothendieck construction forces us to collapse two things that naturally live at different dimensions.

Rather than choosing along which functors we consider heterogeneous arrows, we can acknowledge that they exist along functors pointing both ways, and indeed along \emph{zigzags} in $\Cat$, i.e. chains of functors pointing alternating ways.
Even more generally, we can consider heterogeneous arrows along profunctors $\catP : \catC \nrightarrow \catD$, i.e.\ functors $\catP : \catC\op \times \catD \to \Set$.
Since both functors $F : \catC \to \catD$ and $G : \catD \to \catC$ produce profunctors $\Hom_\catD(F\loch, \loch), \Hom_\catD(\loch, G\loch) : \catC \nrightarrow \catD$ and profunctors can be composed using the coend, zigzags too produce profunctors.

This encourages us to regard contexts not just as 2-categories but rather as \emph{categories equipped with pro-arrows}, also more briefly called (pro-arrow) equipments, which are double categories with extra structure.
In particular, $\Cat$ is an equipment whose arrows are functors, whose pro-arrows are profunctors, and whose squares are heterogeneous natural transformations, or, equivalently, profunctor morphisms.
We then interpret types $\Gamma \sez T \type$ as equipment functors $\interp T : \interp \Gamma \to \Cat$ and remark that the direction of both homogeneous and heterogeneous \emph{arrows} in $T$ is tied to the direction of pro-arrows in $\Gamma$: indeed, the functor $\Op : \Cat\co \to \Cat$ is covariant on arrows but contravariant on pro-arrows.

A sensible and algebraically relevant semantics for the extended context $\Gamma, \ctxmodnovar \mu x T$ (for a certain modality $\mu$) is now as the pro-arrow equipment of pointed categories, whose:
\begin{itemize}
	\item objects are pointed categories,
	\item morphisms are point-\emph{preserving} functors,
	\item pro-arrows are pointed profunctors (i.e.\ a pro-arrow $(\catP, \psi) : (\catC, c) \nrightarrow (\catD, d)$ is a profunctors $\catP : \catC \nrightarrow \catD$ with a designated heterogeneous morphism $\psi \in \catP(c, d)$),
	\item squares are point-preserving profunctor morphisms.
\end{itemize}
Each time, things are paired up whose orientation was coupled anyway: the direction of the mapping relation ${\mapsto} : \Obj(\cat C) \times \Obj(\catD) \to Set$ of a functor $F : \catC \to \catD$ is inevitably related to the direction of $F$ itself, while the direction of a heterogeneous arrow $\psi \in \catP(c, d)$ along a profunctor $\catP : \catC \nrightarrow \catD$ is also inevitably related to the direction of the $\catP$.
The end result is a new equipment in which arrows and pro-arrows can still independently be flipped.

The modality $\mu$ will be the directed version of the \emph{structural} modality in Degrees of Relatedness \cite{reldtt}, by which algebraic structures depend on their structure (e.g.\ pointed categories on their designated point).

We can generalize the above construction to an arbitrary type $\Gamma \sez T \type$, i.e.\ an arbitrary equipment functor $\interp T : \interp \Gamma \to \Cat$, and call this the \textbf{equipment of elements}.
The Grothendieck construction of a functor $F : \catC \to \Cat$ can be defined in terms of the equipment of elements as follows:
\begin{enumerate}
	\item Freely equip $\catC$ with pro-arrows (which is left adjoint to forgetting that $\Cat$ has pro-arrows) obtaining an equipment functor $\bar F : \name{FPro}\,\catC \to \Cat$,
	\item Take the equipment of elements $\int_{\name{FPro}\,\catC} \bar F$,
	\item Extract its category of pro-arrows,
	\item Restrict to those pro-arrows whose underlying pro-arrow in $\name{FPro}\,\catC$ actually arises from an arrow in $\catC$, which can be done by taking a pullback.
\end{enumerate}

%\todoi{\cite[p.\ 179]{street-cat-limits} defines a lax 2-category of elements $El$ called the 2-category of elements.}

\paragraph{Naturality}
Thirdly\todo{Number correctly}, it has been unclear how to deal with the notion of \emph{naturality} in a type system.
In category theory, naturality is only defined in specific situations, such as, with increasing generality:\footnote{Note that these concepts are flexible w.r.t.\ the number and variance of arguments, as each of the mentioned categories can again be a product of (opposites of) categories, and moreover every functor independently has the right to be constant w.r.t.\ one or more of the arguments.}
\begin{itemize}
	\item natural transformations $\nameforall{nat} x . F\,x \to G\,x$ between functors $F, G : \catC \to \catD$ \cite{nat-equiv},
	\item extranatural transformations $\nameforall{exnat} x, y, z : F\,x\,x\,z \to G\,y\,y\,z$ between functors $F : \cat A \times \cat A\op \times \catC \to \catD$ and $G : \cat B \times \cat B\op \times \catC \to \catD$ \cite{kelly-tensor-extranat},
	\item dinatural transformations $\nameforall{dinat} x.F\,x\,x \to G\,x\,x$ between functors $F, G : \catC \times \catC\op \to \catD$,
\end{itemize}
which can all be defined together as a special case of the end $\nameforall{end} x.T\,x\,x$ of a functor $T : \catC \times \catC\op \to \Set$.
However, natural transformations are a rather restrictive concept, while extranatural and dinatural transformations do not always compose.\footnote{The type signature of an extranatural transformation specifies, besides the domain and codomain functors, a string diagram connecting each argument slot of the domain (codomain) functor to either a slot of opposite variance of the domain (codomain) functor or a slot of the same variance of the codomain (domain) functor. Extranatural transformations can be composed insofar as the composition of their string diagrams does not create closed `bubbles' \cite{extranat-compose}. Petri\'{c} provides a similar criterion for dinatural transformations \cite{g-dinat}, which McCusker and Santamaria independently reprove using Petri-nets \cite{composing-dinatural}.}
This is essentially because, given a morphism $\xi : x \to x'$, dinatural transformations have a different notion of heterogeneous equality in their domain and their codomain: in the domain, elements\footnote{in the internal language sense, i.e.\ morphisms to} of $F\,x\,x$ and $F\,x'\,x'$ are considered equal if they \emph{come from} the same element in $F\,x\,x'$, whereas in the codomain, elements of $G\,x\,x$ and $G\,x'\,x'$ are considered equal if they \emph{yield} the same element in $G\,x'\,x$.
Strong dinatural transformations
\[
	\nameforall{s.dinat} F\,x\,x \to G\,x\,x \qquad \text{between functors $F, G : \catC \times \catC\op \to \catD$}
\]
address this by considering elements of $F\,x\,x$ and $F\,x'\,x'$ equal if they \emph{yield} the same element in $F\,x'\,x$.
However, if we nest contravariance a bit deeper, strong dinaturality too proves inadequate for a general typing discipline: given a functor $F : \catC \times \catC\op \to \catD$, the function
\[
	\name{twice} : \forall x . (F\,x\,x \to F\,x\,x) \to (F\,x\,x \to F\,x\,x) : \vfi \mapsto \name{twice}_x\,\vfi := \vfi \circ \vfi
\]
is \emph{not} strongly dinatural, because the notion of heterogeneous equality used for the domain and the codomain \emph{of the domain} (and of the codomain) is different.

%\begin{example}[Counterexample]
%	Let $\catC = \accol{0 \to 1}$ be the walking arrow and $\catD = \Set$.
%	Consider the diagram below, where each diamond is the image of $F$ and the horizontal arrows are the components of $\vfi$:
%	\[
%		\xymatrix{
%			&
%			\Bool
%				\ar[rd]_\id
%				\ar[rrr]_{\lambda \_.\true}
%			&&&
%			\Bool
%				\ar[rd]_\id
%			\\
%			\Unit
%				\ar[ru]_{\lambda \_.\false}
%				\ar[rd]^{\lambda \_.\false}
%			&&
%			\Bool
%			&
%			\Unit
%				\ar[ru]_{\lambda \_.\false}
%				\ar[rd]^{\lambda \_.\false}
%			&&
%			\Bool
%			\\
%			&
%			\Bool
%				\ar[ru]^\id
%				\ar[rrr]^{\name{not}}
%			&&&
%			\Bool
%				\ar[ru]^\id
%		}
%	\]
%\end{example}

This problem appears to remain unsolved as of yet.
It seems that the only type-theoretically adequate way to define naturality of a (possibly mixed-variant, possibly deeply-nested contravariant) operation $\forall x.T\,x$, is to define heterogeneous equality for $T$ by induction on the construction of $T$, as happens in Reynolds' relational model of parametricity for type theory \cite{reynolds} (\cref{sec:intro:param}), as well as in the general presheaf model of type theory \cite[ch.\ 4]{Hofmann97} (\cref{sec:pshmodel}).
In this paper, I take the viewpoint that the correct generalization of naturality to quantifications over arbitrary mixed-variant types \emph{is} parametricity w.r.t.\ graph `relations' of morphisms.
As such, we will build a system for parametric \emph{and} directed type theory, where all types are natively equipped with notions of relations \emph{and} morphisms, modelled in presheaf categories.

\paragraph{The Hom-type}
A notable focal point of the difficulties related to naturality is the question of how to correctly type and model the identity morphism $\id: \forall(x : A).\Hom_A(x, x)$.
In particular, we would like to understand $\Hom_A$ as an inductive type in three ways: (1) $\Hom_A(a, \loch)$ is the initial functor $F : A \to \Type$ such that $F\,a$ is inhabited; (2) $\Hom_A(\loch, b)$ is the initial functor $G : A\op \to \Type$ such that $G\,b$ is inhabited; and (3) $\Hom_A(\loch, \loch)$ is the initial functor $H : A\op \times A \to \Type$ such that the end $\nameforall{end}(x : A).H\,x\,x$ is inhabited.

Lacking any form of natural quantification for non-groupoidal types and having coupled variance of types and terms, North \cite{north-dirhott} defines a $\Hom$-type with an identity morphism $\id : (x : A\core) \to \Hom_A(x, x)$ that is natural only w.r.t.\ the core of $A$ and eliminates according to properties (1) and (2).
However, this leaves the $\Hom$-type underspecified:
%indeed, if we extend North's system with $\Sigma$-types, then the type
%\[
%	H(a, b) := \Sigma(z : A\core).\Hom_A(a, z) \times \Hom_A(z, b)
%\]
%admits the same constructor, eliminators
indeed, North models it as the semantic $\Hom$-set, but it can alternatively be modelled as the non-isomorphic functor $\interp{A}\op \times \interp{A} \to \Set : (a, b) \mapsto \nameexists{coend}(z : \interp{A}\core).\Hom_{\interp{A}}(a, z) \times \Hom_{\interp{A}}(z, b)$,
which interprets an internal morphism from $a$ to $b$ as a semantic two-step morphism via an intermediate object $z$ that is also stored up to isomorphism.

\todoi{
DirTT less advanced. Several reasons. Freedom in design: variance in fibration (Groth opfib, Groth fib, isofib) or in modalities. Causes research to diverge, although we can reconcile in a system that has both.
Also complications:
\begin{itemize}
	\item What is naturality?
	\item How do we define the Hom-type so that Yoneda is its automatic non-dependent eliminator? Bifibrations, naturality, parametricity. Mention treatment of modal inductive types. Interval
\end{itemize}
}

\subsubsection{Parametricity}\label{sec:intro:param}

\todoi{Old Stuff}

We consider three strains of research that all seek to unburden users of proof assistants: parametricity, homotopy type theory (HoTT), and directed type theory (DirTT).


\todoi{Parametricity}
\todoi{HoTT}
\todoi{Directed TT}
\todoi{Everything has a graph: HoTT $<$ DirTT $<$ parametricity}
\todoi{Computational content: parametricity $<$ HoTT and DirTT}
\todoi{Functoriality: DirTT $<$ HoTT and parametricity}

\todoi{You don't have to give a literature overview of parametricity here}

\subsection{Motivation}

\subsection{Example Problem in Functional Programming}

\subsection{Overview of the Paper}

\section{What is Naturality?}

\section{A Quick Look at Fibrancy (Before Setting It Aside)}
\todoi{Related work on internalizing fibrancy}

\section{Separation of Concerns: A Model-First Approach}

\section{Prerequisites}
\subsection{Models of Type Theory}
\todoi{Discuss GATs}
\todoi{Quick intro of CwFs}
\todoi{Mention natural models}

\subsection{Presheaves and Presheaf Models of Type Theory} \label{sec:pshmodel}
\todoi{Superquick intro to presheaves and their relevance to preservation properties}
\todoi{Justify cubical/simplicial stuff as higher graphs}
\todoi{Quickly review presheaf model of TT}

\subsection{Multimod(e/al) Type Theory (MTT)}
\todoi{Either from transpension paper or based on your slides, or both}

\subsection{Lifting Functors to Presheaf Categories}

\subsection{The Modal Transpension System (MTraS)}

\section{Three Approaches to the Model}

\subsection{Tamsamani \& Simpson's Model of $n$-Categories}

\subsection{Pro-Arrow Equipments}

\subsection{Higher Pro-Arrow Equipments as Heterogenized $n$-Categories}

\subsection{Degrees of Relatedness}

\subsection{Directifying Degrees of Relatedness}

\section{Modes and Base Categories}

\subsection{Modes are Anpolarity Masks}
\todoi{Storeys and degrees}

\subsection{Jet Sets and Jet Setoids}

\subsection{Jet Topes and Jet-Topic Sets}

\subsection{Jet Cubes and Jet-Cubical Sets}

\section{Modalities are Polarized Reshuffles}

\subsection{The 2-Poset of Polarized Reshuffles}

\subsection{Semantics on Jet Sets and Jet Setoids}

\subsection{Semantics on Jet Topes and Jet Cubes}

\subsection{Lifting to Presheaves: Semantics on Jet-Topic and Jet-Cubical Sets}

\section{Pruning the Modes: Paths, Jets and Bridges}

\section{Modalities in Action}

\subsection{The Natural Universe}

\subsection{Functoriality}

\subsection{Limithood and Naturality}

\subsection{Modal Existentials}

\section{Intervals and the Hom-Type}
\todoi{Symmetric and Twisted intervals}
\todoi{Properties of the multipliers and internalization}
\todoi{Extension types?}
\todoi{Arguments for bump: (1) reason about pro-arrows, (2) identity should be natural, not mixed, (3) univalence + bump in universe}
\todoi{Hom-type}
\todoi{Path type (also requires a bump)}
\todoi{Bridge type (does not require a bump)}
\todoi{Relational univalence (a.k.a.\ relativity)}

\section{Evaluation and Outlook: Fibrancy}
\todoi{Admit non-formalness and speculativity again}

\subsection{Recursively 0-discrete Types}
\todoi{0-discrete and locally recursively 0-discrete}

\subsection{Recursively 0-setoidal Types}
\todoi{0-monosetoidal and locally recursively 0-monosetoidal}
\todoi{0-monosetoidal means path = jet = bridge is a setoid structure}
\todoi{Expressible internally: the type $A$ is isomorphic to $\Modifynovar{\nonpol_0^B, \nonpol_0^B, \nonpol_0^B}{A}$}

\subsection{\Covarfib{} Types}
\todoi{directed univalence}
\todoi{DUA UP TO A SECTION IS ENOUGH BECAUSE OF THE BUMP}
\todoi{The function type is \covarfib{} if the domain is \contravarfib{} and the codomain is \covarfib{}. So you can close the universe of \covarfib{} types under function types with 0-op'ed domain.}

\subsection{Example}
\todoi{Altenkirch's example: prove by hom-induction that a natural transformation gives rise to commutative squares.
\begin{itemize}
	\item The only type that has to be \covarfib{} is the identity type expressing that the square commutes.
	\item Your category needs to be locally 0-monosetoidal
\end{itemize}
}

\subsection{Kan Types}
\todoi{What do we know about symmetric jet-cubes?}
\todoi{Does shape substitution commute with transpension? Yes if multiplier is a top-slice right adjoint, see transpension techreport.}
\todoi{Can we just say: the heterogeneous path type is covariant?}
\todoi{Can we just say: the path-localization is Segal?}

\subsection{Segal Types}
\todoi{Can we just say: the heterogeneous Hom-type is \covarfib{}? I.e.\ Segal = locally \covarfib{}?}
\todoi{Open boxes where the walls are determined by a covariant proposition on the floor / contravariant proposition on the ceiling?}

\subsection{Rezk Types}
\todoi{categorical univalence}
\todoi{$\name{cua} \circ \name{dua} = \name{ua}$}
\todoi{Other Rezk-like conditions for different storey-composition}

\subsection{Conduch\'e Types}
\todoi{At least briefly mention the considerworthiness of it.}

\subsection{Contextual Fibrancy}
\todoi{Via information flow modalities, perhaps mention embargoes.}

\section{Known Hazards in Directed Type Theory}
\todoi{
\begin{itemize}
	\item The Conduch\'e issue (but what's the issue again?)
	\item $\catC\op \times \catC$
	\item Mixed-variant $\id$
	\item Coupling of type/term variance
\end{itemize}
}
\todoi{Also discuss somewhere: should path $\to$ jet $\to$ bridge be in the base category? The alternative is to have Kan and Segal open boxes with different dimension flavours on the floor, but this will become extremely complex.}
\todoi{Kock: http://home.math.au.dk/kock/fib9.pdf}

\section{Related Work}
\todoi{Lots of stuff}
\todoi{Paige}
\todoi{Riehl/Shulman}
\todoi{Weaver/Licata}
\todoi{Greta Coraglia}

\section*{Acknowledgements}
\todoi{Acknowledgements}

\appendix

\bibliographystyle{alphaurl}
\bibliography{../refs/refs.bib}

%\appendix
%\section{}
%  Here is a check-list to be completed before submitting the paper to
%  LMCS:
%\begin{itemize}[label=$\triangleright$]
%\item your submission uses the latest version of lmcs.cls
%\item the text of your submission is contained in a single file,
%  except for macros and graphics
%\item your graphics use only one format 
%\item you have employed the Journal's original proclamation environments,
%  or suitable extensions thereof 
%\item you have loaded the hyperref package
%\item you have \emph{not} loaded the times package
%\item you have not routinely adjusted vertical spacing manually by issuing
%  \texttt{\textbackslash vspace} or \texttt{\textbackslash vskip} commands
%\item you have used the command \texttt{\textbackslash sloppy} only
%  locally and in emergency cases
%\item your displayed equations use the
%  \texttt{\textbackslash[\dots\textbackslash]} construct
%\item your abstract only contains as few math-expressions as possible and no
%  references 
%\end{itemize}
%
%  This listing also shows how to override the default bullet $\bullet$
%  of the \texttt{itemize}-envronment by a different symbol, in this
%  case \texttt{\textbackslash triangleright}.
\end{document}
