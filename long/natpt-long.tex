\documentclass[a4paper]{article}

\usepackage{a4wide}

\usepackage{amsthm}
\pdfoutput=1

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{mathrsfs}
\RequirePackage{mathtools}
%\RequirePackage{mathabx}
\RequirePackage{latexsym}
%\RequirePackage{epstopdf}
%\RequirePackage{array}
\RequirePackage{stmaryrd}
\RequirePackage[normalem]{ulem}
%\RequirePackage{xfrac}

%\usepackage{bm}
\usepackage[all,cmtip]{xy}
%\usepackage{mathtools}
%\usepackage{longtable}

%\usepackage{mdframed}
%\let\framedCopy=\framed
%\let\framed=\undefined

\usepackage[hidelinks,bookmarksnumbered]{hyperref}
\RequirePackage{cleveref}

\usepackage{wasysym}
\usepackage{stmaryrd}
%\usepackage[notext]{stix}
\usepackage{fontawesome}
\RequirePackage{amssymb}
\RequirePackage{xcolor}
\usepackage{xypic}
	\CompileMatrices
\RequirePackage{mathtools}
\usepackage{stmaryrd}

\usepackage{libertine}

\usepackage[english]{babel}
%\usepackage[dutch]{babel}

\usepackage{../natpt-macros}

%\newcommand{\todoi}[1]{\textbf{\textcolor{red}{#1 \qed}}\par\noindent}
%\newcommand{\todo}[1]{\textbf{\textcolor{red}{\footnote{\textcolor{red}{#1}}}}}
%\newcommand{\todoi}[1]{}
%\newcommand{\todo}[1]{}

\newcommand{\thetitle}{Naturality Pretype Theory - Extended Version}
\newcommand{\theauthors}{Andreas Nuyts}
\begin{document}
	\addtolength{\voffset}{-.5in}

\title{\thetitle}
%\subtitle{Technical report}
\date{\today}
\author{\theauthors{}}
%\address{imec-DistriNet, KU Leuven, Belgium}
\maketitle
%\vspace*{-.5in}
%\begin{abstract}
%\end{abstract}

\tableofcontents

\pagebreak

\section{Base Categories and Modes}

\subsection{Modes are Anpolarity Masks}
In RelDTT, modes were natural numbers (minus one) expressing the number of available relations.
In NatPT, we will specify for each of these relations whether it is directed or not.
\begin{definition} \label{def:anpolarity}
	An \textbf{anpolarity}\footnote{`An' is Latin for `whether', as in `Nescio an polare sit,' meaning `I do not know whether it is polar'.} is an element of the set $\Anpolarity := \accol{\ypolar, \npolar}$, where $\ypolar$ stands for polar/directed and $\npolar$ stands for nonpolar/symmetric.
	
	An \textbf{anpolarity mask} or just \textbf{mask} is a list $\vec a \in \List\,\Anpolarity$ of anpolarities. We write $\lenpol{\vec a}$ for its length.
\end{definition}

\begin{remark} \todoi{Move this remark}
	We note that it is always possible to restrict our mode theory, by discarding modes but keeping the same modalities and 2-cells between remaining modes.
	We could decide to restrict to any of the following subsets of modes:
	\begin{itemize}
		\item Modes of the form $[\ypolar]^*$, i.e.\ where all degrees are polar,
		\item Modes of the form $([\npolar] | [\npolar, \ypolar])^*$, i.e.\ where we think of a level as containing a path relation and optionally a weaker jet relation,
		\begin{itemize}
			\item Modes of the form $[\npolar, \ypolar]^*$ where the presence of a jet relation at each level is required,
		\end{itemize}
		\item Modes of the form $([\npolar] | [\ypolar, \npolar])^*$, i.e.\ where we think of a level as containing a bridge relation and optionally a stronger jet relation,
		\begin{itemize}
			\item Modes of the form $[\ypolar, \npolar]^*$ where the presence of a jet relation at each level is required,
		\end{itemize}
		\item Modes of the form $([\npolar, \npolar] | [\npolar, \ypolar, \npolar])^*$, i.e.\ where we think of a level as containing a path relation and a weaker bridge relation and optionally, in between, a jet relation,
		\begin{itemize}
			\item Modes of the form $[\npolar, \ypolar, \npolar]^*$ where the presence of a jet relation at each level is required.
		\end{itemize}
	\end{itemize}
	We will occasionally discuss these subtheories. By considering all of $\List\,\Anpolarity$ in the current paper, we maintain generality.
\end{remark}

\subsection{Jet Sets}
\begin{definition} \label{def:jetset}
	Let $\vec a$ be a mask. An \textbf{$\vec a$-jet-set} is a set $X$ equipped with $\lenpol{\vec a}$ (proof-irrelevant%
	\footnote{So these relations are functions $X \to X \to \Prop$ where $\Prop$ is a universe of $h$-propositions \cite{hottbook}. In most applications, these relations will be decidable, but we do not require this.}%
	) relations $\jet_i$ where
	\begin{itemize}
		\item $0 \leq i < \lenpol{\vec a}$ is called the \textbf{degree},
		\item $\jet_i$ is called the \textbf{$i$-jet relation},
		\item its opposite $\tej_i$ is called the \textbf{opposite $i$-jet relation},
	\end{itemize}
	such that
	\begin{itemize}
		\item when $a_i = \npolar$, then $\jet_i$ is symmetric, in which case we will denote it as $\edge_i$ and call it the \textbf{$i$-edge relation} (notwithstanding that we still consider it a special case of a jet relation),
		\item $x \jet_i y$ implies both $x \jet_{i+1} y$ and $x \tej_{i+1} y$ whenever $0 \leq i < i+1 < \lenpol{\vec a}$.
	\end{itemize}
	A \textbf{morphism} of $\vec a$-jet-sets is a function that preserves all the jet and edge relations.
	
	The category of $\vec a$-jet-sets is called $\jetset{\vec a}$.
	
	A jet set is called \textbf{transitive} if each of the $i$-jet relations is transitive (i.e. a pre-order and, if $i = \npolar$, an equivalence relation).
\end{definition}
\begin{proposition} \label{thm:jetset-equipment}
	Let $X$ be a transitive $\vec a$-jet-set and $0 \leq i < j < \lenpol{\vec a}$.
	Then the double category whose objects are elements of $X$, morphisms are (unique) proofs of $x \jet_i y$, pro-arrows are (unique) proofs of $x \jet_{j} y$ and squares are elements of the unit type, is a pro-arrow equipment \cite{nlab:proarrow,proarrow1,proarrow2}\todo{Refer to dedicated section instead.}.
\end{proposition}
\begin{proof}
	It is clearly a double category. The existence of companions and conjoints is trivial.
\end{proof}
\begin{definition}
	We define the
	\begin{itemize}
		\item \textbf{$i$-equijet relation} $\equijet_i$ as the symmetric interior of $\jet_i$, i.e.\ $x \equijet_i y$ if and only if $x \jet_i y$ and $x \tej_i y$;
		\item \textbf{$i$-infrajet relation} $\infrajet_i$ as the symmetric closure of $\jet_i$, i.e.\ $x \equijet_i y$ if and only if $x \jet_i y$ or $x \tej_i y$.
	\end{itemize}
\end{definition}
It is immediately clear that for nonpolar degrees, the jet/edge, equijet and infrajet relations coincide.
In general, we can observe that $x \infrajet_i y$ implies $x \equijet_j y$ for $i < j$.
So for mode $[\ypolar, \ypolar, \npolar]$, we get
\[
\xymatrix{
	& 
	\jet_0
		\ar@{:>}[rd]
	&&& 
	\jet_1 
		\ar@{:>}[rd]
	&&& 
	\jet_2 
		\ar@{<:>}[rd]
	\\
	\equijet_0
		\ar@{:>}[ru]
		\ar@{:>}[rd]
	&&
	\infrajet_0
		\ar@{:>}[r]
	&
	\equijet_1
		\ar@{:>}[ru]
		\ar@{:>}[rd]
	&&
	\infrajet_1
		\ar@{:>}[r]
	&
	\equijet_2
		\ar@{<:>}[ru]
		\ar@{<:>}[rd]
	&
	\edge_2
		\ar@{<:>}[l]
		\ar@{<:>}[u]
		\ar@{<:>}[r]
		\ar@{<:>}[d]
	&
	\infrajet_2.
	\\
	& 
	\tej_0 
		\ar@{:>}[ru]
	&&& 
	\tej_1 
		\ar@{:>}[ru]
	&&& 
	\tej_2 
		\ar@{<:>}[ru]
}
\]

\begin{definition} \label{def:op}
	Let $\vec a$ be a mask, $i < \lenpol{\vec a}$ and $X \in \Obj(\jetset{\vec a})$.
	We define the \textbf{$i$-opposite $\Op_i(X)$ of $X$} as the jet set with the same carrier and relations as $X$ except that the $i$-jet relation is reversed: $x \jet_i^{\Op_i(X)} y$ if and only if $x \tej_i^X y$.
	This defines a functor $\Op_i(X) : \jetset{\vec a} \to \jetset{\vec a}$.
\end{definition}
We have $\Op_i \circ \Op_i = \Id$ and if $a_i = \npolar$ then $\Op_i = \Id$.
\begin{definition} \label{def:sym-forget}
	Write $\vec a \sqsubset_i \vec b$ if $\lenpol{\vec a} = \lenpol{\vec b}$, $a_j = b_j$ for all $j \neq i$, $a_i = \npolar$ and $b_i = \ypolar$.
	
	If $\vec a \sqsubset_i \vec b$, then we write $\Usym_i : \jetset{\vec a} \to \jetset{\vec b}$ for the forgetful functor.
\end{definition}
\begin{corollary} \label{def:sym-free} \label{def:sym-cofree}
	The forgetful functor $\Usym_i$ as part of an adjoint triple $\Fsym_i \dashv \Usym_i \dashv \Csym_i$ where $\Fsym_i$ and $\Csym_i$ take a $\vec b$-jet-set $X$ to a $\vec a$-jet-set of the same carrier with the same $j$-jet relations for $j \neq i$ but where
	\begin{itemize}
		\item $x \edge_i^{\Fsym_i X} y$ if and only if $x \infrajet_i^X y$,
		\item $x \edge_i^{\Csym_i X} y$ if and only if $x \equijet_i^X y$.
	\end{itemize}
	We have $\Fsym_i \circ \Usym_i = \Csym_i \circ \Usym_i = \Id$, so that $\UFsym_i := \Usym_i \circ \Fsym_i$ is an idempotent monad and $\UCsym_i := \Usym_i \circ \Csym_i$ is an idempotent comonad.
\end{corollary}
\begin{definition} \label{def:sym-closure-of-sym}
	We extend the definition of $\UFsym_i$ and $\UCsym_i$ to endofunctors on $\jetset{\vec b}$ where $b_i$ can be \emph{any} anpolarity:
	\begin{itemize}
		\item If $b_i = \ypolar$ then they are defined as above,
		\item If $b_i = \npolar$ then they are defined as the identity functor.
	\end{itemize}
	Either way, they are an idempotent (co)monad and we have $\UFsym_i \dashv \UCsym_i$.
\end{definition}

\subsection{Intervals and Prisms}
\begin{definition} \label{def:interval}
	Let $\vec a$ be a mask and $i < \lenpol{\vec a}$.
	\begin{itemize}
		\item The \textbf{$i$-jet interval} $\rival{\jet_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \jet_i 1$.
		\item The \textbf{opposite $i$-jet interval} $\rival{\jet_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \tej_i 1$.
		\item The \textbf{$i$-equijet interval} $\rival{\equijet_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \equijet_i 1$.
	\end{itemize}
	If $a_i = \npolar$ then $\rival{\jet_i} = \rival{\tej_i} = \rival{\equijet_i} =: \rival{\edge_i}$ is called the \textbf{$i$-edge interval}.
\end{definition}
Note that it would be meaningless to define an $i$-infrajet interval in the same way.

\begin{definition} \label{def:prism}
	Let $\vec a$ be a mask, $i < \lenpol{\vec a}$ and $X \in \Obj(\jetset{\vec a})$.
	We define the \textbf{$i$-twisted-prism $X \multip \rival{\jet_i}$} on $X$ as the $\vec a$-jet-set with
	\begin{itemize}
		\item carrier $X \times \accol{0, 1}$,
		\item jet relations generated by the following requirements:
		\begin{itemize}
			\item $(\loch, 0) : \Op_i(X) \to X \multip \rival{\jet_i}$ is a jet set morphism,
			\item $(\loch, 1) : X \to X \multip \rival{\jet_i}$ is a jet set morphism,
			\item $(x, 0) \jet_i (x, 1)$ for all $x \in X$.
		\end{itemize}
	\end{itemize}
	This defines the \textbf{$i$-twisted-prism functor} $\loch \multip \rival{\jet_i} : \jetset{\vec a} \to \jetset{\vec a}$.
	
	We define the \textbf{opposite $i$-twisted-prism $X \multip \rival{\tej_i}$} on $X$ as the jet set of mask $\vec a$ with
	\begin{itemize}
		\item carrier $X \times \accol{0, 1}$,
		\item jet relations generated by the following requirements:
		\begin{itemize}
			\item $(\loch, 0) : X \to X \multip \rival{\tej_i}$ is a jet set morphism,
			\item $(\loch, 1) : \Op_i(X) \to X \multip \rival{\tej_i}$ is a jet set morphism,
			\item $(x, 0) \tej_i (x, 1)$ for all $x \in X$.
		\end{itemize}
	\end{itemize}
	This defines the \textbf{opposite $i$-twisted-prism functor} $\loch \multip \rival{\jet_i} : \jetset{\vec a} \to \jetset{\vec a}$.
	
	If $a_i = \npolar$, then we call this simply the \textbf{$i$-prism functor $\loch \multip \rival{\edge_i}$.}
\end{definition}
Note that in both instances, we take the opposite at the source-side of the jet interval by which we multiply. This makes it unclear how a prism functor for the equijet interval $\rival{\equijet_i}$ should look like.
%\todoi{Should there be a prism functor for $\rival{\equijet_i}$? It would only be well-defined on symmetric jet sets, the category of which is $\jetset{\vec a'}$ where $a'_i = \npolar$, so it is derived from $\loch \multip \rival{\edge_i}$ and the forgetful functor $U^\npolar_i$.}
\begin{corollary} \label{thm:twisted-prism-op}
	We have $\loch \multip \rival{\tej_i} = \Op_i(\loch \multip \rival{\jet_i})$. \qed
\end{corollary}
\begin{corollary} \label{thm:commute}
	Let $F_i$ be a functor between jet set categories of any of the following forms: $\Op_i$, $\Fsym_i$, $\Usym_i$, $\Csym_i$, $\loch \multip \rival{\jet_i}$, $\loch \multip \rival{\tej_i}$, $\loch \multip \rival{\edge_i}$.
	Let $G_j$ be a functor between jet set categories also of one of these forms, but for a different degree $j$.
	Then $F_i$ and $G_j$ commute, i.e.\ there is a natural isomorphism $F_i G_j \cong G_j F_i$. \qed
\end{corollary}

\subsection{Intermezzo: Cube Categories} \label{sec:cubes}
We introduce a family of cube categories with one flavour of dimension. Fix a monad $M$ on $\Set$.
\begin{example} \label{ex:cube-monads}
	Typically $M$ will be one of the following:
	\begin{itemize}
		\item The `exception' monad $\bipointed$ that sends a set $X$ to $X \uplus \accol{0,1}$, which is the carrier of the free bipointed set over $X$;
		\item The monad $\bipointedsym$ that sends a set $X$ to $X \uplus \set{\lnot x}{x \in X} \uplus \accol{0, 1}$, which is the carrier of the free [bipointed set equipped with an involution $\lnot$ that swaps $0$ and $1$] over $X$;
		\item The monad $\distlattice$ that sends a set $X$ to the carrier of the free distributive lattice over $X$;
		\item The monad $\demorgan$ that sends a set $X$ to the carrier of the free de Morgan algebra over $X$;
		\item The monad $\booleanalg$ that sends a set $X$ to the carrier of the free boolean algebra over $X$.
	\end{itemize}
\end{example}

\subsubsection{Cartesian Cubes}
\begin{definition}
	We construct the \textbf{(named) category of cartesian $M$-cubes} $\cubecat^\cartes_M$ (and $\namedcubecat^\cartes_M$ resp.) stepwise:
	\begin{itemize}
		\item The Kleisli category $\Kleisli(M)$ of $M$ has objects $\inKleisli{X}$ where $X$ is a set, and its morphisms $\inKleisli f : \inKleisli X \to \inKleisli Y$ are functions $f : X \to MY$.
		\item Of this, we take the opposite $\Kleisli(M)\op$. (This is the Lawvere theory corresponding to the monad $M$.)
		\item We define $\namedcubecat^\cartes_M$ as the full subcategory of $\Kleisli(M)\op$ on finite sets.
		\item We define $\cubecat^\cartes_M$ as a designate skeleton of $\namedcubecat_M$, e.g.\ the full subcategory of $\namedcubecat^\cartes_M$ on sets of the form $\accol{0, \ldots, n-1}$ with $n \geq 0$.
	\end{itemize}
\end{definition}
Objects of $\namedcubecat^\cartes_M$ will be denoted as tuples of names $(\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX)$ where $\IX$ is meaningless but conveys the intuition that we regard $\dm{i}_k$ as a value ranging over the interval (the cube given by the singleton object).
A morphism $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$ is then a function sending each $\dm{j}_k$ to an expression $\dm{j}_k \psub{\vfi} \in M\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$.
The morphism $\vfi$ will also be denoted as $(\dm{j}_0 \psub \vfi / \dm{j}_0, \ldots, \dm{j}_{m-1} \psub \vfi / \dm{j}_{m-1})$.
The situation in $\cubecat^\cartes_M$ is the same except that we now regard the names $\dm{i}_k$ as De Bruijn indices.

\begin{corollary}
The categories $\cubecat^\cartes_M$ and $\namedcubecat^\cartes_M$ have finite products, given by finite coproducts of sets. \qed
\end{corollary}

\subsubsection{Affine Cubes}
If $T$ is a \emph{container} monad \cite{container-combinatorics}, i.e. a monad whose underlying functor is a container functor \cite{containers} of the form $TX = \Sigma(s : S).(P(s) \to X)$, then we define $T^\# X$ as the set of \emph{affine} expressions $\Sigma(s : S).(P(s) \hookrightarrow X)$, which is an endofunctor on the category $\Set^{\hookrightarrow}$ of sets and injective functions.
If $M$ is merely a \emph{quotient} of a container monad, i.e. $M$ is of the form $MX = TX/\sim_X$ with $T$ as above, then we define $M^\# X$ as the set of equivalence classes with an affine representant.

\begin{remark}
An important source of monads such as $M$ are monads specified by a syntactic algebraic theory \cite{manes-book,adamek-book,keml-diagrams}.
A syntactic algebraic theory specifies a set of operations $S_0$, assigns to each operation $s : S_0$ an arity $P_0(s)$ which is again a set, and subjects these to a set of axioms.%
\footnote{We use `syntactic algebraic theory' to refer to the syntactic presentation as described here, and `monad' and `Lawvere theory' to refer to the less syntactic objects they specify.
%There seems to be disagreement on the terminology.
%Syntactic algebraic theories (a.k.a. presentations of algebraic theories \cite{manes-book,keml-diagrams}) give rise to a monad and a Lawvere category (a.k.a. Lawvere theory or algebraic theory \cite{manes-book}).
%Depending on your definition of a Lawvere theory, the monadic presentation and the Lawvere theory may be interderivable; in turn, they give rise to a category of algebras.
%Neither of these two steps reflects equivalence, so we truly have three different notions, and there is disagreement which one the term `algebraic theory' refers to \cite{adamek-book}.
%
%Different syntactic algebraic theories may have the same category of models, in which case they are called \emph{Morita equivalent} \cite[ch.\ 15]{adamek-book}. We can thus distinguish algebraic theories by their syntactic presentation or consider them up to Morita equivalence. We will use \emph{syntactic algebraic theory} in the former case and \emph{monadic/Lawverian algebraic theory} in the latter case. Some authors insist on the usage of the word `presentation' for the former case \cite{manes-book}, or call the latter case `algebraic categories' \cite{adamek-book}, while the term `algebraic theories' seems to be in use for either case.
}
The container $(S_0, P_0)$ specifies a container functor $FX = \Sigma(s : S_0).(P_0(s) \to X)$ on $\Set$.
A free monad $F^*$ over this functor $F$ exists and satisfies the fixpoint equation $F^* X \cong X \uplus F F^* X$.
We remark that the free monad $F^*$ over a container functor $F$ is again a container functor, i.e.\ there exists a container $(S, P)$ such that
$F^* X = \Sigma(s : S).(P(s) \to X)$
specifies the free monad over $F$.
The axioms determine an equivalence relation $\sim_X$ on $F^* X$ such that $M X := F^* X/\sim_X$ is again a monad.
This situation applies to each of the monads in \cref{ex:cube-monads}.

In fact, often the quotient can be taken already at the level of the container, so that there exists a container $(S', P')$ such that $MX \cong \Sigma(s : S').(P'(s) \to X)$.
\end{remark}

We say that $(s, f), (s', f') \in T^\# X$ are \textbf{mutually fresh}, denoted $(s, f) \freshbin (s', f')$, if $f(P(s))$ and $f'(P(s'))$ are disjoint.
Elements of $M^\# X$ are mutually fresh if they have mutually fresh representants.
We call the monad $(T, \eta, \mu)$ \textbf{affine} if $\eta_X : X \to TX$ lands in $T^\# X$ for all $X$ and $\mu_X : TTX \to TX$ restricted to $(TT)^\# X$ (note that container functors are closed under composition) lands in $T^\# X$; and similar for $M$.

\begin{definition}
Let $M$ be a quotient of a container monad, and let it be affine.
We construct the \textbf{(named) category of affine $M$-cubes $\cubecat_M^\affine$} (and $\namedcubecat_M^\affine$ resp.) stepwise:
\begin{itemize}
	\item The affine Kleisli category $\Kleisli^\#(M)$ has objects $\inKleisli{X}$ where $X$ is a set, and its morphisms $\inKleisli f : \inKleisli X \to \inKleisli Y$ are functions $f : X \to M^\#Y$ such that for any $x \neq x'$ in $X$, we have $f(x) \freshbin f(x')$.
	Identity and composition are well-defined because $M$ is affine.
	\item Of this, we take the opposite $\Kleisli^\#(M)\op$.
	\item We define $\namedcubecat_M^\affine$ as the full subcategory of $\Kleisli^\#(M)\op$ on finite sets.
	\item We define $\cubecat_M^\affine$ as a designate skeleton of $\namedcubecat^\affine_M$, e.g.\ the full subcategory of $\namedcubecat^\affine_M$ on sets of the form $\accol{0, \ldots, n-1}$ with $n \geq 0$.
\end{itemize}
\end{definition}
Objects will be represented as for the cartesian cube categories.

\begin{corollary}
The categories $\cubecat^\affine_M$ and $\namedcubecat^\affine_M$ have a symmetric monoidal structure $(\top, {*})$ given by finite coproducts of sets. The binary operation is called the \textbf{separating product}. \qed
\end{corollary}

\subsubsection{Examples}
This way, we get -- among others -- the following cube categories:
\begin{enumerate}
	\item[$\cubecat^\cartes_{\bipointed}$] The cartesian cube category.
	A morphism $\vfi : V \to W$ sends every dimension $\dm{j} \in W$ to $\dm{j} \psub \vfi \in V \cup \accol{0, 1}$.
	Its cubes have diagonals.
	\item[$\cubecat^\affine_{\bipointed}$] The affine cube category.
	A morphism $\vfi : V \to W$ sends every dimension $\dm{j} \in W$ to $\dm{j} \psub \vfi \in V \cup \accol{0, 1}$, such that if $\dm{j}\psub \vfi = \dm{j}' \psub \vfi \in V$ then $\dm{j} = \dm{j}'$.
	Its cubes have no diagonals.
	\item[$\cubecat^\cartes_{\bipointedsym}$] The symmetric cartesian cube category. We have a negation/involution/symmetry $(\lnot \dm{i} / \dm{j}) : (\dm i : \IX) \to (\dm{j} : \IX)$.
	\item[$\cubecat^\cartes_{\distlattice}$] The cartesian cube category with connections. We have morphisms $(\dm i \vee \dm{j} / \dm k), (\dm i \wedge \dm{j} / \dm k) : (\dm i : \IX, \dm{j} : \IX) \to (\dm k : \IX)$. There are no symmetries
	\item[$\cubecat^\cartes_{\demorgan}$] The CCHM cube category, which combines symmetries and connections \cite{cubical}. We have $(\dm i \wedge \lnot \dm i / \dm j) \neq (0/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$ and $(\dm i \vee \lnot \dm i / \dm j) \neq (1/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$.
	\item[$\cubecat^\cartes_{\booleanalg}$] A cube category very similar to the CCHM one, but we have $(\dm i \wedge \lnot \dm i / \dm j) = (0/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$ and $(\dm i \vee \lnot \dm i / \dm j) = (1/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$.
\end{enumerate}
We remark that $\cubecat^\affine_{\demorgan}$ and $\cubecat^\affine_{\booleanalg}$ should be isomorphic as the additional law of boolean algebras w.r.t.\ de Morgan algebras only affects non-affine expressions.

\subsubsection{The Endpoint Model}
We remarked above that $\catL := \Kleisli(M)\op$ is the Lawvere category of $M$.
It is known then (see e.g.\ \cite{keml-diagrams}), that the Eilenberg-Moore category of $M$ (which is the category of Eilenberg-Moore algebras of $M$) is equivalent to the category of product-preserving functors $\catL \to \Set$.
Such functors are fully determined by the image of the singleton set (as every set is a coproduct of singletons and the Kleisli-category retains coproducts) and that image will be exactly the carrier of the corresponding Eilenberg-Moore algebra.

It is clear that both the cartesian and affine (named) cube categories are subcategories of $\catL$.
As such, any $M$-algebra induces a functor $\catL \to \Set$ and hence a functor from any of the $M$-cube categories to $\Set$.

We are interested, in particular, in $M$-algebra structures on the set of endpoints $\accol{0, 1}$.
Each of the monads in \cref{ex:cube-monads} has an obvious such algebra structure.
Thus, we get functors from each of the corresponding cube categories to $\Set$,
sending $(\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX)$ to $\accol{0, 1}^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}}$.
We will denote each of those functors as $\EP$.

Recall that a morphism $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$ assigns to each $\dm j$ a value $\dm j\psub \vfi$ in $M \accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$, the free $M$-algebra over $\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$.
The function $\EP(\vfi)$ is defined by
\[
	\EP(\vfi)
	\paren{ v^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}} \to \accol{0, 1}} }
	(\dm j)
	= \alpha\paren{ M(v)(\dm j \psub \vfi) },
\]
where $\alpha : M\accol{0, 1} \to \accol{0, 1}$ is the algebra structure on $\accol{0, 1}$.
Using the operation $\bindop^\alpha : MX \to (X \to \accol{0, 1}) \to \accol{0, 1} : \hat x \mapsto f \mapsto \alpha (Mf(\hat x))$, we can write this as $\EP(\vfi)(v)(\dm j) = \dm j \psub \vfi \bindop^\alpha v$.

\begin{proposition}
	The functor $\EP : \cubecat_\booleanalg \to \Set$ is fully faithful.
\end{proposition}
\begin{proof}
	We need to show that any function $f : \accol{0, 1}^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}} \to \accol{0, 1}^{\accol{\dm{j}_0, \ldots, \dm{j}_{m-1}}}$
	can be obtained as some $\EP(\vfi)$ with $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$.
	We remark that such a function $f$ in fact consists of $m$ truth tables in $n$ boolean variables.
	From the full disjunctive normal form, it is clear that elements of the free boolean algebra are in 1-1 correspondence with truth tables.
	Concretely, for each $\dm j$, define $\dm j \psub \vfi$ to be the element of $\booleanalg \accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$ corresponding to the truth table $f(\loch, \dm j)$.
	Then $\dm j \psub \vfi \bindop^\alpha v$ will evaluate $\dm j \psub \vfi$ after replacing each variable $\dm i$ with its value $v(\dm i)$, yielding the value $f(v, \dm j)$ prescribed by the truth table $f(\loch, \dm j)$.
\end{proof}

\subsection{Jet Cubes}

\subsubsection{Jet Cube Objects}
\begin{definition} \label{def:jet-cube}
	Let $\vec a$ be a mask.
	We define the set of \textbf{(forward) $\vec{a}$-jet-cubes} as the set of lists of degrees $0 \leq i < \lenpol{\vec a}$, but we denote them as
	$(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\jet_{i_{n-1}}})$, thinking of the names $\dm{i}_k$ as De Bruijn indices.
	If $a_i = \npolar$, we write $\rival{\edge_i}$ instead of $\rival{\jet_i}$.
	
%	More generally, we define the set of \textbf{opposable jet cubes of mask $\vec a$} as the set of lists of elements of $\set{\jet_i, \tej_i}{a_i = \ypolar} \cup \set{\edge_i}{a_i = \npolar}$, but we denote them as
%	$(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\tej_{i_{n-1}}})$.
%	If $a_i = \npolar$, we use the symbols $\rival{\jet_i}$, $\rival{\tej_i}$ and $\rival{\edge_i}$ interchangeably.
	
	More generally, we define the set of \textbf{trioriented $\vec a$-jet-cubes} as the set of lists of elements of \linebreak $\set{\jet_i, \tej_i, \equijet_i}{0 \leq i < \lenpol{\vec a}}$, where we identify ${\jet_i} = {\tej_i} = {\equijet_i} =: {\edge_i}$ if $a_i = \npolar$, and where $\jet_i$ and $\tej_i$ cannot occur to the left of $\equijet_i$ if $a_i = \ypolar$.
	We denote them e.g.\ as $(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\tej_{i_{n-1}}})$.
\end{definition}
\begin{definition} \label{def:sym-forget-cube}
	Let $\vec a \sqsubset \vec b$. For any trioriented $\vec a$-jet-cube $W$, we define the trioriented $\vec b$-jet-cube $\Usymcube_i W$ by replacing every occurrence of $\edge_i$ with $\equijet_i$.
\end{definition}
Note that a $\vec b$-jet-cube is uniquely in the image of $\Usymcube_i$ if it does not feature the symbols $\jet_i$ and $\tej_i$.
\begin{definition} \label{def:jep}
	For any (forward/trioriented) $\vec a$-jet-cube $W$, we define the $\vec a$-jet-set $\JEP(W)$ as follows:
	\[ \begin{array}{l c l l}
		\JEP(()) &=& \top, \\
		\JEP(W, \dm i : \rival{\jet_i}) &=& \JEP(W) \multip \rival{\jet_i}, \\
		\JEP(W, \dm i : \rival{\tej_i}) &=& \JEP(W) \multip \rival{\tej_i}, \\
		\JEP(W, \dm i : \rival{\edge_i}) &=& \JEP(W) \multip \rival{\edge_i}, \\
		\JEP(W, \dm i : \rival{\equijet_i}) &=& \Usym_i \, \JEP\paren{(\Usymcube_i)\inv(W, \dm i : \rival{\equijet_i})}
		& \text{if $a_i = \ypolar$} \\
		&=& \Usym_i \, \JEP\paren{(\Usymcube_i)\inv(W), \dm i : \rival{\edge_i}} \\
		&=& \Usym_i\paren{\JEP\paren{(\Usymcube_i)\inv(W)} \multip \rival{\edge_i}}.
	\end{array} \]
\end{definition}
\begin{definition} \label{def:jet-cube-erasure}
	We define the \textbf{jet-erasure function} $\erasejc{\loch}$, which sends (forward/trioriented) jet cubes of any mask to cubes (i.e. objects of any of the cube categories defined in \cref{sec:cubes}), by
	\[
		\erasejc{()} = (),
		\qquad
		\erasejc{(W, \dm i : \rival{\jet_i})} =
		\erasejc{(W, \dm i : \rival{\tej_i})} =
		\erasejc{(W, \dm i : \rival{\equijet_i})} =
		\erasejc{(W, \dm i : \rival{\edge_i})} =
		(\erasejc{W}, i : \IX).
	\]
\end{definition}
\begin{corollary} \label{thm:jet-cube-pullback}
	For any (forward/trioriented) jet cube $W$, the carrier of $\JEP(W)$ is $\EP(\erasejc{W})$.
	Thus, every (forward/trioriented) jet cube determines an object of the following strict pullback of categories:
	\[
			\xymatrix{
				\cubecat^\eps_M \times_\Set \jetset{\vec a}
					\ar@{.>}[rr]^{\JEP}
					\ar@{.>}[d]_{\erasejc{\loch}}
					\xydrcorner
				&&
				\jetset{\vec a}
					\ar[d]^U
				\\
				\cubecat^\eps_M
					\ar[rr]_{\EP}
				&&
				\Set,
			}
	\]
	It is straightforward to see that the function thus obtained is injective. \qed
\end{corollary}

\subsubsection{Jet Cube Categories}
\begin{definition} \label{def:jet-cube-cat}
	Let $\vec a$ be a mask, $\eps \in \accol{\affine, \cartes}$ and $M$ a monad on $\Set$.
	We define
	the category $\jetcubeopt{\eps}{M}{\vec a}$ of \textbf{forward $\vec a$-jet-$M$-cubes} and
	the category $\trijetcubeopt{\eps}{M}{\vec a}$ of \textbf{trioriented forward $\vec a$-jet-$M$-cubes}
	as the full subcategory of $\cubecat^\eps_M \times_\Set \jetset{\vec a}$ on (forward/opposable) jet cubes, as justified by \cref{thm:jet-cube-pullback}.
\end{definition}
\begin{proposition} \label{thm:lift-to-jet-cubes}
	The functors $\Fsym_i$, $\loch \multip \rival{\jet_i}$ and $\loch \multip \rival{\edge_i}$ lift to both forward and trioriented jet-$M$-cube categories.
	The functors $\Op_i$, $\Usym_i$ and $\loch \multip \rival{\tej_i}$ lift to trioriented jet-$M$-cube categories.
	We denote the resulting functors as $\Fsymcube_i$, $\loch \multip (\dm i : \rival{\jet_i})$, $\loch \multip (\dm i : \rival{\edge_i})$, $\Opcube_i$, $\Usymcube_i$ and $\loch \multip (\dm i : \rival{\tej_i})$, where each time $\dm i$ represents a bound De Bruijn index.
	We have $\Fsymcube_i \dashv \Usymcube_i$ and thus an idempotent monad $\UFsymcube_i := \Usymcube_i \circ \Fsymcube_i$, whose definition we extend to masks $\vec b$ where $b_i = \npolar$ as in \cref{def:sym-closure-of-sym}.
\end{proposition}
\begin{proof}
	The functors $\Fsym_i$, $\Op_i$ and $\Usym_i$ have no effect on the carrier, so they certainly lift to $\cubecat_M^\eps$, hence to the pullback $\cubecat_M^\eps \times_\Set \jetset{\vec a}$.
	\begin{itemize}
		\item $\Fsym_i$ lifts to (forward/trioriented) jet cubes by replacing every occurrence of $\jet_i$, $\tej_i$ or $\equijet_i$ with $\edge_i$.
		\item $\Op_i$ lifts to trioriented jet cubes by reversing the \emph{last} occurrence of either $\jet_i$ or $\tej_i$ (\cref{thm:twisted-prism-op}).
		\item $\Usym_i$ lifts to jet cubes as the operation $\Usymcube_i$ already introduced in \cref{def:sym-forget-cube}.
	\end{itemize}
	To prove $\Fsymcube \dashv \Usymcube$, we need to build unit and co-unit natural transformations.
	Since the categories of forward/trioriented jet cubes are fully faithful subcategories of the pullback $\cubecat_M^\eps \times_\Set \jetset{\vec a}$, it suffices to build them there.
	They were already established in $\jetset{\vec a}$ by \cref{def:sym-free,def:sym-cofree}.
	As they reduce to the identity unit and co-unit of $\Id \dashv \Id$ for the carriers, they trivially lift to $\cubecat_M^\eps$.
	
	The various prism functors multiply the carrier with $\accol{0, 1}$ and thus lift over $\EP$ to the affine/cartesian cube category by multiplying with $(\dm i : \IX)$.
	Hence, they also lift to the pullback $\cubecat_M^\eps \times_\Set \jetset{\vec a}$.
	Each of them lifts to trioriented jet cubes, and the twisted prism functor also to forward jet cubes, by appending the symbol concerned.
\end{proof}
%\begin{definition} \label{def:prism-cube}
%	Let $\vec a$ be a mask, $\eps \in \accol{\affine, \cartes}$ and $i < \lenpol{\vec a}$. We define the \textbf{$i$-twisted-prism functor $\loch \multip (\dm i : \rival{\jet_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$} on jet cubes as follows:\footnote{We still think of $\dm i$ as a De Bruijn index.}
%	\begin{itemize}
%		\item The object $W$ is sent to $(W, \dm i : \rival{\jet_i})$.
%		\item The morphism $\vfi : V \to W$ is sent to the morphism $\vfi \multip (\dm i : \rival{\jet_i})$ such that
%		\begin{itemize}
%			\item If $\eps = \affine$ then $\erasejc{\vfi \multip (\dm i : \rival{\jet_i})} = \erasejc \vfi * (\dm i : \IX)$,
%			\item If $\eps = \cartes$ then $\erasejc{\vfi \multip (\dm i : \rival{\jet_i})} = \erasejc \vfi \times (\dm i : \IX)$,
%			\item $\JEP(\vfi \multip (\dm i : \rival{\jet_i})) = \JEP(\vfi) \multip \rival{\jet_i}$.
%		\end{itemize}
%	\end{itemize}
%	If $a_i = \npolar$, then we call this simply the \textbf{$i$-prism functor} $\loch \multip (\dm i : \rival{\edge_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$.
%	
%	We similarly define, on opposable jet cubes:
%	\begin{itemize}
%		\item the $i$-twisted-prism functor $\loch \multip (\dm i : \rival{\jet_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$ when $a_i = \ypolar$,
%		\item the opposite $i$-twisted-prism functor $\loch \multip (\dm i : \rival{\tej_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$ when $a_i = \ypolar$,
%		\item the $i$-prism functor $\loch \multip (\dm i : \rival{\edge_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$ when $a_i = \npolar$.
%	\end{itemize}
%\end{definition}
\begin{proposition} \label{thm:cube-commute}
	Any two functors on jet cubes concerned in \cref{thm:lift-to-jet-cubes}, instantiated on different degrees, commute.
	In other words, the natural transformation given in \cref{thm:commute} lifts to (forward/trioriented) jet cubes when the associated functors lift.
\end{proposition}
\begin{proof}
	Since the categories of forward/trioriented jet cubes are fully faithful subcategories of the pullback $\cubecat_M^\eps \times_\Set \jetset{\vec a}$, it suffices to prove the natural isomorphism there.
	The isomorphism was already established in $\jetset{\vec a}$ by \cref{thm:commute}, and the effect on the carrier is either nothing (when at most one prism functor is involved) or swapping components (when both functors are prism functors).
	These isomorphisms lift to $\cubecat_M^\eps$.
\end{proof}

\subsubsection{A Calculus of Trioriented Jet Cube Morphisms}
In this section, we develop a calculus that inductively generates the morphisms of the category $\trijetcubeopt{\eps}{M}{\vec a}$ and therefore also those of its full subcategory $\jetcubeopt{\eps}{M}{\vec a}$.

Since the forgetful functor $U : \jetset{\vec a} \to \Set$ is faithful, so is $\erasejc \loch : \trijetcubeopt{\eps}{M}{\vec a}$.
As such, we can regard `being a morphism of (forward/trioriented) jet cubes' as a proof-irrelevant property of morphisms of cubes, which we will therefore use as preterms.
Our calculus will therefore feature a single judgement $\vfi : V \to W$ meaning that the morphism $\vfi : \erasejc V \to \erasejc W$ is in fact a morphism of jet cubes.
Soundness of the calculus will be the property that the judgement's meaning actually holds when the judgement is derivable, whereas completeness means that the judgement is derivable when its meaning is true.
We do not have to bother with an equational theory, as we can simply inherit it from $\cubecat_M^\eps$.

\begin{convention} \label{conv:sort-cubes}
	When presenting the calculus, with permission from \cref{thm:cube-commute}, we will order the dimensions of a (forward/trioriented) jet cube by \emph{decreasing} degree.
\end{convention}
\begin{remark}
	We will only consider the monads $\bipointedsym$ and $\booleanalg$ because:
	\begin{itemize}
		\item We need involutions in order to be able to work with the source-side of the twisted prism,
		\item We do not see any advantage of $\demorgan$ over $\booleanalg$. In particular, we want $\EP$ to be faithful.
	\end{itemize}
\end{remark}
\begin{figure} \label{fig:calculus}
	\[
		\inferencel{zero:fwd}{
			\sez \vfi : V \to \Opcube_i(W)
		}{
			\sez (\vfi, 0/\dm i) : V \to (W, i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{one:bck}{
			\sez \vfi : V \to \Opcube_i(W)
		}{
			\sez (\vfi, 1/\dm i) : V \to (W, i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{one:fwd}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, 1/\dm i) : V \to (W, i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{zero:bck}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, 0/\dm i) : V \to (W, i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{inv:fwd}{
			\sez (\vfi, t) : V \to (W, i : \rival{\tej_i})
		}{
			\sez (\vfi, \lnot t/\dm i) : V \to (W, i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{inv:bck}{
			\sez (\vfi, t) : V \to (W, i : \rival{\jet_i})
		}{
			\sez (\vfi, \lnot t/\dm i) : V \to (W, i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{prism:fwd}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, \dm i / \dm i) : (V, \dm i : \rival{\jet_i}) \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{prism:bck}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, \dm i / \dm i) : (V, \dm i : \rival{\tej_i}) \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{symmetrize}{
			\sez \vfi : \Fsymcube_i V \to W
		}{
			\sez \vfi : V \to \Usymcube_i W
		}{}
	\]
	\[
		\inferencel{companion:fwd}{
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{companion:bck}{
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\tej_j}, V) \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{conjoint:fwd}{
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\tej_j}, V) \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{conjoint:bck}{
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{conj:fwd}{
			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})
			\\
			\dom(\vfi) = \UFsymcube_i V
		}{
			\sez (\vfi, s \wedge t/\dm k) : V \to (W, \dm k : \rival{\jet_i})
		}{$\booleanalg$}
		\qquad
		\inferencel{disj:bck}{
			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\tej_i}, \dm j : \rival{\tej_i})
			\\
			\dom(\vfi) = \UFsymcube_i V
		}{
			\sez (\vfi, s \vee t/\dm k) : V \to (W, \dm k : \rival{\tej_i})
		}{$\booleanalg$}
	\]
	\[
		\inferencel{disj:fwd}{
			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\tej_i}, \dm j : \rival{\jet_i})
			\\
			\dom(\vfi) = \UFsymcube_i V
		}{
			\sez (\vfi, s \vee t/\dm k) : V \to (W, \dm k : \rival{\jet_i})
		}{$\booleanalg$}
	\qquad
		\inferencel{conj:bck}{
			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\jet_i}, \dm j : \rival{\tej_i})
			\\
			\dom(\vfi) = \UFsymcube_i V
		}{
			\sez (\vfi, s \wedge t/\dm k) : V \to (W, \dm k : \rival{\tej_i})
		}{$\booleanalg$}
	\]
	\[
		\inferencel{truth-table}{
			a_i = \npolar
			\qquad
			\vec t[x_1, \ldots, x_n] \in (\booleanalg \accol{x_1, \ldots, x_n})^m
			\\
			\phantom{a_i = \npolar}
			\qquad
			\text{$\vec t : \accol{0, 1}^n \to \accol{0, 1}^m$ is non-expansive w.r.t.\ $\lVert \ldots \rVert_1$}
			\\
			\sez (\vfi, s_1/\dm i_1, \ldots, s_n/\dm i_n) : V \to (W, \dm i_1 : \rival{\edge_i}, \ldots, \dm i_n : \rival{\edge_i})
		}{
			\sez (\vfi, t_1[s_1, \ldots, s_n] / \dm j_1, \ldots, t_m[s_1, \ldots, s_n]) / \dm j_m) : V \to (W, \dm j_1 : \rival{\edge_i}, \ldots, \dm j_m : \rival{\edge_i})
		}{$\booleanalg$, $\cartes$}
	\]
	\caption{A calculus of trioriented jet cube morphisms}
\end{figure}
\begin{definition} \label{def:calculus}
	For $M \in \accol{\bipointedsym, \booleanalg}$, $\eps \in \accol{\affine, \cartes}$, any mask $\vec a$ and for any two objects $V, W \in \Obj(\jetcubeopt M \eps {\vec a})$, we define a proof-irrelevant predicate on morphisms $\vfi : \erasejc V \to \erasejc W$, denoted $\sez \vfi : V \to W$, inductively generated by the inference rules in \cref{fig:calculus} subject to \cref{conv:sort-cubes}.
\end{definition}
We discuss these inference rules one by one.
We can substitute the last variable with an endpoint. If this end point is at the last dimension's source side, then the rest of the morphism lands in the $i$-opposite of $W$ (\ruleref{zero:fwd}, \ruleref{one:bck}), otherwise it lands in $W$ itself (\ruleref{one:fwd}, \ruleref{zero:bck}).

We can apply an involution to the last variable, provided that we turn around its direction (\ruleref{inv:fwd}, \ruleref{inv:bck}). Doing so means that the source-side is mapped to the source-side and the target-side is mapped to the target-side, so $W$ remains unaffected.

We can apply the (opposite) $i$-twisted prism functor to a morphism (\ruleref{prism:fwd}, \ruleref{prism:bck}).

If the last dimension of our target cube is of the form $\dm i : \rival{\equijet_i}$, then we know that our cube is in the image of $\Usymcube_i$, and we can proceed using the adjunction $\Fsymcube_i \dashv \Usymcube_i$ (\ruleref{symmetrize}).
This turns our last dimension into $\dm i : \rival{\edge_i}$ which is a special case of both $\dm i : \rival{\jet_i}$ and $\dm i : \rival{\tej_i}$, so we can proceed by using the \textsc{fwd} and \textsc{bck} rules of the calculus.

We can substitute the last variable with an expression of a weaker (higher) degree in either direction.
Inspired by \cref{thm:jetset-equipment}, we choose to use terminology from pro-arrow equipments and refer to this action as creating a companion when the direction of the arrow remains the same (\ruleref{companion:fwd}, \ruleref{companion:bck}), and a conjoint when it reverses (\ruleref{conjoint:fwd}, \ruleref{conjoint:bck}).
Some measures of caution need to be taken however, which we consider in the case of \ruleref{companion:fwd}, where we wish to derive $(\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\jet_i})$.
First of all, regardless of whether $\eps = \affine$ or $\eps = \cartes$, we note that $\JEP$ realizes cubes by applying twisted prism functors to jet sets, and these twisted prism functors do not generate diagonals (\cref{def:prism}). Thus, we need to make sure that $\vfi$ does not use the variable $\dm j$, so we will have $\vfi : (\erasejc{U}, \erasejc{V}) \to \erasejc{W}$.
Now let us look at what happens when we set $\dm i$ and $\dm j$ to $0$ or to $1$:
\[
	\xymatrix{
		(\Opcube_j(U), V)
			\ar[d]_{(0/\dm j)}
			\ar@{.>}[rr]^\vfi
		&&
		\Opcube_i(W)
			\ar[d]^{(0/\dm i)}
		\\
		(U, \dm j : \rival{\jet_j}, V)
			\ar[rr]_{(\vfi, \dm j / \dm i)}
		&& (W, \dm i : \rival{\jet_i})
		\\
		(U, V)
			\ar[u]^{(1/\dm j)}
			\ar@{.>}[rr]_\vfi
		&&
		W
			\ar[u]_{(1/\dm i)}
	}
\]
So $\vfi$ needs to be both a morphism of jet cubes from $(U, V)$ to $W$ and from $(\Opcube_j(U), V)$ to $\Opcube_i(W)$ or equivalently from $\Opcube_i(\Opcube_j(U), V)$ to $W$. This can be achieved by asking that $\vfi$ starts from $\UFsym_i(\UFsym_j(U), V)$, which can be thought of as a join of $(U, V)$ and $\Opcube_i(\Opcube_j(U), V)$.

The last five rules involve conjunction and disjunction (together called connections) and only apply if $M = \booleanalg$, as $\bipointedsym$ does not provide these operations.
For rules allow us to substitute the last variable with a connection.
The directions of the arrows in \ruleref{conj:fwd} and \ruleref{disj:fwd} can be understood by simply drawing jet squares and their images:
\[
	\xymatrix{
		& {\mathclap{(\dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})}}
		\\
		(0/\dm i, 0/\dm j)
			\ar[rr]
			\ar@{<-}[d]
		&&
		(1/\dm i, 0/\dm j)
			\ar[d]
		\\
		(0/\dm i, 1/\dm j)
			\ar[rr]
		& \ar@{|=>}[d]^{(\dm i \wedge \dm j / \dm k)} &
		(1/\dm i, 1/\dm j)
		\\
		(0/\dm k)
			\ar@{=}[rr]
			\ar@{=}[d]
		&&
		(0/\dm k)
			\ar[d]
		\\
		(0/\dm k)
			\ar[rr]
		&&
		(1/\dm k)
	}
	\qquad \qquad
	\xymatrix{
		& {\mathclap{(\dm i : \rival{\tej_i}, \dm j : \rival{\jet_i})}}
		\\
		(0/\dm i, 0/\dm j)
			\ar[rr]
			\ar[d]
		&&
		(1/\dm i, 0/\dm j)
			\ar@{<-}[d]
		\\
		(0/\dm i, 1/\dm j)
			\ar[rr]
		& \ar@{|=>}[d]^{(\dm i \vee \dm j / \dm k)} &
		(1/\dm i, 1/\dm j)
		\\
		(0/\dm k)
			\ar[rr]
			\ar[d]
		&&
		(1/\dm k)
			\ar@{=}[d]
		\\
		(1/\dm k)
			\ar@{=}[rr]
		&&
		(1/\dm k)
	}
\]
The rules \ruleref{disj:bck} and \ruleref{conj:bck} then follow by conjugating with the involution.
Again, caution is required.
For example, in \ruleref{conj:fwd}, assume that $s = \dm i$ and $t = \dm j$ and consider what happens when we substitute $\dm i$ and $\dm j$ in \ruleref{conj:fwd} with different combinations that yield $0/\dm k$:
\[
	\xymatrix{
		\Opcube_i(U)
			\ar@/_/[dd]_{(0/\dm i, 1/\dm j)}
			\ar@/^/[dd]^{(1/\dm i, 0/\dm j)}
			\ar@{.>}[rr]^\vfi
		&& \Opcube_i(W)
			\ar[dd]^{(0/\dm k)}
		\\
		& U
			\ar[ld]|{(0/\dm i, 0/\dm j)}
			\ar@{.>}[ru]^\vfi
		\\
		(U, \dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})
		\ar[rr]_{(\vfi, \dm i \wedge \dm j / \dm k)}
		&&
		(W, \dm k : \rival{\jet_i})
	}
\]
Again, we see that $\vfi : \erasejc U \to \erasejc W$ needs to be a morphism of jet cubes both from $\Opcube_i(U) \to \Opcube_i(W)$ (or equivalently from $U \to W$) and from $U \to \Opcube_i(W)$ (or equivalently from $\Opcube_i(U) \to W$). Again, we let $\vfi$ depart from their join $\UFsymcube_i(U)$.
The cube $\erasejc U$ arose as the part of $\erasejc V$ not used by $s$ and $t$, so in the typing rule we can simply use $\UFsymcube_i(V)$ (this will be formalized in \todo{Refer to soundness and completeness theorems}).

Finally, at symmetric degrees, if we have connections and a cartesian cube category, then there are truth tables that produce valid morphisms $\JEP(V) \to \JEP(W)$ but that cannot be derived by our calculus so far due to its affine discipline, such as the `exclusive or' operation
\[
	((\dm i \vee \dm j) \wedge \lnot(\dm i \wedge \dm j)/\dm k) : (\dm i : \rival{\edge_i}, \dm j : \rival{\edge_i}) \to (\dm k : \rival{\edge_i}).
\]
To fix this, we just throw in all truth tables that actually amount to a graph morphism between the corresponding hypercubes, which can alternatively be phrased as being non-expansive with respect to the $\ell^1$-norm.

\begin{theorem}[Soundness]
	If a morphism $\vfi : \erasejc V \to \erasejc W$ satisfies the predicate $\sez \vfi : V \to W$ from \cref{def:calculus}, then it actually arises as the image $\vfi = \erasejc{\hat \vfi}$ of a morphism $\hat \vfi : V \to W$.
\end{theorem}
\begin{proof}
	\todoi{Prove}
\end{proof}

\begin{theorem}[Completeness]
	For any morphism $\vfi : V \to W$ in $\jetcube \eps M {\vec a}$, we have $\sez \erasejc \vfi : V \to W$.
\end{theorem}
\begin{proof}
	\todoi{Prove}
\end{proof}

\todoi{Use $\jetcubeaff{\booleanalg}{\vec a}$ or $\jetcubecart{\booleanalg}{\vec a}$}

\subsection{Jet Cubes Old}
\todoi{This is all wrong: there is no symmetry, no degradation and no connections/companions/conjoints.}

\begin{corollary} \label{thm:jet-cube-op}
	If $W$ is a jet cube, then $\Op_i(W)$ is isomorphic (in $\jetset{\vec a}$) to a jet cube $\Opcube_i(W)$.
	We have $\Opcube_i \circ \Opcube_i = \Id$.
	\todoi{Do we use this? I guess later on to characterize.}
\end{corollary}
In fact, it happens to be the case that $\Opcube_i(W) = W$, but we will avoid to use this fact as the isomorphism $\Op_i(W) \cong \Opcube_i(W) = W$ is not the identity on objects.
\begin{proof}
	We define recursively:
	\begin{itemize}
		\item $\Opcube_i(\top) := \top = \Op_i(\top)$,
		\item $\Opcube_i(W \multip \rival{\jet_i}) := W \multip \rival{\jet_i} \cong \Op_i(W \multip \rival{\jet_i})$ (by swapping 0 and 1),
		\item $\Opcube_i(W \multip \rival{\jet_j}) := \Opcube_i(W) \multip \rival{\jet_j} \cong \Op_i(W) \multip \rival{\jet_j} = \Op_i(W \multip \rival{\jet_j})$ if $i \neq j$. \qedhere
	\end{itemize}
\end{proof}

\begin{definition} \label{def:jet-cube-cat}
	Let $\vec a$ be a mask.
	We define the category $\jetcube{\vec a}$ of \textbf{jet cubes of mask $\vec a$} as the proof-relevant sub\emph{graph} (a priori; it will be a category after \cref{thm:jet-cube-cat}) of $\jetset{\vec a}$ whose nodes are the jet cubes, and whose edges are generated by:
	\begin{itemize}
		\item $(\vfi, 0) : \Hom_{\jetcube{\vec a}}(V, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, \Opcube_i(W))$,
		\item $(\vfi, 1) : \Hom_{\jetcube{\vec a}}(V, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, W)$,
		\item $\vfi \multip \rival{\jet_i} : \Hom_{\jetcube{\vec a}}(V \multip \rival{\jet_i}, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, W)$,
		\item $() : \Hom_{\jetcube{\vec a}}(V, \top)$.
	\end{itemize}
\end{definition}
Again, every jet cube morphism can be generated by the above steps in only a single way, so we can reason about them inductively.
\begin{corollary} \label{thm:jet-cube-op-ftr}
	Each $\Opcube_i$ extends to a well-defined graph endomorphism (and hence, after \cref{thm:jet-cube-cat}, an endofunctor) on $\jetcube{\vec a}$.
	We have $\Opcube_i \circ \Opcube_i = \Id$.
\end{corollary}
\begin{proof}
	We define recursively:
	\begin{itemize}
		\item $\Opcube_i(\vfi, 0 \in \rival{\jet_i}) := (\Opcube_i(\vfi), 1)$,
		\item $\Opcube_i(\vfi, 0 \in \rival{\jet_j}) := (\Opcube_i(\vfi), 0)$ if $i \neq j$,
		\item $\Opcube_i(\vfi, 1 \in \rival{\jet_i}) := (\Opcube_i(\vfi), 0)$,
		\item $\Opcube_i(\vfi, 1 \in \rival{\jet_j}) := (\Opcube_i(\vfi), 1)$ if $i \neq j$,
		\item $\Opcube_i(\vfi \multip \rival{\jet_i}) = \vfi \multip \rival{\jet_i}$,
		\item $\Opcube_i(\vfi \multip \rival{\jet_j}) = \Opcube_i(\vfi) \multip \rival{\jet_j}$ if $i \neq j$,
		\item $\Opcube_i(()) = ()$. \qedhere
	\end{itemize}
\end{proof}
\begin{corollary} \label{thm:jet-cube-cat}
	$\jetcube{\vec a}$ is a category.
\end{corollary}
\begin{proof}
	Identity and composition can be defined recursively; category laws proven inductively.
\end{proof}

\subsection{Comparison to Pinyo and Kraus's Twisted Cube Category}
\todoi{Conjecture: $\jetcubeaff{\bipointedsym}{[\ypolar]}$ is the twisted cube category \cite{pinyo-twisted}. Symmetries zijn nodig om aan 0-kant te embedden. Moogt ook cartesians pakken, want hebt toch geen diagonalen.}
\todoi{Compare to all the different cube categories they have, I think I have them all included.}
In this section, we discuss how our approach reduces to Pinyo and Kraus's \cite{pinyo-twisted} when $\vec a = [\ypolar]$.
$\jetset{[\ypolar]}$ is the category of proof-irrelevant reflexive graphs.
Pinyo and Kraus use arbitrary proof-irrelevant graphs, but since $\top$ is reflexive and the twisted prism functor \cite[def.\ 4]{pinyo-twisted} restricts to reflexive graphs, all twisted cubes are reflexive graphs anyway.
\todoi{Continue}


Out of the category of jet sets, we will carve the category of jet cubes, in such a way that the category of jet cubes of mask $[\ypolar]$ is isomorphic to the twisted cube category \cite{pinyo-twisted}.


\bibliographystyle{alphaurl}
\bibliography{../refs/refs.bib}

\end{document}