\documentclass[a4paper]{memoir}
	\setsecnumdepth{subsubsection}
	%\renewcommand{\thechapter}{\Roman{chapter}}
	%\setlength\cftchapternumwidth{3em}
	\renewcommand{\thesubsubsection}{\arabic{chapter}.\arabic{section}.\arabic{subsection} (\alph{subsubsection})}

\usepackage{a4wide}

\usepackage{amsthm}
\pdfoutput=1

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{mathrsfs}
\RequirePackage{mathtools}
%\RequirePackage{mathabx}
\RequirePackage{latexsym}
%\RequirePackage{epstopdf}
%\RequirePackage{array}
\RequirePackage{stmaryrd}
\RequirePackage[normalem]{ulem}
%\RequirePackage{xfrac}
\RequirePackage{soul}
	\sethlcolor{lightgray}
	
\usepackage{enumitem}
	\setlist{noitemsep}

%\usepackage{bm}
\usepackage[all,cmtip]{xy}
%\usepackage{mathtools}
%\usepackage{longtable}

%\usepackage{mdframed}
%\let\framedCopy=\framed
%\let\framed=\undefined

\usepackage[hidelinks,bookmarksnumbered,bookmarksdepth=subsubsection]{hyperref}
	\setcounter{tocdepth}{3}
\RequirePackage{cleveref}

\usepackage{wasysym}
\usepackage{stmaryrd}
%\usepackage[notext]{stix}
\usepackage{fontawesome}
\RequirePackage{amssymb}
\RequirePackage[dvipsnames]{xcolor}
\usepackage{xypic}
	\CompileMatrices
\RequirePackage{mathtools}
\usepackage{stmaryrd}

\usepackage{libertine}

\usepackage[english]{babel}
%\usepackage[dutch]{babel}

\usepackage{../natpt-macros}
	\renewcommand{\thetheorem}{\arabic{chapter}.\arabic{section}.\arabic{subsection}\textdegree\arabic{theorem}}

%\newcommand{\todoi}[1]{\textbf{\textcolor{red}{#1 \qed}}\par\noindent}
%\newcommand{\todo}[1]{\textbf{\textcolor{red}{\footnote{\textcolor{red}{#1}}}}}
%\newcommand{\todoi}[1]{}
%\newcommand{\todo}[1]{}

\newcommand{\thetitle}{Naturality Pretype Theory - Extended Version}
\newcommand{\theauthors}{Andreas Nuyts}
\begin{document}
	\addtolength{\voffset}{-.5in}

\title{\thetitle}
%\subtitle{Technical report}
\date{\today}
\author{\theauthors{}}
%\address{imec-DistriNet, KU Leuven, Belgium}
\maketitle
%\vspace*{-.5in}
%\begin{abstract}
%\end{abstract}

\pagebreak

\tableofcontents

\pagebreak

\chapter{Base Categories and Modes}

In this chapter, we establish the object part of the mode theory for naturality pretype theory and its model.
Modes will be \textbf{anpolarity masks} $\vec a$ (\cref{sec:mask}) which will be modelled in presheaf categories over certain base categories.
We propose two families of base categories, parametrized by the mask $\vec a$, and both are built using the category $\jetset{\vec a}$ of \textbf{jet sets} over $\vec a$ (\cref{sec:jetset}).

The more complex but better behaved family of base categories are categories of \textbf{jet cubes} $\jetcubefwd \mycubex M {\vec a}$ (\cref{sec:jetcubes}).
While we can get a grasp on jet cubes by characterizing their morphisms using a calculus (\cref{sec:jetcubes:calculus}), this calculus is relatively complex and its soundness and completeness proofs are even more complex.

For these reasons, we alternatively propose to use categories of \textbf{jet jewels} $\jetjewel{\vec a}$ (\cref{sec:jetjewel}). These are full subcategories of $\jetset{\vec a}$ on objects that satisfy certain somewhat arbitrary well-behavedness criteria.
The main purpose of the categories of jet jewels is to be workable for most basic purposes without being as complex as the categories of jet cubes.

Upon a first lecture, readers may choose to omit \cref{sec:jetcubes} on jet cubes.

\todoi{I momentarily had some doubt about usability of jet jewels, but I think it's okay.
The calculus and its soundness proof are used mainly for modalities interacting with the interval. But these will not be used intensively in the NatPT paper itself.}

\section{Anpolarity Masks} \label{sec:mask}
In RelDTT, modes were natural numbers (minus one) expressing the number of available relations.
In NatPT, we will specify for each of these relations whether it is directed or not.
\begin{definition} \label{def:anpolarity}
	An \textbf{anpolarity}\footnote{`An' is Latin for `whether', as in `Nescio an polare sit,' meaning `I do not know whether it is polar'.} is an element of the set $\Anpolarity := \accol{\ypolar, \npolar}$, where $\ypolar$ stands for polar/directed and $\npolar$ stands for nonpolar/symmetric.
	We equip $\Anpolarity$ with the partial order $\npolar \sqsubseteq \ypolar$, corresponding to the intuition that symmetric relations are a subset of directed (i.e.\ potentially asymmetric) relations.
	
	An \textbf{anpolarity mask} or just \textbf{mask} is a list $\vec a \in \List\,\Anpolarity$ of anpolarities. We write $\lenpol{\vec a}$ for its length, and call the numbers $0, \ldots, \lenpol{\vec a} - 1$ \textbf{degrees}.
	We define $\sqsubseteq$ on masks of equal length pointwise.
	
	Both for anpolarities and for masks of equal length, we denote meets (infima) with $\sqcap$ and joins (suprema) with $\sqcup$.
\end{definition}

\section{Jet Sets} \label{sec:jetset}
\subsection{Definitions} \label{sec:jetset:def}
\begin{definition} \label{def:jetset}
	Let $\vec a$ be a mask. An \textbf{$\vec a$-jet-set} is a set $X$ equipped with $\lenpol{\vec a}$ (proof-irrelevant%
	\footnote{So these relations are functions $X \to X \to \Prop$ where $\Prop$ is a universe of $h$-propositions \cite{hottbook}. In most applications, these relations will be decidable, but we do not require this.}%
	) reflexive relations $\jet_i$ where
	\begin{itemize}
		\item $0 \leq i < \lenpol{\vec a}$ is called the \textbf{degree},
		\item $\jet_i$ is called the \textbf{$i$-jet relation},
		\item its opposite $\tej_i$ is called the \textbf{opposite $i$-jet relation},
	\end{itemize}
	such that
	\begin{itemize}
		\item when $a_i = \npolar$, then $\jet_i$ is symmetric, in which case we will denote it as $\edge_i$ and call it the \textbf{$i$-edge relation} (notwithstanding that we still consider it a special case of a jet relation),
		\item $x \jet_i y$ implies both $x \jet_{i+1} y$ and $x \tej_{i+1} y$ whenever $0 \leq i < i+1 < \lenpol{\vec a}$.
	\end{itemize}
	A \textbf{morphism} of $\vec a$-jet-sets is a function that preserves all the jet and edge relations.
	
	The category of $\vec a$-jet-sets is called $\jetset{\vec a}$.
\end{definition}
\begin{definition} \label{def:full-jetsethom}
	A jet set morphism is called \textbf{full} if it reflects all jet relations.
\end{definition}
\begin{definition} \label{def:jet-surjective}
	A jet set morphism $f : X \to Y$ is called \textbf{jet-surjective} if it is surjective as a function, and moreover for any $\vec y \jet_j \vec y'$ in $Y$, there exist $\vec x \jet_j \vec x'$ in $X$ such that $f(\vec x) = \vec y$ and $f(\vec x') = \vec y'$. 
\end{definition}
\begin{definition} \label{def:transitive-jetset}
	A jet set is called \textbf{transitive} if each of the $i$-jet relations is transitive (i.e. a pre-order and, if $i = \npolar$, an equivalence relation).
\end{definition}
The following proposition will not really be used directly, but is a nice encouragement:
\begin{proposition} \label{thm:jetset-equipment}
	Let $X$ be a transitive $\vec a$-jet-set and $0 \leq i < j < \lenpol{\vec a}$.
	Then the double category whose objects are elements of $X$, morphisms are (unique) proofs of $x \jet_i y$, pro-arrows are (unique) proofs of $x \jet_{j} y$ and squares are elements of the unit type, is a pro-arrow equipment \cite{nlab:proarrow,proarrow1,proarrow2}.
	%\todo{Refer to dedicated section instead.}
\end{proposition}
\begin{proof}
	It is clearly a double category. The existence of companions and conjoints is trivial.
\end{proof}
\begin{definition}
	We define the
	\begin{itemize}
		\item \textbf{$i$-equijet relation} $\equijet_i$ as the symmetric interior of $\jet_i$, i.e.\ $x \equijet_i y$ if and only if $x \jet_i y$ and $x \tej_i y$;
		\item \textbf{$i$-infrajet relation} $\infrajet_i$ as the symmetric closure of $\jet_i$, i.e.\ $x \infrajet_i y$ if and only if $x \jet_i y$ or $x \tej_i y$.
	\end{itemize}
\end{definition}
It is immediately clear that for nonpolar degrees, the jet/edge, equijet and infrajet relations coincide.
In general, we can observe that $x \infrajet_i y$ implies $x \equijet_j y$ for $i < j$.
So for mode $[\ypolar, \ypolar, \npolar]$, we get
\[
\xymatrix{
	& 
	\jet_0
		\ar@{:>}[rd]
	&&& 
	\jet_1 
		\ar@{:>}[rd]
	&&& 
	\jet_2 
		\ar@{<:>}[rd]
	\\
	\equijet_0
		\ar@{:>}[ru]
		\ar@{:>}[rd]
	&&
	\infrajet_0
		\ar@{:>}[r]
	&
	\equijet_1
		\ar@{:>}[ru]
		\ar@{:>}[rd]
	&&
	\infrajet_1
		\ar@{:>}[r]
	&
	\equijet_2
		\ar@{<:>}[ru]
		\ar@{<:>}[rd]
	&
	\edge_2
		\ar@{<:>}[l]
		\ar@{<:>}[u]
		\ar@{<:>}[r]
		\ar@{<:>}[d]
	&
	\infrajet_2.
	\\
	& 
	\tej_0 
		\ar@{:>}[ru]
	&&& 
	\tej_1 
		\ar@{:>}[ru]
	&&& 
	\tej_2 
		\ar@{<:>}[ru]
}
\]

\begin{definition} \label{def:op}
	Let $\vec a$ be a mask, $i < \lenpol{\vec a}$ and $X \in \Obj(\jetset{\vec a})$.
	We define the \textbf{$i$-opposite $\Op_i(X)$ of $X$} as the jet set with the same carrier and relations as $X$ except that the $i$-jet relation is reversed: $x \jet_i^{\Op_i(X)} y$ if and only if $x \tej_i^X y$.
	This defines a functor $\Op_i(X) : \jetset{\vec a} \to \jetset{\vec a}$.
\end{definition}
We have $\Op_i \circ \Op_i = \Id$ and if $a_i = \npolar$ then $\Op_i = \Id$.
\begin{definition} \label{def:sym-forget}
	Write $\vec a \sqsubset_i \vec b$ if $\lenpol{\vec a} = \lenpol{\vec b}$, $a_j = b_j$ for all $j \neq i$, $a_i = \npolar$ and $b_i = \ypolar$.
	
	If $\vec a \sqsubset_i \vec b$, then we write $\Usym_i : \jetset{\vec a} \to \jetset{\vec b}$ for the forgetful functor which forgets the symmetry of $\jet_i$.
\end{definition}
\begin{corollary} \label{def:sym-free} \label{def:sym-cofree}
	The forgetful functor $\Usym_i$ is part of an adjoint triple $\Fsym_i \dashv \Usym_i \dashv \Csym_i$ where $\Fsym_i$ and $\Csym_i$ take a $\vec b$-jet-set $X$ to a $\vec a$-jet-set of the same carrier with the same $j$-jet relations for $j \neq i$ but where
	\begin{itemize}
		\item $x \edge_i^{\Fsym_i X} y$ if and only if $x \infrajet_i^X y$,
		\item $x \edge_i^{\Csym_i X} y$ if and only if $x \equijet_i^X y$.
	\end{itemize}
	We have $\Fsym_i \circ \Usym_i = \Csym_i \circ \Usym_i = \Id$, so that $\UFsym_i := \Usym_i \circ \Fsym_i$ is an idempotent monad and $\UCsym_i := \Usym_i \circ \Csym_i$ is an idempotent comonad.
\end{corollary}
\begin{definition} \label{def:sym-closure-of-sym}
	We extend the definition of $\UFsym_i$ and $\UCsym_i$ to endofunctors on $\jetset{\vec b}$ where $b_i$ can be \emph{any} anpolarity:
	\begin{itemize}
		\item If $b_i = \ypolar$ then they are defined as above,
		\item If $b_i = \npolar$ then they are defined as the identity functor.
	\end{itemize}
	Either way, they are an idempotent (co)monad and we have $\UFsym_i \dashv \UCsym_i$.
\end{definition}

\subsection{Intervals and Prisms}
\begin{definition} \label{def:interval}
	Let $\vec a$ be a mask and $i < \lenpol{\vec a}$.
	\begin{itemize}
		\item The \textbf{$i$-jet interval} $\rival{\jet_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \jet_i 1$.
		\item The \textbf{opposite $i$-jet interval} $\rival{\tej_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \tej_i 1$.
		\item The \textbf{$i$-equijet interval} $\rival{\equijet_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \equijet_i 1$.
	\end{itemize}
	If $a_i = \npolar$ then $\rival{\jet_i} = \rival{\tej_i} = \rival{\equijet_i} =: \rival{\edge_i}$ is called the \textbf{$i$-edge interval}.
\end{definition}
Note that it would be meaningless to define an $i$-infrajet interval in the same way.

\begin{definition} \label{def:prism}
	Let $\vec a$ be a mask, $i < \lenpol{\vec a}$ and $X \in \Obj(\jetset{\vec a})$.
	We define the \textbf{$i$-twisted-prism $X \multip \rival{\jet_i}$} on $X$ as the $\vec a$-jet-set with
	\begin{itemize}
		\item carrier $X \times \accol{0, 1}$,
		\item jet relations generated by the following requirements:
		\begin{itemize}
			\item $(\loch, 0) : \Op_i(X) \to X \multip \rival{\jet_i}$ is a jet set morphism,
			\item $(\loch, 1) : X \to X \multip \rival{\jet_i}$ is a jet set morphism,
			\item $(x, 0) \jet_i (x, 1)$ for all $x \in X$.
		\end{itemize}
	\end{itemize}
	This defines the \textbf{$i$-twisted-prism functor} $\loch \multip \rival{\jet_i} : \jetset{\vec a} \to \jetset{\vec a}$.
	
	We define the \textbf{opposite $i$-twisted-prism $X \multip \rival{\tej_i}$} on $X$ as the jet set of mask $\vec a$ with
	\begin{itemize}
		\item carrier $X \times \accol{0, 1}$,
		\item jet relations generated by the following requirements:
		\begin{itemize}
			\item $(\loch, 0) : X \to X \multip \rival{\tej_i}$ is a jet set morphism,
			\item $(\loch, 1) : \Op_i(X) \to X \multip \rival{\tej_i}$ is a jet set morphism,
			\item $(x, 0) \tej_i (x, 1)$ for all $x \in X$.
		\end{itemize}
	\end{itemize}
	This defines the \textbf{opposite $i$-twisted-prism functor} $\loch \multip \rival{\jet_i} : \jetset{\vec a} \to \jetset{\vec a}$.
	
	If $a_i = \npolar$, then we call this simply the \textbf{$i$-prism functor $\loch \multip \rival{\edge_i}$.}
\end{definition}
Note that in both instances, we take the opposite at the source-side of the jet interval by which we multiply. This makes it unclear what a prism functor for the equijet interval $\rival{\equijet_i}$ should look like.
%\todoi{Should there be a prism functor for $\rival{\equijet_i}$? It would only be well-defined on symmetric jet sets, the category of which is $\jetset{\vec a'}$ where $a'_i = \npolar$, so it is derived from $\loch \multip \rival{\edge_i}$ and the forgetful functor $U^\npolar_i$.}
\begin{corollary} \label{thm:twisted-prism-op}
	We have $\loch \multip \rival{\tej_i} = \Op_i(\loch \multip \rival{\jet_i})$. \qed
\end{corollary}
\begin{corollary} \label{thm:commute-diff-degree}
	Let $F_i$ be a functor between jet set categories of any of the following forms: $\Op_i$, $\Fsym_i$, $\Usym_i$, $\Csym_i$, $\loch \multip \rival{\jet_i}$, $\loch \multip \rival{\tej_i}$, $\loch \multip \rival{\edge_i}$.
	Let $G_j$ be a functor between jet set categories also of one of these forms, but for a different degree $j$.
	Then $F_i$ and $G_j$ commute, i.e.\ there is a natural isomorphism $F_i G_j \cong G_j F_i$.
\end{corollary}
\begin{corollary} \label{thm:commute-symmetric}
The functor $\loch \multip \rival{\edge_i}$ commutes with itself, i.e. $(x, v, w) \mapsto (x, w, v)$ is a natural automorphism of $\loch \multip \rival{\edge_i} \multip \rival{\edge_i}$. \qed
\end{corollary}

\section{Jet Jewels} \label{sec:jetjewel}
Write $\jet_i^*$ for the transitive closure of the $\jet_i$, and similarly $\infrajet_i^*$ for the transitive closure of $\infrajet_i$.
We say that $x$ and $y$ are \textbf{$i$-connected} if $x \infrajet_i^* y$, and correspondingly define \textbf{$i$-connected components}.
\begin{definition} \label{def:jet-jewel}
	Let $\vec a$ be a mask of length $n$.
	An $\vec a$-jet-set $X$ is a \textbf{jet jewel} if:
	\begin{enumerate}
		\item it is $(n-1)$-connected, i.e.\ for any $x, y \in X$ we have $x \infrajet_{n-1}^* y$,
		\item for every $0 \leq i < n$, the relation $\jet_i^*$ is a total pre-order on any connected component of $X$, i.e. if $x \infrajet_i^* y$, then $x \jet_i^* y$ or $x \tej_i^* y$. We call this property \textbf{$i$-orientability}.
	\end{enumerate}
	The \textbf{category of jet jewels} $\jetjewel{\vec a}$ is defined as the full subcategory of $\jetset{\vec a}$ on jet jewels.
\end{definition}
Note that $i$-orientability is vacuous if $a_i = \npolar$.
\begin{proposition} \label{thm:lift-to-jet-jewels}
	Jet jewels are closed under the functors $\Op_i$, $\Fsym_i$, $\Usym_i$, $\Csym_{i \neq n-1}$, $\UFsym_i$, $\UCsym_{i \neq n-1}$, $\loch \multip \rival{\jet_i}$ and $\loch \multip \rival{\tej_i}$.
\end{proposition}
\begin{proof}
	\begin{description}
		\item[$\Op_i$] Trivial.
		\item[$\Fsym_i$] This functor clearly preserves $(n-1)$-connectedness even if $i = n-1$. Meanwhile, $j$-orientability is unaffected for $j \neq i$ and vacuous for $i$ which is symmetric in the codomain of $\Fsym_i$.
		\item[$\Usym_i$] This functor does not modify the jet set, so the conditions are preserved.
		\item[$\Csym_{i \neq n-1}$] Since $i \neq n-1$, this functor preserves $(n-1)$-connectedness. Meanwhile, $j$-orientability is unaffected for $j \neq i$ and vacuous for $i$ which is symmetric in the codomain of $\Csym_i$.
		\item[$\UFsym_i$] Since $\UFsym_i = \Usym_i \circ \Fsym_i$.
		\item[$\UCsym_{i \neq n-1}$] Since $\UCsym_i = \Usym_i \circ \Csym_i$.
		\item[$\loch \multip \rival{\jet_i}$] To see $(n-1)$-connectedness, note that:
		\begin{itemize}
			\item All objects of the form $(x, 0)$ are $(n-1)$-connected,
			\item All objects of the form $(x, 1)$ are $(n-1)$-connected,
			\item Since $i \leq n-1$, we always have $(x, 0) \infrajet_i (x, 1)$.
		\end{itemize}
		For $j$-orientability, we consider 3 situations:
		\begin{description}
			\item[$j < i$] Then for every $x$, we have $(x, 0) \not\infrajet_j (x, 1)$. Every $j$-connected component $C \subseteq X$ produces two $j$-connected components $\set{(c, 0)}{c \in C}$ and $\set{(c, 1)}{c \in C}$, where totality of $\jet_j^*$ is inherited from $X$.
			\item[$j > i$] Then for every $x$, we have $(x, 0) \equijet_j (x, 1)$. Every $j$-connected component $C \subseteq X$ produces one $j$-connected component $\set{(c, u)}{c \in C, u \in \accol{0, 1}}$, where totality of $\jet_j^*$ is inherited from $X$.
			\item[$j = i$] Then $(x, u) \infrajet_i^* (y, v)$ if and only if $x \infrajet_i^* y$.
			By $i$-orientability of the original jet jewel $X$, we have $x \jet_i^* y$ or $x \tej_i^* y$. Say we have $x \jet_i^* y$.
			Then we have $(y, 0) \jet_i^* (x, 0) \jet_i (x, 1) \jet_i^* (y, 1)$, and thus either $(x, u) \jet_i^* (y, v)$ or $(x, u) \tej_i^* (y, v)$ depending on $u$ and $v$.
		\end{description}
		\item[$\loch \multip \rival{\tej_i}$] By an analogous argument. \qedhere
	\end{description}
\end{proof}

\section{Jet Cubes} \label{sec:jetcubes}
In \cref{sec:cubes}, we define a family of \emph{cube} categories $\cubecat_M^\mycubex$ parametrized by a monad $M$ which defines the available operations on cube dimensions, and a choice $\mycubex \in \accol{\affine, \cartes}$ of whether we want our cubes to be affine (no diagonals) or cartesian.

In \cref{sec:jetcubes:def}, we define a family of \emph{jet cube} categories $\jetcube{\myorix}{\mycubex}{M}{\vec a}$ furthermore parametrized by a mask $\vec a$ and an orientation set $\myorix$, which determines whether jets can only be forward or also backward and/or bidirectional.

In \cref{sec:jetcubes:calculus}, we characterize morphisms in certain jet cube categories using a calculus.

In \cref{sec:jetcubes:sss}, we shed light on jet cubes from a different corner by introducing the \emph{semisymmetric separated product}.

In \cref{sec:jetcubes:comparison} we compare our general class of jet cube categories to existing cube categories in the literature.

\subsection{Cube Categories} \label{sec:cubes}
We introduce a family of cube categories with one flavour of dimension. Fix a monad $M$ on $\Set$.
\begin{example} \label{ex:cube-monads}
	Typically $M$ will be one of the following:
	\begin{itemize}
		\item The `exception' monad $\bipointed$ that sends a set $X$ to $X \uplus \accol{0,1}$, which is the carrier of the free bipointed set over $X$;
		\item The monad $\bipointedsym$ that sends a set $X$ to $X \uplus \set{\lnot x}{x \in X} \uplus \accol{0, 1}$, which is the carrier of the free [bipointed set equipped with an involution $\lnot$ that swaps $0$ and $1$] over $X$;
		\item The monad $\distlattice$ that sends a set $X$ to the carrier of the free distributive lattice over $X$;
		\item The monad $\demorgan$ that sends a set $X$ to the carrier of the free De Morgan algebra over $X$;
		\item The monad $\booleanalg$ that sends a set $X$ to the carrier of the free boolean algebra over $X$.
	\end{itemize}
\end{example}

\subsubsection{Cartesian Cubes}
\begin{definition}
	We construct the \textbf{(named) category of cartesian $M$-cubes} $\cubecat^\cartes_M$ (and $\namedcubecat^\cartes_M$ resp.) stepwise:
	\begin{itemize}
		\item The Kleisli category $\Kleisli(M)$ of $M$ has objects $\inKleisli{X}$ where $X$ is a set, and its morphisms $\inKleisli f : \inKleisli X \to \inKleisli Y$ are functions $f : X \to MY$.
		\item Of this, we take the opposite $\Kleisli(M)\op$. (This is the Lawvere theory corresponding to the monad $M$.)
		\item We define $\namedcubecat^\cartes_M$ as the full subcategory of $\Kleisli(M)\op$ on finite sets. (Alternatively, this is the opposite Kleisli category of the restriction of $M$ to finite sets, either as a monad on $\FinSet$ or as a relative monad $\FinSet \to \Set$.)
		\item We define $\cubecat^\cartes_M$ as a designate skeleton of $\namedcubecat_M$, e.g.\ the full subcategory of $\namedcubecat^\cartes_M$ on sets of the form $\accol{0, \ldots, n-1}$ with $n \geq 0$.
	\end{itemize}
\end{definition}
Objects of $\namedcubecat^\cartes_M$ will be denoted as tuples of names $(\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX)$ where $\IX$ is meaningless but conveys the intuition that we regard $\dm{i}_k$ as a value ranging over the interval (the cube given by the singleton object).
A morphism $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$ is then a function sending each $\dm{j}_k$ to an expression $\dm{j}_k \psub{\vfi} \in M\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$.
The morphism $\vfi$ will also be denoted as $(\dm{j}_0 \psub \vfi / \dm{j}_0, \ldots, \dm{j}_{m-1} \psub \vfi / \dm{j}_{m-1})$.
The situation in $\cubecat^\cartes_M$ is the same except that we now regard the names $\dm{i}_k$ as De Bruijn indices.

\begin{corollary}
The categories $\cubecat^\cartes_M$ and $\namedcubecat^\cartes_M$ have finite products, given by finite coproducts of sets. \qed
\end{corollary}

\subsubsection{Affine Cubes}
If $T$ is a \emph{container} monad \cite{container-combinatorics}, i.e. a monad whose underlying functor is a container functor \cite{containers} of the form $TX = \Sigma(s : S).(P(s) \to X)$, then we define $T^\# X$ as the set of \emph{affine} expressions $\Sigma(s : S).(P(s) \hookrightarrow X)$, which is an endofunctor on the category $\Set^{\hookrightarrow}$ of sets and injective functions.
If $M$ is merely a \emph{quotient} of a container monad, i.e. $M$ is of the form $MX = TX/\sim_X$ with $T$ as above, then we define $M^\# X$ as the set of equivalence classes with an affine representant.

\begin{remark}
An important source of monads such as $M$ are monads specified by a syntactic algebraic theory \cite{manes-book,adamek-book,keml-diagrams}.
A syntactic algebraic theory specifies a set of operations $S_0$, assigns to each operation $s : S_0$ an arity $P_0(s)$ which is again a set, and subjects these to a set of axioms.%
\footnote{We use `syntactic algebraic theory' to refer to the syntactic presentation as described here, and `monad' and `Lawvere theory' to refer to the less syntactic objects they specify.
%There seems to be disagreement on the terminology.
%Syntactic algebraic theories (a.k.a. presentations of algebraic theories \cite{manes-book,keml-diagrams}) give rise to a monad and a Lawvere category (a.k.a. Lawvere theory or algebraic theory \cite{manes-book}).
%Depending on your definition of a Lawvere theory, the monadic presentation and the Lawvere theory may be interderivable; in turn, they give rise to a category of algebras.
%Neither of these two steps reflects equivalence, so we truly have three different notions, and there is disagreement which one the term `algebraic theory' refers to \cite{adamek-book}.
%
%Different syntactic algebraic theories may have the same category of models, in which case they are called \emph{Morita equivalent} \cite[ch.\ 15]{adamek-book}. We can thus distinguish algebraic theories by their syntactic presentation or consider them up to Morita equivalence. We will use \emph{syntactic algebraic theory} in the former case and \emph{monadic/Lawverian algebraic theory} in the latter case. Some authors insist on the usage of the word `presentation' for the former case \cite{manes-book}, or call the latter case `algebraic categories' \cite{adamek-book}, while the term `algebraic theories' seems to be in use for either case.
}
The container $(S_0, P_0)$ specifies a container functor $FX = \Sigma(s : S_0).(P_0(s) \to X)$ on $\Set$.
A free monad $F^*$ over this functor $F$ exists and satisfies the fixpoint equation $F^* X \cong X \uplus F F^* X$.
We remark that the free monad $F^*$ over a container functor $F$ is again a container functor, i.e.\ there exists a container $(S, P)$ such that
$F^* X = \Sigma(s : S).(P(s) \to X)$
specifies the free monad over $F$.
The axioms determine an equivalence relation $\sim_X$ on $F^* X$ such that $M X := F^* X/\sim_X$ is again a monad.
This situation applies to each of the monads in \cref{ex:cube-monads}.

In fact, often the quotient can be taken already at the level of the container, so that there exists a container $(S', P')$ such that $MX \cong \Sigma(s : S').(P'(s) \to X)$.
\end{remark}

We say that $(s, f), (s', f') \in T^\# X$ are \textbf{mutually fresh}, denoted $(s, f) \freshbin (s', f')$, if the images of $f$ and $f'$ are disjoint.
Elements of $M^\# X$ are mutually fresh if they have mutually fresh representants.
We call the monad $(T, \eta, \mu)$ \textbf{affine} if $\eta_X : X \to TX$ lands in $T^\# X$ for all $X$ and $\mu_X : TTX \to TX$ restricted to $(TT)^\# X$ (note that container functors are closed under composition) lands in $T^\# X$; and similar for $M$.

\begin{definition}
Let $M$ be a quotient of a container monad, and let it be affine.
We construct the \textbf{(named) category of affine $M$-cubes $\cubecat_M^\affine$} (and $\namedcubecat_M^\affine$ resp.) stepwise:
\begin{itemize}
	\item The affine Kleisli category $\Kleisli^\#(M)$ has objects $\inKleisli{X}$ where $X$ is a set, and its morphisms $\inKleisli f : \inKleisli X \to \inKleisli Y$ are functions $f : X \to M^\#Y$ such that for any $x \neq x'$ in $X$, we have $f(x) \freshbin f(x')$.
	Identity and composition are well-defined because $M$ is affine.
	\item Of this, we take the opposite $\Kleisli^\#(M)\op$.
	\item We define $\namedcubecat_M^\affine$ as the full subcategory of $\Kleisli^\#(M)\op$ on finite sets.
	\item We define $\cubecat_M^\affine$ as a designate skeleton of $\namedcubecat^\affine_M$, e.g.\ the full subcategory of $\namedcubecat^\affine_M$ on sets of the form $\accol{0, \ldots, n-1}$ with $n \geq 0$.
\end{itemize}
\end{definition}
Objects will be represented as for the cartesian cube categories.

\begin{corollary}
The categories $\cubecat^\affine_M$ and $\namedcubecat^\affine_M$ have a symmetric monoidal structure $(\top, {*})$ given by finite coproducts of sets. The binary operation is called the \textbf{separated product}. \qed
\end{corollary}

\subsubsection{Examples}
This way, we get -- among others -- the following cube categories:
\begin{enumerate}
	\item[$\cubecat^\cartes_{\bipointed}$] The cartesian cube category.
	A morphism $\vfi : V \to W$ sends every dimension $\dm{j} \in W$ to $\dm{j} \psub \vfi \in V \cup \accol{0, 1}$.
	Its cubes have diagonals.
	\item[$\cubecat^\affine_{\bipointed}$] The affine cube category \cite{bch}.
	A morphism $\vfi : V \to W$ sends every dimension $\dm{j} \in W$ to $\dm{j} \psub \vfi \in V \cup \accol{0, 1}$, such that if $\dm{j}\psub \vfi = \dm{j}' \psub \vfi \in V$ then $\dm{j} = \dm{j}'$.
	Its cubes have no diagonals.
	\item[$\cubecat^\cartes_{\bipointedsym}$] The symmetric cartesian cube category. We have a negation/involution/symmetry $(\lnot \dm{i} / \dm{j}) : (\dm i : \IX) \to (\dm{j} : \IX)$.
	\item[$\cubecat^\cartes_{\distlattice}$] The cartesian cube category with connections. We have morphisms $(\dm i \vee \dm{j} / \dm k), (\dm i \wedge \dm{j} / \dm k) : (\dm i : \IX, \dm{j} : \IX) \to (\dm k : \IX)$. There are no symmetries
	\item[$\cubecat^\cartes_{\demorgan}$] The CCHM cube category \cite{cubical}, which combines symmetries and connections. We have $(\dm i \wedge \lnot \dm i / \dm j) \neq (0/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$ and $(\dm i \vee \lnot \dm i / \dm j) \neq (1/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$.
	\item[$\cubecat^\cartes_{\booleanalg}$] A cube category very similar to the CCHM one, but we have $(\dm i \wedge \lnot \dm i / \dm j) = (0/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$ and $(\dm i \vee \lnot \dm i / \dm j) = (1/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$.
\end{enumerate}
We remark that $\cubecat^\affine_{\demorgan}$ and $\cubecat^\affine_{\booleanalg}$ should be isomorphic as the additional law of boolean algebras w.r.t.\ de Morgan algebras only affects non-affine expressions.

\subsubsection{The Endpoint Model}
We remarked above that $\catL := \Kleisli(M)\op$ is the Lawvere category of $M$.
It is known then (see e.g.\ \cite{keml-diagrams}), that the Eilenberg-Moore category of $M$ (which is the category of Eilenberg-Moore algebras of $M$) is equivalent category of models of $\catL$ (which is the category of product-preserving functors $\catL \to \Set$).
Such functors are fully determined by the image of the singleton set (as every set is a coproduct of singletons and the Kleisli-category retains coproducts) and that image will be exactly the carrier of the corresponding Eilenberg-Moore algebra.

It is clear that both the cartesian and affine (named) cube categories are subcategories of $\catL$.
As such, any $M$-algebra induces a functor $\catL \to \Set$ and hence a functor from either of the $M$-cube categories to $\Set$.

The initial algebra of any monad $M$ on $\Set$ has carrier $M \eset$, which for each of the monads in \cref{ex:cube-monads} equals $\accol{0, 1}$.
Correspondingly, the initial model of $\catL$ is the functor $\EP : \catL \to \Set$ sending $(\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX)$ to $\accol{0, 1}^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}}$.
We call this the \textbf{endpoint model}.
It is naturally isomorphic (in fact equal) to $\Hom_\catL((), \loch) : \catL \to \Set$, since we have
\small \[
	\Hom_\catL((), (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX))
	= \Hom_{\Kleisli(M)}(\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}, \eset)
	= (M\eset)^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}}
	= \accol{0, 1}^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}}.
\] \normalsize

%We are interested, in particular, in $M$-algebra structures on the set of endpoints $\accol{0, 1}$.
%Each of the monads in \cref{ex:cube-monads} has an obvious such algebra structure.
%Thus, we get functors from each of the corresponding cube categories to $\Set$,
%sending $(\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX)$ to $\accol{0, 1}^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}}$.
%We will denote each of those functors as $\EP$.

Recall that a morphism $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$ assigns to each $\dm j$ a value $\dm j\psub \vfi$ in $M \accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$, the free $M$-algebra over $\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$.
The function $\EP(\vfi)$ is defined by
\[
	\EP(\vfi)
	\paren{ v^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}} \to \accol{0, 1}} }
	(\dm j)
	= \alpha\paren{ M(v)(\dm j \psub \vfi) },
\]
where $\alpha : M\accol{0, 1} \to \accol{0, 1}$ is the algebra structure on $\accol{0, 1}$.
Using the operation $\bindop^\alpha : MX \to (X \to \accol{0, 1}) \to \accol{0, 1} : \hat x \mapsto f \mapsto \alpha (Mf(\hat x))$, we can write this as $\EP(\vfi)(v)(\dm j) = \dm j \psub \vfi \bindop^\alpha v$.

\begin{proposition} \label{thm:booleanalg-ff}
	The functor $\EP : \cubecat^\cartes_\booleanalg \to \Set$ is fully faithful.
\end{proposition}
\begin{proof}
	We need to show that any function $f : \accol{0, 1}^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}} \to \accol{0, 1}^{\accol{\dm{j}_0, \ldots, \dm{j}_{m-1}}}$
	can be obtained as some $\EP(\vfi)$ with $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$.
	We remark that such a function $f$ in fact consists of $m$ truth tables in $n$ boolean variables.
	From the full disjunctive normal form, it is clear that elements of the free boolean algebra are in 1-1 correspondence with truth tables.
	Concretely, for each $\dm j$, define $\dm j \psub \vfi$ to be the element of $\booleanalg \accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$ corresponding to the truth table $f(\loch, \dm j)$.
	Then $\dm j \psub \vfi \bindop^\alpha v$ will evaluate $\dm j \psub \vfi$ after replacing each variable $\dm i$ with its value $v(\dm i)$, yielding the value $f(v, \dm j)$ prescribed by the truth table $f(\loch, \dm j)$.
\end{proof}
\begin{proposition} \label{thm:monad-coercions-faithful}
	The obvious functor $I : \cubecat_M^\mycubey \to \cubecat_N^\mycubex$ where
	\begin{itemize}
		\item $\mycubey, \mycubex \in \accol{\affine, \cartes}$ and $\mycubey \leq \mycubex$ according to the order $\affine \leq \cartes$,
		\item $M, N \in \accol{\bipointed, \bipointedsym, \distlattice, \booleanalg}$ and $M \leq N$ according to the partial order
		\[
			\xymatrix{
				\bipointed
					\ar[r]^\leq
					\ar[d]_{\rotatebox{270}{$\scriptstyle\leq$}}
				& \bipointedsym
					\ar[d]_{\rotatebox{270}{$\scriptstyle\leq$}}
					\ar@/^/[ddr]^{\rotatebox{270}{$\scriptstyle\leq$}}
				\\
				\distlattice
					\ar[r]^\leq
					\ar@/_/[rrd]_\leq
				& \demorgan
				\\
				&& \booleanalg,
			}
		\]
		is faithful.
	\end{itemize}
\end{proposition}
\begin{proof}
	In a first step, it is obvious by construction that $\cubecat^\affine_M \to \cubecat^\cartes_M$ is faithful.
	
	In a second step, note that we have a monad morphism $\iota : M \to N$ such that $\iota_X : M(X) \to N(X)$ is injective for all $X$. Then the resulting functor between the Kleisli categories, which are opposite to the cartesian cube categories, is faithful.
\end{proof}
Clearly, the functor $I : \cubecat_\demorgan^\cartes \to \cubecat_\booleanalg^\cartes$ is not faithful: it sends the morphisms $(0/\dm j), (\dm i \wedge \lnot \dm i/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$ in $\cubecat_\demorgan^\cartes$ to the same morphism in $\cubecat_\booleanalg^\cartes$.
\begin{corollary} \label{thm:monads-faithful}
	The functor $\EP : \cubecat^\mycubex_M \to \Set$ is faithful for each $M \in \accol{\bipointed, \bipointedsym, \distlattice, \booleanalg}$.
\end{corollary}
\begin{proof}
	Follows by composing \cref{thm:booleanalg-ff} and \cref{thm:monad-coercions-faithful}.
\end{proof}

\subsection{Jet Cubes} \label{sec:jetcubes:def}

\subsubsection{Jet Cube Objects}
\begin{definition}
	An \textbf{orientation set} is one of the following sets of formal symbols:\footnote{The letters stand for \emph{forward}, \emph{backward} and \emph{equijet}.}
	\[
		\orif = \accol{{\jet}}, \qquad
		\orife = \accol{{\jet}, {\equijet}}, \qquad
		\orifb = \accol{{\jet}, {\tej}}, \qquad
		\orifbe = \accol{{\jet}, {\tej}, {\equijet}}.
	\]
	The set of orientation sets will be denoted $\Ori = \accol{\orif, \orife, \orifb, \orifbe}$.
\end{definition}
\begin{definition} \label{def:jet-cube}
	Let $\vec a$ be a mask and $\myorix$ an orientation set.
	We define the set of \textbf{$(\myorix, \vec{a})$-jet-cubes} as the set of lists of elements of $\set{P_i}{P \in \myorix, 0 \leq i < \lenpol{\vec a}}$,
	where we identify all $P_i = Q_i =: {\edge}_i$ ($P, Q \in \myorix$) if $a_i = \npolar$.
	We denote jet cubes as
	$(\dm i_0 : \rival{(P_0)_{i_0}}, \ldots, \dm i_{n-1} : \rival{(P_{n-1})_{i_{n-1}}})$,
	thinking of the names $\dm{i}_k$ as De Bruijn indices.
	
%	degrees $0 \leq i < \lenpol{\vec a}$, but we denote them as
%	$(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\jet_{i_{n-1}}})$, thinking of the names $\dm{i}_k$ as De Bruijn indices.
%	If $a_i = \npolar$, we write $\rival{\edge_i}$ instead of $\rival{\jet_i}$.
%	
%%	More generally, we define the set of \textbf{trioriented jet cubes of mask $\vec a$} as the set of lists of elements of $\set{\jet_i, \tej_i}{a_i = \ypolar} \cup \set{\edge_i}{a_i = \npolar}$, but we denote them as
%%	$(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\tej_{i_{n-1}}})$.
%%	If $a_i = \npolar$, we use the symbols $\rival{\jet_i}$, $\rival{\tej_i}$ and $\rival{\edge_i}$ interchangeably.
%	
%	More generally, we define the set of \textbf{trioriented $\vec a$-jet-cubes} as the set of lists of elements of \allowbreak $\set{\jet_i, \tej_i, \equijet_i}{0 \leq i < \lenpol{\vec a}}$, where we identify ${\jet_i} = {\tej_i} = {\equijet_i} =: {\edge_i}$ if $a_i = \npolar$, and where $\jet_i$ and $\tej_i$ cannot occur to the left of $\equijet_i$ if $a_i = \ypolar$.
%	We denote them e.g.\ as $(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\tej_{i_{n-1}}})$.
\end{definition}
\begin{definition} \label{def:symmetric-var}
	We call a variable $\dm i$ of an $(\myorix, \vec a)$-jet-cube \textbf{$i$-symmetric} (for a degree $0 \leq i < \lenpol{\vec a}$) if \emph{any} of the following conditions holds:
	\begin{itemize}
		\item $\dm i$ is not of degree $i$,
		\item $\dm i$ is an equijet variable, i.e.\ $\dm i : \rival{\equijet_j}$,
		\item $a_i = \npolar$.
	\end{itemize}
	Otherwise, it is called \textbf{$i$-directed}.
	Thus, if $\dm i$ is $i$-directed, then $a_i = \ypolar$ and $\dm i : \rival{\jet_i}$ or $\dm i : \rival{\tej_i}$.
\end{definition}
\begin{definition} \label{def:sym-forget-cube}
	Let $\vec a \sqsubset_i \vec b$ and ${\equijet} \in \myorix$. For any $(\myorix, \vec a)$-jet-cube $W$, we define the $(\myorix, \vec b)$-jet-cube $\Usymcube_i W$ by replacing every occurrence of $\edge_i$ with $\equijet_i$.
\end{definition}
Note that a $\vec b$-jet-cube is uniquely in the image of $\Usymcube_i$ if it does not feature the symbols $\jet_i$ and $\tej_i$, i.e.\ if all variables are $i$-symmetric.
\begin{definition} \label{def:jep}
	For any $(\myorix, \vec a)$-jet-cube $W$, we define the $\vec a$-jet-set $\JEP(W)$ as follows:
	\[ \begin{array}{l c l l}
		\JEP(()) &=& \top, \\
		\JEP(W, \dm i : \rival{\jet_i}) &=& \JEP(W) \multip \rival{\jet_i}, \\
		\JEP(W, \dm i : \rival{\tej_i}) &=& \JEP(W) \multip \rival{\tej_i}, \\
		\JEP(W, \dm i : \rival{\edge_i}) &=& \JEP(W) \multip \rival{\edge_i}, \\
		\JEP(W, \dm i : \rival{\equijet_i}) &=& \Usym_i \, \JEP\paren{(\Usymcube_i)\inv(W, \dm i : \rival{\equijet_i})}
		& \text{if $a_i = \ypolar$} \\
		&=& \Usym_i \, \JEP\paren{(\Usymcube_i)\inv(W), \dm i : \rival{\edge_i}} \\
		&=& \Usym_i\paren{\JEP\paren{(\Usymcube_i)\inv(W)} \multip \rival{\edge_i}}.
	\end{array} \]
	Setting $V = (\Usymcube_i)\inv(W)$, the last equation can be rephrased as
	\[ \begin{array}{l c l l}
		\JEP(\Usymcube_i V, \dm i : \rival{\equijet_i})
		= \JEP(\Usymcube_i(V, \dm i : \rival{\edge_i}))
		&=& \Usym_i(\JEP(V, \dm i : \rival{\edge_i})) \\
		&=& \Usym_i(\JEP(V) \multip \rival{\edge_i}).
	\end{array} \]
\end{definition}
\begin{definition} \label{def:jet-cube-erasure}
	We define the \textbf{jet-erasure function} $\erasejc{\loch}$, which sends $(\myorix, \vec a)$-jet-cubes to cubes (i.e. objects of any of the cube categories defined in \cref{sec:cubes}), by
	\[
		\erasejc{()} = (),
		\qquad
		\erasejc{(W, \dm i : \rival{\jet_i})} =
		\erasejc{(W, \dm i : \rival{\tej_i})} =
		\erasejc{(W, \dm i : \rival{\equijet_i})} =
		\erasejc{(W, \dm i : \rival{\edge_i})} =
		(\erasejc{W}, i : \IX).
	\]
\end{definition}
\begin{corollary} \label{thm:jet-cube-pullback}
	For any $(\myorix, \vec a)$-jet-cube $W$, the carrier of $\JEP(W)$ is $\EP(\erasejc{W})$.
	Thus, every (forward/trioriented) jet cube determines an object of the following strict pullback of categories:
	\[
			\xymatrix{
				\accol{\text{$(\myorix, \vec a)$-jet-cubes}}
					\ar@/^/[rrrd]^{\JEP}
					\ar@/_/[rdd]_{\erasejc{\loch}}
					\ar@{.>}[rd]
				\\
				&
				\cubecat^\mycubex_M \times_\Set \jetset{\vec a}
					\ar@{.>}[rr]
					\ar@{.>}[d]
					\xydrcorner
				&&
				\jetset{\vec a}
					\ar[d]^U
				\\
				&
				\cubecat^\mycubex_M
					\ar[rr]_{\EP}
				&&
				\Set,
			}
	\]
	It is straightforward to see that the function thus obtained is injective. \qed
\end{corollary}

\subsubsection{Jet Cube Categories}
\begin{definition} \label{def:jet-cube-cat}
	Let $\vec a$ be a mask, $\myorix \in \Ori$, $\mycubex \in \accol{\affine, \cartes}$ and $M$ a monad on $\Set$.
	We define
	the category $\jetcube{\myorix}{\mycubex}{M}{\vec a}$ of \textbf{$(\myorix, \vec a)$-jet-$M$-cubes}
	as the full subcategory of $\cubecat^\mycubex_M \times_\Set \jetset{\vec a}$ on $(\myorix, \vec a)$-jet-cubes, as justified by \cref{thm:jet-cube-pullback}.
	The functions $\JEP$ and $\erasejc{\loch}$ are correspondingly extended to functors.
\end{definition}
\begin{corollary} \label{thm:jet-cubes-are-jewels}
	The functor $\JEP : \jetcube{\myorix}{\mycubex}{M}{\vec a} \to \jetset{\vec a}$ factors over the inclusion $\jetjewel{\vec a} \hookrightarrow \jetset{\vec a}$.
\end{corollary}
\begin{proof}
	By induction on the dimension and using \cref{thm:lift-to-jet-jewels}, it is clear that for any jet cube $W$, the jet set $\JEP(W)$ is a jet jewel, which factors the action on objects. The action on morphisms factors because $\jetjewel{\vec a}$ is a full subcategory of $\jetset{\vec a}$.
\end{proof}
We will ultimately only be interested in $(\orif, \vec a)$-jet-cubes, but in \cref{sec:jetcubes:calculus}, we define an inductive predicate to determine whether a cube morphism $\vfi : \erasejc V \to \erasejc W$ is in fact a jet cube morphism $V \to W$, and this predicate's inference rules make use of $(\orifbe, \vec a)$-jet-cubes in their premises.
The orientation sets $\orife$ and $\orifb$ are only introduced for explanatory purposes: we can easily relate jet cubes with and without $\tej$ (\cref{thm:backward-jets-equivalent}), and later on\todo{Refer} we will be able to relate jet cubes with and without $\equijet$ by inserting additional symmetric degrees.
\begin{proposition} \label{thm:backward-jets-equivalent}
	Let $(\myorix, \myorix') \in \accol{(\orif, \orifb), (\orife, \orifbe)}$.
	Then the inclusion
	\[
		\jetcube{\myorix}{\mycubex}{M}{\vec a} \hookrightarrow \jetcube{\myorix'}{\mycubex}{M}{\vec a},
	\]
	which is fully faithful by definition, is also split essentially surjective and therefore an equivalence.
\end{proposition}
\begin{proof}
	One proves, by induction on the length of the jet cube, that any jet cube is equivalent to the jet cube in which every occurrence of $\rival{\tej_i}$ is replaced with $\rival{\jet_i}$.
\end{proof}
\begin{proposition} \label{thm:lift-to-jet-cubes}
	The following functors on $\vec a$-jet-sets lift over $\JEP$ to functors on $(\myorix, \vec a)$-jet-cubes under the following conditions:
	\begin{center}
		\begin{tabular}{c c c c l}
			$\Op_i$ & lifts to & $\Opcube_i$ & if & ${\tej} \in \myorix$ \\
			$\Fsym_i$ & lifts to & $\Fsymcube_i$ && \\
			$\Usym_i$ & lifts to & $\Usymcube_i$ & if & ${\equijet} \in \myorix$ \\
			$\UFsym_i$ & lifts to & $\UFsymcube_i$ & if & ${\equijet} \in \myorix$ \\
			$\loch \multip \rival{\jet_i}$ & lifts to & $\loch \multip (\dm i : \rival{\jet_i})$ && \\
			$\loch \multip \rival{\edge_i}$ & lifts to & $\loch \multip (\dm i : \rival{\edge_i})$ & if & $a_i = \npolar$ \\
			$\loch \multip \rival{\tej_i}$ & lifts to & $\loch \multip (\dm i : \rival{\tej_i})$ & if & ${\tej} \in \myorix$ \\
		\end{tabular}
	\end{center}
%	The functors $\Fsym_i$, $\loch \multip \rival{\jet_i}$ and $\loch \multip \rival{\edge_i}$ lift to both forward and trioriented jet-$M$-cube categories.
%	The functors $\Op_i$, $\Usym_i$ and $\loch \multip \rival{\tej_i}$ lift to trioriented jet-$M$-cube categories.
%	We denote the resulting functors as $\Fsymcube_i$, $\loch \multip (\dm i : \rival{\jet_i})$, $\loch \multip (\dm i : \rival{\edge_i})$, $\Opcube_i$, $\Usymcube_i$ (in agreement with \cref{def:sym-forget-cube}) and $\loch \multip (\dm i : \rival{\tej_i})$, where each time $\dm i$ represents a bound De Bruijn index.
	We have $\Fsymcube_i \dashv \Usymcube_i$ and thus an idempotent monad $\UFsymcube_i := \Usymcube_i \circ \Fsymcube_i$, whose definition we extend to masks $\vec b$ where $b_i = \npolar$ as in \cref{def:sym-closure-of-sym}.
\end{proposition}
\begin{proof}
	The functors $\Fsym_i$, $\Op_i$ and $\Usym_i$ have no effect on the carrier, so they certainly lift to $\cubecat_M^\mycubex$, hence to the pullback $\cubecat_M^\mycubex \times_\Set \jetset{\vec a}$.
	\begin{itemize}
		\item $\Fsym_i$ lifts to jet cubes by replacing every occurrence of $\jet_i$, $\tej_i$ or $\equijet_i$ with $\edge_i$.
		\item $\Op_i$ lifts to jet cubes if ${\tej} \in \myorix$ by reversing the \emph{last} occurrence of either $\jet_i$ or $\tej_i$ (\cref{thm:twisted-prism-op}), if present.
		\item $\Usym_i$ lifts to jet cubes as the operation $\Usymcube_i$ already introduced in \cref{def:sym-forget-cube}.
	\end{itemize}
	To prove $\Fsymcube \dashv \Usymcube$, we need to build unit and co-unit natural transformations.
	Since the categories of jet cubes are fully faithful subcategories of the pullback $\cubecat_M^\mycubex \times_\Set \jetset{\vec a}$, it suffices to build them there.
	They were already established in $\jetset{\vec a}$ by \cref{def:sym-free,def:sym-cofree}.
	As they reduce to the identity unit and co-unit of $\Id \dashv \Id$ for the carriers, they trivially lift to $\cubecat_M^\mycubex$.
	
	The various prism functors multiply the carrier with $\accol{0, 1}$ and thus lift over $\EP$ to the affine/cartesian cube category by multiplying with $(\dm i : \IX)$.
	Hence, they also lift to the pullback $\cubecat_M^\mycubex \times_\Set \jetset{\vec a}$.
	Each of them lifts to jet cubes by appending the symbol concerned (if available).
\end{proof}
%\begin{definition} \label{def:prism-cube}
%	Let $\vec a$ be a mask, $\mycubex \in \accol{\affine, \cartes}$ and $i < \lenpol{\vec a}$. We define the \textbf{$i$-twisted-prism functor $\loch \multip (\dm i : \rival{\jet_i}) : \jetcubefwd{\mycubex}{M}{\vec a} \to \jetcubefwd{\mycubex}{M}{\vec a}$} on jet cubes as follows:\footnote{We still think of $\dm i$ as a De Bruijn index.}
%	\begin{itemize}
%		\item The object $W$ is sent to $(W, \dm i : \rival{\jet_i})$.
%		\item The morphism $\vfi : V \to W$ is sent to the morphism $\vfi \multip (\dm i : \rival{\jet_i})$ such that
%		\begin{itemize}
%			\item If $\mycubex = \affine$ then $\erasejc{\vfi \multip (\dm i : \rival{\jet_i})} = \erasejc \vfi * (\dm i : \IX)$,
%			\item If $\mycubex = \cartes$ then $\erasejc{\vfi \multip (\dm i : \rival{\jet_i})} = \erasejc \vfi \times (\dm i : \IX)$,
%			\item $\JEP(\vfi \multip (\dm i : \rival{\jet_i})) = \JEP(\vfi) \multip \rival{\jet_i}$.
%		\end{itemize}
%	\end{itemize}
%	If $a_i = \npolar$, then we call this simply the \textbf{$i$-prism functor} $\loch \multip (\dm i : \rival{\edge_i}) : \jetcubefwd{\mycubex}{M}{\vec a} \to \jetcubefwd{\mycubex}{M}{\vec a}$.
%	
%	We similarly define, on trioriented jet cubes:
%	\begin{itemize}
%		\item the $i$-twisted-prism functor $\loch \multip (\dm i : \rival{\jet_i}) : \jetcubefwd{\mycubex}{M}{\vec a} \to \jetcubefwd{\mycubex}{M}{\vec a}$ when $a_i = \ypolar$,
%		\item the opposite $i$-twisted-prism functor $\loch \multip (\dm i : \rival{\tej_i}) : \jetcubefwd{\mycubex}{M}{\vec a} \to \jetcubefwd{\mycubex}{M}{\vec a}$ when $a_i = \ypolar$,
%		\item the $i$-prism functor $\loch \multip (\dm i : \rival{\edge_i}) : \jetcubefwd{\mycubex}{M}{\vec a} \to \jetcubefwd{\mycubex}{M}{\vec a}$ when $a_i = \npolar$.
%	\end{itemize}
%\end{definition}
\begin{proposition} \label{thm:cube-commute-diff-degree}
	Any two functors on jet cubes concerned in \cref{thm:lift-to-jet-cubes}, instantiated on different degrees, commute.
	In other words, the natural transformation given in \cref{thm:commute-diff-degree} lifts to (forward/trioriented) jet cubes when the associated functors lift.
\end{proposition}
\begin{proof}
	Since the categories of jet cubes are fully faithful subcategories of the pullback $\cubecat_M^\mycubex \times_\Set \jetset{\vec a}$, it suffices to prove the natural isomorphism there.
	The isomorphism was already established in $\jetset{\vec a}$ by \cref{thm:commute-diff-degree}, and the effect on the carrier is either nothing (when at most one prism functor is involved) or swapping components (when both functors are prism functors).
	These isomorphisms lift to $\cubecat_M^\mycubex$.
\end{proof}
\begin{proposition} \label{thm:cube-commute-symmetric}
	The functor $\loch \multip (\dm i : \rival{\edge_i})$ commutes with itself, i.e.\ the natural automorphism given in \cref{thm:commute-symmetric} lifts to jet cubes as $(\dm i / \dm i, \dm j / \dm j) : \loch \multip (\dm i : \rival{\edge_i}) \multip (\dm j : \rival{\edge_i}) \cong \loch \multip (\dm j : \rival{\edge_i}) \multip (\dm i : \rival{\edge_i})$.
\end{proposition}
\begin{proof}
	Analogous to the proof of \cref{thm:cube-commute-diff-degree}.
	The isomorphism was already established in $\jetset{\vec a}$ by \cref{thm:commute-symmetric}, and the effect on the carrier is swapping components, which lifts to $\cubecat_M^\mycubex$.
\end{proof}
\begin{remark} \label{rem:two-monads}
	As of this point we will only be interested in the monads $\bipointedsym$ and $\booleanalg$ because:
	\begin{itemize}
		\item We need involutions in order to be able to work with the source-side of the twisted prism, ruling out $\bipointed$ and $\distlattice$.
		\item We do not see any advantage of $\demorgan$ over $\booleanalg$. In particular, we want $\EP$ to be faithful (\cref{thm:monad-coercions-faithful}).
	\end{itemize}
\end{remark}
\begin{theorem} \label{thm:affine-automatic}
	Assuming decidability of the affineness predicate on cube morphisms, then for $M \in \accol{\bipointed, \bipointedsym}$, we have isomorphisms of categories\footnote{Depending on the formalization, possibly even equalities.}
	\[
		\jetcube \myorix \affine M {\vec a} \cong \jetcube \myorix \cartes M {\vec a},
	\]
	which act as the identity on objects.
\end{theorem}
\begin{proof}
	%Since the forward jet cube categories are full subcategories of the trioriented ones, it suffices to prove the first isomorphism.
	%There, 
	We know that $\jetcube \myorix \affine \bipointedsym {\vec a}$ is a subcategory of $\jetcube \myorix \cartes \bipointedsym {\vec a}$.
	So we need to show that any morphism in $\jetcubetri \cartes \bipointedsym {\vec a}$ is in fact affine.
	Take such a morphism $\hat \vfi : V \to W$ (write $\vfi = \erasejc{\hat \vfi}$) and assume it is not affine.
	Since $M$ only has nullary and unary operations, this means that $W$ has dimensions $\dm i$ and $\dm j$ such that $\dm i \psub \vfi$ and $\dm j \psub \vfi$ are not mutually fresh, meaning that $V$ has some dimension $\dm k$ such that $\dm i \psub \vfi, \dm j \psub \vfi \in \accol{\dm k, \lnot \dm k}$.
	Then $\JEP(\hat \vfi)$ cannot be a jet set morphism as $\JEP(W)$ has no diagonals. This is a contradiction.
\end{proof}
Note that the situation is not so simple for $\booleanalg$.
For example, at symmetric degrees, $\jetcubefwd \cartes \booleanalg{\vec a}$ features the `exclusive or' operation
\[
	((\dm i \vee \dm j) \wedge \lnot(\dm i \wedge \dm j)/\dm k) : (\dm i : \rival{\edge_i}, \dm j : \rival{\edge_i}) \to (\dm k : \rival{\edge_i})
\]
which cannot be constructed in $\jetcubefwd \affine \booleanalg{\vec a}$.
More startlingly, even at directed degrees, we have operations such as the following:
\[
	(\dm i \wedge \dm j/\dm p, \dm j \wedge \dm k/\dm q) : (\dm i : \rival{\jet_i}, \dm j : \rival{\jet_i}, \dm k : \rival{\jet_i}) \to (\dm p : \rival{\jet_i}, \dm q : \rival{\jet_i}),
\]
which collapses five consecutive points of the Hamiltonian path and is a legitimate jet cube morphism:
\[
	\xymatrix{
		(1, 0, 0)
			\ar[rrr]
		&&& (1, 0, 1)
			\ar[ld]
			\ar@{.>}[ddd]
		\\
		& (0, 0, 0)
			\ar[lu]
			\ar@{.>}[r]
		& (0, 0, 1)
			\ar[d]
		\\
		& (0, 1, 0)
			\ar[u]
			\ar@{.>}[r]
		& (0, 1, 1)
			\ar[rd]
		\\
		(1, 1, 0)
			\ar[ru]
			\ar@{.>}[uuu]
			\ar@{.>}[rrr]
			\ar@{}[rrrdd]|{\rotatebox{270}{$\mapsto$}}
		&&& (1, 1, 1)
		\\
		\\
		(0, 0)
			\ar@{=}[rrr]
		&&& (0, 0)
			\ar@{=}[ld]
			\ar@{.>}[ddd]
		\\
		& (0, 0)
			\ar@{=}[lu]
			\ar@{:}[r]
		& (0, 0)
			\ar[d]
		\\
		& (0, 0)
			\ar@{=}[u]
			\ar@{.>}[r]
		& (0, 1)
			\ar[rd]
		\\
		(1, 0)
			\ar[ru]
			\ar@{.>}[uuu]
			\ar@{.>}[rrr]
		&&& (1, 1).
	}
\]
While the operations $\vee$ and $\wedge$ in themselves are useful in developing a base category for pro-arrow equipments in order to extract companion and conjoint squares from an arrow, cube transformations such as the one above are not assumed in the definition of pro-arrow equipments, so we wish to exclude these.
For this reason, we will no longer be interested in cartesian jet-$\booleanalg$-cubes.
By \cref{thm:affine-automatic}, we are also no longer interested in cartesian jet-$\bipointedsym$-cubes.
In short then, by \cref{rem:two-monads}:
\begin{remark} \label{rem:no-cartesian}
	We are no longer interested in cartesian jet cubes.
\end{remark}

\subsection{A Calculus for Jet Cube Morphisms} \label{sec:jetcubes:calculus}
In this section, we develop a calculus that inductively generates the morphisms of the category \allowbreak $\jetcubetri{\affine}{M}{\vec a}$ and therefore also those of its full subcategories $\jetcube{\myorix}{\affine}{M}{\vec a}$.

Since the forgetful functor $U : \jetset{\vec a} \to \Set$ is faithful, so is $\erasejc \loch : \jetcube{\myorix}{\affine}{M}{\vec a} \to \cubecat^\affine_M$.
As such, we can regard `being a morphism of jet cubes' as a proof-irrelevant property of morphisms of cubes, which we will therefore use as preterms.
Our calculus will therefore feature a single judgement $\sez \vfi : V \to W$ meaning that the morphism $\vfi : \erasejc V \to \erasejc W$ is in fact a morphism of jet cubes.
Soundness (\cref{thm:calculus-sound}) of the calculus will be the property that the judgement's meaning actually holds when the judgement is derivable, whereas completeness (\cref{thm:calculus-complete}) means that the judgement is derivable when its meaning is true.
We do not have to bother with an equational theory, as we can simply inherit it from $\cubecat_M^\affine$.

\begin{definition} \label{def:conv-jet-cube-cat}
	We call a jet cube \textbf{conventional} if each of its dimensions has a degree equal to or lower than the previous one.
	We write $\convjetcube{\myorix}{\mycubex}{M}{\vec a}$ for the full subcategory of $\jetcube{\myorix}{\mycubex}{M}{\vec a}$ on conventional cubes.
\end{definition}
\begin{corollary} \label{thm:conv-jet-cube-cat}
	By \cref{thm:cube-commute-diff-degree}, the inclusion $\convjetcube{\myorix}{\mycubex}{M}{\vec a} \hookrightarrow \jetcube{\myorix}{\mycubex}{M}{\vec a}$ is essentially surjective (in fact split essentially surjective by the existence of sorting algorithms) and thus an equivalence of categories. \qedhere
\end{corollary}
%\begin{convention} \label{conv:sort-cubes}
%	When presenting the calculus, as justified by \cref{thm:cube-commute-diff-degree}, we will order the dimensions of a (forward/trioriented) jet cube by \emph{decreasing} degree.
%\end{convention}
\begin{figure}
	\[
		\inferencel{terminal}{
		}{
			\sez () : V \to ()
		}{}
	\]
	\[
		\inferencel{src:fwd}{
			\sez \vfi : V \to \Opcube_i(W)
		}{
			\sez (\vfi, 0/\dm i) : V \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{src:bck}{
			\sez \vfi : V \to \Opcube_i(W)
		}{
			\sez (\vfi, 1/\dm i) : V \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{tgt:fwd}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, 1/\dm i) : V \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{tgt:bck}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, 0/\dm i) : V \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{inv:fwd}{
			\sez (\vfi, t/\dm i) : V \to (W, \dm i : \rival{\tej_i})
		}{
			\sez (\vfi, \lnot t/\dm i) : V \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{inv:bck}{
			\sez (\vfi, t/\dm i) : V \to (W, \dm i : \rival{\jet_i})
		}{
			\sez (\vfi, \lnot t/\dm i) : V \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{prism:fwd}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, \dm i / \dm i) : (V, \dm i : \rival{\jet_i}) \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{prism:bck}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, \dm i / \dm i) : (V, \dm i : \rival{\tej_i}) \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
%	\[
%		\inferencel{prism:sym}{
%			\sez \vfi : (U, V) \to W
%		}{
%			\sez (\vfi, \dm i / \dm i) : (U, \dm i : \rival{\edge_i}, V) \to (W, \dm i : \rival{\edge_i})
%		}{}
%	\]
	\[
		\inferencel{symmetrize}{
			\sez \vfi : \Fsymcube_i V \to W
		}{
			\sez \vfi : V \to \Usymcube_i W
		}{}
	\]
	\[
		\inferencel{wkn}{
			\sez \vfi : \UFsymcube_i(V) \to W \qquad
			R \in \accol{\jet, \tej, \equijet}
		}{
			\sez (\vfi, \dm i / \novar) : (V, \dm i : \rival{R_i}) \to W
		}{}
%		\qquad
%		\inferencel{wkn:bck}{
%			\sez \vfi : \UFsymcube_i(V) \to W
%		}{
%			\sez (\vfi, \dm i / \novar) : (V, \dm i : \rival{\jet_i}) \to W
%		}{}
		\qquad
		\inferencel{exchange}{
			\sez \vfi : (V, \dm j : \rival{\equijet_i}, U_1, \dm i : \rival{\equijet_i}, U_2) \to W
		}{
			\sez \vfi : (V, \dm i : \rival{\equijet_i}, U_1, \dm j : \rival{\equijet_i}, U_2) \to W
		}{}
	\]
	\[
		\inferencel{concursor}{
			P \in \accol{\jet, \tej, \equijet}
			\qquad
			Q \in \accol{\jet, \tej}
			\qquad
			j > i
			\\
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{P_j}, V) \to (W, \dm i : \rival{Q_i})
		}{}
%		\inferencel{concursor:fwd}{
%			P \in \left\{
%				\begin{array}{c l}
%					\jet & \text{(`companion')}, \\
%					\tej & \text{(`conjoint')}, \\
%					\equijet & \text{(`equiconcursor')},
%				\end{array}
%			\right\}
%			\\
%			\\
%			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
%			\qquad
%			j > i
%		}{
%			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{P_j}, V) \to (W, \dm i : \rival{\jet_i})
%		}{}
%		\qquad
%		\inferencel{concursor:bck}{
%			P \in \left\{
%				\begin{array}{c l}
%					\tej & \text{(`companion')}, \\
%					\jet & \text{(`conjoint')}, \\
%					\equijet & \text{(`equiconcursor')},
%				\end{array}
%			\right\}
%			\\
%			\\
%			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
%			\qquad
%			j > i
%		}{
%			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{P_j}, V) \to (W, \dm i : \rival{\tej_i})
%		}{}
	\]
%	\[
%		\inferencel{companion:fwd}{
%			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
%			\qquad
%			j > i
%		}{
%			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\jet_i})
%		}{}
%		\qquad
%		\inferencel{companion:bck}{
%			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
%			\qquad
%			j > i
%		}{
%			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\tej_j}, V) \to (W, \dm i : \rival{\tej_i})
%		}{}
%	\]
%	\[
%		\inferencel{conjoint:fwd}{
%			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
%			\qquad
%			j > i
%		}{
%			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\tej_j}, V) \to (W, \dm i : \rival{\jet_i})
%		}{}
%		\qquad
%		\inferencel{conjoint:bck}{
%			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
%			\qquad
%			j > i
%		}{
%			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\tej_i})
%		}{}
%	\]
%	\[
%		\inferencel{equicompanion:fwd}{
%			\sez \vfi : \UFsymcube_i(U, V) \to W
%			\qquad
%			j > i
%		}{
%			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\equijet_j}, V) \to (W, \dm i : \rival{\jet_i})
%		}{}
%		\qquad
%		\inferencel{equicompanion:bck}{
%			\sez \vfi : \UFsymcube_i(U, V) \to W
%			\qquad
%			j > i
%		}{
%			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\equijet_j}, V) \to (W, \dm i : \rival{\tej_i})
%		}{}
%	\]
	\[
		\inferencel{conn:prism:src-neutral}{
			(Q, \opA) \in \mathemph{\accol{(\jet, \vee), (\tej, \wedge)}} \\
			\sez \vfi : \UFsymcube_i V \to W \\
			\sez (\vfi, t / \dm i) : \mathemph{\Opcube_i V} \to (W, \dm i : \rival{Q_i})
		}{
			\sez (\vfi, t \opA \dm i / \dm i) : (V, \dm i : \rival{Q_i}) \to (W, \dm i : \rival{Q_i})
		}{$\booleanalg$}
		\qquad
		\inferencel{conn:prism:tgt-neutral}{
			(Q, \opA) \in \mathemph{\accol{(\jet, \wedge), (\tej, \vee)}} \\
			\sez \vfi : \UFsymcube_i V \to W \\
			\sez (\vfi, t / \dm i) : \mathemph{V} \to (W, \dm i : \rival{Q_i})
		}{
			\sez (\vfi, t \opA \dm i / \dm i) : (V, \dm i : \rival{Q_i}) \to (W, \dm i : \rival{Q_i})
		}{$\booleanalg$}
	\]
	\[
		\inferencel{conn:prism-inv:src-neutral}{
			(Q, \opA, P) \in \mathemph{\accol{(\jet, \vee, \tej), (\tej, \wedge, \jet)}} \\
			\sez \vfi : \UFsymcube_i V \to W \\
			\sez (\vfi, t / \dm i) : \mathemph{\Opcube_i V} \to (W, \dm i : \rival{Q_i})
		}{
			\sez (\vfi, t \opA \mathemphB{\lnot \dm i} / \dm i) : (V, \dm i : \mathemphB{\rival{P_i}}) \to (W, \dm i : \rival{Q_i})
		}{$\booleanalg$}
		\qquad
		\inferencel{conn:prism-inv:tgt-neutral}{
			(Q, \opA, P) \in \mathemph{\accol{(\jet, \wedge, \tej), (\tej, \vee, \jet)}} \\
			\sez \vfi : \UFsymcube_i V \to W \\
			\sez (\vfi, t / \dm i) : \mathemph{V} \to (W, \dm i : \rival{Q_i})
		}{
			\sez (\vfi, t \opA \mathemphB{\lnot \dm i} / \dm i) : (V, \dm i : \mathemphB{\rival{P_i}}) \to (W, \dm i : \rival{Q_i})
		}{$\booleanalg$}
	\]
	\[
		\inferencel{conn:degree-symmetric}{
			Q \in \accol{\jet, \tej} \qquad
			\opA \in \accol{{\vee}, {\wedge}} \\
			\sez (\vfi, s / \dm i) : \UFsymcube_i V \to (W, \dm i : \rival{Q_i}) \\
			\sez (\vfi, t / \dm i) : V \to (W, \dm i : \rival{Q_i})
		}{
			\sez (\vfi, t \opA s / \dm i) : V \to (W, \dm i : \rival{Q_i})
		}{$\booleanalg$}
	\]
%	\[
%		\inferencel{conj:fwd}{
%			\sez \vfi : \UFsymcube_i V \to W \\
%			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})
%		}{
%			\sez (\vfi, s \wedge t/\dm k) : V \to (W, \dm k : \rival{\jet_i})
%		}{$\booleanalg$}
%		\qquad
%		\inferencel{disj:bck}{
%			\sez \vfi : \UFsymcube_i V \to W \\
%			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\tej_i}, \dm j : \rival{\tej_i})
%		}{
%			\sez (\vfi, s \vee t/\dm k) : V \to (W, \dm k : \rival{\tej_i})
%		}{$\booleanalg$}
%	\]
%	\[
%		\inferencel{disj:fwd}{
%			\sez \vfi : \UFsymcube_i V \to W \\
%			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\tej_i}, \dm j : \rival{\jet_i})
%		}{
%			\sez (\vfi, s \vee t/\dm k) : V \to (W, \dm k : \rival{\jet_i})
%		}{$\booleanalg$}
%	\qquad
%		\inferencel{conj:bck}{
%			\sez \vfi : \UFsymcube_i V \to W \\
%			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\jet_i}, \dm j : \rival{\tej_i})
%		}{
%			\sez (\vfi, s \wedge t/\dm k) : V \to (W, \dm k : \rival{\tej_i})
%		}{$\booleanalg$}
%	\]
%	\[
%		\inferencel{truth-table}{
%			a_i = \npolar
%			\qquad
%			\vec t[x_1, \ldots, x_n] \in (\booleanalg \accol{x_1, \ldots, x_n})^m
%			\\
%			\phantom{a_i = \npolar}
%			\qquad
%			\text{$\vec t : \accol{0, 1}^n \to \accol{0, 1}^m$ is non-expansive w.r.t.\ $\ell^1$-distance}
%			\\
%			\sez (\vfi, s_1/\dm i_1, \ldots, s_n/\dm i_n) : V \to (W, \dm i_1 : \rival{\edge_i}, \ldots, \dm i_n : \rival{\edge_i})
%		}{
%			\sez (\vfi, t_1[s_1, \ldots, s_n] / \dm j_1, \ldots, t_m[s_1, \ldots, s_n]) / \dm j_m) : V \to (W, \dm j_1 : \rival{\edge_i}, \ldots, \dm j_m : \rival{\edge_i})
%		}{$\booleanalg$, $\cartes$}
%	\]
	\caption{A calculus of affine trioriented jet cube morphisms, for the monads $\bipointedsym$ and $\booleanalg$. See \cref{fig:calculus:sym} for specializations of these rules to symmetric degrees and \cref{fig:calculus:general} for unified versions of the specialized forward/backward rules.}
	\label{fig:calculus}
\end{figure}
\begin{figure}[htb]
	\[
		\inferencel{endpoint:sym}{
			\sez \vfi : V \to W
			\qquad
			c \in \accol{0, 1}
		}{
			\sez (\vfi, c/\dm i) : V \to (W, \dm i : \rival{\edge_i})
		}{}
		\qquad
		\inferencel{inv:sym}{
			\sez (\vfi, t/\dm i) : V \to (W, \dm i : \rival{\edge_i})
		}{
			\sez (\vfi, \lnot t/\dm i) : V \to (W, \dm i : \rival{\edge_i})
		}{}
	\]
	\[
		\inferencel{prism:sym}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, \dm i / \dm i) : (V, \dm i : \rival{\edge_i}) \to (W, \dm i : \rival{\edge_i})
		}{}
		\qquad
		\inferencel{wkn:sym}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, \dm i / \novar) : (V, \dm i : \rival{\edge_i}) \to W
		}{}
%		\inferencel{conn:prism:sym}{
%			\opA \in \accol{{\vee}, {\wedge}} \\
%			\sez (\vfi, s / \dm i) : V \to (W, \dm i : \rival{\edge_i})
%		}{
%			\sez (\vfi, \dm i \opA s / \dm i) : (V, \dm i : \rival{\edge_i}) \to (W, \dm i : \rival{\edge_i})
%		}{$\booleanalg$}
	\]
	\[
		\inferencel{exchange:sym}{
			\sez \vfi : (V, \dm j : \rival{\edge_i}, U_1, \dm i : \rival{\edge_i}, U_2) \to W
		}{
			\sez \vfi : (V, \dm i : \rival{\edge_i}, U_1, \dm j : \rival{\edge_i}, U_2) \to W
		}{}
		\qquad
		\inferencel{conn:sym}{
			\opA \in \accol{{\vee}, {\wedge}} \\
			\sez (\vfi, s / \dm i) : V \to (W, \dm i : \rival{\edge_i}) \\
			\sez (\vfi, t / \dm i) : V \to (W, \dm i : \rival{\edge_i})
		}{
			\sez (\vfi, t \opA s / \dm i) : V \to (W, \dm i : \rival{\edge_i})
		}{$\booleanalg$}
	\]
	\caption{Symmetric specializations of the rules in \cref{fig:calculus}. Note that the rules \textsc{conn:prism:}$*$ become a special case of \ruleref{conn:degree-symmetric}. We omit \ruleref{terminal} which specifies no degree, \ruleref{concursor} which specifies two, and \ruleref{symmetrize} which already places constraints on the anpolarity $a_i$.}
	\label{fig:calculus:sym}
\end{figure}
\begin{figure}[htb]
	\[
		\inferencel{src}{
			(Q, c) \in \mathemph{\accol{(\jet, 0), (\tej, 1)}} \\
			\sez \vfi : V \to \mathemph{\Opcube_i(W)}
		}{
			\sez (\vfi, c/\dm i) : V \to (W, \dm i : \rival{Q_i})
		}{}
		\qquad
		\inferencel{tgt}{
			(Q, c) \in \mathemph{\accol{(\jet, 1), (\tej, 0)}} \\
			\sez \vfi : V \to \mathemph{W}
		}{
			\sez (\vfi, c/\dm i) : V \to (W, \dm i : \rival{Q_i})
		}{}
	\]
	\[
		\inferencel{inv}{
			\accol{P, Q} = \accol{\jet, \tej} \\
			\sez (\vfi, t/\dm i) : V \to (W, \dm i : \rival{P_i})
		}{
			\sez (\vfi, \lnot t/\dm i) : V \to (W, \dm i : \rival{Q_i})
		}{}
		\qquad
		\inferencel{prism}{
			\sez \vfi : V \to W
			\qquad
			Q \in \accol{\jet, \tej}
		}{
			\sez (\vfi, \dm i / \dm i) : (V, \dm i : \rival{Q_i}) \to (W, \dm i : \rival{Q_i})
		}{}
	\]
	\caption{Unified versions of the specialized forward/backward rules in \cref{fig:calculus}.}
	\label{fig:calculus:general}
\end{figure}
\begin{definition} \label{def:calculus}
	For $M \in \accol{\bipointedsym, \booleanalg}$, any mask $\vec a$ and for any two objects
	\[
		V, W \in \Obj(\convjetcubetri \affine M {\vec a}),
	\]
	we define a proof-irrelevant predicate on morphisms $\vfi : \erasejc V \to \erasejc W$, denoted $\sez \vfi : V \to W$, inductively generated by the inference rules in \cref{fig:calculus}.
\end{definition}
We discuss these inference rules one by one; their soundness and completeness will be proven in \cref{thm:calculus-sound,thm:calculus-complete}.
Specializations of these rules for symmetric degrees are given in \cref{fig:calculus:sym}, and some rules are grouped together in \cref{fig:calculus:general}.

The unique morphism to the terminal cube $()$ is a jet cube morphism (\ruleref{terminal}).

We can substitute the last variable with an endpoint. If this end point is at the last dimension's source side, then the rest of the morphism lands in the $i$-opposite of $W$ (\ruleref{src:fwd}, \ruleref{src:bck}), otherwise it lands in $W$ itself (\ruleref{tgt:fwd}, \ruleref{tgt:bck}).

We can apply an involution to the last variable, provided that we turn around its direction (\ruleref{inv:fwd}, \ruleref{inv:bck}). Doing so means that the source-side is mapped to the source-side and the target-side is mapped to the target-side, so $W$ remains unaffected.

We can apply the (opposite) $i$-twisted prism functor to a morphism (\ruleref{prism:fwd}, \ruleref{prism:bck}).

If the last dimension of our target cube is of the form $\dm i : \rival{\equijet_i}$, then we know that our cube is in the image of $\Usymcube_i$, and we can proceed using the adjunction $\Fsymcube_i \dashv \Usymcube_i$ (\ruleref{symmetrize}).
This turns our last dimension into $\dm i : \rival{\edge_i}$ which is a special case of both $\dm i : \rival{\jet_i}$ and $\dm i : \rival{\tej_i}$, so we can proceed by using the \textsc{fwd} and \textsc{bck} rules of the calculus.

We can weaken w.r.t.\ the last dimension (\ruleref{wkn}) of the source cube, but some caution is required. At the source-side of the last dimension, we find $\Opcube_i(V)$, whereas at the target-side we have $V$.
Thus, $\vfi$ needs to be a morphism of jet cubes from $\Opcube_i(V) \to W$ as well as from $V \to W$.
This can be achieved by asking that $\vfi$ starts from $\UFsymcube_i(V)$, which can be thought of as a join of $\Opcube_i(V)$ and $V$. In the case of an equijet dimension, $\UFsymcube_i(V) = V = \Opcube_i(V)$.

We can exchange variables of the same symmetric degree $i$ (\ruleref{exchange}).
Note that conventionality implies that all variables in $U_1$ are also of type $\rival{\equijet_i}$.

We can substitute the last variable with a variable of a weaker (higher) degree in either direction (or of equijet dimension).
Inspired by \cref{thm:jetset-equipment}, we choose to use terminology from pro-arrow equipments and refer to this action as creating a companion when the direction of the arrow remains the same ($P = Q$), and a conjoint when it reverses ($\accol{P, Q} = \accol{\jet, \tej}$); we introduce the term \textbf{concursor} (\ruleref{concursor}) as the common generalization of companions, conjoints, and their symmetric counterpart \textbf{equiconcursors} ($P = {\equijet}$).
Some measures of caution need to be taken however, which we consider in the case of forward companions ($P = Q = {\jet}$), where we wish to derive $(\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\jet_i})$.
First of all, we need to enforce affineness and make sure that $\vfi$ does not use the variable $\dm j$, so we will have $\vfi : (\erasejc{U}, \erasejc{V}) \to \erasejc{W}$.
Now let us look at what happens when we set $\dm i$ and $\dm j$ to $0$ or to $1$:
\[
	\xymatrix{
		(\Opcube_j(U), V)
			\ar[d]_{(0/\dm j)}
			\ar@{.>}[rr]^\vfi
		&&
		\Opcube_i(W)
			\ar[d]^{(0/\dm i)}
		\\
		(U, \dm j : \rival{\jet_j}, V)
			\ar[rr]_{(\vfi, \dm j / \dm i)}
		&& (W, \dm i : \rival{\jet_i})
		\\
		(U, V)
			\ar[u]^{(1/\dm j)}
			\ar@{.>}[rr]_\vfi
		&&
		W
			\ar[u]_{(1/\dm i)}
	}
\]
So $\vfi$ needs to be both a morphism of jet cubes from $(U, V)$ to $W$ and from $(\Opcube_j(U), V)$ to $\Opcube_i(W)$ or equivalently from $\Opcube_i(\Opcube_j(U), V)$ to $W$. This can be achieved by asking that $\vfi$ starts from \allowbreak $\UFsym_i(\UFsym_j(U), V)$, which can be thought of as a join of $(U, V)$ and $\Opcube_i(\Opcube_j(U), V)$.

The last five rules involve connections (conjunction and disjunction) and only apply if $M = \booleanalg$, as $\bipointedsym$ does not provide these operations.
Due to the twisted nature of the twisted prism functor, it turns out that we can substitute the last variable of the target cube only with a connection of which one operand (say the right one) is either (the negation of) the last variable of the source cube, or an expression depending only on $i$-symmetric variables.%
\footnote{This is formalized in \cref{thm:char-jet-cube-to-line}.}

In either case, it turns out that whether the last term reduces to $0$ or $1$ on any end point of the source cube, is sufficiently irregular that $i$-directed terms in the remainder of $\vfi$ can only depend on $i$-symmetric variables.
The promotion of all variables of degree $i$ to equijet variables in the context of $\vfi$ in at least one of the premises, precludes their usage in $i$-directed terms.

In the latter case, we can use \ruleref{conn:degree-symmetric}, where $s$ is also checked in the symmetrized context.

In the former case, we get to apply a rule that combines a connection, possibly an inversion, and the \ruleref{prism} rules.
The main point worth remarking upon is that the behaviour of $t$ only matters when the other operand reduces to the neutral element of the connection at hand.
Depending on this, we decide whether $t$ must be checked in the $i$-opposite context or not.
For example, in \ruleref{conn:prism:src-neutral}, if $Q = {\jet}$ and $\opA = \vee$, then the neutral element is $0$, so the behaviour of $t$ only matters when the other operand is $0$.
This means that we are coming from the source-side of $\dm i$, i.e.\ from $\Opcube_i V$.
This distinction leads to four different rules (\ruleref{conn:prism:src-neutral}, \ruleref{conn:prism:tgt-neutral}, \ruleref{conn:prism-inv:src-neutral}, \ruleref{conn:prism-inv:src-neutral}).

It is worth pointing out that if $a_i = \npolar$, then \ruleref{conn:degree-symmetric} specializes to the rule \ruleref{conn:sym} (\cref{fig:calculus:sym}) that is sufficiently general to also subsume the symmetric specializations of the other connection rules.

%\todoi{Old stuff}
%For rules allow us to substitute the last variable with a connection.
%The directions of the arrows in \ruleref{conj:fwd} and \ruleref{disj:fwd} can be understood by simply drawing jet squares and their images:
%\[
%	\xymatrix{
%		& {\mathclap{(\dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})}}
%		\\
%		(0/\dm i, 0/\dm j)
%			\ar[rr]
%			\ar@{<-}[d]
%		&&
%		(0/\dm i, 1/\dm j)
%			\ar[d]
%		\\
%		(1/\dm i, 0/\dm j)
%			\ar[rr]
%		& \ar@{|=>}[d]^{(\dm i \wedge \dm j / \dm k) \circ \loch} &
%		(1/\dm i, 1/\dm j)
%		\\
%		(0/\dm k)
%			\ar@{=}[rr]
%			\ar@{=}[d]
%		&&
%		(0/\dm k)
%			\ar[d]
%		\\
%		(0/\dm k)
%			\ar[rr]
%		&&
%		(1/\dm k)
%	}
%	\qquad \qquad
%	\xymatrix{
%		& {\mathclap{(\dm i : \rival{\tej_i}, \dm j : \rival{\jet_i})}}
%		\\
%		(0/\dm i, 0/\dm j)
%			\ar[rr]
%			\ar[d]
%		&&
%		(0/\dm i, 1/\dm j)
%			\ar@{<-}[d]
%		\\
%		(1/\dm i, 0/\dm j)
%			\ar[rr]
%		& \ar@{|=>}[d]^{(\dm i \vee \dm j / \dm k) \circ \loch} &
%		(1/\dm i, 1/\dm j)
%		\\
%		(0/\dm k)
%			\ar[rr]
%			\ar[d]
%		&&
%		(1/\dm k)
%			\ar@{=}[d]
%		\\
%		(1/\dm k)
%			\ar@{=}[rr]
%		&&
%		(1/\dm k)
%	}
%\]
%The rules \ruleref{disj:bck} and \ruleref{conj:bck} then follow by conjugating with the involution.
%Again, caution is required.
%For example, in \ruleref{conj:fwd}, assume that $s = \dm i$ and $t = \dm j$ and consider what happens when we substitute $\dm i$ and $\dm j$ in \ruleref{conj:fwd} with different combinations that yield $0/\dm k$:
%\[
%	\xymatrix{
%		\Opcube_i(U)
%			\ar@/_/[dd]_{(0/\dm i, 1/\dm j)}
%			\ar@/^/[dd]^{(1/\dm i, 0/\dm j)}
%			\ar@{.>}[rr]^\vfi
%		&& \Opcube_i(W)
%			\ar[dd]^{(0/\dm k)}
%		\\
%		& U
%			\ar[ld]|{(0/\dm i, 0/\dm j)}
%			\ar@{.>}[ru]^\vfi
%		\\
%		(U, \dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})
%		\ar[rr]_{(\vfi, \dm i \wedge \dm j / \dm k)}
%		&&
%		(W, \dm k : \rival{\jet_i})
%	}
%\]
%Again, we see that $\vfi : \erasejc U \to \erasejc W$ needs to be a morphism of jet cubes both from $\Opcube_i(U) \to \Opcube_i(W)$ (or equivalently from $U \to W$) and from $U \to \Opcube_i(W)$ (or equivalently from $\Opcube_i(U) \to W$). Again, we let $\vfi$ depart from their join $\UFsymcube_i(U)$.
%The cube $\erasejc U$ arose as the part of $\erasejc V$ not used by $s$ and $t$, so in the typing rule we can simply use $\UFsymcube_i(V)$ (this will be formalized in \cref{thm:calculus-sound,thm:calculus-complete}).

\subsubsection{Soundness}
\begin{theorem}[Soundness] \label{thm:calculus-sound}
	If a morphism $\vfi : \erasejc V \to \erasejc W$ satisfies the predicate $\sez \vfi : V \to W$ from \cref{def:calculus}, then it actually arises as the image $\vfi = \erasejc{\hat \vfi}$ of a morphism $\hat \vfi : V \to W$.
\end{theorem}
\begin{proof}
	Note that what really needs to be proven is that $\sez \vfi : V \to W$ implies that $\EP(\vfi)$, which a priori is a function from the set $\EP(\erasejc V) = U(\JEP(V))$ to $\EP(\erasejc W) = U(\JEP(W))$, is in fact a morphism of jet sets $\JEP(V) \to \JEP(W)$.
	We prove this, of course, by induction on the derivation of the inductive predicate.
	
	\begin{itemize}
		\item For \ruleref{terminal}, note that $\JEP(())$ is the terminal jet set.
	
		\item For \ruleref{src:fwd}, \ruleref{src:bck}, \ruleref{tgt:fwd} and \ruleref{tgt:bck}, this follows immediately from \cref{def:prism}.
		
		\item For \ruleref{inv:fwd}, by postcomposition, it suffices to show that $\zeta : (\id_W, \lnot \dm i / \dm i) : \erasejc{(W, i : \rival{\tej_i})} \to \erasejc{(W, i : \rival{\jet_i})}$ is a morphism of jet cubes, i.e.\ that $\EP(\zeta) : (\vec w, u) \mapsto (\vec w, \lnot u)$ is a morphism of jet sets $\JEP(W) \multip \rival{\tej_i} \to \JEP(W) \multip \rival{\jet_i}$.
		
		Let $(\vec w, u) \jet_j (\vec w', u')$ in $\JEP(W) \multip \rival{\tej_i}$. Then by \cref{def:prism} of the opposite $i$-twisted prism, there are 3 possibilities:
		\begin{itemize}
			\item We have $u = u' = 0$ and $\vec w \jet_j \vec w'$ in $\JEP(W)$.
			In that case, we also have the required jet between the images $(\vec w, 1) \jet_j (\vec w', 1)$ in $\JEP(W) \multip \rival{\jet_i}$.
			\item We have $u = u' = 1$ and $\vec w \jet_j \vec w'$ in $\Op_i(\JEP(W))$.
			In that case, we also have the required jet between the images $(\vec w, 0) \jet_j (\vec w', 0)$ in $\JEP(W) \multip \rival{\jet_i}$.
			\item We have $j = i$, $u = 1$, $u' = 0$ and $\vec w = \vec w'$.
			In that case, we also have the required jet between the images $(\vec w, 0) \jet_i (\vec w, 1)$ in $\JEP(W) \multip \rival{\jet_i}$.
		\end{itemize}
		The proof of soundness of \ruleref{inv:bck} is analogous.
		
		\item Soundness of \ruleref{prism:fwd} and \ruleref{prism:bck} was already established by \cref{thm:lift-to-jet-cubes}.
		
		\item Soundness of \ruleref{symmetrize} follows from the adjunction established in \cref{thm:lift-to-jet-cubes}.
		
		\item We prove soundness of \ruleref{wkn} by precomposition with a jet cube morphism that erases to $(\id, \dm i / \novar) : \erasejc{(V, \dm i : \rival{R_i})} \to \UFsym_i \erasejc{V}$.
		Thus, we need to prove that $\EP(\id, \dm i / \novar) : (\vec v, w) \mapsto \vec v$ is a jet set morphism $\JEP(V, \dm i : \rival{R_i})
		%= \JEP(V) \multip \rival{\jet_i}
		\to \JEP(\UFsymcube_i(V))$.
		Let $(\vec v, w) \jet_j (\vec v', w')$ in $\JEP(V, \dm i : \rival{R_i})$.
		Then there are two possibilities:
		\begin{itemize}
			\item $w = w'$ and $(\vec v, w) \jet_j (\vec v', w)$. The latter implies $\vec v \jet_j \vec v'$ in $\JEP(V)$ if $j \neq i$ and $\vec v \infrajet_i \vec v'$ if $j = i$. Moving to $\JEP(\UFsymcube_i(V))$, we get $\vec v \jet_j \vec v'$ in all cases, as required.
			\item $j = i$, $\vec v = \vec v'$ and $w \jet_i w'$. In this case we have $\vec v \jet_j \vec v$ in $\JEP(\UFsymcube_i(V))$ by reflexivity.
		\end{itemize}
		
		\item Recalling \cref{def:jep}, soundness of \ruleref{exchange} follows from \cref{thm:cube-commute-symmetric}.
		(Note that, since we are dealing with conventional cubes, all variables in $U_1$ also have type $\rival{\equijet_i}$.)
		
		\item We prove soundness of \ruleref{concursor}.
		Assume that $\vfi$ is a jet cube morphism $\UFsymcube_i(\UFsymcube_j U, V) \to W$ and $j > i$.
		We prove that $(\vfi, \dm j / \dm i)$ is a jet cube morphism $(U, \dm j : \rival{P_j}, V) \to (W, \dm i : \rival{Q_i})$.
		Write $f = \EP(\vfi)$ and $g = \EP(\vfi, \dm j / \dm i)$.
		
		Pick a jet $(\vec u, t, \vec v) \jet_k (\vec u', t', \vec v')$ in $\JEP(U, \dm j : \rival{P_j}, V)$.
		We can assume that this jet is not reflexive.
		Let $\dm k$ be the variable where both hands differ.
		There are three possibilities:
		\begin{itemize}
			\item If $\dm k \in U$, then we have $t = t'$, $\vec v = \vec v'$ and $(\vec u, t, \vec v) \jet_k (\vec u', t, \vec v)$.
			\begin{itemize}
				\item If $k \neq j$ and $k \neq i$, this implies $(\vec u, \vec v) \jet_k (\vec u', \vec v)$ in $\JEP(U, V)$ and therefore also in $\JEP(\UFsymcube_i(\UFsymcube_j U, V))$, whence $f(\vec u, \vec v) \jet_k f(\vec u', \vec v)$, whence $g(\vec u, t, \vec v) = (f(\vec u, \vec v), t) \jet_k (f(\vec u', \vec v), t) = g(\vec u', t, \vec v)$.
				\item If $k = i$ or $k = j$, this implies $(\vec u, \vec v) \infrajet_k (\vec u', \vec v)$ in $\JEP(U, V)$ and therefore $(\vec u, \vec v) \equijet_k (\vec u', \vec v)$ in $\JEP(\UFsymcube_i(\UFsymcube_j U, V))$, whence $f(\vec u, \vec v) \equijet_k f(\vec u', \vec v)$, whence $g(\vec u, t, \vec v) = (f(\vec u, \vec v), t) \equijet_k (f(\vec u', \vec v), t) = g(\vec u', t, \vec v)$.
			\end{itemize}
			\item If $\dm k = \dm j$, then we have $k = j$, $\vec u = \vec u'$, $t \neq t'$ and $\vec v = \vec v'$. Then $g(\vec u, t, \vec v) = (f(\vec u, \vec v), t) \infrajet_i (f(\vec u, \vec v), t') = g(\vec u, t', \vec v)$ which implies $g(\vec u, t, \vec v) \jet_j g(\vec u, t', \vec v)$ since $j > i$.
			\item If $\dm k \in V$, then we have $t = t'$, $\vec u = \vec u'$ and $\vec v \jet_k \vec v'$ in $\JEP(V)$.
			\begin{itemize}
				\item If $k \neq i$, this implies $(\vec u, \vec v) \jet_k (\vec u, \vec v')$ in $\JEP(\UFsymcube_i(\UFsymcube_j U, V))$, whence $f(\vec u, \vec v) \jet_k f(\vec u, \vec v')$, whence $g(\vec u, t, \vec v) = (f(\vec u, \vec v), t) \jet_k (f(\vec u, \vec v'), t) = g(\vec u, t, \vec v')$.
				\item If $k = i$, this implies $(\vec u, \vec v) \equijet_i (\vec u, \vec v')$ in $\JEP(\UFsymcube_i(\UFsymcube_j U, V))$, whence $f(\vec u, \vec v) \equijet_i f(\vec u, \vec v')$, whence $g(\vec u, t, \vec v) = (f(\vec u, \vec v), t) \equijet_i (f(\vec u, \vec v'), t) = g(\vec u, t, \vec v')$.
			\end{itemize}
		\end{itemize}
		
		\item We prove soundness of \ruleref{conn:prism:src-neutral} for the case where $Q = {\jet}$ and $\opA = \vee$, the other case is proven analogously.
		Assume that $\vfi$ is a jet cube morphism $\UFsymcube_i V \to W$ and $(\vfi, t / \dm i)$ is a jet cube morphism $\Opcube_i V \to (W, \dm i : \rival{\jet_i})$.
		We prove that $(\vfi, t \vee \dm i / \dm i)$ is a jet cube morphism $(V, \dm i : \rival{\jet_i}) \to (W, \dm i : \rival{\jet_i})$.
		Write $f = \EP(\vfi)$ and $g = \EP(\vfi, t \vee \dm i / \dm i)$ and $h = \EP(\vfi, t / \dm i)$.
		
		Pick a non-reflexive jet $(\vec v, u) \jet_j (\vec v', u')$ in $\JEP(V, \dm i : \rival{\jet_i})$.
		Let $\dm k$ be the variable where both hands defer.
		There are two possibilities:
		\begin{itemize}
			\item If $\dm k = \dm i$, then $j = i$, $\vec v = \vec v'$, $u = 0$ and $u' = 1$.
			In this case, $(t \vee \dm i) \psub{\vec v, 1} = 1$, so that there is necessarily an $i$-jet $g(\vec v, 0) = (f(\vec v), (t \vee \dm i) \psub{\vec v, 0}) \jet_i (f(\vec v), 1) = g(\vec v, 1)$.
			\item If $\dm k \in V$, then $u = u'$ and $(\vec v, u) \jet_j (\vec v', u)$. Let $\dm l$ be the variable in $(W, \dm i : \rival{\jet_i})$ such that $\dm l \psub{\vfi, t \vee \dm i}$ depends on $\dm k$.
			If there is no such variable, then we are done.
			\begin{itemize}
				\item If $\dm l = \dm i$, then $\dm k$ occurs in $t$.
				\begin{itemize}
					\item If $u = 1$, then $g(\vec v, 1) = (f(\vec v), 1) \overset{=}{\jet}_j (f(\vec v'), 1) = g(\vec v', 1)$ as required.
					\item If $u = 0$, then we have $\vec v \jet_j \vec v'$ in $\JEP(\Opcube_i V)$.
					Because $(\vfi, t / \dm i)$ is a jet cube morphism $\Opcube_i V \to (W, \dm i : \rival{\jet_i})$, we get
					$g(\vec v, 0) = h(\vec v) \jet_j h(\vec v') = g(\vec v', 0)$ as required.
				\end{itemize}
				\item If $\dm l \in W$, then $\dm k$ occurs in $\vfi$.
				Define $z = (t \vee \dm i) \psub{\vec v, u} = (t \vee \dm i) \psub{\vec v', u}$.
				We have $g(\vec v, u) = (f(\vec v), z)$ and $g(\vec v', u) = (f(\vec v'), z)$.
				\begin{itemize}
					\item If $j = i$, then we have $\vec v \equijet_i \vec v'$ in $\JEP(\UFsymcube_i V)$, whence $f(\vec v) \equijet_i f(\vec v')$ in $\JEP(W)$, whence $g(\vec v, u) = (f(\vec v), z) \jet_i (f(\vec v'), z) = g(\vec v', u)$ in $\JEP(W, \dm i : \rival{\jet_i})$.
					\item If $j \neq i$, then we have $\vec v \jet_j \vec v'$ in $\JEP(\UFsymcube_i V)$, whence $f(\vec v) \jet_j f(\vec v')$ in $\JEP(W)$, whence $g(\vec v, u) = (f(\vec v), z) \jet_j (f(\vec v'), z) = g(\vec v', u)$ in $\JEP(W, \dm i : \rival{\jet_i})$.
				\end{itemize}
			\end{itemize}
%			\item $u = u'$ and $(\vec v, u) \jet_j (\vec v', u)$. The latter implies $\vec v \jet_j \vec v'$ in $\JEP(V)$ if $j \neq i$ and $\vec v \infrajet_i \vec v'$ if $j = i$.
%			Either way, we get $\vec v \jet_j \vec v'$ in $\JEP(\UFsymcube_i V)$ and therefore $f(\vec v) \jet_j f(\vec v')$ in $\JEP(W)$ where $f = \EP(\vfi)$.
		\end{itemize}
		
		\item Soundness of \ruleref{conn:prism:tgt-neutral} is proven analogously to that of \ruleref{conn:prism:src-neutral}.
		
		\item Soundness of \ruleref{conn:prism-inv:src-neutral} is proven from soundness of \allowbreak \ruleref{conn:prism:src-neutral} by precomposing the result with $(\id_V, \lnot \dm i / \dm i)$ which is a jet cube morphism $(V, \dm i : \rival{P_i}) \to (V, \dm i : \rival{Q_i})$.
		
		\item Soundness of \ruleref{conn:prism-inv:tgt-neutral} is similarly proven from soundness of \ruleref{conn:prism:tgt-neutral}.
		
		\item We prove soundness of \ruleref{conn:degree-symmetric}.
		Assume that
		\begin{itemize}
			\item $(\vfi, s / \dm i)$ is a jet cube morphism $\UFsymcube_i V \to (W, \dm i : \rival{Q_i})$,
			\item $(\vfi, t / \dm i)$ is a jet cube morphism $V \to (W, \dm i : \rival{Q_i})$.
		\end{itemize}
		We prove that $(\vfi, s \opA t / \dm i)$ is a jet cube morphism $V \to (W, \dm i : \rival{Q_i})$.
		Write
		\[
			f = \EP(\vfi), \qquad
			g = \EP(\vfi, s / \dm i), \qquad
			h = \EP(\vfi, t / \dm i), \qquad
			d = \EP(\vfi, s \opA t / \dm i).
		\]
		Pick a non-reflexive jet $\vec v \jet_j \vec v'$ in $\JEP(V)$; we prove that $d(\vec v) \jet d(\vec v')$ in $\JEP(W, \dm i : \rival{Q_i})$.
		Let $\dm k$ be the variable of $V$ where $\vec v$ and $\vec v'$ differ.
		There are four possible cases:
		\begin{itemize}
			\item If $\vfi$, $s$ and $t$ do not depend on $\dm k$ then the target jet is reflexive.
			\item If $\vfi$ or $s$ depends on $\dm k$, then we have $t \psub{\vec v} = t \psub{\vec v'} =: t_0$.
			\begin{itemize}
				\item If $j \neq i$, then we have $\vec v \jet_j \vec v'$ in $\JEP(\UFsymcube_i V)$, whence $(f(\vec v), s\psub{\vec v}) = g(\vec v) \jet_j g(\vec v') = (f(\vec v'), s\psub{\vec v'})$ in $\JEP(W, \dm i : \rival{Q_i})$.
				Taking a connection with $t_0$ does not influence the direction of the arrows to the left of $\dm i$, nor of the arrows at $\dm i$.
				Hence we get $d(\vec v) = (f(\vec v), s\psub{\vec v} \opA t_0) \jet_j (f(\vec v'), s\psub{\vec v'} \opA t_0) = d(\vec v')$.
				
				\item If $j = i$, then we have $\vec v \equijet_i \vec v'$ in $\JEP(\UFsymcube_i V)$, whence $(f(\vec v), s\psub{\vec v}) = g(\vec v) \equijet_i g(\vec v') = (f(\vec v'), s\psub{\vec v'})$ in $\JEP(W, \dm i : \rival{Q_i})$.
				Hence we get $d(\vec v) = (f(\vec v), s\psub{\vec v} \opA t_0) \equijet_i (f(\vec v'), s\psub{\vec v'} \opA t_0) = d(\vec v')$.
			\end{itemize}
			\item If $t$ depends on $\dm k$, then we have $f(\vec v) = f(\vec v') = : f_0$ and $s \psub{\vec v} = s \psub{\vec v'} =: s_0$.
			We get $(f_0, t \psub{\vec v}) = h(\vec v) \jet_j h(\vec v') = (f_0, t \psub{\vec v'})$.
			Taking a connection with $s_0$ yields $d(\vec v) = (f_0, s_0 \opA t \psub{\vec v}) \jet_j (f_0, s_0 \opA t \psub{\vec v'}) = d(\vec v')$. \qedhere
		\end{itemize}
		
%		\item \todoi{Find-replace companion/conjoint} For \ruleref{companion:fwd}, let $\hat \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W$ be a jet cube morphism.
%		Then $f := \JEP(\hat \vfi)$ is a jet set morphism $\JEP(\UFsymcube_i(\UFsymcube_j U, V)) \to \JEP(W)$.
%		We need to show that $g : (\vec u, w, \vec v) \mapsto (f(\vec u, \vec v), w)$ is a jet set morphism $\JEP(U, \dm j : \rival{\jet_j}, V) \to \JEP(W, \dm i : \rival{\jet_i}) = \JEP(W) \multip \rival{\jet_i}$.
%		
%		Assume we have $(\vec u, w, \vec v) \jet_k (\vec u', w', \vec v')$ in $\JEP(U, \dm j : \rival{\jet_j}, V)$.
%		By induction on $V$, one can show that we are in one of the following situations:
%		\begin{itemize}
%			\item $\vec u = \vec u'$, $w = w'$ and $(\vec u, \vec v) \jet_k (\vec u, \vec v')$ in $\JEP(U, V)$.
%			The fact that $f$ is a jet set morphism implies that $f(\vec u, \vec v) \jet_k f(\vec u, \vec v')$ and even $f(\vec u, \vec v) \equijet_i f(\vec u, \vec v')$ if $k = i$.
%			Then we have the required jet between the images $(f(\vec u, \vec v), w) \jet_k (f(\vec u, \vec v'), w)$ in $\JEP(W) \multip \rival{\jet_i}$, where if $k = i$ we use the forward part of the equijet if $w = 1$ and the backward part if $w = 0$.
%			
%			\item $k = j$, $\vec u = \vec u'$, $\vec v = \vec v'$ and $\accol{w, w'} = \accol{0, 1}$. In that case, we have the required jet between the images $(f(\vec u, \vec v), w) \jet_j (f(\vec u, \vec v), w')$ because we have $(f(\vec u, \vec v), w) \infrajet_i (f(\vec u, \vec v), w')$ and $i < j$.
%			
%			\item $w = w'$, $\vec v = \vec v'$ and $(\vec u, w, \vec v) \jet_k (\vec u', w, \vec v)$ in $\JEP(U, \dm j : \rival{\jet_j}, V)$.
%			The latter implies $(\vec u, \vec v) \jet_k (\vec u', \vec v)$ in $\JEP(U, V)$ if $k \neq j$ and $(\vec u, \vec v) \infrajet_j (\vec u', \vec v)$ if $k = j$.
%			Moving to \allowbreak $\JEP(\UFsymcube_i(\UFsymcube_j U, V))$, the $j$-infrajet for $k = j$ turns into a $j$-equijet and the $i$-jet for $k = i$ turns into an $i$-equijet.
%			Thus, we conclude, in any case, that $f(\vec u, \vec v) \jet_k f(\vec u', \vec v)$ in $\JEP(W)$, and even $f(\vec u, \vec v) \equijet_i f(\vec u', \vec v)$ if $k = i$.
%			Then we have the required jet between the images $(f(\vec u, \vec v), w) \jet_k (f(\vec u', \vec v), w)$.
%		\end{itemize}
%		Soundness of \ruleref{companion:bck}, \ruleref{conjoint:fwd},\ruleref{conjoint:bck}, \ruleref{equicompanion:fwd} and \ruleref{equicompanion:bck} is proven almost identically, where it may be enlightening to remark that in the equicompanion rules, we know that $\UFsymcube_j(U) = U$.
%		
%		\item For \ruleref{conj:fwd}, assume given a jet cube morphism $\hat \vfi : \UFsymcube_i V \to W$ (write $\vfi = \erasejc{\hat \vfi}$ and $\EP(\vfi) = f$) and boolean expressions $s$ and $t$ such that $\EP(\vfi, s/\dm i, t/\dm j)$ is a jet set morphism $\JEP(V) \to \JEP(W, \dm i : \rival{\jet_i}, \dm j : \rival{\jet_i}) = \JEP(W) \multip \rival{\jet_i} \multip \rival{\jet_i}$.
%		We show that $\EP(\vfi, s \wedge t / \dm k)$ is a jet set morphism $\JEP(V) \to \JEP(W, \dm k : \rival{\jet_i}) = \JEP(W) \multip \rival{\jet_i}$.
%		Assume we have $v \jet_k v'$ in $\JEP(V)$. Then because $\EP(\vfi, s/\dm i, t/\dm j)$ is a jet set morphism, we are in one of the following situations:
%		\begin{itemize}
%			\item $s(\vec v) = s(\vec v') =: s_0$ and $t(\vec v) = t(\vec v') =: t_0$ and $(f(\vec v), s_0, t_0) \jet_k (f(\vec v'), s_0, t_0)$.
%			The latter implies that $f(\vec v) \jet_k f(\vec v')$ if $k \neq i$.
%			On the other hand, if $k = i$ then because $\hat \vfi : \UFsymcube_i V \to W$ is a jet cube morphism, we know that $f(\vec v) \equijet_i f(\vec v')$.
%			In any case, we get the required jet between the images $(f(\vec v), s_0 \wedge t_0) \jet_k (f(\vec v'), s_0 \wedge t_0)$.
%			
%			\item $k = i$, $f(\vec v) = f(\vec v') = f_0$ and $(s(\vec v), t(\vec v)) \jet_i (s(\vec v'), t(\vec v'))$ in $\rival{\jet_i} \multip \rival{\jet_i}$.
%			The latter implies that exactly one row of the following table applies:
%			\[
%				\begin{array}{c | c | c c}
%					(s(\vec v), t(\vec v))
%					& (s(\vec v'), t(\vec v'))
%					& s(\vec v) \wedge t(\vec v)
%					& s(\vec v') \wedge t(\vec v')
%					\\ \hline
%					(1, 0) & (0, 0) & 0 & 0
%					\\
%					(0, 1) & (1, 1) & 0 & 1
%					\\
%					(0, 0) & (0, 1) & 0 & 0
%					\\
%					(1, 0) & (1, 1) & 0 & 1
%				\end{array}
%			\]
%			In each case, we get $s(\vec v) \wedge t(\vec v) \jet_i s(\vec v') \wedge t(\vec v')$ in $\rival{\jet_i}$, and thus the required jet between the images $(f_0, s(\vec v) \wedge t(\vec v)) \jet_i (f_0, s(\vec v') \wedge t(\vec v'))$.
%		\end{itemize}
%		Soundness of \ruleref{disj:bck}, \ruleref{disj:fwd} and \ruleref{conj:bck} is proven analogously, but with a different case analysis in the table. \qedhere
		
%		\item We prove soundness of \ruleref{truth-table} by postcomposition with a jet cube morphism that erases to $(\id, \vec t[\vec{\dm i}]/\vec{\dm j}) : (W, \dm i_1 : \rival{\edge_i}, \ldots, \dm i_n : \rival{\edge_i}) \to (W, \dm j_1 : \rival{\edge_i}, \ldots, \dm j_m : \rival{\edge_i})$, i.e. we prove that $\EP(\id, \vec t[\vec{\dm i}]/\vec{\dm j}) : (\vec w, \vec u) \mapsto (\vec w, \vec t(\vec u))$ is a jet set morphism $\JEP(W, \dm i_1 : \rival{\edge_i}, \ldots, \dm i_n : \rival{\edge_i}) \to \JEP(W, \dm j_1 : \rival{\edge_i}, \ldots, \dm j_m : \rival{\edge_i})$.
%		
%		Assume we have $(\vec w, \vec u) \jet_j (\vec w', \vec u')$ in the domain.
%		Then there are two possibilities:
%		\begin{itemize}
%			\item $\vec u = \vec u'$ and $(\vec w, \vec u) \jet_j (\vec w', \vec u)$.
%			The latter implies $\vec w \jet_j \vec w'$ in $\JEP(W)$ even if $j = i$ because $a_i = \npolar$.
%			In that case, we have $(\vec w, \vec t(\vec u)) \jet_j (\vec w', \vec t(\vec u))$.
%			\item $i = j$, $\vec w = \vec w'$ and $\vec u \edge_i \vec u'$ in $\JEP(U)$. The latter implies that the $\ell^1$-distance $d^1(\vec u, \vec u') \leq 1$, hence $d^1(\vec t(\vec u), \vec t(\vec u')) \leq 1$, hence $\vec t(\vec u) \edge_i \vec t(\vec u')$, so that $(\vec w, \vec t(\vec u)) \edge_i (\vec w, \vec t(\vec u'))$.
%		\end{itemize}
	\end{itemize}
\end{proof}

\subsubsection{Lemmas for Completeness}
Proving completeness for the $\bipointedsym$ monad is fairly straightforward,
but for the cases involving connections (conjunctions and disjunctions), we need a couple of helper lemmas.

\paragraph{Boolean reduction}
\begin{definition} \label{def:reduction}
	Boolean terms $t \in \booleanalg(X)$ are equivalence classes $t = [e]$ of boolean expressions $e$, which can be regarded as abstract syntax trees.
	We define two reduction algorithms that reduce an expression $e$ to $e'$ such that $[e] = [e']$.
	\begin{itemize}
		\item By \textbf{(basic) reduction}, we mean the process of pushing all negations to the leaves, eliminating double negations, and simplifying conjunctions/disjunctions with the constants $0$ and $1$.
		The outcome is either a constant, or a binary tree whose nodes are labelled with $\vee$ or $\wedge$ and whose leaves are (negations of) elements of $X$ (called \textbf{variables} in this setting).
		\item For \textbf{associative reduction}, we first apply reduction and subsequently merge nodes with the same label.
		The outcome is either a constant or a tree whose nodes are alternatingly (as we climb the tree) labeled with $\vee$ and $\wedge$ (the root can have either) and whose leaves are (negations of) variables.
		Every node has finitely many children and at least 2.
	\end{itemize}
	We can also non-deterministically apply these algorithms to a term by first picking a representant and then reducing the representant.
\end{definition}
\begin{lemma} \label{thm:boolexp-to-const-assignment}
	For every $t \in \booleanalg^\#(X)$ with non-constant reduction $e$ and $c \in \accol{0, 1}$, there exists a bit assignment $\sigma : X \to \accol{0, 1}$ such that $t[\sigma] = c$.
\end{lemma}
\begin{proof}
	By induction on the height of $e$.
\end{proof}
\begin{lemma} \label{thm:boolexp-to-var-assignment}
	For every $t \in \booleanalg^\#(X)$ with reduction $e$ that has a leaf $\tilde x \in \accol{x,\lnot x}$ where $x \in X$, there exists a bit assignment $\sigma : X \setminus \accol x \to \accol{0, 1}$ such that $t[\sigma] = \tilde x$.
\todoi{Generalize this to sets of leaves.}
\end{lemma}
\begin{proof}
	By induction on the height of the tree.
	It is clear that $e$ is no constant, since it mentions $x$.
	If the tree is a leaf, we are done.
	If $e$ is a conjunction, then for every operand $d$ not depending on $x$, choose an assignment $\sigma$ for that operand's dependencies such that $[d][\sigma] = 1$.
	For the sole operand mentioning $x$, apply the induction hypothesis.
	For disjunctions, we proceed dually.
\end{proof}
\begin{corollary} \label{thm:reduction-minimal-deps}
	If $e$ is a (basic/associative) reduction of $t$ and $e$ depends on $x$, then every expression representing $t$ depends on $x$. \qedhere
\end{corollary}
\begin{definition} \label{def:in-connection}
	If an affine boolean $t \in \booleanalg^\#(X)$ reduces to $e$ which depends on $x, y \in X$, then we say that $x$ and $y$ are \textbf{in conjunction/disjunction in $e$} if the closest common parent node of (the negation of) $x$ and (the negation of) $y$ is labelled with a conjunction/disjunction.\footnote{This is manifestly a property of an \emph{expression} and not of a \emph{term}, since we can flip all labels by negating an expression twice and pushing one negation down the tree.} \todoi{This is a property of the reduction}
\end{definition}
\todoi{Associative reduction of affine terms is deterministic. This follows from the graph representation of expressions, which can be recognized from terms by assigning stuff. Develop some theory for this, this sounds fun.}

\paragraph{Understanding jet cube morphisms}
\begin{lemma} \label{thm:left-of-concursor}
	In $\jetcubetri \affine M {\vec a}$ with $M \in \accol{\bipointedsym, \booleanalg}$,
	%assuming \cref{conv:sort-cubes},
	the following holds:
	If a cube morphism $\vfi$ is a jet cube morphism $V = (V_0, \dm j : \rival{P_j}, V_1) \to W = (W_0, \dm i : \rival{Q_i}, W_1)$ with $P, Q \in \accol{\jet, \tej, \equijet}$ and $j > i$,
	and if either of the following conditions hold:
	\begin{itemize}
		\item $\dm j$ appears in $\dm i \psub \vfi$,
		\item $\dm j$ does not appear in $\vfi$ at all,
	\end{itemize}
	then $\vfi$ is also a jet cube morphism
	$\tilde V := (\UFsymcube_j(V_0), \dm j : \rival{\equijet_j}, V_1) \to W$.
\end{lemma}
We remark that this lemma is vacuous if $a_i = \npolar$ or $P = {\equijet}$.

In words, the lemma says: When a variable of the domain of a jet cube morphism is used at a lower degree in the codomain, or not at all, then that variable and all variables of the same degree to its left can be promoted to equijet variables.

%In practice, we will only use this lemma for $M = \booleanalg$.
\begin{proof}
	Let $W'$ be the cube obtained from $W$ by simply deleting all variables of degree $i$ or lower.
	Then the weakening morphism $\pi : W \to W'$ is a jet cube morphism.
	Thanks to affineness, $\pi \circ \vfi : V \to W'$ does not depend on $\dm j$.
	Hence, $\pi \circ \vfi \circ (0/\dm j) = \pi \circ \vfi \circ (1/\dm j) =: \rho : (\erasejc{V_0}, \erasejc{V_1}) \to \erasejc{W'}$.
	In the category of \emph{jet cubes} and \emph{cube morphisms between their erasures}, we have a commutative diagram
	\[
		\xymatrix{
			(\Opcube_j V_0, V_1)
				\ar@{.>}@/_/[rrdd]_{\rho}
				\ar[rr]^{(0/\dm j)}
			&&
			V
				\ar[d]^\vfi
			&&
			(V_0, V_1)
				\ar@{.>}@/^/[lldd]^{\rho}
				\ar[ll]_{(1/\dm j)}
			\\
			&& W
				\ar[d]^\pi
			\\
			&& W'
		}
	\]
	where the black arrows are known to be jet cube morphisms, and hence the dotted arrows are also jet cube morphisms as jet cube morphisms compose.
	Thus, $\rho$ is both a jet cube morphism $(\Opcube_j V_0, V_1) \to W'$ and $(V_0, V_1) \to W'$, hence it is a jet cube morphism $(\UFsymcube_j V_0, V_1) \to W'$.
	
	We now show that $\vfi$ is a jet cube morphism $\tilde V \to W$, i.e.\ that $f := \EP(\vfi)$ is a jet set morphism $\JEP(\tilde V) \to \JEP(W)$.
	Pick a non-reflexive jet $\vec v = (\vec v_0, u, \vec v_1) \jet_k \vec v' = (\vec v_0', u', \vec v_1')$ in $\tilde V$; we show that $f(\vec v) \jet_k f(\vec v')$.
	If $k \neq j$, then $\vec v \jet_k \vec v'$ is also a jet in $V$ and therefore preserved by $f$.
	Thus, we can assume that $k = j$.
	%If $\vec v = \vec v'$, then preservation is trivial, so we assume $\vec v \neq \vec v'$.
	Let $\dm k$ be the unique variable where $\vec v$ and $\vec v'$ differ.
	There are three possibilities
	\begin{description}
		\item[\framebox{$\dm k \in V_0$}]
		In this case, we have $\vec v_0 \infrajet_j \vec v_0'$ in $V_0$, $u = u'$, $\vec v_1 = \vec v_1'$, $\vec v \infrajet_j \vec v'$ in $V$ and $f(\vec v) \infrajet_j f(\vec v')$ in $W$.
		If $\vfi$ does not depend on $\dm k$, then $f(\vec v) = f(\vec v')$ and therefore $f(\vec v) \jet_j f(\vec v')$.
		So we assume that $\vfi$ depends on $\dm k$; let $\dm l$ be the variable such that $\dm l \psub \vfi$ depends on $\dm k$.
		\begin{itemize}
			\item If $\dm l$ is of degree $\ell \leq i < j$, then $f(\vec v) \infrajet_j f(\vec v')$ is only possible if $f(\vec v) \infrajet_\ell f(\vec v')$ which implies $f(\vec v) \equijet_j f(\vec v')$.
			\item If $\dm l$ is of degree $\ell > i$, then we have $\EP(\rho)(\vec v_0, \vec v_1) \overset{\neq}{\equijet}_j \EP(\rho)(\vec v_0', \vec v_1)$ because $\rho$ is a jet cube morphism $(\UFsymcube_j V_0, V_1) \to W'$.
			Since $\EP(\rho) = \EP(\pi) \circ \EP(\vfi) \circ \EP(c/\dm j)$ for any $c \in \accol{0, 1}$ and the components forgotten by $\EP(\pi)$ are identical,
			%and include any dependency on $\dm j$,
			we have $f(\vec v) \equijet_j f(\vec v')$.
		\end{itemize}
		
		\item[\framebox{$\dm k = \dm j$}] In this case, we have $\vec v_0 = \vec v_0'$, $\vec v_1 = \vec v_1'$, and $\vec v \infrajet_j \vec v'$ in $V$.
		Therefore we get $f(\vec v) \infrajet_j f(\vec v')$ and these vectors differ at their value for $\dm i$, which has degree $i$, so this is only possible if $f(\vec v) \infrajet_i f(\vec v')$, which implies $f(\vec v) \equijet_j f(\vec v')$.
		
		\item[\framebox{$\dm k \in V_1$}] Then $\vec v \jet_j \vec v'$ holds in $V$ and is therefore preserved by $f = \EP(\vfi)$. \qedhere
	\end{description}
\end{proof}
\begin{lemma} \label{thm:char-twisted-cube-to-line}
	In $\jetcubetri \mycubex \booleanalg {\vec a}$ with $\mycubex \in \accol{\affine, \cartes}$, let $V$ be a jet cube with only $i$-directed variables called (from left to right) $\dm j_1, \ldots, \dm j_n$, and consider $\vfi : V \to (\dm i : \rival{P_i})$ with $P \in \accol{\jet, \tej}$.
	Then $\dm i \psub{\vfi}$ is either a constant or of the (obviously affine) form
	\[
		\dm i \psub{\vfi} = (\ldots((\lnot^{p_1} \dm j_1 \opA_1 \lnot^{p_2} \dm j_2) \opA_2 \lnot^{p_3} \dm j_3) \ldots) \opA_{n-1} \lnot^{p_n} \dm j_n
	\]
	with $p_k \in \accol{0, 1}$ and $\opA_k \in \accol{{\vee}, {\wedge}, {\opK}}$ where we define $x \opK y := y$.
\end{lemma}
We will only use this lemma when $\mycubex = \affine$.
\begin{proof}
	%It is sufficient to prove this for $\mycubex = \cartes$ as the category of affine jet cubes is a subcategory of the category of cartesian jet cubes.
%
	We assume $P = {\jet}$, the proof for $P = {\tej}$ is analogous.

	We prove this by induction on $n$.
	% (and we don't have to worry about calling the induction hypothesis only on affine morphisms).
	If $n = 0$ then $\dm i \psub \vfi$ is necessarily a constant.
	Assume $n > 0$, implying that $a_i = \ypolar$.
	The jet set $\JEP(V)$ has $2^n$ elements and a unique Hamiltonian path of $i$-jets.
	The function $f := \JEP(\vfi)$ sends this Hamiltonian path to a path in $\JEP(\dm i : \rival{\jet_i}) = \accol{0 \jet_i 1}$.
	Thus, $f$ is entirely determined by the step in the Hamiltonian path where the image of $f$ flips from $0$ to $1$.
	Write $\dm j_k'$ to mean $\dm j_k$ if $\dm j_k : \rival{\jet_i}$ and to mean $\lnot \dm j_k$ if $\dm j_k : \rival{\tej_i}$.
	There are 5 possible scenarios:
	\begin{itemize}
		\item The entire path is sent to $0$. Then $\dm i \psub \vfi = 1 = \_ \opK 0$.
		\item The entire path is sent to $1$. Then $\dm i \psub \vfi = 1 = \_ \opK 1$.
		\item The first half of the path is sent to $0$, the second half is sent to $1$. Then $\dm i \psub \vfi = \dm j_n' = \_ \opK \dm j_n'$.
		\item The output of $f$ flips somewhere in the first half of the path.
		Then $\dm i \psub \vfi = s \vee \dm j_n'$ for some boolean expression $s$ depending on $\dm j_1, \ldots, \dm j_{n-1}$.
		Write $V = (U, \dm j_n : \_)$.
		Then we have $(s/\dm i) : \Opcube_i U \to (\dm i : \rival{\jet_i})$, such that $\JEP(s/\dm i)$ is essentially the restriction of $f$ to the first half of the Hamiltonian path as is evident from the following commutative diagram:
		\[
			\xymatrix{
				\Opcube_i U
					\ar[rr]^{(s/\dm i)}
					\ar[rd]_{(0/\dm j_n)}
				&&
				(\dm i : \rival{\jet_i}).
				\\
				& V = (U, \dm j_n : \_)
					\ar[ru]_{(s \vee \dm j_n / \dm i)}
			}
		\]
		By the induction hypothesis, $s$ is of the prescribed form, and therefore so is $\dm i \psub \vfi$.
		\item The output of $f$ flips somewhere in the second half of the path.
		Then $\dm i \psub \vfi = s \wedge \dm j_n'$ for some boolean expression $s$ depending on $\dm j_1, \ldots, \dm j_{n-1}$.
		Write $V = (U, \dm j_n : \_)$.
		Then we have $(s/\dm i) : U \to (\dm i : \rival{\jet_i})$, such that $\JEP(s/\dm i)$ is essentially the restriction of $f$ to the second half of the Hamiltonian path as is evident from the following commutative diagram:
		\[
			\xymatrix{
				U
					\ar[rr]^{(s/\dm i)}
					\ar[rd]_{(1/\dm j_n)}
				&&
				(\dm i : \rival{\jet_i}).
				\\
				& V = (U, \dm j_n : \_)
					\ar[ru]_{(s \wedge \dm j_n / \dm i)}
			}
		\]
		By the induction hypothesis, $s$ is of the prescribed form, and therefore so is $\dm i \psub \vfi$. \qedhere
	\end{itemize}
\end{proof}
\begin{lemma} \label{thm:char-jet-cube-to-line}
	In $\jetcubetri \affine \booleanalg {\vec a}$ where $a_i = \ypolar$, consider $\vfi : V \to (\dm i : \rival{P_i})$ with $P \in \accol{\jet, \tej}$.
	Write $\dm j_1, \ldots, \dm j_n$ for the $i$-directed variables of $V$.
	Then $\vfi$ does not depend on variables of degree lower (stronger) than $i$, nor on $i$-equijet variables of $V$.
	Moreover, $\dm i \psub{\vfi}$ is of the form
	\[
		\dm i \psub{\vfi} = h_n(h_{n-1}(\ldots h_3(h_2(h_1(\lnot^{p_1} \dm j_1) \opA_1 \lnot^{p_2} \dm j_2) \opA_2 \lnot^{p_3} \dm j_3) \ldots ) \opA_{n-1} \lnot^{p_n} \dm j_n)
	\]
	with $p_k \in \accol{0, 1}$ and $\opA_k \in \accol{{\vee}, {\wedge}, {\opK}}$ where we define $x \opK y := y$, and every $h_k$ is a composition of functions of the form $\loch \opB t$ with $t$ any affine boolean expression mentioning only $i$-symmetric variables and ${\opB} \in \accol{{\vee}, {\wedge}, {\opK}}$.
\end{lemma}
\todoi{This follows directly from the previous lemma via the graph representation of boolean expressions.}
\begin{proof}
	We assume $P = {\jet}$, the proof for $P = {\tej}$ is analogous.

	First of all, the $i$-equijet relation as well as all $\ell$-jet relations for $\ell < i$ are reflexive in $\JEP(\dm i : \rival{\jet_i}) = \accol{0 \jet_i 1}$, so that $\JEP(\vfi)$ must be constant on $i$-equijet- or $\ell$-jet-connected components, implying that $\vfi$ cannot depend on those variables.
	Then $\vfi$ factors over the map $\chi : V \to W$ that weakens over all those variables.
	($\JEP(\chi)$ is the map that quotients out the $i$-equijet relation and therefore also the $\ell$-jet relations for $\ell < i$.)
	Thus, without loss of generality, we can assume that $V$ contains no variables of degree lower than $i$, and no $i$-equijet variables.
	Moreover, applying \cref{thm:conv-jet-cube-cat}, we can assume without loss of generality that $V$ is conventional so that the $i$-directed variables in $V$ are the last ones.
	
	We prove the rest of the theorem by induction on $n$, the number of $i$-directed variables in $V$.
	If $n = 0$, then $\dm i \psub \vfi = t = \_ \opK t$ where $t$ does not mention any $i$-directed variables.
	
	Let $n > 0$.
	We reduce $\dm i \psub \vfi$ to an expression $e$ by associative reduction (\cref{def:reduction}).
	Write $\dm j_k'$ to mean $\dm j_k$ if $\dm j_k : \rival{\jet_i}$ and to mean $\lnot \dm j_k$ if $\dm j_k : \rival{\tej_i}$.
	Write $U$ for the $i$-directed part of $V$ and note that any assignment of bits to all $i$-symmetric variables yields a jet cube morphism $U \to V$ whose composite with $\vfi$ necessarily satisfies \cref{thm:char-twisted-cube-to-line}.
	
	We prove the induction step again by induction, now on the height of the syntax tree of $e$. \todoi{Are we though?}
	
	\begin{itemize}
		\item We claim that if $\dm j_n$ and $\dm j_{k}$ occur in different children of the root node of $e$, then $\dm j'_n$ is a direct child of $e$.
		
		Let the root node of $e$ be labelled with $\opA$, where $\accol{(\opA, \absorbA), (\opZ, \absorbZ)} = \accol{(\vee, 1), (\wedge, 0)}$, and let $t$ be the child of $e$ mentioning $\dm j_n$.
		
		First of all, note that there exists an assignment of all $i$-symmetric variables in $t$ that makes none of the $i$-directed variables disappear.
		The result should reduce to something satisfying \cref{thm:char-twisted-cube-to-line}.
		Then this is only possible if any two $i$-directed variables in $t$ are also in $\opA$-connection (\cref{def:in-connection}), so that the parentheses can be moved around. \todoi{Also in $\opA$-connection with $\dm j_n$?}
		
		We know that if $\dm j'_n$ is not a direct child of $e$, then it must depend on other variables and the root node of $t$ is labelled with $\opZ$.
		If one of the immediate operands $s$ of $t$ depends on $\dm j_n$,
		then any other operand $r$ of $t$ can only depend on $i$-symmetric variables, as $\dm j_n$ is in $\opA$-connection with all $i$-directed variables in $t$.
		Then for every $r$ (and in particular for some $r$) there exists a bit assignment of its dependencies that makes $r$ reduce to $\absorbZ$, such that all of $t$ reduces to $\absorbZ$, and gets ignored as an operand of $e$.
		In all other direct operands of $e$, we can choose bit assignments of $i$-symmetric variables that make no $i$-directed variables disappear.
		Then $e$ will reduce to an expression containing $\dm j_k$ but not $\dm j_n$, in violation of \cref{thm:char-twisted-cube-to-line}.
		\todoi{This is incomprehensible, prove this again!}
		
%		\todoi{The reasoning below is not good enough.}
%		
%		Assume $t$ mentions an $i$-symmetric variable.
%		Then we can choose a bit-assignment of all $i$-symmetric variables that makes $\dm j_n$ disappear in $t$, but does not make any of the other $i$-directed variables appearing in other children of $e$ disappear.
%		It is clear that we can accomplish this on a per-child-of-$e$ basis.
%		Of course $t$ will reduce to a constant, so we need to make sure that this constant is not $0$ if $e$ is a conjunction, or $1$ if it is a disjunction.
%		However, if $e$ is a conjunction, then $t$ is a disjunction, and we can set an operand that does not contain $\dm j_n$ to 1. The dual holds if $e$ is a disjunction.
%		We now obtain a boolean expression that is not of the form described in \cref{thm:char-twisted-cube-to-line}, which is a contradiction.
%		
%		Assume $t$ mentions another $i$-directed variable.
%		Thanks to affineness, we can choose a bit-assignment of all $i$-symmetric variables such that no $i$-directed variable disappears (set them to 1 in conjunctions and to 0 in disjunctions).
%		This yields a boolean expression that is not of the form described in \cref{thm:char-twisted-cube-to-line}, which is a contradiction.
%		\todoi{Not necessarily!}
		
		\item In the case described in the previous bullet point, we conclude that $e$ is of the form $s \opA \dm j_n'$ with ${\opA} \in \accol{{\vee}, {\wedge}}$ (and $s$ may further use the same symbol $R$ in its root node).
		Write $V = (V', \dm j_n : \_)$.
		\begin{itemize}
			\item If $\opA = \vee$, then we know that $\vfi \circ (0/\dm j_n) = (s/\dm i)$ is a jet cube morphism $\Opcube_i V' \to (\dm i : \rival{\jet_i})$.
			Then by the outer induction hypothesis, $s$ is of the required form, and therefore so is $e$.
			\item If $\opA = \wedge$, then we know that $\vfi \circ (1/\dm j_n) = (s/\dm i)$ is a jet cube morphism $V' \to (\dm i : \rival{\jet_i})$.
			Then by the outer induction hypothesis, $s$ is of the required form, and therefore so is $e$.
		\end{itemize}
		
		\item In the remaining case, all $i$-directed variables occur in the same child $t$ of $e$, if at all.
		Thus, $e$ is of the form $t \opA s$ with $\opA \in \accol{{\vee}, {\wedge}, {\opK}}$ and $s$ depending only on $i$-symmetric variables and possibly using $\opA$ again in its root node.
		By the inner induction hypothesis, $t$ is of the required form, and therefore so is $e$. \qedhere
	\end{itemize}
\end{proof}
\begin{lemma} \label{thm:left-of-connection}
	In $\jetcubetri \affine \booleanalg {\vec a}$, let $\hat \vfi : V \to W$ be a jet cube morphism and write $\vfi = \erasejc{\hat \vfi}$.
	Let $W = (W_0, \dm i : \rival{Q_i})$ with $Q \in \accol{\jet, \tej}$ and $a_i = \ypolar$.
	Let $e$ be the reduction of $\dm i \psub \vfi$ and let $\dm j_1, \ldots, \dm j_n$ ($n \geq 0$) be all the variables of degree $i$ that $e$ depends on, and $\dm k_1, \ldots, \dm k_m$ ($m \geq 0$) all the other variables that $e$ depends on.
	Assume $m+n \geq 2$.
	By \cref{thm:char-jet-cube-to-line}, we know that $\dm j_1, \ldots, \dm j_n$ these are the \emph{last} $n$ variables of degree $i$ in $V$.
	Order $V$ by \cref{conv:sort-cubes}, and write $V = (V_0, \dm j_1 : \rival{P^1_i}, \ldots, \dm j_n : \rival{P^n_i}, V_1)$ so that (even if $n = 0$) all variables in $V_0$ have degree at least (at the strongest) $i$ and all variables in $V_1$ have degree strictly less (stronger) than $i$.
	Here, each $P^1, \ldots, P^n \in \accol{\jet, \tej}$.%
	\footnote{We could in principle allow $\equijet$ but it is easy to see that $\vfi$ being a jet cube morphism (equivalently, $\EP(\vfi)$ being a jet set) implies $P^1, \ldots, P^n \in \accol{\jet, \tej}$.}
	Define $\tilde V = (\UFsymcube_i V_0, \dm j_1 : \rival{P^1_i}, \ldots, \dm j_n : \rival{P^n_i}, V_n)$, i.e.\ every variable of degree $i$ to the left of $\dm j_1$ gets promoted to an equijet variable.
	Then $\vfi$ is a jet cube morphism $\tilde V \to W$.
\end{lemma}
%The lemma allows $P^1, \ldots, P^n \in \accol{\jet, \tej, \equijet}$, but it is easy to see that $\vfi$ being a jet cube morphism (equivalently, $\EP(\vfi)$ being a jet set) implies $P^1, \ldots, P^n \in \accol{\jet, \tej}$.
It is clear that $\dm k_1, \ldots, \dm k_m$ all occur in $V_0$ as they cannot have degree less (stronger) than $i$.

In words, this lemma says that if the last variable $\dm i$ of $W$ is substituted with an expression $e$ depending on at least two variables, then all variables in $V$ of same degree as $\dm i$ that $e$ does \emph{not} depend on, can be promoted to equijet variables.
\begin{proof}
	%Let $\dm k_1, \ldots, \dm k_m$ be all \emph{other} variables that $e$ depends on.
	For $c \in \accol{0, 1}$, let $A_c$ be the set of all $(\vec \kappa, \vec \zeta) \in \accol{0, 1}^{m+n}$ such that $\dm i \psub{\vfi} \psub{\vec \kappa / \vec{\dm k}, \vec \zeta / \vec{\dm j}} = c$.
	Let $U$ be the (ordinary) cube obtained from $\erasejc{V}$ by removing all dependencies of $e$.
	Then for any $(\vec \kappa, \vec \zeta) \in \accol{0, 1}^{m+n}$, by applying cube opposite functors in all the right places, there is a jet cube $U_{(\vec \kappa, \vec \zeta)}$ such that $\erasejc{U_{(\vec \kappa, \vec \zeta)}} = U$ and $(\vec \kappa / \vec{\dm k}, \vec \zeta / \vec{\dm j}) : U_{(\vec \kappa, \vec \zeta)} \to V$ is a jet cube morphism.
	
	Then in the category of \emph{jet cubes} and \emph{cube morphisms between their erasures}, for any $(\vec \kappa, \vec \zeta) \in A_c$, we obtain a commutative diagram
	\[
		\xymatrix{
			U_{(\vec \kappa, \vec \zeta)}
				\ar[d]_{(\vec \kappa / \vec{\dm k}, \vec \zeta / \vec{\dm j})}
				\ar@{.>}[rr]^\chi
			&&
			(\Opcube_i)^{1-c}(W_0)
				\ar[d]^{(c/\dm i)}
			\\
			V
				\ar[rr]_{\vfi}
			&&
			W
		}
	\]
	where all the black lines are jet cube morphisms and the cube morphism $\chi$ is defined as $(\dm i / \novar) \circ \vfi \circ (\vec \kappa / \vec{\dm k}, \vec \zeta / \vec{\dm j})$, which thanks to afineness does not depend on our choice of $(\vec \kappa, \vec \zeta)$, nor even on $c$.
	Commutativity of the diagram and the fact that $\JEP(c/\dm i)$ is a full jet set morphism, imply that $\chi$, too, is a jet cube morphism.
	
	We now show that $\vfi$ is a jet cube morphsim $\tilde V \to W$.
	Let $\vec v \jet_k \vec v'$ in $\tilde V$.
	We prove that $f(\vec v) \jet_k f(\vec v')$ where $f = \EP(\vfi)$.
	If $\vec v = \vec v'$ then this is trivial, so let $\dm l$ be the variable where they differ.
	If $k \neq i$ or $\dm l \not\in V_0$ then we have $\vec v \jet_k \vec v'$ in $V$ so this is preserved by $f$.
	
	Assume $k = i$ and $\dm l \in V_0$, which implies that $\dm l$ is not a dependency of $e$.
	This implies that $e \psub{\vec v} = e \psub{\vec v'} =: c$, or differently put $\dm i \psub{f(\vec v)} = \dm i \psub{f(\vec v')} = c$.
	We have $\vec v \infrajet_i \vec v'$ in $V$, say $\vec v \mathrel{S}_i \vec v'$ where $S \in \accol{\jet, \tej}$.
	This is preserved by $f$, so $f(\vec v) \mathrel{S}_i f(\vec v')$.
	Because $(c/\dm i)$ is a full jet set morphism, writing $p = \EP(\dm i / \novar)$, we can conclude that $p(f(\vec v)) \mathrel{S}_i p(f(\vec v'))$ in $(\Opcube_i)^{1-c}(W_0)$.
	
	Let $\vec u$ and $\vec u'$ be bit-assignments to the variables in $U$ obtained by projecting out all bits assigned to the dependencies of $e$ in the vectors $\vec v$ and $\vec v'$, and let $\vec \zeta$ and $\vec \kappa$ be the bits thus forgotten (which are the same for $\vec v$ and $\vec v'$).
	Thus, $\vec v = \EP(\vec \zeta/\vec{\dm j}, \vec \kappa/\vec{\dm k})(\vec u)$ and similar for $\vec v'$.
	Writing $g = \EP(\chi)$, this implies that $p(f(\vec v)) = g(\vec u)$ and $p(f(\vec v')) = g(\vec u')$.
	Thus, we have $g(\vec u) \mathrel S_i g(\vec u')$ in $(\Opcube_i)^{1-c}(W_0)$.
	
	If $\vfi$ does not depend on $\dm l$, then we have nothing to prove,
	so let $\dm h$ be the variable of $W$ such that $\dm h \psub \vfi$ depends on $\dm l$. Note that $\dm h \neq \dm i$.
%	\begin{itemize}
%		\item If $\dm h \in W_1$, then we have $g(\vec w) \mathrel S_i g(\vec w')$ in $(W_0, W_1)$.
%		\item If $\dm h \in W_0$, then the direction of the jet between $g(\vec w)$ and $g(\vec w')$ in $(W_0, W_1)$ flips with $c = e \psub{\vec v}$, which is a function of $(\vec \kappa, \vec \zeta)$.
%	\end{itemize}
	We remark that the direction of the jet between $g(\vec u)$ and $g(\vec u')$ in $(\Opcube_i)^{1-c}(W_0)$ flips with $c = e \psub{\vec v}$, which is a function of $(\vec \kappa, \vec \zeta)$.
	
	On the other hand, looking at the direction of the jet between $\vec u$ and $\vec u'$ in $U_{(\vec \kappa, \vec \zeta)}$, we see that this flips with the $\dm j_1 \veebar \ldots \veebar \dm j_n$, the exclusive disjunction of all dependencies of $e$ of degree $i$, which all appear to the right of $\dm l$.
	Now if $m+n \geq 2$, then it is impossible that the affine boolean expression $e \in \booleanalg^\#(\accol{\dm k_1, \ldots, \dm k_m, \dm j_1, \ldots, \dm j_n})$ which is in a reduced state and therefore truly depends on each of the mentioned variables, yields the exact same truth table as $\dm j_1 \veebar \ldots \veebar \dm j_n$.
	
	Thus, fixing $\vec u$ and $\vec u'$ and varying $(\vec \kappa, \vec \zeta)$, we see that there are assignments $(\vec \kappa, \vec \zeta)$ for which the jets between $\vec u$ and $\vec u'$ in $U_{(\vec \kappa, \vec \zeta)}$ on one hand, and between $g(\vec u)$ and $g(\vec u')$ in $(\Opcube_i)^{1-c}(W_0)$ are aligned, and others for which they are opposed.
	Pick an assignment $(\vec \kappa', \vec \zeta')$ for which they are opposed.
	We also know that $\chi$ is a jet cube morphism for any assignment $(\vec \kappa, \vec \zeta)$, and in particular for $(\vec \kappa', \vec \zeta')$.
	Thus, $\chi$ provides us the jet pointing the other way, and we can conclude that $g(\vec u) \equijet_i g(\vec u')$.
	Composing with $\EP(c/\dm i)$ for our original $c$ yields $f(\vec v) \equijet_i f(\vec v')$.
\end{proof}
\begin{corollary} \label{thm:weaken-connection}
	In $\jetcubetri \affine \booleanalg {\vec a}$, let $\hat \vfi : V \to W$ be a jet cube morphism and write $\vfi = \erasejc{\hat \vfi}$.
	Let $W = (W_0, \dm i : \rival{Q_i})$ with $Q \in \accol{\jet, \tej}$ and $a_i = \ypolar$.
	Let $e$ be the reduction of $\dm i \psub \vfi$ and assume $e$ depends on at least two variables.
	Then $(\novar/\dm i) \circ \vfi$ is a jet cube morphism $\UFsymcube_i V \to W_0$.
\end{corollary}
\begin{proof}
	We know from \cref{thm:left-of-connection} that $\vfi$ is a jet cube morphism $\tilde V \to W$.
	We first show that $(\novar / \dm i) \circ \vfi$ is a jet cube morphism $\tilde V \to W_0$.
	Write $f = \EP(\vfi)$ and $p = \EP(\novar / \dm i)$.
	Pick a non-reflexive jet $\vec v \jet_j \vec v'$ in $\tilde{V}$.
	We show that $p(f(\vec v)) \jet_j p(f(\vec v'))$ in $W_0$.
	We know that $f(\vec v) \jet_j f(\vec v')$ in $W$.
	If $j \neq i$, it follows that $p(f(\vec v)) \jet_j p(f(\vec v'))$ in $W_0$.
	If $j = i$, it follows that $p(f(\vec v)) \infrajet_i p(f(\vec v'))$ in $W_0$.
	But because $(\novar/\dm i) \circ \vfi$ only depends on $i$-symmetric variables in $\tilde{V}$, we can conclude that $p(f(\vec v)) \equijet_i p(f(\vec v'))$.
	Hence we also have the other arrow.
	
	We conclude that $(\novar/\dm i) \circ \vfi$ is a jet cube morphism $\tilde V \to W$.
	Since it only depends on $i$-symmetric variables, there is no harm in promoting the ignored variables of degree $i$ to equijet variables, and that is all that $\UFsymcube_i V$ does.
\end{proof}

\subsubsection{Completeness}
\begin{theorem}[Completeness] \label{thm:calculus-complete}
	For $M \in \accol{\bipointedsym, \booleanalg}$ and any morphism $\hat \vfi : V \to W$ in $\jetcubetri \affine M {\vec a}$ between cubes compliant to \cref{conv:sort-cubes}, writing $\vfi = \erasejc{\hat \vfi}$, we have $\sez \vfi : V \to W$.
\end{theorem}
\begin{proof}
	For each variable $\dm k$ in $W$, let $e_{\dm k}$ be the reduction of $\dm k \psub{\vfi}$.

	We prove completeness by induction on the number of nodes and leaves (added up) in the tuple $(e_{\dm k})_{\dm k \in W}$.
	
	If $W = ()$, then use \ruleref{terminal}.
	
	If $a_i = \ypolar$ and the last variable in $W$ is $\dm i : \rival{\equijet_i}$, then $W$ is of the form $\Usymcube_i(U)$ and there will be a corresponding morphism $\Fsymcube_i(V) \to U$ and we can use the rule \ruleref{symmetrize}.
	
	In the remaining case, the last variable in $W$ is not an equijet dimension at a directed degree, i.e.\ it is of the form $\dm i : \rival{\jet_i}$ or $\dm i : \rival{\tej_i}$.
	
	If the last variable in $V$ is of degree strictly lower (stronger) than $\dm i$, then in order to be a jet set morphism, $\JEP(\hat \vfi)$ cannot depend on that variable, so we can invoke \ruleref{wkn} until the last variable in $V$ is of degree at least $i$. We do not resort to the induction hypothesis but proceed below.
	
%	If $a_i = \npolar$, then we use \ruleref{exchange} (which is sound by \cref{thm:calculus-sound}) to reorder the variables of degree $i$ in $W$, and immediately proceed with the algorithm below.
%	We put constants last. Before that, if existent, we put the sole variable $\dm k_1$ such that $e_{\dm k_1}$ mentions the last variable of degree $i$ in $V$.
%	Before that, we put, if existent, the sole variable $\dm k_2$ such that $e_{\dm k_2}$ mentions the second to last variable of degree $i$ in $V$. Etc.
	
	We proceed by inspecting $e_{\dm i}$.
	
	\begin{itemize}
		\item If [$\dm i : \rival{\jet_i}$ and $e_{\dm i} = 0$] or [$\dm i : \rival{\tej_i}$ and $e_{\dm i} = 1$], then $\vfi$ being a jet cube morphism $V \to W = (U, \dm i : \_)$ (equivalently: $\EP(\vfi)$ being a jet set morphism $\JEP(V) \to \JEP(W)$) is equivalent to $(\novar / \dm i) \circ \vfi$ being a jet cube morphism $V \to \Opcube_i(U)$, so we can apply \ruleref{src:fwd} or \ruleref{src:bck}.
		
		\item If [$\dm i : \rival{\jet_i}$ and $e_{\dm i} = 1$] or [$\dm i : \rival{\tej_i}$ and $e_{\dm i} = 0$], then $\vfi$ being a jet cube morphism $V \to W = (U, \dm i : \_)$ (equivalently: $\EP(\vfi)$ being a jet set morphism $\JEP(V) \to \JEP(W)$) is equivalent to $(\novar / \dm i) \circ \vfi$ being a jet cube morphism $V \to U$, so we can apply \ruleref{tgt:fwd} or \ruleref{tgt:bck}.
		
		\item If $\dm i : \rival{\jet_i}$ and $e_{\dm i} = \lnot \dm j$, then $\vfi$ being a jet cube morphism $V \to W = (U, \dm i : \rival{\jet_i})$ is equivalent to $(\lnot \dm i / \dm i) \circ \vfi$ being a jet cube morphism $V \to (U, \dm i : \rival{\tej_i})$, so we can apply \ruleref{inv:fwd}.
		Similarly, if $\dm i : \rival{\tej_i}$ and $e_{\dm i} = \lnot \dm j$, we can apply \ruleref{inv:bck}.
		
		\item If $\dm i : \rival{\jet_i}$ ($\dm i : \rival{\tej_i}$ is handled analogously) and $e_{\dm i} = \dm j$ where $V$ specifies that $\dm j$ has degree $j$, then we know that $\vfi = (\chi, \dm j / \dm i)$ is a jet cube morphism $V = (V_0, \dm j : \rival{R_j}, V_1) \to W = (U, \dm i : \rival{\jet_i})$ for some $R \in \accol{\jet, \tej, \equijet}$.
		We have the following commutative diagram in the category of \emph{jet cubes} and \emph{cube morphisms between erased jet cubes}:
		\[
			\xymatrix{
				(\Opcube_j(V_0), V_1)
					\ar[d]_{(0/\dm j)}
					\ar@{.>}[rr]^\chi
				&&
				\Opcube_i(U)
					\ar[d]^{(0/\dm i)}
				\\
				(V_0, \dm j : \rival{R_j}, V_1)
					\ar[rr]_{\vfi = (\chi, \dm j / \dm i)}
				&& (U, \dm i : \rival{\jet_i})
				\\
				(V_0, V_1)
					\ar[u]^{(1/\dm j)}
					\ar@{.>}[rr]_\chi
				&&
				U
					\ar[u]_{(1/\dm i)}
			}
		\]
		We note that the black arrows are all jet cube morphisms, and the vertical arrows all yield full jet set morphisms (\cref{def:full-jetsethom}).
		This implies that the dashed arrows also lift to jet set morphisms, i.e.\ are jet cube morphisms.
		Then $\chi$ is both a jet cube morphism $(V_0, V_1) \to U$ and $\Opcube_i(\Opcube_j(V_0), V_1) \to U$.
		\begin{itemize}
			\item If $j = i$, then all variables in $V_1$ have degree $i$ and $\chi$ is both a jet cube morphism $(V_0, V_1) \to U$ and $\Opcube_i(\Opcube_i V_0, V_1) \to U$.
			This implies that $\EP(\vfi)$ sends every $i$-jet of the form $(\vec v_0, r, \vec v_1) \jet_i (\vec v_0, r, \vec v_1')$ in $\JEP(V_0, V_1)$ -- which points the other way in $\JEP(\Opcube_i(\Opcube_i V_0, V_1))$ -- to an $i$-equijet $(\EP(\chi)(\vec v_0, \vec v_1), r) \equijet_i (\EP(\chi)(\vec v_0, \vec v'_1), r)$ in $\JEP(U, \dm i : \rival{\jet_i})$.
			\begin{itemize}
				\item If $a_i = \ypolar$, then for any bit-assignment $\vec v_1$ of the variables in $V_1$, we get a jet cube morphism $(\chi \circ (\vec v_1/V_1), \dm j / \dm i) : (\Opcube_i)^p(V_0, \dm j : \rival{R_j}) \to (U, \dm i : \rival{\jet_i})$, where $p$ is the number of zeroes in $\vec v$.
				This implies that $p$ is the same for all assignments $\vec v$, which is only possible if $V_1 = ()$.
				In that case, it is easy to see that $R = {\jet}$.
				Thus, we can apply \ruleref{prism:fwd}.
				
%				\todoi{Old}
%				then all $i$-equijets in $\JEP(U, \dm i : \rival{\jet_i})$ are reflexive and all elements of the form $(\vec v_0, r, \vec v_1)$ for fixed $\vec v_0$ and $r$ but variable $\vec v_1$ are $i$-infrajet-connected, so this means that $\EP(\chi)(\vec v_0, \vec v_1)$ is independent of $V_1$.
%				Then $\chi$ cannot mention any variables from $V_1$.
%				\begin{itemize}
%					\item If $V_1$ contains any variables, then we can apply \ruleref{wkn}.
%					\item Otherwise, we can apply \ruleref{prism:fwd}.
%				\end{itemize}
				
				\item If $a_i = \npolar$, then we can use \ruleref{exchange} to create a morphism from $(V_0, V_1, \dm j : \rival{\edge_i})$ instead, which can be done using \ruleref{prism:fwd} (or equivalently \ruleref{prism:bck}).
			\end{itemize}
			
			If $j > i$, then $\chi$ is necessarily a jet cube morphism $\UFsymcube_i(\UFsymcube_j(V_0), V_1) \to U$, so we can apply \ruleref{concursor}.
		\end{itemize}
		
		\item We have now covered all cases for the monad $\bipointedsym$.
		In the remaining cases, $e_{\dm i}$ contains connection (conjunction or disjunction) symbols.
		If $\dm i : \rival{\tej_i}$, we apply \ruleref{inv:fwd} and push down the introduced negation, after which we do not resort to the induction hypothesis but proceed below.\footnote{Alternatively, we could duplicate and adapt the proof below to the case where $\dm i : \rival{\tej_i}$.}
		We now assume that $\dm i : \rival{\jet_i}$.
		
		\begin{itemize}
			\item We first treat the case where $a_i = \npolar$.
			Let $\vfi = (\chi, s \opA t/\dm i)$ where $\opA \in \accol{{\vee}, {\wedge}}$ and $W = (U, \dm i : \rival{\jet_i})$.
			We claim that if $\vfi$ is a jet cube morphism $V \to W = (U, \dm i : \rival{\edge_i})$, then so are $(\chi, s/\dm i)$ and $(\chi, t/\dm i)$, so that we can invoke \ruleref{conn:sym}.
			Write
			\[
				f = \EP(\vfi), \qquad
				g = \EP(\chi), \qquad
				p = \EP(\chi, s/\dm i), \qquad
				q = \EP(\chi, t/\dm i).
			\]
			Pick a non-reflexive jet $\vec v \jet_j \vec v'$.
			We prove $p(\vec v) \jet_j p(\vec v')$; by symmetry of the situation we do not have to prove the same for $q$.
			Let $\dm k$ be the variable of $V$ where $\vec v$ and $\vec v'$ differ.
			There are four possible situations:
			\begin{itemize}
				\item If $\vfi$ does not depend on $\dm k$, then we are done.
				\item If $\chi$ depends on $\dm k$, then we have $s \psub{\vec v} = s \psub{\vec v'} =: s_0$ and $t \psub{\vec v} = t \psub{\vec v'} =: t_0$.
				\begin{itemize}
					\item If $j \neq i$, then from $(g(\vec v), s_0 \opA t_0) = f(\vec v) \jet_j f(\vec v') = (g(\vec v'), s_0 \opA t_0)$, it follows that $g(\vec v) \jet_j g(\vec v')$ in $\JEP(U)$, whence $p(\vec v) = (g(\vec v), s_0) \jet_j (g(\vec v'), s_0) = p(\vec v')$.
					\item If $j = i$, then from $(g(\vec v), s_0 \opA t_0) = f(\vec v) \edge_i f(\vec v') = (g(\vec v'), s_0 \opA t_0)$ it follows that $g(\vec v) \edge_i g(\vec v')$ in $\JEP(U)$, whence $p(\vec v) = (g(\vec v), s_0) \edge_i (g(\vec v'), s_0) = p(\vec v')$.
				\end{itemize}
				\item If $s$ depends on $\dm k$, then we have $g(\vec v) = g(\vec v') =: g_0$ and $t \psub{\vec v} = t \psub{\vec v'} =: t_0$.
				Pick a bit-assignment $\tau$ of the dependencies of $t$ such that $t \psub \tau$ reduces to the neutral element $\neutralA$ of $\opA$.\footnote{If this were not possible, then $t$ would be a constant, which is in contradiction with the assumption that $e_{\dm i}$ was reduced.}
				Define $\vec x$ and $\vec x'$ by overwriting $\vec v$ and $\vec v'$ with $\tau$. Then $g(\vec x) = g(\vec x') = g_0$ and $t \psub{\vec x} = t \psub{\vec x'} = \neutralA$ and $s \psub{\vec x} = s \psub{\vec v}$ and $s \psub{\vec x'} = s \psub{\vec v'}$.
				We have $\vec x \infrajet_j \vec x'$, whence $p(\vec v) = (g_0, s \psub{\vec v}) = f(\vec x) \infrajet_j f(\vec x') = (g_0, s \psub{\vec v'}) = p(\vec v')$ in $\JEP(W, \dm i : \rival{\jet_i})$.
				Now, since these vectors only differ at $\dm i$, we can deduce equality if $j < i$ ($j$ is stronger than $i$) and otherwise that $p(\vec v) \edge_i p(\vec v')$, which implies $p(\vec v) \jet_j p(\vec v')$ since $j \geq i$ ($j$ is weaker than or equal to $i$).
				
				\item If $t$ depends on $\dm k$, then $\chi$ and $s$ do not so $p(\vec v) = p(\vec v')$ and we are done.
			\end{itemize}
			
			\item Now assume that $a_i = \ypolar$.
			Let $\vfi = (\chi, t \opA s/\dm i)$ where $\opA \in \accol{{\vee}, {\wedge}}$ and $W = (U, \dm i : \rival{\jet_i})$.
			\Cref{thm:weaken-connection} immediately tells us that $\chi$ is a jet cube morphism $\UFsymcube V \to U$.
			By \cref{thm:char-jet-cube-to-line}, we can assume that $s$ is either (the negation of) the last variable of degree $i$ in $V = (V_0, \dm i : \rival{P_i})$ with $P \in \accol{\jet, \tej}$ or a boolean expression only depending on $i$-symmetric variables.
			\begin{itemize}
				\item If $s = \dm i' \in \accol{\dm i, \lnot \dm i}$, then depending on $\opA$ we have one of the following commutative diagrams, where each arrow is a jet cube morphism but labelled with its erasure:
				\[
					\xymatrix{
						&&\Opcube_i V
							\ar[d]_{(0/\dm i)}
							\ar@/^/[rrd]^{(\chi, t/\dm i)}
						\\
						(V, \dm i : \rival{\tej_i})
							\ar@{<->}[rr]^{\cong}_{(\chi, \lnot \dm i/\dm i)}
						&&
						(V, \dm i : \rival{\jet_i})
							\ar[rr]_{(\chi, t \vee \dm i/\dm i)}
						&&
						(W, \dm i : \rival{\jet_i})
						\\
						&& V
							\ar[d]_{(1/\dm i)}
							\ar@/^/[rrd]^{(\chi, t/\dm i)}
						\\
						(V, \dm i : \rival{\tej_i})
							\ar@{<->}[rr]^{\cong}_{(\chi, \lnot \dm i/\dm i)}
						&&
						(V, \dm i : \rival{\jet_i})
							\ar[rr]_{(\chi, t \wedge \dm i/\dm i)}
						&&
						(W, \dm i : \rival{\jet_i})
					}
				\]
				Thus, we can invoke one of the rules \ruleref{conn:prism:src-neutral}, \allowbreak \ruleref{conn:prism:tgt-neutral}, \ruleref{conn:prism-inv:src-neutral}, \ruleref{conn:prism-inv:tgt-neutral}.
				
				\item If $s$ depends only on $i$-symmetric variables, then the same holds for $(\vfi, s / \dm i)$. Write
				\[
					f = \EP(\vfi), \qquad
					g = \EP(\chi), \qquad
					p = \EP(\chi, s/\dm i), \qquad
					q = \EP(\chi, t/\dm i).
				\]
				We show that
				\begin{itemize}
					\item $(\chi, s / \dm i)$ is a jet cube morphism $\UFsymcube_i V \to (W, \dm i : \rival{\jet_i})$,
					\item $(\chi, t / \dm i)$ is a jet cube morphism $V \to (W, \dm i : \rival{\jet_i})$,
				\end{itemize}
				so that we can invoke \ruleref{conn:degree-symmetric}.
				
				Pick a non-reflexive jet $\vec v \jet_j \vec v'$ in $\JEP(V)$.
				We will prove $p(\vec v) \jet_j p(\vec v')$ and $q(\vec v) \jet_j q(\vec v')$ and, if $j = i$, even $p(\vec v) \equijet_j p(\vec v')$, all the time in $\JEP(W, \dm i : \rival{\jet_i})$.
				Let $\dm k$ be the variable where $\vec v$ and $\vec v'$ differ.
				There are four possibilities:
				\begin{itemize}
					\item If $\vfi$ does not depend on $\dm k$, then we are done.
					\item If $\chi$ depends on $\dm k$, then $s \psub{\vec v} = s \psub{\vec v'} =: s_0$ and $t \psub{\vec v} = t \psub{\vec v'} =: t_0$.
					\begin{description}
						\item[$\cdot$] If $j = i$, then $g(\vec v) \equijet_i g(\vec v')$ and hence $p(\vec v) = (g(\vec v), s_0) \equijet_i (g(\vec v'), s_0) = p(\vec v')$ and $q(\vec v) = (g(\vec v), t_0) \equijet_i (g(\vec v'), t_0) = q(\vec v')$ as required.
						\item[$\cdot$] If $j \neq i$, then $g(\vec v) \jet_j g(\vec v')$ and hence $p(\vec v) = (g(\vec v), s_0) \jet_j (g(\vec v'), s_0) = p(\vec v')$ and $q(\vec v) = (g(\vec v), t_0) \jet_j (g(\vec v'), t_0) = q(\vec v')$ as required.
					\end{description}
					\item If $s$ depends on $\dm k$, then $g(\vec v) = g(\vec v') =: g_0$ and $t \psub{\vec v} = t \psub{\vec v'} =: t_0$, so $q(\vec v) = q(\vec v')$.
					We pick $\tau$ and define $\vec x$ and $\vec x'$ in the same way as we did when $a_i = \npolar$ and all other circumstances were the same.
					Then we have $\vec x \infrajet_j \vec x'$ in $\JEP(V)$, whence $p(\vec v) = f(\vec x) \infrajet_j f(\vec x') = p(\vec v')$.
					Now, since these vectors only differ at $\dm i$, we can deduce equality if $j < i$ ($j$ is stronger than $i$) and otherwise that $p(\vec v) \infrajet_i p(\vec v')$.
					But since $s$ and $\chi$ only depend on $i$-symmetric variables, it must be the case that $p(\vec v) \equijet_i p(\vec v')$, as required if $i = j$, and implying $p(\vec v) \jet_j p(\vec v')$ if $j > i$.
					
					\item If $t$ depends on $\dm k$, then $g(\vec v) = g(\vec v') =: g_0$ and $s \psub{\vec v} = s \psub{\vec v'} =: s_0$, so $p(\vec v) = p(\vec v')$.
					Pick an assignment $\sigma$ of the dependencies of $s$ such that $s \psub \sigma$ reduces to the neutral element $\neutralA$ of $\opA$.
					Define $\vec y$ and $\vec y'$ by overwriting $\vec v$ and $\vec v'$ with $\sigma$.
					Then $g(\vec y) = g(\vec y') = g_0$ and $s \psub{\vec y} = s \psub{\vec y'} = \neutralA$ and $t \psub{\vec y} = t \psub{\vec v}$ and $t \psub{\vec y'} = t \psub{\vec v'}$.
					We have $\vec y \infrajet_j \vec y'$ but, since all dependencies of $s$ are $i$-symmetric, they come to the left of all $i$-directed variables, so if $i = j$ we actually still have $\vec y \jet_i \vec y'$.
					Now we have
					\[
						q(\vec v) = (g_0, t \psub{\vec v}) = f(\vec y) \infrajet_j f(\vec y') = (g_0, t \psub{\vec v'}) = q(\vec v')
					\]
					and $q(\vec v) \jet_i q(\vec v')$ if $j = i$.
					Thus, the case $j = i$ has been handled.
					Since $q(\vec v)$ and $q(\vec v')$ can only differ at $\dm i$ which has degree $i$, we can deduce equality if $j < i$ ($j$ is stronger than $i$) and otherwise that $q(\vec v) \infrajet_i q(\vec v')$ which implies $q(\vec v) \jet_j q(\vec v')$ as required. \qedhere
				\end{itemize}
			\end{itemize}
		\end{itemize}
	\end{itemize}
\end{proof}

\subsection{The Semisymmetric Separated Product} \label{sec:jetcubes:sss}
\begin{definition}
	We define the \textbf{separated product} functor
	\[
		\loch * \loch : \jetset{\vec a} \times \jetset{\vec a} \to \jetset{\vec a}
	\]
	by letting $X * Y$ be the jet set with carrier $UX \times UY$ such that $(x, y) \jet_j (x', y')$ if either
	\begin{itemize}
		\item $x \jet_j x'$ and $y = y'$,
		\item $x = x'$ and $y \jet_j y'$.
	\end{itemize}
	The action on morphisms is of course faithfully inherited from the cartesian product functor on $\Set$, which indeed produces jet set morphisms between separated products.
\end{definition}
\begin{definition} \label{def:sssprod}
	Given masks $\vec a$ and $\vec b$ of equal length, if $\vec a \sqcap \vec b = \vec \npolar$, i.e. if for every $i$ we have $a_i = \npolar$ and/or $b_i = \npolar$, then we define the \textbf{semisymmetric separated product (SSS-product)} functor
	\[
		\loch * \loch : \jetcubetri \mycubex M {\vec a} \times \jetcubetri \mycubex M {\vec b} \to \jetcubetri \mycubex M {\vec a \sqcup \vec b}
	\]
	as follows:
	\begin{itemize}
		\item We rewrite input objects according to \cref{conv:sort-cubes}.
		The variables of a pair of objects $(V, W)$ are zipped on a per-degree basis:
		\begin{itemize}
			\item If $a_i = b_i = \npolar$, then we list all variables of degree $i$ of $V$, followed by all variables of degree $i$ of $W$, all of them typed as $\rival{\edge_i}$,
			\item If $a_i = \ypolar$ and $b_i = \npolar$, then we list all variables of degree $i$ of $W$, retyped as $\rival{\equijet_i}$, followed by all variables of degree $i$ of $V$ with their original types,
			\item If $a_i = \npolar$ and $b_i = \ypolar$, then we list all variables of degree $i$ of $V$, retyped as $\rival{\equijet_i}$, followed by all variables of degree $i$ of $W$ with their original types.
		\end{itemize}
		\begin{corollary} \label{thm:erase-sssprod}
			In $\cubecat_M^\mycubex$, we have
			\begin{align*}
				\erasejc{V * W} &\cong \erasejc V * \erasejc W &\text{if $\mycubex = \affine$,} \\
				\erasejc{V * W} &\cong \erasejc V \times \erasejc W &\text{if $\mycubex = \cartes$.}
			\end{align*}
		\end{corollary}
		\begin{corollary}
			In $\jetset{\vec a \sqcup \vec b}$, we have
			\[
				\JEP(V * W) \cong \Usym_{\vec a \sqsubseteq \vec a \sqcup \vec b}(V) * \Usym_{\vec b \sqsubseteq \vec a \sqcup \vec b}(W),
			\]
			where $\Usym_{\vec x \sqsubseteq \vec y} : \jetset{\vec x} \to \jetset{\vec y}$ is the forgetful functor.
		\end{corollary}
		\item Recalling \cref{def:jet-cube-cat}, the action of morphisms is established as follows:
		\begin{itemize}
			\item At the level of $\cubecat_M^\mycubex$, by relying on functoriality of the separated/cartesian product,
			\item At the level of $\jetset{\vec a \sqcup \vec b}$, by relying on functoriality of the separated product,
			\item At the level of $\Set$, both of these approaches reduce to functoriality of the cartesian product.
		\end{itemize}
	\end{itemize}
\end{definition}
\begin{definition}
	Given a fixed length $\ell$, which we assume clear from the context, and a degree $0 \leq i < \ell$, we define the \textbf{punch mask} $\vec \delta^i$ by $\vec \delta^i_j = \npolar$ if $i \neq j$ and $\vec \delta^i_i = \ypolar$.
\end{definition}
Thus, $\bigsqcup_i \vec \delta^i = \vec{\ypolar}$, and more generally $\vec a = \bigsqcup_i (\vec \delta^i \sqcap \vec a)$.
\begin{theorem}[SSS-factorization] \label{sssfactorization}
	Let $\vec a$ be a mask of length $\ell$.
	For any jet cube morphism $\hat \vfi : V \to W$ in $\jetcubefwd \affine M {\vec a}$, there exist jet cubes $(V_i)_{0 \leq i < \ell}$ and $(W_i)_{0 \leq i < \ell}$ where $V_i, W_i$ are jet cubes of mask $\vec a \sqcap \vec \delta^i$, as well as jet cube morphisms $\vfi_i : V_i \to W_i$ and jet cube morphisms $\rho_0$ and $\rho_1$ that are cube renamings\footnote{Morphisms in $\Kleisli(M)$ that come from $\Set$, i.e.\ are not effectful or do not use the constants and operators provided by $M$.}, such that $\vfi$ factorizes as:
	\[
		\xymatrix{
			V
				\ar[rr]^{\rho_0}
			&& {\bigasterisk_i V_i}
				\ar[rr]^{\bigasterisk_i \vfi_i}
			&& {\bigasterisk_i W_i}
				\ar[rr]^{\rho_1}_\cong
			&& W,
		}
	\]
	where $\bigasterisk$ denotes a semisymmetric separated product.
\end{theorem}
\begin{proof}
	Assume $V$ and $W$ adhere to \cref{conv:sort-cubes}.

	We simply define $W_i$ as the jet cube consisting of all variables of $W$ of degree $i$, with their original typing.
	It is then immediately clear that $\bigasterisk_i W_i \cong W$ by a renaming $\rho_1$.\footnote{In fact $\rho_1$ is the identity but this is due to the assumption of \cref{conv:sort-cubes}.}
	
	Next, we define $V_i$ as the jet cube consisting of all variables $\dm j$ of $V_i$ such that there is a variable $\dm i \in W_i$ such that $\dm i \psub \vfi$ depends on $\dm j$ (after reduction).
	Variables of degree $i$ are kept with their original typing, unless a variable to their right has been used at a lower (stronger) degree, in which case they are retyped as $\rival{\equijet_i}$. Variables of higher (weaker) degree $j>i$ are retyped as $\rival{\edge_j}$. Variables of lower degree cannot occur.
	
	We then define $\rho_0$ as the cube morphism that discards all variables unused by $\vfi$, and $\vfi_i$ as the cube morphism such that $\dm i \psub{\vfi_i} = \dm i \psub{\vfi}$ for every variable $\dm i$ in $W_i$.
	It is then immediately clear that $\vfi = \rho_1 \circ \paren{\bigasterisk_i \vfi_i} \circ \rho_0$.
	What remains to be proven is that $\rho_0$ and $\vfi_i$ are jet cube morphisms.
	
	By \cref{thm:left-of-concursor}, any variable that is either unused, or used at a strictly lower (stronger) degree, or to the left of such a variable of the same degree, can be promoted to an equijet variable, and $\vfi$ will still be a jet cube morphism.
	The result of these promotions is exactly (up to renaming isomorphism) $\bigasterisk_i V_i$.
	As only an initial segment of the variables of any given degree gets promoted to equijet variables, the renaming $\rho_0 : V \to \bigasterisk_i V_i$ is a jet cube morphism.
	
	For $\vfi_i$, first note that the weakening morphism $\pi_i$ is a jet cube morphism $W \to \Usymcube_{\vec a \sqcap \vec \delta^i \sqsubseteq \vec a} W_i$, and hence so is $\pi_i \circ \vfi$.
	By transposition, we see that $\pi_i \circ \vfi$ is also a jet cube morphism $\Fsymcube_{\vec a \sqcap \vec \delta^i \sqsubseteq \vec a} V \to W_i$.
	As a cube morphism, $\pi_i \circ \vfi$ factors over the weakening morphism $\xi_i : \erasejc V \to \erasejc{V_i}$ as $\pi_i \circ \vfi = \vfi_i \circ \xi_i$.
	Now $\xi_i$ only projects out symmetric variables therefore is a jet cube morphism $\Fsymcube_{\vec a \sqcap \vec \delta^i \sqsubseteq \vec a} V \to V_i$. Moreover, $\JEP(\xi_i)$ is jet-surjective (\cref{def:jet-surjective}), so we conclude that $\vfi_i$ too must be a jet cube morphism.
\end{proof}

\subsection{Comparison to the Literature} \label{sec:jetcubes:comparison}
\subsubsection{Point category}
\begin{proposition}
	The point category (terminal category) is isomorphic to $\jetcubefwd{\mycubex}{M}{[]}$.
\end{proposition}
\begin{proof}
	It is clear that $()$ is the only object.
	The only endomorphism of $()$ in $\cubecat^\mycubex_M$ is the identity, and $\erasejc \loch$ is faithful, so there is only one morphism.
\end{proof}

\subsubsection{Affine Symmetric Cubes}
I am unsure whether the category of affine symmetric cubes $\cubecat_\bipointedsym^\affine$ appears anywhere.
\begin{proposition} \label{thm:jetcubes:comparison:bipointedsym}
	The category $\cubecat_\bipointedsym^\affine$ is isomorphic to $\jetcubefwd{\affine}{\bipointedsym}{[\npolar]}$ and $\jetcubefwd{\cartes}{\bipointedsym}{[\npolar]}$.
\end{proposition}
\begin{proof}
	The latter two categories are isomorphic by \cref{thm:affine-automatic}.
	It is clear that $\erasejc{\loch} : \jetcubefwd{\affine}{\bipointedsym}{[\npolar]} \to \cubecat_\bipointedsym^\affine$ is bijective on objects.
	It is faithful, because $U : \jetset{[\npolar]} \to \Set$ is faithful.
	It is full, because any morphism can be derived in the calculus (\cref{fig:calculus}), as can be shown by induction on the length of the codomain.
\end{proof}

\subsubsection{Affine Cubes}
The category of affine cubes $\cubecat_\bipointed^\affine$ appears in a cubical model of HoTT \cite{bch} and its unary analogue in a cubical model of parametricity \cite{bcm}.
\begin{proposition} \label{thm:jetcubes:comparison:bipointed}
	The category $\cubecat_\bipointed^\affine$ is isomorphic to $\jetcubefwd{\affine}{\bipointed}{[\npolar]}$ and $\jetcubefwd{\cartes}{\bipointed}{[\npolar]}$.
\end{proposition}
\begin{proof}
	Each time, the category for $\bipointed$ is the wide\footnote{Containing all objects.} subcategory of the corresponding one for $\bipointedsym$ on morphisms that do not mention $\lnot$, so the result follows from \cref{thm:jetcubes:comparison:bipointedsym}.
\end{proof}

\subsubsection{Cartesian Cubes}
One might hope to retrieve other existing categories as follows:
\begin{itemize}
	\item De Morgan cubes $\cubecat^\cartes_\demorgan$ \cite{cubical} as $\jetcubefwd{\cartes}{\demorgan}{[\npolar]}$,
	\item Cartesian cubes $\cubecat^\cartes_\bipointed$ as $\jetcubefwd{\cartes}{\demorgan}{[\npolar]}$,
	\item Depth $n$ cubes \cite{reldtt,reldtt-techreport} as $\jetcubefwd{\cartes}{\bipointed}{[\npolar]^n}$, where $\vec x^n$ denotes the $n$-fold repetition of the list $\vec x$,
	\item \ldots
\end{itemize}
However, one cannot:
\begin{proposition}
	The morphism $(\dm i / \dm j, \dm i / \dm k) : (\dm i : \IX) \to (\dm j : \IX, \dm k : \IX)$ in $\cubecat^\cartes_M$ is not the erasure of any jet cube morphism.
\end{proposition}
\begin{proof}
	Jet sets obtained from $\JEP$ do not have diagonals.
\end{proof}

\subsubsection{Affine Depth $n$ Cubes}
\begin{definition}
	The category $\dcubeopt \mycubex M n$ has:
	\begin{itemize}
		\item As objects lists of the form $W = (\dm i_1 : \rival{k_1}, \ldots, \dm i_m : \rival{k_m})$ where the $\dm i_i$ are regarded as bound de Bruijn indices and the $k_i$ are in $\accol{0, \ldots, n-1}$.
		We define its erasure as $\erasejc W = (\dm i_1 : \IX, \ldots, \dm i_m : \IX)$.
		\item As morphisms $\hat\vfi : V \to W$, morphisms $\vfi : \erasejc V \to \erasejc W$ such that for each $\dm i : \rival{k}$ in $W$, the expression $\dm i\psub \vfi$ mentions only variables $\dm j : \rival{\ell}$ in $V$ such that $\ell \geq k$.
	\end{itemize}
	Clearly this category comes with a faithful functor $\erasejc \loch : \dcubeopt \mycubex M n \to \cubecat^\mycubex_M$.
\end{definition}
The categories $\dcubeopt \cartes \bipointed n$ appear in the model of Degrees of Relatedness \cite{reldtt,reldtt-techreport}.

\begin{proposition} \label{thm:jetcubes:comparison:depth-bipointedsym}
	The category $\dcubeopt \affine \bipointedsym n$ is isomorphic to the category $\jetcubefwd \mycubex \bipointedsym {[\npolar]^n}$ for $\mycubex \in \accol{\cartes, \affine}$.
\end{proposition}
\begin{proof}
	By \cref{thm:affine-automatic}, the value of $\mycubex$ does not matter, so let us set $\mycubex = \affine$.
	We construct a functor $F : \jetcubefwd \affine \bipointedsym {[\npolar]^n} \to \dcubeopt \affine \bipointedsym n$ such that $\erasejc \loch \circ F = \erasejc \loch$:
	\begin{itemize}
		\item $F(\dm i_1 : \rival{\edge_{k_1}}, \ldots, \dm i_m : \rival{\edge_{k_m}}) = (\dm i_1 : \rival{k_1}, \ldots, \dm i_m : \rival{k_m})$,
		\item For the action on morphisms, we have nothing to choose, we can only verify that it exists. This is done by induction on the derivation in the calculus (\cref{fig:calculus}).
	\end{itemize}
	
	It is clear that $F$ is bijective on objects, and faithful.
	Fullness is proven by proving by induction on the length of the codomain that every morphism of depth $n$ cubes can be derived in the calculus.
\end{proof}

\begin{proposition} \label{thm:jetcubes:comparison:depth-bipointed}
	The category $\dcubeopt \affine \bipointed n$ is isomorphic to the category $\jetcubefwd \mycubex \bipointed {[\npolar]^n}$ for $\mycubex \in \accol{\cartes, \affine}$.
\end{proposition}
\begin{proof}
	Each time, the category for $\bipointed$ is the wide subcategory of the corresponding one for $\bipointedsym$ on morphisms that do not mention $\lnot$, so the result follows from \cref{thm:jetcubes:comparison:depth-bipointedsym}.
\end{proof}

\subsubsection{Comparison to Pinyo and Kraus's Twisted Cube Category}
In this section, we relate jet cubes to Pinyo and Kraus's twisted cubes \cite{pinyo-twisted} when $\vec a = [\ypolar]$.
$\jetset{[\ypolar]}$ is the category of proof-irrelevant reflexive graphs.
Pinyo and Kraus use arbitrary proof-irrelevant graphs, but since $\top$ is reflexive and the twisted prism functor \cite[def.\ 4]{pinyo-twisted} restricts to reflexive graphs, all twisted cubes are reflexive graphs anyway.

Two twisted cube categories appear (up to isomorphism) in \cite{pinyo-twisted}, and we show that we can recover both.

\begin{definition} \cite[def.\ 25]{pinyo-twisted}
	The category $\twistedcubegrp$ has as objects $[\ypolar]$-jet-cubes (i.e.\ natural numbers) and as morphisms $V \to W$ all jet set morphisms (i.e. graph morphisms) $\JEP(V) \to \JEP(W)$.
\end{definition}
\begin{proposition}
	 $\twistedcubegrp$ is isomorphic to $\jetcubefwd \cartes \booleanalg {[\ypolar]}$.
\end{proposition}
\begin{proof}
	Clearly, the objects correspond.
	The morphisms $V \to W$ of $\jetcubefwd \cartes \booleanalg {[\ypolar]}$ are morphisms $f : \JEP(V) \to \JEP(W)$ such that $Uf : \EP(\erasejc V) \to \EP(\erasejc W)$ lifts to a morphism of cubes, which it always does by \cref{thm:booleanalg-ff}.
\end{proof}

We thoroughly rephrase Pinyo and Kraus's ternary twisted cube category:
\begin{definition} \cite[def.\ 34]{pinyo-twisted} \label{def:twisted-tri}
	The category $\twistedcubetri$ has as objects $[\ypolar]$-jet-cubes (i.e.\ natural numbers) and as morphisms $V \to W$ all jet set morphisms (i.e. graph morphisms) $\JEP(V) \to \JEP(W)$ or, equivalently by the previous proposition, all jet cube morphisms $V \to W$ in $\jetcubefwd \cartes \booleanalg {[\ypolar]}$,	
	 generated by the rules \ruleref{terminal}, [\ruleref{src:fwd} immediately below \ruleref{inv:bck}], \ruleref{tgt:fwd} and \ruleref{prism:fwd} in \cref{fig:calculus}.
\end{definition}
The shared reader may object that Pinyo and Kraus define the morphisms of $\twistedcubetri$ by \emph{constructing} them inductively, rather than by selecting them inductively as we do above. However:
\begin{corollary} \label{thm:twisted-tri-inductive}
	Any morphism of $\twistedcubetri$ has a unique derivation using the given rules. \qed
\end{corollary}
\begin{proposition}
	$\twistedcubetri$ is isomorphic to $\jetcubefwd \affine \bipointedsym {[\ypolar]}$.
\end{proposition}
\begin{proof}
	Since the rules mentioned in \cref{def:twisted-tri} pertain to the calculus of $\jetcubetri \affine \bipointedsym {[\ypolar]}$ and in fact always yield premises/conclusions about forward cubes for conclusions/premises about forward cubes, and since $\jetcubefwd \affine \bipointedsym {[\ypolar]}$ is a faithful subcategory of $\jetcubefwd \cartes \booleanalg {[\ypolar]}$ by \cref{thm:monad-coercions-faithful}, it is clear that the identity-on-objects functor $\twistedcubetri \to \jetcubefwd \affine \bipointedsym {[\ypolar]}$ is faithful, i.e.\ we can think of $\twistedcubetri$ as a wide subcategory of $\jetcubefwd \affine \bipointedsym {[\ypolar]}$.
	
	To show fullness, we note the following facts about the calculus for $\jetcubetri \affine \bipointedsym {[\ypolar]}$:
	\begin{enumerate}
		\item No rule (read bottom-up) introduces equijets in the codomain.
		\item In absence of equijets in the codomain, no rule changes the mask (except \ruleref{symmetrize} applied to the terminal codomain, but then apply \ruleref{terminal} instead).
		\begin{itemize}
			\item In particular, \ruleref{symmetrize} is useless.
		\end{itemize}
		\item Equijet variables can only be used at strictly stronger (lower) degrees, or at the current degree $i$ if $a_i = \npolar$. Since we have only one directed degree, equijet variables cannot be used.
		\begin{itemize}
			\item Hence \ruleref{wkn} can only be used to derive constant morphisms, which can instead be derived by [\ruleref{src:fwd} after \ruleref{inv:bck}] and \ruleref{tgt:fwd}.
			\item Hence \ruleref{exchange} is useless.
		\end{itemize} 
		\item At mask $[\ypolar]$, the rule \ruleref{concursor} cannot be used as there is only one degree.
		\item Since \ruleref{inv:fwd} and \ruleref{inv:bck} are mutually inverse, they can together be freely inserted everywhere. Hence, we can replace the rule \ruleref{src:fwd} with [\ruleref{src:fwd} after \ruleref{inv:bck}].
		\item \ruleref{inv:fwd} and \ruleref{inv:bck} can be pushed up through any of the remaining rules except \ruleref{prism:fwd} and \ruleref{prism:bck}. Thus, we only involute right before using a variable.
		All other rules (still read bottom-up) do not turn a forward codomain into a trioriented codomain, i.e.\ they do not introduce opposite jets.
		Thus, we can assume the codomain is a forward jet cube until we encounter $\lnot \dm i$.
		\item This means that until we encounter $\lnot \dm i$, we only need the rules \ruleref{terminal}, [\ruleref{src:fwd} after \ruleref{inv:bck}], \ruleref{tgt:fwd} and \ruleref{prism:fwd}.
		These do not turn a forward domain into a trioriented domain. Thus, until we encounter $\lnot \dm i$, we can assume the domain is forward.
		\item If both domain and codomain are forward, we cannot encounter $\lnot \dm i$.
	\end{enumerate}
	This means we can always rewrite a derivation tree in the calculus for $\jetcubetri \affine \bipointedsym {[\ypolar]}$ of a morphism in $\jetcubefwd \affine \bipointedsym {[\ypolar]}$ to use only the prescribed rules. 
\end{proof}

\chapter{Modalities}

\chapter{Paths and Bridges}
\begin{remark} \todoi{Move this remark}
	We note that it is always possible to restrict our mode theory, by discarding modes but keeping the same modalities and 2-cells between remaining modes.
	We could decide to restrict to any of the following subsets of modes:
	\begin{itemize}
		\item Modes of the form $[\ypolar]^*$, i.e.\ where all degrees are polar,
		\item Modes of the form $([\npolar] | [\npolar, \ypolar])^*$, i.e.\ where we think of a level as containing a path relation and optionally a weaker jet relation,
		\begin{itemize}
			\item Modes of the form $[\npolar, \ypolar]^*$ where the presence of a jet relation at each level is required,
		\end{itemize}
		\item Modes of the form $([\npolar] | [\ypolar, \npolar])^*$, i.e.\ where we think of a level as containing a bridge relation and optionally a stronger jet relation,
		\begin{itemize}
			\item Modes of the form $[\ypolar, \npolar]^*$ where the presence of a jet relation at each level is required,
		\end{itemize}
		\item Modes of the form $([\npolar, \npolar] | [\npolar, \ypolar, \npolar])^*$, i.e.\ where we think of a level as containing a path relation and a weaker bridge relation and optionally, in between, a jet relation,
		\begin{itemize}
			\item Modes of the form $[\npolar, \ypolar, \npolar]^*$ where the presence of a jet relation at each level is required.
		\end{itemize}
	\end{itemize}
	We will occasionally discuss these subtheories. By considering all of $\List\,\Anpolarity$ in the current paper, we maintain generality.
\end{remark}
\todoi{Relate cubes with and without equijets.}

\chapter{Transpension}
\todoi{Does Tw : sSet $\to$ sSet have a transp type? (Yes if it's Tw$_!$)}

\bibliographystyle{alphaurl}
\bibliography{../refs/refs.bib}

\end{document}