\documentclass[a4paper]{article}

\usepackage{a4wide}

\usepackage{amsthm}
\pdfoutput=1

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{mathrsfs}
\RequirePackage{mathtools}
%\RequirePackage{mathabx}
\RequirePackage{latexsym}
%\RequirePackage{epstopdf}
%\RequirePackage{array}
\RequirePackage{stmaryrd}
\RequirePackage[normalem]{ulem}
%\RequirePackage{xfrac}

%\usepackage{bm}
\usepackage[all,cmtip]{xy}
%\usepackage{mathtools}
%\usepackage{longtable}

%\usepackage{mdframed}
%\let\framedCopy=\framed
%\let\framed=\undefined

\usepackage[hidelinks,bookmarksnumbered]{hyperref}
\RequirePackage{cleveref}

\usepackage{wasysym}
\usepackage{stmaryrd}
%\usepackage[notext]{stix}
\usepackage{fontawesome}
\RequirePackage{amssymb}
\RequirePackage{xcolor}
\usepackage{xypic}
	\CompileMatrices
\RequirePackage{mathtools}
\usepackage{stmaryrd}

\usepackage{libertine}

\usepackage[english]{babel}
%\usepackage[dutch]{babel}

\usepackage{../natpt-macros}

%\newcommand{\todoi}[1]{\textbf{\textcolor{red}{#1 \qed}}\par\noindent}
%\newcommand{\todo}[1]{\textbf{\textcolor{red}{\footnote{\textcolor{red}{#1}}}}}
%\newcommand{\todoi}[1]{}
%\newcommand{\todo}[1]{}

\newcommand{\thetitle}{Naturality Pretype Theory - Extended Version}
\newcommand{\theauthors}{Andreas Nuyts}
\begin{document}
	\addtolength{\voffset}{-.5in}

\title{\thetitle}
%\subtitle{Technical report}
\date{\today}
\author{\theauthors{}}
%\address{imec-DistriNet, KU Leuven, Belgium}
\maketitle
%\vspace*{-.5in}
%\begin{abstract}
%\end{abstract}

\tableofcontents

\pagebreak

\section{Base Categories and Modes}
$\ltimes$

\subsection{Modes are Anpolarity Lists}
In RelDTT, modes were natural numbers (minus one) expressing the number of available relations.
In NatPT, we will specify for each of these relations whether it is directed or not.
\begin{definition} \label{def:anpolarity}
	An \textbf{anpolarity}\footnote{`An' is Latin for `whether', as in `Nescio an polare sit,' meaning `I do not know whether it is polar'.} is an element of the set $\Anpolarity := \accol{\ypolar, \npolar}$, where $\ypolar$ stands for polar/directed and $\npolar$ stands for nonpolar/symmetric.
\end{definition}
\noindent As our set of modes, we take $\List\,\Anpolarity$. If $\vec a \in \List\,\Anpolarity$, we write $\lenpol{\vec a}$ for its length.

\begin{remark}
	We note that it is always possible to restrict our mode theory, by discarding modes but keeping the same modalities and 2-cells between remaining modes.
	We could decide to restrict to any of the following subsets of modes:
	\begin{itemize}
		\item Modes of the form $[\ypolar]^*$, i.e.\ where all degrees are polar,
		\item Modes of the form $([\npolar] | [\npolar, \ypolar])^*$, i.e.\ where we think of a level as containing a path relation and optionally a weaker jet relation,
		\begin{itemize}
			\item Modes of the form $[\npolar, \ypolar]^*$ where the presence of a jet relation at each level is required,
		\end{itemize}
		\item Modes of the form $([\npolar] | [\ypolar, \npolar])^*$, i.e.\ where we think of a level as containing a bridge relation and optionally a stronger jet relation,
		\begin{itemize}
			\item Modes of the form $[\ypolar, \npolar]^*$ where the presence of a jet relation at each level is required,
		\end{itemize}
		\item Modes of the form $([\npolar, \npolar] | [\npolar, \ypolar, \npolar])^*$, i.e.\ where we think of a level as containing a path relation and a weaker bridge relation and optionally, in between, a jet relation,
		\begin{itemize}
			\item Modes of the form $[\npolar, \ypolar, \npolar]^*$ where the presence of a jet relation at each level is required.
		\end{itemize}
	\end{itemize}
	We will occasionally discuss these subtheories. By considering all of $\List\,\Anpolarity$ in the current paper, we maintain generality.
\end{remark}

\subsection{Jet Sets}
\begin{definition} \label{def:jetset}
	Let $\vec a$ be a mode. A \textbf{jet set of mode $\vec a$} is a set $X$ equipped with $\lenpol{\vec a}$ (proof-irrelevant%
	\footnote{So these relations are functions $X \to X \to \Prop$ where $\Prop$ is a universe of $h$-propositions \cite{hottbook}. In most applications, these relations will be decidable, but we do not require this.}%
	) relations $\jet_i$ where
	\begin{itemize}
		\item $0 \leq i < \lenpol{\vec a}$ is called the \textbf{degree} and
		\item $\jet_i$ is called the \textbf{$i$-jet relation}
	\end{itemize}
	such that
	\begin{itemize}
		\item when $a_i = \npolar$, then $\jet_i$ is symmetric, in which case we will denote it as $\edge_i$ and call it the \textbf{$i$-edge relation} (notwithstanding that we still consider it a special case of a jet relation),
		\item $x \jet_i y$ implies both $x \jet_{i+1} y$ and $x \tej_{i+1} y$ whenever $0 \leq i < i+1 < \lenpol{\vec a}$.
	\end{itemize}
	A \textbf{morphism} of jet sets of mode $\vec a$ is a function that preserves all the jet and edge relations.
	
	The category of jet sets of mode $\vec a$ is called $\jetset{\vec a}$.
	
	A jet set is called \textbf{transitive} if each of the $i$-jet relations is transitive (i.e. a pre-order and, if $i = \npolar$, an equivalence relation).
\end{definition}
\begin{proposition}
	Let $X$ be a transitive jet set of mode $\vec a$ and $0 \leq i < j < \lenpol{\vec a}$.
	Then the double category whose objects are elements of $X$, morphisms are (unique) proofs of $x \jet_i y$, pro-arrows are (unique) proofs of $x \jet_{j} y$ and squares are elements of the unit type, is a pro-arrow equipment \cite{nlab:proarrow,proarrow1,proarrow2}\todo{Refer to dedicated section instead.}.
\end{proposition}
\begin{proof}
	It is clearly a double category. The existence of companions and conjoints is trivial.
\end{proof}
\begin{definition}
	We define the
	\begin{itemize}
		\item \textbf{$i$-equijet relation} $\equijet_i$ as the symmetric interior of $\jet_i$, i.e.\ $x \equijet_i y$ if and only if $x \jet_i y$ and $x \tej_i y$;
		\item \textbf{$i$-infrajet relation} $\infrajet_i$ as the symmetric closure of $\jet_i$, i.e.\ $x \equijet_i y$ if and only if $x \jet_i y$ or $x \tej_i y$.
	\end{itemize}
\end{definition}
It is immediately clear that for nonpolar degrees, the jet/edge, equijet and infrajet relations coincide.
In general, we can observe that $x \infrajet_i y$ implies $x \equijet_j y$ for $i < j$.
So for mode $[\ypolar, \ypolar, \npolar]$, we get
\[
\xymatrix{
	& 
	\jet_0
		\ar@{:>}[rd]
	&&& 
	\jet_1 
		\ar@{:>}[rd]
	&&& 
	\jet_2 
		\ar@{<:>}[rd]
	\\
	\equijet_0
		\ar@{:>}[ru]
		\ar@{:>}[rd]
	&&
	\infrajet_0
		\ar@{:>}[r]
	&
	\equijet_1
		\ar@{:>}[ru]
		\ar@{:>}[rd]
	&&
	\infrajet_1
		\ar@{:>}[r]
	&
	\equijet_2
		\ar@{<:>}[ru]
		\ar@{<:>}[rd]
	&
	\edge_2
		\ar@{<:>}[l]
		\ar@{<:>}[u]
		\ar@{<:>}[r]
		\ar@{<:>}[d]
	&
	\infrajet_2.
	\\
	& 
	\tej_0 
		\ar@{:>}[ru]
	&&& 
	\tej_1 
		\ar@{:>}[ru]
	&&& 
	\tej_2 
		\ar@{<:>}[ru]
}
\]

\begin{definition}
	Let $\vec a$ be a mode, $i < \lenpol{\vec a}$ and $X \in \Obj(\jetset{\vec a})$.
	We define the \textbf{$i$-opposite $\Op_i(X)$ of $X$} as the jet set with the same carrier and relations as $X$ except that the $i$-jet relation is reversed: $x \jet_i^{\Op_i(X)} y$ if and only if $x \tej_i^X y$.
	This defines a functor $\Op_i(X) : \jetset{\vec a} \to \jetset{\vec a}$.
\end{definition}
We have $\Op_i \circ \Op_i = \Id$ and if $a_i = \npolar$ then $\Op_i = \Id$.

\subsection{Intervals and Prisms}
\begin{definition} \label{def:interval}
	Let $\vec a$ be a mode and $i < \lenpol{\vec a}$.
	\begin{itemize}
		\item The \textbf{$i$-jet interval} $\rival{\jet_i}$ is defined as the jet set of mode $\vec a$ with carrier $\accol{0, 1}$ and relations generated by $0 \jet_i 1$.
		\item The \textbf{$i$-equijet interval} $\rival{\equijet_i}$ is defined as the jet set of mode $\vec a$ with carrier $\accol{0, 1}$ and relations generated by $0 \equijet_i 1$.
	\end{itemize}
	If $a_i = \npolar$ then $\rival{\jet_i} = \rival{\equijet_i} =: \rival{\edge_i}$ is called the \textbf{$i$-edge interval}.
\end{definition}
Note that it would be meaningless to define an $i$-infrajet interval in the same way.

\begin{definition} \label{def:prism}
	Let $\vec a$ be a mode, $i < \lenpol{\vec a}$ and $X \in \Obj(\jetset{\vec a})$.
	We define the \textbf{$i$-twisted prism $X \multip \rival{\jet_i}$} on $X$ as the jet set of mode $\vec a$ with
	\begin{itemize}
		\item carrier $X \times \accol{0, 1}$,
		\item jet relations generated by the following requirements:
		\begin{itemize}
			\item $(\loch, 0) : \Op_i(X) \to X \multip \rival{\jet_i}$ is a jet set morphism,
			\item $(\loch, 1) : X \to X \multip \rival{\jet_i}$ is a jet set morphism,
			\item $(x, 0) \jet_i (x, 1)$ for all $x \in X$.
		\end{itemize}
	\end{itemize}
	This defines the \textbf{$i$-twisted prism functor} $\loch \multip \rival{\jet_i} : \jetset{\vec a} \to \jetset{\vec a}$.
	If $a_i = \npolar$, then we call this simply the \textbf{$i$-prism functor $\loch \multip \rival{\edge_i}$.}
\end{definition}
\todoi{Should there be a prism functor for $\rival{\equijet_i}$?}

\subsection{Jet Cubes}
\begin{definition} \label{def:jet-cube}
	Let $\vec a$ be a mode.
	We define the set of \textbf{jet cubes of mode $\vec a$} as the set of objects of $\jetset{\vec a}$ generated by:
	\begin{itemize}
		\item the terminal object $\top := \accol{()}$,
		\item the twisted prism operations $\loch \multip \rival{\jet_i} : \Obj(\jetset{\vec a}) \to \Obj(\jetset{\vec a})$.
	\end{itemize}
\end{definition}
It is clear that every jet cube can be generated by the above steps in only a single way, so we can reason about jet cubes inductively.
\begin{corollary} \label{thm:jet-cube-op}
	If $W$ is a jet cube, then $\Op_i(W)$ is isomorphic (in $\jetset{\vec a}$) to a jet cube $\Opcube_i(W)$.
	We have $\Opcube_i \circ \Opcube_i = \Id$.
\end{corollary}
In fact, it happens to be the case that $\Opcube_i(W) = W$, but we will avoid to use this fact as the isomorphism $\Op_i(W) \cong \Opcube_i(W) = W$ is not the identity on objects.
\begin{proof}
	We define recursively:
	\begin{itemize}
		\item $\Opcube_i(\top) := \top = \Op_i(\top)$,
		\item $\Opcube_i(W \multip \rival{\jet_i}) := W \multip \rival{\jet_i} \cong \Op_i(W \multip \rival{\jet_i})$ (by swapping 0 and 1),
		\item $\Opcube_i(W \multip \rival{\jet_j}) := \Opcube_i(W) \multip \rival{\jet_j} \cong \Op_i(W) \multip \rival{\jet_j} = \Op_i(W \multip \rival{\jet_j})$ if $i \neq j$. \qedhere
	\end{itemize}
\end{proof}

\begin{definition} \label{def:jet-cube-cat}
	Let $\vec a$ be a mode.
	We define the category $\jetcube{\vec a}$ of \textbf{jet cubes of mode $\vec a$} as the proof-relevant sub\emph{graph} (a priori; it will be a category after \cref{thm:jet-cube-cat}) of $\jetset{\vec a}$ whose nodes are the jet cubes, and whose edges are generated by:
	\begin{itemize}
		\item $(\vfi, 0) : \Hom_{\jetcube{\vec a}}(V, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, \Opcube_i(W))$,
		\item $(\vfi, 1) : \Hom_{\jetcube{\vec a}}(V, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, W)$,
		\item $\vfi \multip \rival{\jet_i} : \Hom_{\jetcube{\vec a}}(V \multip \rival{\jet_i}, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, W)$,
		\item $() : \Hom_{\jetcube{\vec a}}(V, \top)$.
	\end{itemize}
\end{definition}
Again, every jet cube morphism can be generated by the above steps in only a single way, so we can reason about them inductively.
\begin{corollary} \label{thm:jet-cube-op-ftr}
	Each $\Opcube_i$ extends to a well-defined graph endomorphism (and hence, after \cref{thm:jet-cube-cat}, an endofunctor) on $\jetcube{\vec a}$.
	We have $\Opcube_i \circ \Opcube_i = \Id$.
\end{corollary}
\begin{proof}
	We define recursively:
	\begin{itemize}
		\item $\Opcube_i(\vfi, 0 \in \rival{\jet_i}) := (\Opcube_i(\vfi), 1)$,
		\item $\Opcube_i(\vfi, 0 \in \rival{\jet_j}) := (\Opcube_i(\vfi), 0)$ if $i \neq j$,
		\item $\Opcube_i(\vfi, 1 \in \rival{\jet_i}) := (\Opcube_i(\vfi), 0)$,
		\item $\Opcube_i(\vfi, 1 \in \rival{\jet_j}) := (\Opcube_i(\vfi), 1)$ if $i \neq j$,
		\item $\Opcube_i(\vfi \multip \rival{\jet_i}) = \vfi \multip \rival{\jet_i}$,
		\item $\Opcube_i(\vfi \multip \rival{\jet_j}) = \Opcube_i(\vfi) \multip \rival{\jet_j}$ if $i \neq j$,
		\item $\Opcube_i(()) = ()$. \qedhere
	\end{itemize}
\end{proof}
\begin{corollary} \label{thm:jet-cube-cat}
	$\jetcube{\vec a}$ is a category.
\end{corollary}
\begin{proof}
	Identity and composition can be defined recursively; category laws proven inductively.
\end{proof}

\subsection{Comparison to Pinyo and Kraus's Twisted Cube Category}
Out of the category of jet sets, we will carve the category of jet cubes, in such a way that the category of jet cubes of mode $[\ypolar]$ is isomorphic to the twisted cube category \cite{pinyo-twisted}.


\bibliographystyle{alphaurl}
\bibliography{../refs/refs.bib}

\end{document}