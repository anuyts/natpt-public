\documentclass[a4paper]{article}

\usepackage{a4wide}

\usepackage{amsthm}
\pdfoutput=1

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{mathrsfs}
\RequirePackage{mathtools}
%\RequirePackage{mathabx}
\RequirePackage{latexsym}
%\RequirePackage{epstopdf}
%\RequirePackage{array}
\RequirePackage{stmaryrd}
\RequirePackage[normalem]{ulem}
%\RequirePackage{xfrac}

%\usepackage{bm}
\usepackage[all,cmtip]{xy}
%\usepackage{mathtools}
%\usepackage{longtable}

%\usepackage{mdframed}
%\let\framedCopy=\framed
%\let\framed=\undefined

\usepackage[hidelinks,bookmarksnumbered]{hyperref}
\RequirePackage{cleveref}

\usepackage{wasysym}
\usepackage{stmaryrd}
%\usepackage[notext]{stix}
\usepackage{fontawesome}
\RequirePackage{amssymb}
\RequirePackage{xcolor}
\usepackage{xypic}
	\CompileMatrices
\RequirePackage{mathtools}
\usepackage{stmaryrd}

\usepackage{libertine}

\usepackage[english]{babel}
%\usepackage[dutch]{babel}

\usepackage{../natpt-macros}

%\newcommand{\todoi}[1]{\textbf{\textcolor{red}{#1 \qed}}\par\noindent}
%\newcommand{\todo}[1]{\textbf{\textcolor{red}{\footnote{\textcolor{red}{#1}}}}}
%\newcommand{\todoi}[1]{}
%\newcommand{\todo}[1]{}

\newcommand{\thetitle}{Naturality Pretype Theory - Extended Version}
\newcommand{\theauthors}{Andreas Nuyts}
\begin{document}
	\addtolength{\voffset}{-.5in}

\title{\thetitle}
%\subtitle{Technical report}
\date{\today}
\author{\theauthors{}}
%\address{imec-DistriNet, KU Leuven, Belgium}
\maketitle
%\vspace*{-.5in}
%\begin{abstract}
%\end{abstract}

\tableofcontents

\pagebreak

\section{Base Categories and Modes}

\subsection{Modes are Anpolarity Masks}
In RelDTT, modes were natural numbers (minus one) expressing the number of available relations.
In NatPT, we will specify for each of these relations whether it is directed or not.
\begin{definition} \label{def:anpolarity}
	An \textbf{anpolarity}\footnote{`An' is Latin for `whether', as in `Nescio an polare sit,' meaning `I do not know whether it is polar'.} is an element of the set $\Anpolarity := \accol{\ypolar, \npolar}$, where $\ypolar$ stands for polar/directed and $\npolar$ stands for nonpolar/symmetric.
	
	An \textbf{anpolarity mask} or just \textbf{mask} is a list $\vec a \in \List\,\Anpolarity$ of anpolarities. We write $\lenpol{\vec a}$ for its length, and call the numbers $0, \ldots, \lenpol{\vec a} - 1$ \textbf{degrees}.
\end{definition}

\begin{remark} \todoi{Move this remark}
	We note that it is always possible to restrict our mode theory, by discarding modes but keeping the same modalities and 2-cells between remaining modes.
	We could decide to restrict to any of the following subsets of modes:
	\begin{itemize}
		\item Modes of the form $[\ypolar]^*$, i.e.\ where all degrees are polar,
		\item Modes of the form $([\npolar] | [\npolar, \ypolar])^*$, i.e.\ where we think of a level as containing a path relation and optionally a weaker jet relation,
		\begin{itemize}
			\item Modes of the form $[\npolar, \ypolar]^*$ where the presence of a jet relation at each level is required,
		\end{itemize}
		\item Modes of the form $([\npolar] | [\ypolar, \npolar])^*$, i.e.\ where we think of a level as containing a bridge relation and optionally a stronger jet relation,
		\begin{itemize}
			\item Modes of the form $[\ypolar, \npolar]^*$ where the presence of a jet relation at each level is required,
		\end{itemize}
		\item Modes of the form $([\npolar, \npolar] | [\npolar, \ypolar, \npolar])^*$, i.e.\ where we think of a level as containing a path relation and a weaker bridge relation and optionally, in between, a jet relation,
		\begin{itemize}
			\item Modes of the form $[\npolar, \ypolar, \npolar]^*$ where the presence of a jet relation at each level is required.
		\end{itemize}
	\end{itemize}
	We will occasionally discuss these subtheories. By considering all of $\List\,\Anpolarity$ in the current paper, we maintain generality.
\end{remark}

\subsection{Jet Sets}
\begin{definition} \label{def:jetset}
	Let $\vec a$ be a mask. An \textbf{$\vec a$-jet-set} is a set $X$ equipped with $\lenpol{\vec a}$ (proof-irrelevant%
	\footnote{So these relations are functions $X \to X \to \Prop$ where $\Prop$ is a universe of $h$-propositions \cite{hottbook}. In most applications, these relations will be decidable, but we do not require this.}%
	) relations $\jet_i$ where
	\begin{itemize}
		\item $0 \leq i < \lenpol{\vec a}$ is called the \textbf{degree},
		\item $\jet_i$ is called the \textbf{$i$-jet relation},
		\item its opposite $\tej_i$ is called the \textbf{opposite $i$-jet relation},
	\end{itemize}
	such that
	\begin{itemize}
		\item when $a_i = \npolar$, then $\jet_i$ is symmetric, in which case we will denote it as $\edge_i$ and call it the \textbf{$i$-edge relation} (notwithstanding that we still consider it a special case of a jet relation),
		\item $x \jet_i y$ implies both $x \jet_{i+1} y$ and $x \tej_{i+1} y$ whenever $0 \leq i < i+1 < \lenpol{\vec a}$.
	\end{itemize}
	A \textbf{morphism} of $\vec a$-jet-sets is a function that preserves all the jet and edge relations.
	
	The category of $\vec a$-jet-sets is called $\jetset{\vec a}$.
\end{definition}
\begin{definition} \label{def:full-jetsethom}
	A jet set morphism is called \textbf{full} if it reflects all jet relations.
\end{definition}
\begin{definition} \label{def:transitive-jetset}
	A jet set is called \textbf{transitive} if each of the $i$-jet relations is transitive (i.e. a pre-order and, if $i = \npolar$, an equivalence relation).
\end{definition}
\begin{proposition} \label{thm:jetset-equipment}
	Let $X$ be a transitive $\vec a$-jet-set and $0 \leq i < j < \lenpol{\vec a}$.
	Then the double category whose objects are elements of $X$, morphisms are (unique) proofs of $x \jet_i y$, pro-arrows are (unique) proofs of $x \jet_{j} y$ and squares are elements of the unit type, is a pro-arrow equipment \cite{nlab:proarrow,proarrow1,proarrow2}\todo{Refer to dedicated section instead.}.
\end{proposition}
\begin{proof}
	It is clearly a double category. The existence of companions and conjoints is trivial.
\end{proof}
\begin{definition}
	We define the $a \cdot a \infrajet b_{a \cdot a \infrajet b_{a \cdot a \infrajet b}}$
	\begin{itemize}
		\item \textbf{$i$-equijet relation} $\equijet_i$ as the symmetric interior of $\jet_i$, i.e.\ $x \equijet_i y$ if and only if $x \jet_i y$ and $x \tej_i y$;
		\item \textbf{$i$-infrajet relation} $\infrajet_i$ as the symmetric closure of $\jet_i$, i.e.\ $x \equijet_i y$ if and only if $x \jet_i y$ or $x \tej_i y$.
	\end{itemize}
\end{definition}
It is immediately clear that for nonpolar degrees, the jet/edge, equijet and infrajet relations coincide.
In general, we can observe that $x \infrajet_i y$ implies $x \equijet_j y$ for $i < j$.
So for mode $[\ypolar, \ypolar, \npolar]$, we get
\[
\xymatrix{
	& 
	\jet_0
		\ar@{:>}[rd]
	&&& 
	\jet_1 
		\ar@{:>}[rd]
	&&& 
	\jet_2 
		\ar@{<:>}[rd]
	\\
	\equijet_0
		\ar@{:>}[ru]
		\ar@{:>}[rd]
	&&
	\infrajet_0
		\ar@{:>}[r]
	&
	\equijet_1
		\ar@{:>}[ru]
		\ar@{:>}[rd]
	&&
	\infrajet_1
		\ar@{:>}[r]
	&
	\equijet_2
		\ar@{<:>}[ru]
		\ar@{<:>}[rd]
	&
	\edge_2
		\ar@{<:>}[l]
		\ar@{<:>}[u]
		\ar@{<:>}[r]
		\ar@{<:>}[d]
	&
	\infrajet_2.
	\\
	& 
	\tej_0 
		\ar@{:>}[ru]
	&&& 
	\tej_1 
		\ar@{:>}[ru]
	&&& 
	\tej_2 
		\ar@{<:>}[ru]
}
\]

\begin{definition} \label{def:op}
	Let $\vec a$ be a mask, $i < \lenpol{\vec a}$ and $X \in \Obj(\jetset{\vec a})$.
	We define the \textbf{$i$-opposite $\Op_i(X)$ of $X$} as the jet set with the same carrier and relations as $X$ except that the $i$-jet relation is reversed: $x \jet_i^{\Op_i(X)} y$ if and only if $x \tej_i^X y$.
	This defines a functor $\Op_i(X) : \jetset{\vec a} \to \jetset{\vec a}$.
\end{definition}
We have $\Op_i \circ \Op_i = \Id$ and if $a_i = \npolar$ then $\Op_i = \Id$.
\begin{definition} \label{def:sym-forget}
	Write $\vec a \sqsubset_i \vec b$ if $\lenpol{\vec a} = \lenpol{\vec b}$, $a_j = b_j$ for all $j \neq i$, $a_i = \npolar$ and $b_i = \ypolar$.
	
	If $\vec a \sqsubset_i \vec b$, then we write $\Usym_i : \jetset{\vec a} \to \jetset{\vec b}$ for the forgetful functor.
\end{definition}
\begin{corollary} \label{def:sym-free} \label{def:sym-cofree}
	The forgetful functor $\Usym_i$ as part of an adjoint triple $\Fsym_i \dashv \Usym_i \dashv \Csym_i$ where $\Fsym_i$ and $\Csym_i$ take a $\vec b$-jet-set $X$ to a $\vec a$-jet-set of the same carrier with the same $j$-jet relations for $j \neq i$ but where
	\begin{itemize}
		\item $x \edge_i^{\Fsym_i X} y$ if and only if $x \infrajet_i^X y$,
		\item $x \edge_i^{\Csym_i X} y$ if and only if $x \equijet_i^X y$.
	\end{itemize}
	We have $\Fsym_i \circ \Usym_i = \Csym_i \circ \Usym_i = \Id$, so that $\UFsym_i := \Usym_i \circ \Fsym_i$ is an idempotent monad and $\UCsym_i := \Usym_i \circ \Csym_i$ is an idempotent comonad.
\end{corollary}
\begin{definition} \label{def:sym-closure-of-sym}
	We extend the definition of $\UFsym_i$ and $\UCsym_i$ to endofunctors on $\jetset{\vec b}$ where $b_i$ can be \emph{any} anpolarity:
	\begin{itemize}
		\item If $b_i = \ypolar$ then they are defined as above,
		\item If $b_i = \npolar$ then they are defined as the identity functor.
	\end{itemize}
	Either way, they are an idempotent (co)monad and we have $\UFsym_i \dashv \UCsym_i$.
\end{definition}

\subsection{Intervals and Prisms}
\begin{definition} \label{def:interval}
	Let $\vec a$ be a mask and $i < \lenpol{\vec a}$.
	\begin{itemize}
		\item The \textbf{$i$-jet interval} $\rival{\jet_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \jet_i 1$.
		\item The \textbf{opposite $i$-jet interval} $\rival{\jet_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \tej_i 1$.
		\item The \textbf{$i$-equijet interval} $\rival{\equijet_i}$ is defined as the $\vec a$-jet-set with carrier $\accol{0, 1}$ and relations generated by $0 \equijet_i 1$.
	\end{itemize}
	If $a_i = \npolar$ then $\rival{\jet_i} = \rival{\tej_i} = \rival{\equijet_i} =: \rival{\edge_i}$ is called the \textbf{$i$-edge interval}.
\end{definition}
Note that it would be meaningless to define an $i$-infrajet interval in the same way.

\begin{definition} \label{def:prism}
	Let $\vec a$ be a mask, $i < \lenpol{\vec a}$ and $X \in \Obj(\jetset{\vec a})$.
	We define the \textbf{$i$-twisted-prism $X \multip \rival{\jet_i}$} on $X$ as the $\vec a$-jet-set with
	\begin{itemize}
		\item carrier $X \times \accol{0, 1}$,
		\item jet relations generated by the following requirements:
		\begin{itemize}
			\item $(\loch, 0) : \Op_i(X) \to X \multip \rival{\jet_i}$ is a jet set morphism,
			\item $(\loch, 1) : X \to X \multip \rival{\jet_i}$ is a jet set morphism,
			\item $(x, 0) \jet_i (x, 1)$ for all $x \in X$.
		\end{itemize}
	\end{itemize}
	This defines the \textbf{$i$-twisted-prism functor} $\loch \multip \rival{\jet_i} : \jetset{\vec a} \to \jetset{\vec a}$.
	
	We define the \textbf{opposite $i$-twisted-prism $X \multip \rival{\tej_i}$} on $X$ as the jet set of mask $\vec a$ with
	\begin{itemize}
		\item carrier $X \times \accol{0, 1}$,
		\item jet relations generated by the following requirements:
		\begin{itemize}
			\item $(\loch, 0) : X \to X \multip \rival{\tej_i}$ is a jet set morphism,
			\item $(\loch, 1) : \Op_i(X) \to X \multip \rival{\tej_i}$ is a jet set morphism,
			\item $(x, 0) \tej_i (x, 1)$ for all $x \in X$.
		\end{itemize}
	\end{itemize}
	This defines the \textbf{opposite $i$-twisted-prism functor} $\loch \multip \rival{\jet_i} : \jetset{\vec a} \to \jetset{\vec a}$.
	
	If $a_i = \npolar$, then we call this simply the \textbf{$i$-prism functor $\loch \multip \rival{\edge_i}$.}
\end{definition}
Note that in both instances, we take the opposite at the source-side of the jet interval by which we multiply. This makes it unclear how a prism functor for the equijet interval $\rival{\equijet_i}$ should look like.
%\todoi{Should there be a prism functor for $\rival{\equijet_i}$? It would only be well-defined on symmetric jet sets, the category of which is $\jetset{\vec a'}$ where $a'_i = \npolar$, so it is derived from $\loch \multip \rival{\edge_i}$ and the forgetful functor $U^\npolar_i$.}
\begin{corollary} \label{thm:twisted-prism-op}
	We have $\loch \multip \rival{\tej_i} = \Op_i(\loch \multip \rival{\jet_i})$. \qed
\end{corollary}
\begin{corollary} \label{thm:commute-diff-degree}
	Let $F_i$ be a functor between jet set categories of any of the following forms: $\Op_i$, $\Fsym_i$, $\Usym_i$, $\Csym_i$, $\loch \multip \rival{\jet_i}$, $\loch \multip \rival{\tej_i}$, $\loch \multip \rival{\edge_i}$.
	Let $G_j$ be a functor between jet set categories also of one of these forms, but for a different degree $j$.
	Then $F_i$ and $G_j$ commute, i.e.\ there is a natural isomorphism $F_i G_j \cong G_j F_i$.
\end{corollary}
\begin{corollary} \label{thm:commute-symmetric}
The functor $\loch \multip \rival{\edge_i}$ commutes with itself, i.e. $(x, v, w) \mapsto (x, w, v)$ is a natural automorphism of $\loch \multip \rival{\edge_i} \multip \rival{\edge_i}$. \qed
\end{corollary}

\subsection{Intermezzo: Cube Categories} \label{sec:cubes}
We introduce a family of cube categories with one flavour of dimension. Fix a monad $M$ on $\Set$.
\begin{example} \label{ex:cube-monads}
	Typically $M$ will be one of the following:
	\begin{itemize}
		\item The `exception' monad $\bipointed$ that sends a set $X$ to $X \uplus \accol{0,1}$, which is the carrier of the free bipointed set over $X$;
		\item The monad $\bipointedsym$ that sends a set $X$ to $X \uplus \set{\lnot x}{x \in X} \uplus \accol{0, 1}$, which is the carrier of the free [bipointed set equipped with an involution $\lnot$ that swaps $0$ and $1$] over $X$;
		\item The monad $\distlattice$ that sends a set $X$ to the carrier of the free distributive lattice over $X$;
		\item The monad $\demorgan$ that sends a set $X$ to the carrier of the free de Morgan algebra over $X$;
		\item The monad $\booleanalg$ that sends a set $X$ to the carrier of the free boolean algebra over $X$.
	\end{itemize}
\end{example}

\subsubsection{Cartesian Cubes}
\begin{definition}
	We construct the \textbf{(named) category of cartesian $M$-cubes} $\cubecat^\cartes_M$ (and $\namedcubecat^\cartes_M$ resp.) stepwise:
	\begin{itemize}
		\item The Kleisli category $\Kleisli(M)$ of $M$ has objects $\inKleisli{X}$ where $X$ is a set, and its morphisms $\inKleisli f : \inKleisli X \to \inKleisli Y$ are functions $f : X \to MY$.
		\item Of this, we take the opposite $\Kleisli(M)\op$. (This is the Lawvere theory corresponding to the monad $M$.)
		\item We define $\namedcubecat^\cartes_M$ as the full subcategory of $\Kleisli(M)\op$ on finite sets.
		\item We define $\cubecat^\cartes_M$ as a designate skeleton of $\namedcubecat_M$, e.g.\ the full subcategory of $\namedcubecat^\cartes_M$ on sets of the form $\accol{0, \ldots, n-1}$ with $n \geq 0$.
	\end{itemize}
\end{definition}
Objects of $\namedcubecat^\cartes_M$ will be denoted as tuples of names $(\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX)$ where $\IX$ is meaningless but conveys the intuition that we regard $\dm{i}_k$ as a value ranging over the interval (the cube given by the singleton object).
A morphism $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$ is then a function sending each $\dm{j}_k$ to an expression $\dm{j}_k \psub{\vfi} \in M\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$.
The morphism $\vfi$ will also be denoted as $(\dm{j}_0 \psub \vfi / \dm{j}_0, \ldots, \dm{j}_{m-1} \psub \vfi / \dm{j}_{m-1})$.
The situation in $\cubecat^\cartes_M$ is the same except that we now regard the names $\dm{i}_k$ as De Bruijn indices.

\begin{corollary}
The categories $\cubecat^\cartes_M$ and $\namedcubecat^\cartes_M$ have finite products, given by finite coproducts of sets. \qed
\end{corollary}

\subsubsection{Affine Cubes}
If $T$ is a \emph{container} monad \cite{container-combinatorics}, i.e. a monad whose underlying functor is a container functor \cite{containers} of the form $TX = \Sigma(s : S).(P(s) \to X)$, then we define $T^\# X$ as the set of \emph{affine} expressions $\Sigma(s : S).(P(s) \hookrightarrow X)$, which is an endofunctor on the category $\Set^{\hookrightarrow}$ of sets and injective functions.
If $M$ is merely a \emph{quotient} of a container monad, i.e. $M$ is of the form $MX = TX/\sim_X$ with $T$ as above, then we define $M^\# X$ as the set of equivalence classes with an affine representant.

\begin{remark}
An important source of monads such as $M$ are monads specified by a syntactic algebraic theory \cite{manes-book,adamek-book,keml-diagrams}.
A syntactic algebraic theory specifies a set of operations $S_0$, assigns to each operation $s : S_0$ an arity $P_0(s)$ which is again a set, and subjects these to a set of axioms.%
\footnote{We use `syntactic algebraic theory' to refer to the syntactic presentation as described here, and `monad' and `Lawvere theory' to refer to the less syntactic objects they specify.
%There seems to be disagreement on the terminology.
%Syntactic algebraic theories (a.k.a. presentations of algebraic theories \cite{manes-book,keml-diagrams}) give rise to a monad and a Lawvere category (a.k.a. Lawvere theory or algebraic theory \cite{manes-book}).
%Depending on your definition of a Lawvere theory, the monadic presentation and the Lawvere theory may be interderivable; in turn, they give rise to a category of algebras.
%Neither of these two steps reflects equivalence, so we truly have three different notions, and there is disagreement which one the term `algebraic theory' refers to \cite{adamek-book}.
%
%Different syntactic algebraic theories may have the same category of models, in which case they are called \emph{Morita equivalent} \cite[ch.\ 15]{adamek-book}. We can thus distinguish algebraic theories by their syntactic presentation or consider them up to Morita equivalence. We will use \emph{syntactic algebraic theory} in the former case and \emph{monadic/Lawverian algebraic theory} in the latter case. Some authors insist on the usage of the word `presentation' for the former case \cite{manes-book}, or call the latter case `algebraic categories' \cite{adamek-book}, while the term `algebraic theories' seems to be in use for either case.
}
The container $(S_0, P_0)$ specifies a container functor $FX = \Sigma(s : S_0).(P_0(s) \to X)$ on $\Set$.
A free monad $F^*$ over this functor $F$ exists and satisfies the fixpoint equation $F^* X \cong X \uplus F F^* X$.
We remark that the free monad $F^*$ over a container functor $F$ is again a container functor, i.e.\ there exists a container $(S, P)$ such that
$F^* X = \Sigma(s : S).(P(s) \to X)$
specifies the free monad over $F$.
The axioms determine an equivalence relation $\sim_X$ on $F^* X$ such that $M X := F^* X/\sim_X$ is again a monad.
This situation applies to each of the monads in \cref{ex:cube-monads}.

In fact, often the quotient can be taken already at the level of the container, so that there exists a container $(S', P')$ such that $MX \cong \Sigma(s : S').(P'(s) \to X)$.
\end{remark}

We say that $(s, f), (s', f') \in T^\# X$ are \textbf{mutually fresh}, denoted $(s, f) \freshbin (s', f')$, if $f(P(s))$ and $f'(P(s'))$ are disjoint.
Elements of $M^\# X$ are mutually fresh if they have mutually fresh representants.
We call the monad $(T, \eta, \mu)$ \textbf{affine} if $\eta_X : X \to TX$ lands in $T^\# X$ for all $X$ and $\mu_X : TTX \to TX$ restricted to $(TT)^\# X$ (note that container functors are closed under composition) lands in $T^\# X$; and similar for $M$.

\begin{definition}
Let $M$ be a quotient of a container monad, and let it be affine.
We construct the \textbf{(named) category of affine $M$-cubes $\cubecat_M^\affine$} (and $\namedcubecat_M^\affine$ resp.) stepwise:
\begin{itemize}
	\item The affine Kleisli category $\Kleisli^\#(M)$ has objects $\inKleisli{X}$ where $X$ is a set, and its morphisms $\inKleisli f : \inKleisli X \to \inKleisli Y$ are functions $f : X \to M^\#Y$ such that for any $x \neq x'$ in $X$, we have $f(x) \freshbin f(x')$.
	Identity and composition are well-defined because $M$ is affine.
	\item Of this, we take the opposite $\Kleisli^\#(M)\op$.
	\item We define $\namedcubecat_M^\affine$ as the full subcategory of $\Kleisli^\#(M)\op$ on finite sets.
	\item We define $\cubecat_M^\affine$ as a designate skeleton of $\namedcubecat^\affine_M$, e.g.\ the full subcategory of $\namedcubecat^\affine_M$ on sets of the form $\accol{0, \ldots, n-1}$ with $n \geq 0$.
\end{itemize}
\end{definition}
Objects will be represented as for the cartesian cube categories.

\begin{corollary}
The categories $\cubecat^\affine_M$ and $\namedcubecat^\affine_M$ have a symmetric monoidal structure $(\top, {*})$ given by finite coproducts of sets. The binary operation is called the \textbf{separating product}. \qed
\end{corollary}

\subsubsection{Examples}
This way, we get -- among others -- the following cube categories:
\begin{enumerate}
	\item[$\cubecat^\cartes_{\bipointed}$] The cartesian cube category.
	A morphism $\vfi : V \to W$ sends every dimension $\dm{j} \in W$ to $\dm{j} \psub \vfi \in V \cup \accol{0, 1}$.
	Its cubes have diagonals.
	\item[$\cubecat^\affine_{\bipointed}$] The affine cube category.
	A morphism $\vfi : V \to W$ sends every dimension $\dm{j} \in W$ to $\dm{j} \psub \vfi \in V \cup \accol{0, 1}$, such that if $\dm{j}\psub \vfi = \dm{j}' \psub \vfi \in V$ then $\dm{j} = \dm{j}'$.
	Its cubes have no diagonals.
	\item[$\cubecat^\cartes_{\bipointedsym}$] The symmetric cartesian cube category. We have a negation/involution/symmetry $(\lnot \dm{i} / \dm{j}) : (\dm i : \IX) \to (\dm{j} : \IX)$.
	\item[$\cubecat^\cartes_{\distlattice}$] The cartesian cube category with connections. We have morphisms $(\dm i \vee \dm{j} / \dm k), (\dm i \wedge \dm{j} / \dm k) : (\dm i : \IX, \dm{j} : \IX) \to (\dm k : \IX)$. There are no symmetries
	\item[$\cubecat^\cartes_{\demorgan}$] The CCHM cube category, which combines symmetries and connections \cite{cubical}. We have $(\dm i \wedge \lnot \dm i / \dm j) \neq (0/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$ and $(\dm i \vee \lnot \dm i / \dm j) \neq (1/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$.
	\item[$\cubecat^\cartes_{\booleanalg}$] A cube category very similar to the CCHM one, but we have $(\dm i \wedge \lnot \dm i / \dm j) = (0/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$ and $(\dm i \vee \lnot \dm i / \dm j) = (1/\dm j) : (\dm i : \IX) \to (\dm j : \IX)$.
\end{enumerate}
We remark that $\cubecat^\affine_{\demorgan}$ and $\cubecat^\affine_{\booleanalg}$ should be isomorphic as the additional law of boolean algebras w.r.t.\ de Morgan algebras only affects non-affine expressions.

\subsubsection{The Endpoint Model}
We remarked above that $\catL := \Kleisli(M)\op$ is the Lawvere category of $M$.
It is known then (see e.g.\ \cite{keml-diagrams}), that the Eilenberg-Moore category of $M$ (which is the category of Eilenberg-Moore algebras of $M$) is equivalent to the category of product-preserving functors $\catL \to \Set$.
Such functors are fully determined by the image of the singleton set (as every set is a coproduct of singletons and the Kleisli-category retains coproducts) and that image will be exactly the carrier of the corresponding Eilenberg-Moore algebra.

It is clear that both the cartesian and affine (named) cube categories are subcategories of $\catL$.
As such, any $M$-algebra induces a functor $\catL \to \Set$ and hence a functor from any of the $M$-cube categories to $\Set$.

We are interested, in particular, in $M$-algebra structures on the set of endpoints $\accol{0, 1}$.
Each of the monads in \cref{ex:cube-monads} has an obvious such algebra structure.
Thus, we get functors from each of the corresponding cube categories to $\Set$,
sending $(\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX)$ to $\accol{0, 1}^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}}$.
We will denote each of those functors as $\EP$.

Recall that a morphism $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$ assigns to each $\dm j$ a value $\dm j\psub \vfi$ in $M \accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$, the free $M$-algebra over $\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$.
The function $\EP(\vfi)$ is defined by
\[
	\EP(\vfi)
	\paren{ v^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}} \to \accol{0, 1}} }
	(\dm j)
	= \alpha\paren{ M(v)(\dm j \psub \vfi) },
\]
where $\alpha : M\accol{0, 1} \to \accol{0, 1}$ is the algebra structure on $\accol{0, 1}$.
Using the operation $\bindop^\alpha : MX \to (X \to \accol{0, 1}) \to \accol{0, 1} : \hat x \mapsto f \mapsto \alpha (Mf(\hat x))$, we can write this as $\EP(\vfi)(v)(\dm j) = \dm j \psub \vfi \bindop^\alpha v$.

\begin{proposition}
	The functor $\EP : \cubecat_\booleanalg \to \Set$ is fully faithful.
\end{proposition}
\begin{proof}
	We need to show that any function $f : \accol{0, 1}^{\accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}} \to \accol{0, 1}^{\accol{\dm{j}_0, \ldots, \dm{j}_{m-1}}}$
	can be obtained as some $\EP(\vfi)$ with $\vfi : (\dm{i}_0 : \IX, \ldots, \dm{i}_{n-1} : \IX) \to (\dm{j}_0 : \IX, \ldots, \dm{j}_{m-1} : \IX)$.
	We remark that such a function $f$ in fact consists of $m$ truth tables in $n$ boolean variables.
	From the full disjunctive normal form, it is clear that elements of the free boolean algebra are in 1-1 correspondence with truth tables.
	Concretely, for each $\dm j$, define $\dm j \psub \vfi$ to be the element of $\booleanalg \accol{\dm{i}_0, \ldots, \dm{i}_{n-1}}$ corresponding to the truth table $f(\loch, \dm j)$.
	Then $\dm j \psub \vfi \bindop^\alpha v$ will evaluate $\dm j \psub \vfi$ after replacing each variable $\dm i$ with its value $v(\dm i)$, yielding the value $f(v, \dm j)$ prescribed by the truth table $f(\loch, \dm j)$.
\end{proof}

\subsection{Jet Cubes}

\subsubsection{Jet Cube Objects}
\begin{definition} \label{def:jet-cube}
	Let $\vec a$ be a mask.
	We define the set of \textbf{(forward) $\vec{a}$-jet-cubes} as the set of lists of degrees $0 \leq i < \lenpol{\vec a}$, but we denote them as
	$(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\jet_{i_{n-1}}})$, thinking of the names $\dm{i}_k$ as De Bruijn indices.
	If $a_i = \npolar$, we write $\rival{\edge_i}$ instead of $\rival{\jet_i}$.
	
%	More generally, we define the set of \textbf{opposable jet cubes of mask $\vec a$} as the set of lists of elements of $\set{\jet_i, \tej_i}{a_i = \ypolar} \cup \set{\edge_i}{a_i = \npolar}$, but we denote them as
%	$(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\tej_{i_{n-1}}})$.
%	If $a_i = \npolar$, we use the symbols $\rival{\jet_i}$, $\rival{\tej_i}$ and $\rival{\edge_i}$ interchangeably.
	
	More generally, we define the set of \textbf{trioriented $\vec a$-jet-cubes} as the set of lists of elements of \linebreak $\set{\jet_i, \tej_i, \equijet_i}{0 \leq i < \lenpol{\vec a}}$, where we identify ${\jet_i} = {\tej_i} = {\equijet_i} =: {\edge_i}$ if $a_i = \npolar$, and where $\jet_i$ and $\tej_i$ cannot occur to the left of $\equijet_i$ if $a_i = \ypolar$.
	We denote them e.g.\ as $(\dm i_0 : \rival{\jet_{i_0}}, \ldots, \dm i_{n-1} : \rival{\tej_{i_{n-1}}})$.
\end{definition}
\begin{definition} \label{def:symmetric-var}
	We call a variable $\dm i$ of a (forward/trioriented) $\vec a$-jet-cube \textbf{$i$-symmetric} (for a degree $0 \leq i < \lenpol(\vec a)$) if \emph{any} of the following conditions holds:
	\begin{itemize}
		\item $\dm i$ is not of degree $i$,
		\item $\dm i$ is an equijet variable,
		\item $a_i = \npolar$.
	\end{itemize}
	Otherwise, it is called \textbf{$i$-directed}.
	Thus, if $\dm i$ is $i$-directed, then $a_i = \ypolar$ and $\dm i : \rival{\jet_i}$ or $\dm i : \rival{\tej_i}$.
\end{definition}
\begin{definition} \label{def:sym-forget-cube}
	Let $\vec a \sqsubset \vec b$. For any trioriented $\vec a$-jet-cube $W$, we define the trioriented $\vec b$-jet-cube $\Usymcube_i W$ by replacing every occurrence of $\edge_i$ with $\equijet_i$.
\end{definition}
Note that a $\vec b$-jet-cube is uniquely in the image of $\Usymcube_i$ if it does not feature the symbols $\jet_i$ and $\tej_i$.
\begin{definition} \label{def:jep}
	For any (forward/trioriented) $\vec a$-jet-cube $W$, we define the $\vec a$-jet-set $\JEP(W)$ as follows:
	\[ \begin{array}{l c l l}
		\JEP(()) &=& \top, \\
		\JEP(W, \dm i : \rival{\jet_i}) &=& \JEP(W) \multip \rival{\jet_i}, \\
		\JEP(W, \dm i : \rival{\tej_i}) &=& \JEP(W) \multip \rival{\tej_i}, \\
		\JEP(W, \dm i : \rival{\edge_i}) &=& \JEP(W) \multip \rival{\edge_i}, \\
		\JEP(W, \dm i : \rival{\equijet_i}) &=& \Usym_i \, \JEP\paren{(\Usymcube_i)\inv(W, \dm i : \rival{\equijet_i})}
		& \text{if $a_i = \ypolar$} \\
		&=& \Usym_i \, \JEP\paren{(\Usymcube_i)\inv(W), \dm i : \rival{\edge_i}} \\
		&=& \Usym_i\paren{\JEP\paren{(\Usymcube_i)\inv(W)} \multip \rival{\edge_i}}.
	\end{array} \]
\end{definition}
\begin{definition} \label{def:jet-cube-erasure}
	We define the \textbf{jet-erasure function} $\erasejc{\loch}$, which sends (forward/trioriented) jet cubes of any mask to cubes (i.e. objects of any of the cube categories defined in \cref{sec:cubes}), by
	\[
		\erasejc{()} = (),
		\qquad
		\erasejc{(W, \dm i : \rival{\jet_i})} =
		\erasejc{(W, \dm i : \rival{\tej_i})} =
		\erasejc{(W, \dm i : \rival{\equijet_i})} =
		\erasejc{(W, \dm i : \rival{\edge_i})} =
		(\erasejc{W}, i : \IX).
	\]
\end{definition}
\begin{corollary} \label{thm:jet-cube-pullback}
	For any (forward/trioriented) jet cube $W$, the carrier of $\JEP(W)$ is $\EP(\erasejc{W})$.
	Thus, every (forward/trioriented) jet cube determines an object of the following strict pullback of categories:
	\[
			\xymatrix{
				\cubecat^\eps_M \times_\Set \jetset{\vec a}
					\ar@{.>}[rr]^{\JEP}
					\ar@{.>}[d]_{\erasejc{\loch}}
					\xydrcorner
				&&
				\jetset{\vec a}
					\ar[d]^U
				\\
				\cubecat^\eps_M
					\ar[rr]_{\EP}
				&&
				\Set,
			}
	\]
	It is straightforward to see that the function thus obtained is injective. \qed
\end{corollary}

\subsubsection{Jet Cube Categories}
\begin{definition} \label{def:jet-cube-cat}
	Let $\vec a$ be a mask, $\eps \in \accol{\affine, \cartes}$ and $M$ a monad on $\Set$.
	We define
	the category $\jetcubeopt{\eps}{M}{\vec a}$ of \textbf{forward $\vec a$-jet-$M$-cubes} and
	the category $\trijetcubeopt{\eps}{M}{\vec a}$ of \textbf{trioriented forward $\vec a$-jet-$M$-cubes}
	as the full subcategory of $\cubecat^\eps_M \times_\Set \jetset{\vec a}$ on (forward/opposable) jet cubes, as justified by \cref{thm:jet-cube-pullback}.
\end{definition}
\begin{proposition} \label{thm:lift-to-jet-cubes}
	The functors $\Fsym_i$, $\loch \multip \rival{\jet_i}$ and $\loch \multip \rival{\edge_i}$ lift to both forward and trioriented jet-$M$-cube categories.
	The functors $\Op_i$, $\Usym_i$ and $\loch \multip \rival{\tej_i}$ lift to trioriented jet-$M$-cube categories.
	We denote the resulting functors as $\Fsymcube_i$, $\loch \multip (\dm i : \rival{\jet_i})$, $\loch \multip (\dm i : \rival{\edge_i})$, $\Opcube_i$, $\Usymcube_i$ and $\loch \multip (\dm i : \rival{\tej_i})$, where each time $\dm i$ represents a bound De Bruijn index.
	We have $\Fsymcube_i \dashv \Usymcube_i$ and thus an idempotent monad $\UFsymcube_i := \Usymcube_i \circ \Fsymcube_i$, whose definition we extend to masks $\vec b$ where $b_i = \npolar$ as in \cref{def:sym-closure-of-sym}.
\end{proposition}
\begin{proof}
	The functors $\Fsym_i$, $\Op_i$ and $\Usym_i$ have no effect on the carrier, so they certainly lift to $\cubecat_M^\eps$, hence to the pullback $\cubecat_M^\eps \times_\Set \jetset{\vec a}$.
	\begin{itemize}
		\item $\Fsym_i$ lifts to (forward/trioriented) jet cubes by replacing every occurrence of $\jet_i$, $\tej_i$ or $\equijet_i$ with $\edge_i$.
		\item $\Op_i$ lifts to trioriented jet cubes by reversing the \emph{last} occurrence of either $\jet_i$ or $\tej_i$ (\cref{thm:twisted-prism-op}).
		\item $\Usym_i$ lifts to jet cubes as the operation $\Usymcube_i$ already introduced in \cref{def:sym-forget-cube}.
	\end{itemize}
	To prove $\Fsymcube \dashv \Usymcube$, we need to build unit and co-unit natural transformations.
	Since the categories of forward/trioriented jet cubes are fully faithful subcategories of the pullback $\cubecat_M^\eps \times_\Set \jetset{\vec a}$, it suffices to build them there.
	They were already established in $\jetset{\vec a}$ by \cref{def:sym-free,def:sym-cofree}.
	As they reduce to the identity unit and co-unit of $\Id \dashv \Id$ for the carriers, they trivially lift to $\cubecat_M^\eps$.
	
	The various prism functors multiply the carrier with $\accol{0, 1}$ and thus lift over $\EP$ to the affine/cartesian cube category by multiplying with $(\dm i : \IX)$.
	Hence, they also lift to the pullback $\cubecat_M^\eps \times_\Set \jetset{\vec a}$.
	Each of them lifts to trioriented jet cubes, and the twisted prism functor also to forward jet cubes, by appending the symbol concerned.
\end{proof}
%\begin{definition} \label{def:prism-cube}
%	Let $\vec a$ be a mask, $\eps \in \accol{\affine, \cartes}$ and $i < \lenpol{\vec a}$. We define the \textbf{$i$-twisted-prism functor $\loch \multip (\dm i : \rival{\jet_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$} on jet cubes as follows:\footnote{We still think of $\dm i$ as a De Bruijn index.}
%	\begin{itemize}
%		\item The object $W$ is sent to $(W, \dm i : \rival{\jet_i})$.
%		\item The morphism $\vfi : V \to W$ is sent to the morphism $\vfi \multip (\dm i : \rival{\jet_i})$ such that
%		\begin{itemize}
%			\item If $\eps = \affine$ then $\erasejc{\vfi \multip (\dm i : \rival{\jet_i})} = \erasejc \vfi * (\dm i : \IX)$,
%			\item If $\eps = \cartes$ then $\erasejc{\vfi \multip (\dm i : \rival{\jet_i})} = \erasejc \vfi \times (\dm i : \IX)$,
%			\item $\JEP(\vfi \multip (\dm i : \rival{\jet_i})) = \JEP(\vfi) \multip \rival{\jet_i}$.
%		\end{itemize}
%	\end{itemize}
%	If $a_i = \npolar$, then we call this simply the \textbf{$i$-prism functor} $\loch \multip (\dm i : \rival{\edge_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$.
%	
%	We similarly define, on opposable jet cubes:
%	\begin{itemize}
%		\item the $i$-twisted-prism functor $\loch \multip (\dm i : \rival{\jet_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$ when $a_i = \ypolar$,
%		\item the opposite $i$-twisted-prism functor $\loch \multip (\dm i : \rival{\tej_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$ when $a_i = \ypolar$,
%		\item the $i$-prism functor $\loch \multip (\dm i : \rival{\edge_i}) : \jetcubeopt{\eps}{M}{\vec a} \to \jetcubeopt{\eps}{M}{\vec a}$ when $a_i = \npolar$.
%	\end{itemize}
%\end{definition}
\begin{proposition} \label{thm:cube-commute-diff-degree}
	Any two functors on jet cubes concerned in \cref{thm:lift-to-jet-cubes}, instantiated on different degrees, commute.
	In other words, the natural transformation given in \cref{thm:commute-diff-degree} lifts to (forward/trioriented) jet cubes when the associated functors lift.
\end{proposition}
\begin{proof}
	Since the categories of forward/trioriented jet cubes are fully faithful subcategories of the pullback $\cubecat_M^\eps \times_\Set \jetset{\vec a}$, it suffices to prove the natural isomorphism there.
	The isomorphism was already established in $\jetset{\vec a}$ by \cref{thm:commute-diff-degree}, and the effect on the carrier is either nothing (when at most one prism functor is involved) or swapping components (when both functors are prism functors).
	These isomorphisms lift to $\cubecat_M^\eps$.
\end{proof}
\begin{proposition} \label{thm:cube-commute-symmetric}
	The functor $\loch \multip (\dm i : \rival{\edge_i})$ commutes with itself, i.e.\ the natural automorphism given in \cref{thm:commute-symmetric} lifts to (forward/trioriented) jet cubes as $(\dm i / \dm i, \dm j / \dm j) : \loch \multip (\dm i : \rival{\edge_i}) \multip (\dm j : \rival{\edge_i}) \cong \loch \multip (\dm j : \rival{\edge_i}) \multip (\dm i : \rival{\edge_i})$.
\end{proposition}
\begin{proof}
	Analogous to the proof of \cref{thm:cube-commute-diff-degree}.
	The isomorphism was already established in $\jetset{\vec a}$ by \cref{thm:commute-symmetric}, and the effect on the carrier is swapping components, which lifts to $\cubecat_M^\eps$.
\end{proof}
\begin{remark} \label{rem:two-monads}
	As of this point we will only be interested in the monads $\bipointedsym$ and $\booleanalg$ because:
	\begin{itemize}
		\item We need involutions in order to be able to work with the source-side of the twisted prism, ruling out $\bipointed$ and $\distlattice$.
		\item We do not see any advantage of $\demorgan$ over $\booleanalg$. In particular, we want $\EP$ to be faithful.
	\end{itemize}
\end{remark}
\begin{theorem} \label{thm:affine-automatic}
	Assuming the law of excluded middle for the affineness predicate on cube morphisms, we have isomorphisms of categories\footnote{Depending on the formalization, possibly even equalities.}
	\[
		\trijetcubeopt \affine \bipointedsym {\vec a} \cong \trijetcubeopt \cartes \bipointedsym {\vec a},
		\qquad \qquad
		\jetcubeopt \affine \bipointedsym {\vec a} \cong \jetcubeopt \cartes \bipointedsym {\vec a},
	\]
	which act as the identity on objects.
\end{theorem}
\begin{proof}
	Since the forward jet cube categories are full subcategories of the trioriented ones, it suffices to prove the first isomorphism.
	There, it is immediately clear that $\trijetcubeopt \affine \bipointedsym {\vec a}$ is a subcategory of $\trijetcubeopt \cartes \bipointedsym {\vec a}$.
	So we need to show that any morphism in $\trijetcubeopt \cartes \bipointedsym {\vec a}$ is in fact affine.
	Take such a morphism $\hat \vfi : V \to W$ (write $\vfi = \erasejc{\hat \vfi}$) and assume it is not affine.
	Since $\bipointedsym$ only has nullary and unary operations, this means that $W$ has dimensions $\dm i$ and $\dm j$ such that $\dm i \psub \vfi$ and $\dm j \psub \vfi$ are not mutually fresh, meaning that $V$ has some dimension $\dm k$ such that $\dm i \psub \vfi, \dm j \psub \vfi \in \accol{\dm k, \lnot \dm k}$.
	Then $\JEP(\hat \vfi)$ cannot be a jet set morphism as $\JEP(W)$ has no diagonals. This is a contradiction.
\end{proof}
Note that the situation is not so simple for $\booleanalg$.
For example, at symmetric degrees, $\jetcubeopt \cartes \booleanalg{\vec a}$ features the `exclusive or' operation
\[
	((\dm i \vee \dm j) \wedge \lnot(\dm i \wedge \dm j)/\dm k) : (\dm i : \rival{\edge_i}, \dm j : \rival{\edge_i}) \to (\dm k : \rival{\edge_i})
\]
which cannot be constructed in $\jetcubeopt \affine \booleanalg{\vec a}$.
More startlingly, even at directed degrees, we have operations such as the following:
\[
	(\dm i \wedge \dm j/\dm p, \dm j \wedge \dm k/\dm q) : (\dm i : \rival{\jet_i}, \dm j : \rival{\jet_i}, \dm k : \rival{\jet_i}) \to (\dm p : \rival{\jet_i}, \dm q : \rival{\jet_i}),
\]
which collapses five consecutive points of the Hamiltonian path and is a legitimate jet cube morphism:
\[
	\xymatrix{
		(1, 0, 0)
			\ar[rrr]
		&&& (1, 0, 1)
			\ar[ld]
			\ar@{.>}[ddd]
		\\
		& (0, 0, 0)
			\ar[lu]
			\ar@{.>}[r]
		& (0, 0, 1)
			\ar[d]
		\\
		& (0, 1, 0)
			\ar[u]
			\ar@{.>}[r]
		& (0, 1, 1)
			\ar[rd]
		\\
		(1, 1, 0)
			\ar[ru]
			\ar@{.>}[uuu]
			\ar@{.>}[rrr]
			\ar@{}[rrrdd]|{\rotatebox{270}{$\mapsto$}}
		&&& (1, 1, 1)
		\\
		\\
		(0, 0)
			\ar@{=}[rrr]
		&&& (0, 0)
			\ar@{=}[ld]
			\ar@{.>}[ddd]
		\\
		& (0, 0)
			\ar@{=}[lu]
			\ar@{:}[r]
		& (0, 0)
			\ar[d]
		\\
		& (0, 0)
			\ar@{=}[u]
			\ar@{.>}[r]
		& (0, 1)
			\ar[rd]
		\\
		(1, 0)
			\ar[ru]
			\ar@{.>}[uuu]
			\ar@{.>}[rrr]
		&&& (1, 1).
	}
\]
Such morphisms are not assumed in the definition of pro-arrow equipments, so we wish to exclude these.
For this reason, we will no longer be interested in cartesian jet-$\booleanalg$-cubes.
By \cref{thm:affine-automatic}, we are also no longer interested in cartesian jet-$\bipointedsym$-cubes.
In short then, by \cref{rem:two-monads}:
\begin{remark} \label{rem:no-cartesian}
	We are no longer interested in cartesian jet cubes.
\end{remark}

\subsection{A Calculus of Trioriented Jet Cube Morphisms}
In this section, we develop a calculus that inductively generates the morphisms of the category \linebreak $\trijetcubeopt{\affine}{M}{\vec a}$ and therefore also those of its full subcategory $\jetcubeopt{\affine}{M}{\vec a}$.

Since the forgetful functor $U : \jetset{\vec a} \to \Set$ is faithful, so is $\erasejc \loch : \trijetcubeopt{\affine}{M}{\vec a}$.
As such, we can regard `being a morphism of (forward/trioriented) jet cubes' as a proof-irrelevant property of morphisms of cubes, which we will therefore use as preterms.
Our calculus will therefore feature a single judgement $\sez \vfi : V \to W$ meaning that the morphism $\vfi : \erasejc V \to \erasejc W$ is in fact a morphism of jet cubes.
Soundness (\cref{thm:calculus-sound}) of the calculus will be the property that the judgement's meaning actually holds when the judgement is derivable, whereas completeness (\cref{thm:calculus-complete}) means that the judgement is derivable when its meaning is true.
We do not have to bother with an equational theory, as we can simply inherit it from $\cubecat_M^\affine$.

\begin{convention} \label{conv:sort-cubes}
	When presenting the calculus, as justified by \cref{thm:cube-commute-diff-degree}, we will order the dimensions of a (forward/trioriented) jet cube by \emph{decreasing} degree.
\end{convention}
\begin{figure} \label{fig:calculus}
	\[
		\inferencel{terminal}{
		}{
			\sez \vfi : V \to ()
		}{}
	\]
	\[
		\inferencel{zero:fwd}{
			\sez \vfi : V \to \Opcube_i(W)
		}{
			\sez (\vfi, 0/\dm i) : V \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{one:bck}{
			\sez \vfi : V \to \Opcube_i(W)
		}{
			\sez (\vfi, 1/\dm i) : V \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{one:fwd}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, 1/\dm i) : V \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{zero:bck}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, 0/\dm i) : V \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{inv:fwd}{
			\sez (\vfi, t/\dm i) : V \to (W, \dm i : \rival{\tej_i})
		}{
			\sez (\vfi, \lnot t/\dm i) : V \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{inv:bck}{
			\sez (\vfi, t/\dm i) : V \to (W, \dm i : \rival{\jet_i})
		}{
			\sez (\vfi, \lnot t/\dm i) : V \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{prism:fwd}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, \dm i / \dm i) : (V, \dm i : \rival{\jet_i}) \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{prism:bck}{
			\sez \vfi : V \to W
		}{
			\sez (\vfi, \dm i / \dm i) : (V, \dm i : \rival{\tej_i}) \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
%	\[
%		\inferencel{prism:sym}{
%			\sez \vfi : (U, V) \to W
%		}{
%			\sez (\vfi, \dm i / \dm i) : (U, \dm i : \rival{\edge_i}, V) \to (W, \dm i : \rival{\edge_i})
%		}{}
%	\]
	\[
		\inferencel{symmetrize}{
			\sez \vfi : \Fsymcube_i V \to W
		}{
			\sez \vfi : V \to \Usymcube_i W
		}{}
	\]
	\[
		\inferencel{wkn}{
			\sez \vfi : \UFsymcube_i(V) \to W \qquad
			R \in \accol{\jet, \tej, \equijet}
		}{
			\sez (\vfi, \dm i / \novar) : (V, \dm i : \rival{R_i}) \to W
		}{}
%		\qquad
%		\inferencel{wkn:bck}{
%			\sez \vfi : \UFsymcube_i(V) \to W
%		}{
%			\sez (\vfi, \dm i / \novar) : (V, \dm i : \rival{\jet_i}) \to W
%		}{}
	\]
	\[
		\inferencel{exchange}{
			\sez \vfi : (V, \dm j : \rival{\edge_i}, U_1, \dm i : \rival{\edge_i}, U_2) \to W
		}{
			\sez \vfi : (V, \dm i : \rival{\edge_i}, U_1, \dm j : \rival{\edge_i}, U_2) \to W
		}{}
	\]
	\[
		\inferencel{companion:fwd}{
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{companion:bck}{
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\tej_j}, V) \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{conjoint:fwd}{
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\tej_j}, V) \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{conjoint:bck}{
			\sez \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\[
		\inferencel{equicompanion:fwd}{
			\sez \vfi : \UFsymcube_i(U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\equijet_j}, V) \to (W, \dm i : \rival{\jet_i})
		}{}
		\qquad
		\inferencel{equicompanion:bck}{
			\sez \vfi : \UFsymcube_i(U, V) \to W
			\qquad
			j > i
		}{
			\sez (\vfi, \dm j / \dm i) : (U, \dm j : \rival{\equijet_j}, V) \to (W, \dm i : \rival{\tej_i})
		}{}
	\]
	\todoi{Merge 3 rules into `concursor'}
	\[
		\inferencel{conj:fwd}{
			\sez \vfi : \UFsymcube_i V \to W \\
			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})
		}{
			\sez (\vfi, s \wedge t/\dm k) : V \to (W, \dm k : \rival{\jet_i})
		}{$\booleanalg$}
		\qquad
		\inferencel{disj:bck}{
			\sez \vfi : \UFsymcube_i V \to W \\
			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\tej_i}, \dm j : \rival{\tej_i})
		}{
			\sez (\vfi, s \vee t/\dm k) : V \to (W, \dm k : \rival{\tej_i})
		}{$\booleanalg$}
	\]
	\[
		\inferencel{disj:fwd}{
			\sez \vfi : \UFsymcube_i V \to W \\
			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\tej_i}, \dm j : \rival{\jet_i})
		}{
			\sez (\vfi, s \vee t/\dm k) : V \to (W, \dm k : \rival{\jet_i})
		}{$\booleanalg$}
	\qquad
		\inferencel{conj:bck}{
			\sez \vfi : \UFsymcube_i V \to W \\
			\sez (\vfi, s/\dm i, t/\dm j) : V \to (W, \dm i : \rival{\jet_i}, \dm j : \rival{\tej_i})
		}{
			\sez (\vfi, s \wedge t/\dm k) : V \to (W, \dm k : \rival{\tej_i})
		}{$\booleanalg$}
	\]
	\todoi{Have several versions
	\begin{itemize}
		\item Connection with concursor; symmetrize everything at current degree (for purely $i$-symmetric connections), appropriately symmetrize lower degree.
		\item Connection with current degree; symmetrize everything at current degree.
	\end{itemize}
	}
%	\[
%		\inferencel{truth-table}{
%			a_i = \npolar
%			\qquad
%			\vec t[x_1, \ldots, x_n] \in (\booleanalg \accol{x_1, \ldots, x_n})^m
%			\\
%			\phantom{a_i = \npolar}
%			\qquad
%			\text{$\vec t : \accol{0, 1}^n \to \accol{0, 1}^m$ is non-expansive w.r.t.\ $\ell^1$-distance}
%			\\
%			\sez (\vfi, s_1/\dm i_1, \ldots, s_n/\dm i_n) : V \to (W, \dm i_1 : \rival{\edge_i}, \ldots, \dm i_n : \rival{\edge_i})
%		}{
%			\sez (\vfi, t_1[s_1, \ldots, s_n] / \dm j_1, \ldots, t_m[s_1, \ldots, s_n]) / \dm j_m) : V \to (W, \dm j_1 : \rival{\edge_i}, \ldots, \dm j_m : \rival{\edge_i})
%		}{$\booleanalg$, $\cartes$}
%	\]
	\caption{A calculus of affine trioriented jet cube morphisms, for the monads $\bipointedsym$ and $\booleanalg$.}
\end{figure}
\begin{definition} \label{def:calculus}
	For $M \in \accol{\bipointedsym, \booleanalg}$, any mask $\vec a$ and for any two objects $V, W \in \Obj(\trijetcubeopt \affine M {\vec a})$, we define a proof-irrelevant predicate on morphisms $\vfi : \erasejc V \to \erasejc W$, denoted $\sez \vfi : V \to W$, inductively generated by the inference rules in \cref{fig:calculus} subject to \cref{conv:sort-cubes}.
\end{definition}
We discuss these inference rules one by one.

The unique morphism to the terminal cube $()$ is a jet cube morphism (\ruleref{terminal}).

We can substitute the last variable with an endpoint. If this end point is at the last dimension's source side, then the rest of the morphism lands in the $i$-opposite of $W$ (\ruleref{zero:fwd}, \ruleref{one:bck}), otherwise it lands in $W$ itself (\ruleref{one:fwd}, \ruleref{zero:bck}).

We can apply an involution to the last variable, provided that we turn around its direction (\ruleref{inv:fwd}, \ruleref{inv:bck}). Doing so means that the source-side is mapped to the source-side and the target-side is mapped to the target-side, so $W$ remains unaffected.

We can apply the (opposite) $i$-twisted prism functor to a morphism (\ruleref{prism:fwd}, \ruleref{prism:bck}).

We can weaken w.r.t.\ the last dimension (\ruleref{wkn}), but some caution is required. At the source-side of the last dimension, we find $\Opcube_i(V)$, whereas at the target-side we have $V$. (In the case of an equijet dimension, both are equal.)
Thus, $\vfi$ needs to be a morphism of jet cubes from $\Opcube_i(V) \to W$ as well as from $V \to W$.
This can be achieved by asking that $\vfi$ starts from $\UFsymcube_i(V)$, which can be thought of as a join of $\Opcube_i(V)$ and $V$.

We can exchange variables of the same symmetric degree $i$ (\ruleref{exchange}).
Note that \cref{conv:sort-cubes} implies that all variables in $U_1$ and $U_2$ are also of type $\rival{\edge_i}$.

If the last dimension of our target cube is of the form $\dm i : \rival{\equijet_i}$, then we know that our cube is in the image of $\Usymcube_i$, and we can proceed using the adjunction $\Fsymcube_i \dashv \Usymcube_i$ (\ruleref{symmetrize}).
This turns our last dimension into $\dm i : \rival{\edge_i}$ which is a special case of both $\dm i : \rival{\jet_i}$ and $\dm i : \rival{\tej_i}$, so we can proceed by using the \textsc{fwd} and \textsc{bck} rules of the calculus.

We can substitute the last variable with an expression of a weaker (higher) degree in either direction (or both).
Inspired by \cref{thm:jetset-equipment}, we choose to use terminology from pro-arrow equipments and refer to this action as creating a companion when the direction of the arrow remains the same (\ruleref{companion:fwd}, \ruleref{companion:bck}), and a conjoint when it reverses (\ruleref{conjoint:fwd}, \ruleref{conjoint:bck}).
We also allow equijet variables of higher degrees (\ruleref{equicompanion:fwd}, \ruleref{equicompanion:bck}).
Some measures of caution need to be taken however, which we consider in the case of \ruleref{companion:fwd}, where we wish to derive $(\vfi, \dm j / \dm i) : (U, \dm j : \rival{\jet_j}, V) \to (W, \dm i : \rival{\jet_i})$.
First of all, we need to enforce affineness and make sure that $\vfi$ does not use the variable $\dm j$, so we will have $\vfi : (\erasejc{U}, \erasejc{V}) \to \erasejc{W}$.
Now let us look at what happens when we set $\dm i$ and $\dm j$ to $0$ or to $1$:
\[
	\xymatrix{
		(\Opcube_j(U), V)
			\ar[d]_{(0/\dm j)}
			\ar@{.>}[rr]^\vfi
		&&
		\Opcube_i(W)
			\ar[d]^{(0/\dm i)}
		\\
		(U, \dm j : \rival{\jet_j}, V)
			\ar[rr]_{(\vfi, \dm j / \dm i)}
		&& (W, \dm i : \rival{\jet_i})
		\\
		(U, V)
			\ar[u]^{(1/\dm j)}
			\ar@{.>}[rr]_\vfi
		&&
		W
			\ar[u]_{(1/\dm i)}
	}
\]
So $\vfi$ needs to be both a morphism of jet cubes from $(U, V)$ to $W$ and from $(\Opcube_j(U), V)$ to $\Opcube_i(W)$ or equivalently from $\Opcube_i(\Opcube_j(U), V)$ to $W$. This can be achieved by asking that $\vfi$ starts from \linebreak $\UFsym_i(\UFsym_j(U), V)$, which can be thought of as a join of $(U, V)$ and $\Opcube_i(\Opcube_j(U), V)$.

The last four rules involve conjunction and disjunction (together called connections) and only apply if $M = \booleanalg$, as $\bipointedsym$ does not provide these operations.
For rules allow us to substitute the last variable with a connection.
The directions of the arrows in \ruleref{conj:fwd} and \ruleref{disj:fwd} can be understood by simply drawing jet squares and their images:
\[
	\xymatrix{
		& {\mathclap{(\dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})}}
		\\
		(0/\dm i, 0/\dm j)
			\ar[rr]
			\ar@{<-}[d]
		&&
		(0/\dm i, 1/\dm j)
			\ar[d]
		\\
		(1/\dm i, 0/\dm j)
			\ar[rr]
		& \ar@{|=>}[d]^{(\dm i \wedge \dm j / \dm k) \circ \loch} &
		(1/\dm i, 1/\dm j)
		\\
		(0/\dm k)
			\ar@{=}[rr]
			\ar@{=}[d]
		&&
		(0/\dm k)
			\ar[d]
		\\
		(0/\dm k)
			\ar[rr]
		&&
		(1/\dm k)
	}
	\qquad \qquad
	\xymatrix{
		& {\mathclap{(\dm i : \rival{\tej_i}, \dm j : \rival{\jet_i})}}
		\\
		(0/\dm i, 0/\dm j)
			\ar[rr]
			\ar[d]
		&&
		(0/\dm i, 1/\dm j)
			\ar@{<-}[d]
		\\
		(1/\dm i, 0/\dm j)
			\ar[rr]
		& \ar@{|=>}[d]^{(\dm i \vee \dm j / \dm k) \circ \loch} &
		(1/\dm i, 1/\dm j)
		\\
		(0/\dm k)
			\ar[rr]
			\ar[d]
		&&
		(1/\dm k)
			\ar@{=}[d]
		\\
		(1/\dm k)
			\ar@{=}[rr]
		&&
		(1/\dm k)
	}
\]
The rules \ruleref{disj:bck} and \ruleref{conj:bck} then follow by conjugating with the involution.
Again, caution is required.
For example, in \ruleref{conj:fwd}, assume that $s = \dm i$ and $t = \dm j$ and consider what happens when we substitute $\dm i$ and $\dm j$ in \ruleref{conj:fwd} with different combinations that yield $0/\dm k$:
\[
	\xymatrix{
		\Opcube_i(U)
			\ar@/_/[dd]_{(0/\dm i, 1/\dm j)}
			\ar@/^/[dd]^{(1/\dm i, 0/\dm j)}
			\ar@{.>}[rr]^\vfi
		&& \Opcube_i(W)
			\ar[dd]^{(0/\dm k)}
		\\
		& U
			\ar[ld]|{(0/\dm i, 0/\dm j)}
			\ar@{.>}[ru]^\vfi
		\\
		(U, \dm i : \rival{\jet_i}, \dm j : \rival{\jet_i})
		\ar[rr]_{(\vfi, \dm i \wedge \dm j / \dm k)}
		&&
		(W, \dm k : \rival{\jet_i})
	}
\]
Again, we see that $\vfi : \erasejc U \to \erasejc W$ needs to be a morphism of jet cubes both from $\Opcube_i(U) \to \Opcube_i(W)$ (or equivalently from $U \to W$) and from $U \to \Opcube_i(W)$ (or equivalently from $\Opcube_i(U) \to W$). Again, we let $\vfi$ depart from their join $\UFsymcube_i(U)$.
The cube $\erasejc U$ arose as the part of $\erasejc V$ not used by $s$ and $t$, so in the typing rule we can simply use $\UFsymcube_i(V)$ (this will be formalized in \cref{thm:calculus-sound,thm:calculus-complete}).

\subsubsection{Soundness}
\begin{theorem}[Soundness] \label{thm:calculus-sound}
	If a morphism $\vfi : \erasejc V \to \erasejc W$ satisfies the predicate $\sez \vfi : V \to W$ from \cref{def:calculus}, then it actually arises as the image $\vfi = \erasejc{\hat \vfi}$ of a morphism $\hat \vfi : V \to W$.
\end{theorem}
\begin{proof}
	Note that what really needs to be proven is that $\sez \vfi : V \to W$ implies that $\EP(\vfi)$, which a priori is a function from the set $\EP(\erasejc V) = U(\JEP(V))$ to $\EP(\erasejc W) = U(\JEP(W))$, is in fact a morphism of jet sets $\JEP(V) \to \JEP(W)$.
	We prove this, of course, by induction on the derivation of the inductive predicate.
	
	\begin{itemize}
		\item For \ruleref{terminal}, note that $\JEP(())$ is the terminal jet set.
	
		\item For \ruleref{zero:fwd}, \ruleref{one:bck}, \ruleref{one:fwd} and \ruleref{zero:bck}, this follows immediately from \cref{def:prism}.
		
		\item For \ruleref{inv:fwd}, by postcomposition, it suffices to show that $\zeta : (\id_W, \lnot \dim i / \dim i) : \erasejc{(W, i : \rival{\tej_i})} \to \erasejc{(W, i : \rival{\jet_i})}$ is a morphism of jet cubes, i.e.\ that $\EP(\zeta) : (\vec w, u) \mapsto (\vec w, \lnot u)$ is a morphism of jet sets $\JEP(W) \multip \rival{\tej_i} \to \JEP(W) \multip \rival{\jet_i}$.
		
		Let $(\vec w, u) \jet_j (\vec w', u')$ in $\JEP(W) \multip \rival{\tej_i}$. Then by \cref{def:prism} of the opposite $i$-twisted prism, there are 3 possibilities:
		\begin{itemize}
			\item We have $u = u' = 0$ and $\vec w \jet_j \vec w'$ in $\JEP(W)$.
			In that case, we also have the required jet between the images $(\vec w, 1) \jet_j (\vec w', 1)$ in $\JEP(W) \multip \rival{\jet_i}$.
			\item We have $u = u' = 1$ and $\vec w \jet_j \vec w'$ in $\Op_i(\JEP(W))$.
			In that case, we also have the required jet between the images $(\vec w, 0) \jet_j (\vec w', 0)$ in $\JEP(W) \multip \rival{\jet_i}$.
			\item We have $j = i$, $u = 1$, $u' = 0$ and $\vec w = \vec w'$.
			In that case, we also have the required jet between the images $(\vec w, 0) \jet_i (\vec w, 1)$ in $\JEP(W) \multip \rival{\jet_i}$.
		\end{itemize}
		The proof of soundness of \ruleref{inv:bck} is analogous.
		
		\item Soundness of \ruleref{prism:fwd} and \ruleref{prism:bck} was already established by \cref{thm:lift-to-jet-cubes}.
		
		\item Soundness of \ruleref{symmetrize} follows from the adjunction established in \cref{thm:lift-to-jet-cubes}.
		
		\item We prove soundness of \ruleref{wkn} by precomposition with a jet cube morphism that erases to $(\id, \dm i / \novar) : (V, \dm i : \rival{R_i}) \to \UFsym_i V$.
		Thus, we need to prove that $\EP(\id, \dm i / \novar) : (\vec v, w) \mapsto \vec v$ is a jet set morphism $\JEP(V, \dm i : \rival{R_i})
		%= \JEP(V) \multip \rival{\jet_i}
		\to \JEP(\UFsymcube_i(V))$.
		Let $(\vec v, w) \jet_j (\vec v', w')$ in $\JEP(V, \dm i : \rival{R_i})$.
		Then there are two possibilities:
		\begin{itemize}
			\item $w = w'$ and $(\vec v, w) \jet_j (\vec v', w)$. The latter implies $\vec v \jet_j \vec v'$ in $\JEP(V)$ if $j \neq i$ and $\vec v \infrajet_i \vec v'$ if $j = i$. Moving to $\JEP(\UFsymcube_i(V))$, we get $\vec v \jet_j \vec v'$ in all cases, as required.
			\item $j = i$, $\vec v = \vec v'$ and $w \jet_i w'$. In this case we trivially have $\vec v \jet_j \vec v$ in $\JEP(\UFsymcube_i(V))$.
		\end{itemize}
		
		\item Soundness of \ruleref{exchange} follows from \cref{thm:cube-commute-symmetric}.
		
		\item For \ruleref{companion:fwd}, let $\hat \vfi : \UFsymcube_i(\UFsymcube_j U, V) \to W$ be a jet cube morphism.
		Then $f := \JEP(\hat \vfi)$ is a jet set morphism $\JEP(\UFsymcube_i(\UFsymcube_j U, V)) \to \JEP(W)$.
		We need to show that $g : (\vec u, w, \vec v) \mapsto (f(\vec u, \vec v), w)$ is a jet set morphism $\JEP(U, \dm j : \rival{\jet_j}, V) \to \JEP(W, \dm i : \rival{\jet_i}) = \JEP(W) \multip \rival{\jet_i}$.
		
		Assume we have $(\vec u, w, \vec v) \jet_k (\vec u', w', \vec v')$ in $\JEP(U, \dm j : \rival{\jet_j}, V)$.
		By induction on $V$, one can show that we are in one of the following situations:
		\begin{itemize}
			\item $\vec u = \vec u'$, $w = w'$ and $(\vec u, \vec v) \jet_k (\vec u, \vec v')$ in $\JEP(U, V)$.
			The fact that $f$ is a jet set morphism implies that $f(\vec u, \vec v) \jet_k f(\vec u, \vec v')$ and even $f(\vec u, \vec v) \equijet_i f(\vec u, \vec v')$ if $k = i$.
			Then we have the required jet between the images $(f(\vec u, \vec v), w) \jet_k (f(\vec u, \vec v'), w)$ in $\JEP(W) \multip \rival{\jet_i}$, where if $k = i$ we use the forward part of the equijet if $w = 1$ and the backward part if $w = 0$.
			
			\item $k = j$, $\vec u = \vec u'$, $\vec v = \vec v'$ and $\accol{w, w'} = \accol{0, 1}$. In that case, we have the required jet between the images $(f(\vec u, \vec v), w) \jet_j (f(\vec u, \vec v), w')$ because we have $(f(\vec u, \vec v), w) \infrajet_i (f(\vec u, \vec v), w')$ and $i < j$.
			
			\item $w = w'$, $\vec v = \vec v'$ and $(\vec u, w, \vec v) \jet_k (\vec u', w, \vec v)$ in $\JEP(U, \dm j : \rival{\jet_j}, V)$.
			The latter implies $(\vec u, \vec v) \jet_k (\vec u', \vec v)$ in $\JEP(U, V)$ if $k \neq j$ and $(\vec u, \vec v) \infrajet_j (\vec u', \vec v)$ if $k = j$.
			Moving to \linebreak $\JEP(\UFsymcube_i(\UFsymcube_j U, V))$, the $j$-infrajet for $k = j$ turns into a $j$-equijet and the $i$-jet for $k = i$ turns into an $i$-equijet.
			Thus, we conclude, in any case, that $f(\vec u, \vec v) \jet_k f(\vec u', \vec v)$ in $\JEP(W)$, and even $f(\vec u, \vec v) \equijet_i f(\vec u', \vec v)$ if $k = i$.
			Then we have the required jet between the images $(f(\vec u, \vec v), w) \jet_k (f(\vec u', \vec v), w)$.
		\end{itemize}
		Soundness of \ruleref{companion:bck}, \ruleref{conjoint:fwd},\ruleref{conjoint:bck}, \ruleref{equicompanion:fwd} and \ruleref{equicompanion:bck} is proven almost identically, where it may be enlightening to remark that in the equicompanion rules, we know that $\UFsymcube_j(U) = U$.
		
		\item For \ruleref{conj:fwd}, assume given a jet cube morphism $\hat \vfi : \UFsymcube_i V \to W$ (write $\vfi = \erasejc{\hat \vfi}$ and $\EP(\vfi) = f$) and boolean expressions $s$ and $t$ such that $\EP(\vfi, s/\dm i, t/\dm j)$ is a jet set morphism $\JEP(V) \to \JEP(W, \dm i : \rival{\jet_i}, \dm j : \rival{\jet_i}) = \JEP(W) \multip \rival{\jet_i} \multip \rival{\jet_i}$.
		We show that $\EP(\vfi, s \wedge t / \dm k)$ is a jet set morphism $\JEP(V) \to \JEP(W, \dm k : \rival{\jet_i}) = \JEP(W) \multip \rival{\jet_i}$.
		Assume we have $v \jet_k v'$ in $\JEP(V)$. Then because $\EP(\vfi, s/\dm i, t/\dm j)$ is a jet set morphism, we are in one of the following situations:
		\begin{itemize}
			\item $s(\vec v) = s(\vec v') =: s_0$ and $t(\vec v) = t(\vec v') =: t_0$ and $(f(\vec v), s_0, t_0) \jet_k (f(\vec v'), s_0, t_0)$.
			The latter implies that $f(\vec v) \jet_k f(\vec v')$ if $k \neq i$.
			On the other hand, if $k = i$ then because $\hat \vfi : \UFsymcube_i V \to W$ is a jet cube morphism, we know that $f(\vec v) \equijet_i f(\vec v')$.
			In any case, we get the required jet between the images $(f(\vec v), s_0 \wedge t_0) \jet_k (f(\vec v'), s_0 \wedge t_0)$.
			
			\item $k = i$, $f(\vec v) = f(\vec v') = f_0$ and $(s(\vec v), t(\vec v)) \jet_i (s(\vec v'), t(\vec v'))$ in $\rival{\jet_i} \multip \rival{\jet_i}$.
			The latter implies that exactly one row of the following table applies:
			\[
				\begin{array}{c | c | c c}
					(s(\vec v), t(\vec v))
					& (s(\vec v'), t(\vec v'))
					& s(\vec v) \wedge t(\vec v)
					& s(\vec v') \wedge t(\vec v')
					\\ \hline
					(1, 0) & (0, 0) & 0 & 0
					\\
					(0, 1) & (1, 1) & 0 & 1
					\\
					(0, 0) & (0, 1) & 0 & 0
					\\
					(1, 0) & (1, 1) & 0 & 1
				\end{array}
			\]
			In each case, we get $s(\vec v) \wedge t(\vec v) \jet_i s(\vec v') \wedge t(\vec v')$ in $\rival{\jet_i}$, and thus the required jet between the images $(f_0, s(\vec v) \wedge t(\vec v)) \jet_i (f_0, s(\vec v') \wedge t(\vec v'))$.
		\end{itemize}
		Soundness of \ruleref{disj:bck}, \ruleref{disj:fwd} and \ruleref{conj:bck} is proven analogously, but with a different case analysis in the table. \qedhere
		
%		\item We prove soundness of \ruleref{truth-table} by postcomposition with a jet cube morphism that erases to $(\id, \vec t[\vec{\dm i}]/\vec{\dm j}) : (W, \dm i_1 : \rival{\edge_i}, \ldots, \dm i_n : \rival{\edge_i}) \to (W, \dm j_1 : \rival{\edge_i}, \ldots, \dm j_m : \rival{\edge_i})$, i.e. we prove that $\EP(\id, \vec t[\vec{\dm i}]/\vec{\dm j}) : (\vec w, \vec u) \mapsto (\vec w, \vec t(\vec u))$ is a jet set morphism $\JEP(W, \dm i_1 : \rival{\edge_i}, \ldots, \dm i_n : \rival{\edge_i}) \to \JEP(W, \dm j_1 : \rival{\edge_i}, \ldots, \dm j_m : \rival{\edge_i})$.
%		
%		Assume we have $(\vec w, \vec u) \jet_j (\vec w', \vec u')$ in the domain.
%		Then there are two possibilities:
%		\begin{itemize}
%			\item $\vec u = \vec u'$ and $(\vec w, \vec u) \jet_j (\vec w', \vec u)$.
%			The latter implies $\vec w \jet_j \vec w'$ in $\JEP(W)$ even if $j = i$ because $a_i = \npolar$.
%			In that case, we have $(\vec w, \vec t(\vec u)) \jet_j (\vec w', \vec t(\vec u))$.
%			\item $i = j$, $\vec w = \vec w'$ and $\vec u \edge_i \vec u'$ in $\JEP(U)$. The latter implies that the $\ell^1$-distance $d^1(\vec u, \vec u') \leq 1$, hence $d^1(\vec t(\vec u), \vec t(\vec u')) \leq 1$, hence $\vec t(\vec u) \edge_i \vec t(\vec u')$, so that $(\vec w, \vec t(\vec u)) \edge_i (\vec w, \vec t(\vec u'))$.
%		\end{itemize}
	\end{itemize}
\end{proof}

\subsubsection{Lemmas for Completeness}
Proving completeness for the $\bipointedsym$ monad is fairly straightforward,
but for the cases involving connections (conjunctions and disjunctions), we need a couple of helper lemmas.

\paragraph{Boolean reduction}
\begin{definition} \label{def:reduction}
	Boolean terms $t \in \booleanalg(X)$ are equivalence classes $t = [e]$ of boolean expressions $e$, which can be regarded as abstract syntax trees.
	We define two reduction algorithms that reduce an expression $e$ to $e'$ such that $[e] = [e']$.
	\begin{itemize}
		\item By \textbf{(basic) reduction}, we mean the process of pushing all negations to the leaves, eliminating double negations, and simplifying conjunctions/disjunctions with the constants $0$ and $1$.
		The outcome is either a constant, or a binary tree whose nodes are labelled with $\vee$ or $\wedge$ and whose leaves are (negations of) elements of $X$ (called \textbf{variables} in this setting).
		\item For \textbf{associative reduction}, we first apply reduction and subsequently merge nodes with the same label.
		The outcome is either a constant or a tree whose nodes are alternatingly (as we climb the tree) labeled with $\vee$ and $\wedge$ (the root can have either) and whose leaves are (negations of) variables.
		Every node has finitely many children and at least 2.
	\end{itemize}
\end{definition}
\begin{lemma} \label{thm:boolexp-to-const-assignment}
	For every $t \in \booleanalg^\#(X)$ with non-constant reduction $e$ and $c \in \accol{0, 1}$, there exists a bit assignment $\sigma : X \to \accol{0, 1}$ such that $t[\sigma] = c$.
\end{lemma}
\begin{proof}
	By induction on the height of $e$.
\end{proof}
\begin{lemma} \label{thm:boolexp-to-var-assignment}
	For every $t \in \booleanalg^\#(X)$ with reduction $e$ that has a leaf $\tilde x \in \accol{x,\lnot x}$ where $x \in X$, there exists a bit assignment $\sigma : X \setminus \accol x \to \accol{0, 1}$ such that $t[\sigma] = \tilde x$.
\end{lemma}
\begin{proof}
	By induction on the height of the tree.
	It is clear that $e$ is no constant, since it mentions $x$.
	If the tree is a leaf, we are done.
	If $e$ is a conjunction, then for every operand $d$ not depending on $x$, choose an assignment $\sigma$ for that operand's dependencies such that $[d][\sigma] = 1$.
	For the sole operand mentioning $x$, apply the induction hypothesis.
	For disjunctions, we proceed dually.
\end{proof}
\begin{corollary} \label{thm:reduction-minimal-deps}
	If the (basic/associative) reduction of $t$ is $e$ and $e$ depends on $x$, then every expression representing $t$ depends on $x$. \qedhere
\end{corollary}
\begin{definition} \label{def:in-connection}
	If an affine boolean term $t \in \booleanalg^\#(X)$ reduces to $e$ which depends on $x, y \in X$, then we say that $x$ and $y$ are \textbf{in conjunction/disjunction in $e$} if the closest common parent node of (the negation of) $x$ and (the negation of) $y$ is labelled with a conjunction/disjunction.
\end{definition}

\paragraph{Understanding jet cube morphisms}
\begin{lemma} \label{thm:left-of-concursor}
	In $\trijetcubeopt \affine M {\vec a}$ with $M \in \accol{\bipointedsym, \booleanalg}$,
	%assuming \cref{conv:sort-cubes},
	the following holds:
	If a cube morphism $\vfi$ is a jet cube morphism $V = (V_0, \dm j : \rival{P_j}, V_1) \to W = (W_0, \dm i : \rival{Q_i}, W_1)$ with $P, Q \in \accol{\jet, \tej, \equijet}$ and $j > i$,
	and if either of the following conditions hold:
	\begin{itemize}
		\item $\dm j$ appears in $\dm i \psub \vfi$,
		\item $\dm j$ does not appear in $\vfi$ at all,
	\end{itemize}
	then $\vfi$ is also a jet cube morphism
	$\tilde V := (\UFsymcube_j(V_0), \dm j : \rival{\equijet_j}, V_1) \to W$.
\end{lemma}
We remark that this lemma is vacuous if $a_i = \npolar$ or $P = {\equijet}$.

In words, the lemma says: When a variable of the domain of a jet cube morphism is used at a lower degree in the codomain, or not at all, then that variable and all variables of the same degree to its left can be promoted to equijet variables.

In practice, we will only use this lemma for $M = \booleanalg$.
\begin{proof}
	Let $W'$ be the cube obtained from $W$ by simply deleting all variables of degree $i$ or lower.
	Then the weakening morphism $\pi : W \to W'$ is a jet cube morphism.
	Thanks to affineness, $\pi \circ \vfi : V \to W'$ does not depend on $\dm j$.
	Hence, $\pi \circ \vfi \circ (0/\dm j) = \pi \circ \vfi \circ (1/\dm j) =: \rho : (\erasejc{V_0}, \erasejc{V_1}) \to \erasejc{W'}$.
	In the category of \emph{jet cubes} and \emph{cube morphisms between their erasures}, we have a commutative diagram
	\[
		\xymatrix{
			(\Opcube_j V_0, V_1)
				\ar@{.>}@/_/[rrdd]_{\rho}
				\ar[rr]^{(0/\dm j)}
			&&
			V
				\ar[d]^\vfi
			&&
			(V_0, V_1)
				\ar@{.>}@/^/[lldd]^{\rho}
				\ar[ll]_{(1/\dm j)}
			\\
			&& W
				\ar[d]^\pi
			\\
			&& W'
		}
	\]
	where the black arrows are known to be jet cube morphisms, and hence the dotted arrows are also jet cube morphisms as jet cube morphisms compose.
	Thus, $\rho$ is both a jet cube morphism $(\Opcube_j V_0, V_1) \to W'$ and $(V_0, V_1) \to W'$, hence it is a jet cube morphism $(\UFsymcube_j V_0, V_1) \to W'$.
	
	We now show that $\vfi$ is a jet cube morphism $\tilde V \to W$, i.e.\ that $f := \EP(\vfi)$ is a jet set morphism $\JEP(\tilde V) \to \JEP(W)$.
	Pick a jet $\vec v = (\vec v_0, u, \vec v_1) \jet_k \vec v' = (\vec v_0', u', \vec v_1')$ in $\tilde V$; we show that $f(\vec v) \jet_k f(\vec v')$.
	If $k \neq j$, then $\vec v \jet_k \vec v'$ is also a jet in $V$ and therefore preserved by $f$.
	Thus, we can assume that $k = j$.
	If $\vec v = \vec v'$, then preservation is trivial, so we assume $\vec v \neq \vec v'$
	Let $\dm k$ be the unique variable where they differ.
	There are three possibilities
	\begin{description}
		\item[\framebox{$\dm k \in V_0$}]
		In this case, we have $\vec v_0 \infrajet_j \vec v_0'$ in $V_0$, $u = u'$, $\vec v_1 = \vec v_1'$, $\vec v \infrajet_j \vec v'$ in $V$ and $f(\vec v) \infrajet_j f(\vec v')$ in $W$.
		If $\vfi$ does not depend on $\dm k$, then $f(\vec v) = f(\vec v')$ and therefore $f(\vec v) \jet_j f(\vec v')$.
		So we assume that $\vfi$ depends on $\dm k$; let $\dm l$ be the variable such that $\dm l \psub \vfi$ depends on $\dm k$.
		\begin{itemize}
			\item If $\dm l$ is of degree $\ell \leq i < j$, then $f(\vec v) \infrajet_j f(\vec v')$ is only possible if $f(\vec v) \infrajet_\ell f(\vec v')$ which implies $f(\vec v) \equijet_j f(\vec v')$.
			\item If $\dm l$ is of degree $\ell > i$, then we have $\EP(\rho)(\vec v_0, \vec v_1) \overset{\neq}{\equijet}_j \EP(\rho)(\vec v_0', \vec v_1)$ because $\rho$ is a jet cube morphism $(\UFsymcube_j V_0, V_1) \to W'$.
			Since $\EP(\rho) = \EP(\pi) \circ \EP(\vfi) \circ \EP(c/\dm j)$ for any $c \in \accol{0, 1}$ and the components forgotten by $\EP(\pi)$ are identical and include any dependency on $\dm j$, we have $f(\vec v) \equijet_j f(\vec v')$.
		\end{itemize}
		
		\item[\framebox{$\dm k = \dm j$}] In this case, we have $\vec v_0 = \vec v_0'$, $\vec v_1 = \vec v_1'$, and $\vec v \infrajet_j \vec v'$ in $V$.
		Therefore we get $f(\vec v) \infrajet_j f(\vec v')$ and these vectors differ at their value for $\dm i$, which has degree $i$, so this is only possible if $f(\vec v) \infrajet_i f(\vec v')$, which implies $f(\vec v) \equijet_j f(\vec v')$.
		
		\item[\framebox{$\dm k \in V_1$}] Then $\vec v \jet_j \vec v'$ holds in $V$ and is therefore preserved by $f = \EP(\vfi)$. \qedhere
	\end{description}
\end{proof}
\begin{lemma} \label{thm:char-twisted-cube-to-line}
	In $\trijetcubeopt \eps \booleanalg {\vec a}$ with $\eps \in \accol{\affine, \cartes}$, let $V$ be a jet cube with only $i$-directed variables called (from left to right) $\dm j_1, \ldots, \dm j_n$, and consider $\vfi : V \to (\dm i : \rival{P_i})$ with $P \in \accol{\jet, \tej}$.
	Then $\dm i \psub{\vfi}$ is either a constant or of the form
	\[
		\dm i \psub{\vfi} = (\ldots((\lnot^{p_1} \dm j_1 \opA_1 \lnot^{p_2} \dm j_2) \opA_2 \lnot^{p_3} \dm j_3) \ldots) \opA_{n-1} \lnot^{p_n} \dm j_n
	\]
	with $p_k \in \accol{0, 1}$ and $\opA_k \in \accol{{\vee}, {\wedge}, {\opK}}$ where we define $x \opK y := y$.
\end{lemma}
We will only use this lemma when $\eps = \affine$.
\begin{proof}
	We assume $P = {\jet}$, the proof for $P = {\tej}$ is analogous.

	We prove this by induction on $n$.
	If $n = 0$ then $\dm i \psub \vfi$ is necessarily a constant.
	Assume $n > 0$, implying that $a_i = \ypolar$.
	The jet set $\JEP(V)$ has $2^n$ elements and a unique Hamiltonian path of $i$-jets.
	The function $f := \JEP(\vfi)$ sends this Hamiltonian path to a path in $\JEP(\dm i : \rival{\jet_i}) = \accol{0 \jet_i 1}$.
	Thus, $f$ is entirely determined by the step in the Hamiltonian path where the image of $f$ flips from $0$ to $1$.
	Write $\dm j_k'$ to mean $\dm j_k$ if $\dm j_k : \rival{\jet_i}$ and to mean $\lnot \dm j_k$ if $\dm j_k : \rival{\tej_i}$.
	There are 5 possible scenarios:
	\begin{itemize}
		\item The entire path is sent to $0$. Then $\dm i \psub \vfi = 1 = \_ \opK 0$.
		\item The entire path is sent to $1$. Then $\dm i \psub \vfi = 1 = \_ \opK 1$.
		\item The first half of the path is sent to $0$, the second half is sent to $1$. Then $\dm i \psub \vfi = \dm j_n' = \_ \opK \dm j_n'$.
		\item The output of $f$ flips somewhere in the first half of the path.
		Then $\dm i \psub \vfi = s \vee \dm j_n'$ for some boolean expression $s$ depending on $\dm j_1, \ldots, \dm j_{n-1}$.
		Write $V = (U, \dm j_n : \_)$.
		Then we have $(s/\dm i) : \Opcube_i U \to (\dm i : \rival{\jet_i})$, such that $\JEP(s/\dm i)$ is essentially the restriction of $f$ to the first half of the Hamiltonian path as is evident from the following commutative diagram:
		\[
			\xymatrix{
				\Opcube_i U
					\ar[rr]^{(s/\dm i)}
					\ar[rd]_{(0/\dm j_n)}
				&&
				(\dm i : \rival{\jet_i}).
				\\
				& V = (U, \dm j_n : \_)
					\ar[ru]_{(s \vee \dm j_n / \dm i)}
			}
		\]
		By the induction hypothesis, $s$ is of the prescribed form, and therefore so is $\dm i \psub \vfi$.
		\item The output of $f$ flips somewhere in the second half of the path.
		Then $\dm i \psub \vfi = s \wedge \dm j_n'$ for some boolean expression $s$ depending on $\dm j_1, \ldots, \dm j_{n-1}$.
		Write $V = (U, \dm j : \_)$.
		Then we have $(s/\dm i) : U \to (\dm i : \rival{\jet_i})$, such that $\JEP(s/\dm i)$ is essentially the restriction of $f$ to the second half of the Hamiltonian path as is evident from the following commutative diagram:
		\[
			\xymatrix{
				U
					\ar[rr]^{(s/\dm i)}
					\ar[rd]_{(1/\dm j_n)}
				&&
				(\dm i : \rival{\jet_i}).
				\\
				& V = (U, \dm j_n : \_)
					\ar[ru]_{(s \wedge \dm j_n / \dm i)}
			}
		\]
		By the induction hypothesis, $s$ is of the prescribed form, and therefore so is $\dm i \psub \vfi$. \qedhere
	\end{itemize}
\end{proof}
\begin{lemma} \label{thm:char-jet-cube-to-line}
	In $\trijetcubeopt \affine \booleanalg {\vec a}$ where $a_i = \ypolar$, consider $\vfi : V \to (\dm i : \rival{P_i})$ with $P \in \accol{\jet, \tej}$.
	Write $\dm j_1, \ldots, \dm j_n$ for the $i$-directed variables of $V$.
	Then $\vfi$ does not depend on variables of degree lower (stronger) than $i$, nor on $i$-equijet variables of $V$.
	Moreover, $\dm i \psub{\vfi}$ is of the form
	\[
		\dm i \psub{\vfi} = h_n(h_{n-1}(\ldots h_3(h_2(h_1(\lnot^{p_1} \dm j_1) \opA_1 \lnot^{p_2} \dm j_2) \opA_2 \lnot^{p_3} \dm j_3) \ldots ) \opA_{n-1} \lnot^{p_n} \dm j_n)
	\]
	with $p_k \in \accol{0, 1}$ and $\opA_k \in \accol{{\vee}, {\wedge}, {\opK}}$ where we define $x \opK y := y$, and every $h_k$ is a composition of functions of the form $\loch \opB t$ with $t$ any affine boolean expression mentioning only $i$-symmetric variables and ${\opB} \in \accol{{\vee}, {\wedge}, {\opK}}$.
\end{lemma}
\begin{proof}
	We assume $P = {\jet}$, the proof for $P = {\tej}$ is analogous.

	First of all, the $i$-equijet relation as well as all $\ell$-jet relations for $\ell < i$ are reflexive in $\JEP(\dm i : \rival{\jet_i}) = \accol{0 \jet_i 1}$, so that $\JEP(\vfi)$ must be constant on $i$-equijet- or $\ell$-jet-connected components, implying that $\vfi$ cannot depend on those variables.
	Then $\vfi$ factors over the map $\chi : V \to W$ that weakens over all those variables.
	($\JEP(\chi)$ is the map that quotients out the $i$-equijet and therefore also the $\ell$-jet relations for $\ell < i$.)
	Thus, without loss of generality, we can assume that $V$ contains no variables of degree lower than $i$, and no $i$-equijet variables.
	Moreover, applying \cref{conv:sort-cubes}, we can assume that the $i$-directed variables in $V$ are the last ones.
	
	We prove the rest of the theorem by induction on $n$, the number of $i$-directed variables in $V$.
	If $n = 0$, then $\dm i \psub \vfi = t = \_ \opK t$ where $t$ does not mention any $i$-directed variables.
	
	Let $n > 0$.
	We reduce $\dm i \psub \vfi$ to an expression $e$ by associative reduction (\cref{def:reduction}).
	Write $\dm j_k'$ to mean $\dm j_k$ if $\dm j_k : \rival{\jet_i}$ and to mean $\lnot \dm j_k$ if $\dm j_k : \rival{\tej_i}$.
	Write $U$ for the $i$-directed part of $V$ and note that any assignment of bits to all $i$-symmetric variables yields a jet cube morphism $U \to V$ which necessarily satisfies \cref{thm:char-twisted-cube-to-line}.
	
	We prove the induction step again by induction, now on the height of the syntax tree of $e$.
	
	\begin{itemize}
		\item We claim that if $\dm j_n$ and $\dm j_{k}$ occur in different children of the root node of $e$, then $\dm j'_n$ is a direct child of $e$.
		
		Let the root node of $e$ be labelled with $\opA$, where $\accol{(\opA, \absorbA), (\opZ, \absorbZ)} = \accol{(\vee, 1), (\wedge, 0)}$, and let $t$ be the child of $e$ mentioning $\dm j_n$.
		
		First of all, note that there exists an assignment of all $i$-symmetric variables in $t$ that makes none of the $i$-directed variables disappear.
		The result should reduce to something satisfying \cref{thm:char-twisted-cube-to-line}.
		Then this is only possible if any two $i$-directed variables in $t$ are also in $\opA$-connection (\cref{def:in-connection}), so that the parentheses can be moved around.
		
		We know that if $\dm j'_n$ is not a direct child of $e$, then it must depend on other variables and the root node of $t$ is labelled with $\opZ$.
		If one of the immediate operands $s$ of $t$ depends on $\dm j_n$,
		then any other operand $r$ of $t$ can only depend on $i$-symmetric variables, as $\dm j_n$ is in $\opA$-connection with all $i$-directed variables in $t$.
		Then for every $r$ (and in particular for some $r$) there exists a bit assignment of its dependencies that makes $r$ reduce to $\absorbZ$, such that all of $t$ reduces to $\absorbZ$, and gets ignored as an operand of $e$.
		In all other direct operands of $e$, we can choose bit assignments of $i$-symmetric variables that make no $i$-directed variables disappear.
		Then $e$ will reduce to an expression containing $\dm j_k$ but not $\dm j_n$, in violation of \cref{thm:char-twisted-cube-to-line}.
		
%		\todoi{The reasoning below is not good enough.}
%		
%		Assume $t$ mentions an $i$-symmetric variable.
%		Then we can choose a bit-assignment of all $i$-symmetric variables that makes $\dm j_n$ disappear in $t$, but does not make any of the other $i$-directed variables appearing in other children of $e$ disappear.
%		It is clear that we can accomplish this on a per-child-of-$e$ basis.
%		Of course $t$ will reduce to a constant, so we need to make sure that this constant is not $0$ if $e$ is a conjunction, or $1$ if it is a disjunction.
%		However, if $e$ is a conjunction, then $t$ is a disjunction, and we can set an operand that does not contain $\dm j_n$ to 1. The dual holds if $e$ is a disjunction.
%		We now obtain a boolean expression that is not of the form described in \cref{thm:char-twisted-cube-to-line}, which is a contradiction.
%		
%		Assume $t$ mentions another $i$-directed variable.
%		Thanks to affineness, we can choose a bit-assignment of all $i$-symmetric variables such that no $i$-directed variable disappears (set them to 1 in conjunctions and to 0 in disjunctions).
%		This yields a boolean expression that is not of the form described in \cref{thm:char-twisted-cube-to-line}, which is a contradiction.
%		\todoi{Not necessarily!}
		
		\item In the case described in the previous bullet point, we conclude that $e$ is of the form $s \opA \dm j_n'$ with ${\opA} \in \accol{{\vee}, {\wedge}}$ (and $s$ may further use the same symbol $R$ in its root node).
		Write $V = (V', \dm j_n : \_)$.
		\begin{itemize}
			\item If $\opA = \vee$, then we know that $\vfi \circ (0/\dm j_n) = (s/\dm i)$ is a jet cube morphism $\Opcube_i V' \to (\dm i : \rival{\jet_i})$.
			Then by the outer induction hypothesis, $s$ is of the required form, and therefore so is $e$.
			\item If $\opA = \wedge$, then we know that $\vfi \circ (1/\dm j_n) = (s/\dm i)$ is a jet cube morphism $V' \to (\dm i : \rival{\jet_i})$.
			Then by the outer induction hypothesis, $s$ is of the required form, and therefore so is $e$.
		\end{itemize}
		
		\item In the remaining case, all $i$-directed variables occur in the same child $t$ of $e$, if at all.
		Thus, $e$ is of the form $t \opA s$ with $\opA \in \accol{{\vee}, {\wedge}, {\opK}}$ and $s$ depending only on $i$-symmetric variables and possibly using $\opA$ again in its root node.
		By the inner induction hypothesis, $t$ is of the required form, and therefore so is $e$. \qedhere
	\end{itemize}
\end{proof}
\begin{lemma} \label{thm:left-of-connection}
	In $\trijetcubeopt \affine \booleanalg {\vec a}$, let $\hat \vfi : V \to W$ be a jet cube morphism and write $\vfi = \erasejc{\hat \vfi}$.
	Let $W = (W_0, \dm i : \rival{Q_i})$ with $Q \in \accol{\jet, \tej}$ and $a_i = \ypolar$.
	Let $e$ be the reduction of $\dm i \psub \vfi$ and let $\dm j_1, \ldots, \dm j_n$ ($n \geq 0$) be all the variables of degree $i$ that $e$ depends on.
	\todoi{Must be at least 2 variables.}
	Let $V = (V_0, \dm j_1 : \rival{P_i^1}, V_1, \ldots, V_{n-1}, \dm j_n : \rival{P_i^n}, V_n)$, where each $P^1, \ldots, P^n \in \accol{\jet, \tej, \equijet}$.
	Define $\tilde V = (\UFsym_i V_0, \dm j_1 : \rival{P_i^1}, \UFsym_i V_1, \ldots, \UFsym_i V_{n-1}, \dm j_n : \rival{P_i^n}, V_n)$, i.e.\ every variable of degree $i$ to the left of $\dm j_n$ gets promoted to an equijet variable.
	Then $\vfi$ is a jet cube morphism $\tilde V \to W$.
\end{lemma}
Note in advance that \cref{thm:char-twisted-cube-to-line} will tell us that $\dm j_1, \ldots, \dm j_n$ are necessarily the \emph{last} $n$ variables of degree $i$ occurring in $V$. Neither lemma relies on the other.
\begin{proof}
	Let $\dm k_1, \ldots, \dm k_m$ be all \emph{other} variables that $e$ depends on.
	For $c \in \accol{0, 1}$, let $A_c$ be the set of all $(\vec \zeta, \vec \kappa) \in \accol{0, 1}^{n+m}$ such that $\dm i \psub{\vfi} \psub{\vec \zeta / \vec{\dm j}, \vec \kappa / \vec{\dm k}} = c$.
	Let $U$ be the (ordinary) cube obtained from $\erasejc{V}$ by removing all dependencies of $e$.
	Then for any $(\vec \zeta, \vec \kappa) \in \accol{0, 1}^{n+m}$, by applying cube opposite functors in all the right places, there is a jet cube $U_{(\vec \zeta, \vec \kappa)}$ such that $\erasejc{U_{(\vec \zeta, \vec \kappa)}} = U$ and $(\vec \zeta / \vec{\dm j}, \vec \kappa / \vec{\dm k}) : U_{(\vec \zeta, \vec \kappa)} \to V$ is a jet cube morphism.
	
	Then in the category of \emph{jet cubes} and \emph{cube morphisms between their erasures}, for any $(\vec \zeta, \vec \kappa) \in A_c$, we obtain a commutative diagram
	\[
		\xymatrix{
			U_{(\vec \zeta, \vec \kappa)}
				\ar[d]_{(\vec \zeta / \vec{\dm j}, \vec \kappa / \vec{\dm k})}
				\ar@{.>}[rr]^\chi
			&&
			((\Opcube_i)^{1-c}(W_0), W_1)
				\ar[d]^{(c/\dm i)}
			\\
			V
				\ar[rr]_{\vfi}
			&&
			W
		}
	\]
	where all the black lines are jet cube morphisms and the cube morphism $\chi$ is defined as $(\dm i / \novar) \circ \vfi \circ (\vec \zeta / \vec{\dm j}, \vec \kappa / \vec{\dm k})$, which thanks to afineness does not depend on our choice of $(\vec \zeta, \vec \kappa)$, nor even on $c$.
	Commutativity of the diagram and the fact that $\JEP(c/\dm i)$ is a full jet set morphism, imply that $\chi$, too, is a jet cube morphism.
	
	We now show that $\vfi$ is a jet cube morphsim $\tilde V \to W$.
	Let $\vec v \jet_k \vec v'$ in $\tilde V$.
	We prove that $f(\vec v) \jet_k f(\vec v')$ where $f = \EP(\vfi)$.
	If $\vec v = \vec v'$ then this is trivial, so let $\dm l$ be the variable where they differ.
	If $k \neq i$ or $\dm l \in V_n$ then we have $\vec v \jet_k \vec v'$ in $V$ so this is preserved by $f$.
	
	Assume $k = i$ and $\dm l \in V_0$, which implies that $\dm l$ is not a dependency of $e$.
	This implies that $e \psub{\vec v} = e \psub{\vec v'} =: c$, or differently put $\dm i \psub{f(\vec v)} = \dm i \psub{f(\vec v')} = c$.
	We have $\vec v \infrajet_i \vec v'$ in $V$, say $\vec v \mathrel{S}_i \vec v'$ where $S \in \accol{\jet, \tej}$.
	This is preserved by $f$, so $f(\vec v) \mathrel{S}_i f(\vec v')$.
	Because $(c/\dm i)$ is a full jet set morphism, writing $p = \EP(\dm i / \novar)$, we can conclude that $p(f(\vec v)) \mathrel{S}_i p(f(\vec v'))$ in $((\Opcube_i)^{1-c}(W_0), W_1)$.
	Let $\vec u$ and $\vec u'$ be bit-assignments to the variables in $U$ obtained by projecting out all bits assigned to the dependencies of $e$ in the vectors $\vec v$ and $\vec v'$, and let $\vec \zeta$ and $\vec \kappa$ be the bits thus forgotten (which are the same for $\vec v$ and $\vec w$).
	Thus, $\vec v = \EP(\vec \zeta/\vec{\dm j}, \vec \kappa/\vec{\dm k})(\vec w)$ and similar for $\vec v'$.
	Writing $g = \EP(\chi)$, this implies that $p(f(\vec v)) = g(\vec w)$ and similar for $\vec v'$.
	Thus, we have $g(\vec w) \mathrel S_i g(\vec w')$ in $((\Opcube_i)^{1-c}(W_0), W_1)$.
	
	If $\vfi$ does not depend on $\dm l$, then we have nothing to prove,
	so let $\dm h$ be the variable of $W$ such that $\dm h \psub \vfi$ depends on $\dm l$. Note that $\dm h \neq \dm i$.
	\begin{itemize}
		\item If $\dm h \in W_1$, then we have $g(\vec w) \mathrel S_i g(\vec w')$ in $(W_0, W_1)$.
		\item If $\dm h \in W_0$, then the direction of the jet between $g(\vec w)$ and $g(\vec w')$ in $(W_0, W_1)$ flips with $c = e \psub{\vec v}$, which is a function of $(\vec \zeta, \vec \kappa)$.
	\end{itemize}
	On the other hand, looking at the direction of the jet between $\vec w$ and $\vec w'$, we see that this flips with the $\dm j_1 \veebar \ldots \veebar \dm j_n$, the exclusive disjunction of all dependencies of $e$ of degree $i$, which all appear to the right of $\dm l$.
	We remark, thus, that there are assignments $(\vec \zeta, \vec \kappa)$ for which the jets between $\vec w$ and $\vec w'$ on one hand, and between $g(\vec w)$ and $g(\vec w')$ are aligned, and others for which they are opposed. Indeed:
	\begin{itemize}
		\item If $\dm h \in W_1$, then we know that $\dm j_1 \veebar \ldots \veebar \dm j_n$ is not a constant,
		\item If $\dm h \in W_0$, then we know that $\dm j_1 \veebar \ldots \veebar \dm j_n$ is not equal to $[e] = \dm i \psub{\vfi}$, which is an affine boolean expression that cannot possibly express an exclusive disjunction of more than 1 variable.
		\todoi{This is also not possible if $m \neq 0$ and $j \leq 1$.}
	\end{itemize}
	Yet, we also know that $\chi$ is a jet cube morphism for any assignment $(\vec \zeta, \vec \kappa)$.
	Hence, we can conclude that we have $g(\vec w) \equijet_i g(\vec w')$.
	Composing with $\EP(c/\dm i)$ yields $f(\vec v) \equijet_i f(\vec v')$.
\end{proof}

\subsubsection{Completeness}
\begin{theorem}[Completeness] \label{thm:calculus-complete}
	For $M \in \accol{\bipointedsym, \booleanalg}$ and any morphism $\hat \vfi : V \to W$ in $\trijetcubeopt \affine M {\vec a}$ between cubes compliant to \cref{conv:sort-cubes}, writing $\vfi = \erasejc{\hat \vfi}$, we have $\sez \vfi : V \to W$.
\end{theorem}
\begin{proof}
	For each variable $\dm k$ in $W$, let $e_{\dm k}$ be the reduction of $\dm k \psub{\vfi}$.

	We prove completeness by induction on the number of nodes and leaves in the tuple $(e_{\dm k})_{\dm k \in W}$.
	
	If $W = ()$, then use \ruleref{terminal}.
	
	If $a_i = \ypolar$ and the last variable in $W$ is $\dm i : \rival{\equijet_i}$, then $W$ is of the form $\Usymcube_i(U)$ and there will be a corresponding morphism $\Fsymcube_i(V) \to U$ and we can use the rule \ruleref{symmetrize}.
	
	In the remaining case, the last variable in $W$ is not an equijet dimension at a directed degree, i.e.\ it is of the form $\dm i : \rival{\jet_i}$ or $\dm i : \rival{\tej_i}$.
	
	If the last variable in $V$ is of degree strictly lower than $\dm i$, then in order to be a jet set morphism, $\JEP(\hat \vfi)$ cannot depend on that variable, so we can invoke \ruleref{wkn} until the last variable in $V$ is of degree at least $i$. We do not resort to the induction hypothesis but proceed below.
	
%	If $a_i = \npolar$, then we use \ruleref{exchange} (which is sound by \cref{thm:calculus-sound}) to reorder the variables of degree $i$ in $W$, and immediately proceed with the algorithm below.
%	We put constants last. Before that, if existent, we put the sole variable $\dm k_1$ such that $e_{\dm k_1}$ mentions the last variable of degree $i$ in $V$.
%	Before that, we put, if existent, the sole variable $\dm k_2$ such that $e_{\dm k_2}$ mentions the second to last variable of degree $i$ in $V$. Etc.
	
	We proceed by inspecting $e_{\dm i}$.
	
	\begin{itemize}
		\item If [$\dm i : \rival{\jet_i}$ and $e_{\dm i} = 0$] or [$\dm i : \rival{\tej_i}$ and $e_{\dm i} = 1$], then $\vfi$ being a jet cube morphism $V \to W = (U, \dm i : \_)$ (equivalently: $\EP(\vfi)$ being a jet set morphism $\JEP(V) \to \JEP(W)$) is equivalent to $(\novar / \dm i) \circ \vfi$ being a jet cube morphism $V \to \Opcube_i(U)$, so we can apply \ruleref{zero:fwd} or \ruleref{one:bck}.
		
		\item If [$\dm i : \rival{\jet_i}$ and $e_{\dm i} = 1$] or [$\dm i : \rival{\tej_i}$ and $e_{\dm i} = 0$], then $\vfi$ being a jet cube morphism $V \to W = (U, \dm i : \_)$ (equivalently: $\EP(\vfi)$ being a jet set morphism $\JEP(V) \to \JEP(W)$) is equivalent to $(\novar / \dm i) \circ \vfi$ being a jet cube morphism $V \to U$, so we can apply \ruleref{one:fwd} or \ruleref{zero:bck}.
		
		\item If $\dm i : \rival{\jet_i}$ and $e_{\dm i} = \lnot \dm j$, then $\vfi$ being a jet cube morphism $V \to W = (U, \dm i : \rival{\jet_i})$ is equivalent to $(\lnot \dm i / \dm i) \circ \vfi$ being a jet cube morphism $V \to (U, \dm i : \rival{\tej_i})$, so we can apply \ruleref{inv:fwd}.
		Similarly, if $\dm i : \rival{\tej_i}$ and $e_{\dm i} = \lnot \dm j$, we can apply \ruleref{inv:bck}.
		
		\item If $\dm i : \rival{\jet_i}$ ($\dm i : \rival{\tej_i}$ is handled analogously) and $e_{\dm i} = \dm j$ where $V$ specifies that $\dm j$ has degree $j$, then we know that $\vfi = (\chi, \dm j / \dm i)$ is a jet cube morphism $V = (V_0, \dm j : \rival{R_j}, V_1) \to W = (U, \dm i : \rival{\jet_i})$ for some $R \in \accol{\jet, \tej, \equijet}$.
		We have the following commutative diagram in the category of \emph{jet cubes} and \emph{cube morphisms between erased jet cubes}:
		\[
			\xymatrix{
				(\Opcube_j(V_0), V_1)
					\ar[d]_{(0/\dm j)}
					\ar@{.>}[rr]^\chi
				&&
				\Opcube_i(U)
					\ar[d]^{(0/\dm i)}
				\\
				(V_0, \dm j : \rival{R_j}, V_1)
					\ar[rr]_{\vfi (\chi, \dm j / \dm i)}
				&& (U, \dm i : \rival{\jet_i})
				\\
				(V_0, V_1)
					\ar[u]^{(1/\dm j)}
					\ar@{.>}[rr]_\chi
				&&
				U
					\ar[u]_{(1/\dm i)}
			}
		\]
		We note that the non-dashed arrows are all jet cube morphisms, and the vertical arrows all yield full jet set morphisms (\cref{def:full-jetsethom}).
		This implies that the dashed arrows also lift to jet set morphisms, i.e.\ are jet cube morphisms.
		Then $\chi$ is both a jet cube morphism $(V_0, V_1) \to U$ and $\Opcube_i(\Opcube_j(V_0), V_1) \to U$.
		\begin{itemize}
			\item If $j = i$, then $R = {\jet}$, all variables in $V_1$ have degree $i$ and $\chi$ is both a jet cube morphism $(V_0, V_1) \to U$ and $(V_0, \Opcube_i(V_1)) \to U$.
			This implies that $\EP(\vfi)$ sends every $i$-jet of the form $(\vec v_0, r, \vec v_1) \jet_i (\vec v_0, r, \vec v_1')$ (and hence every such $i$-infrajet) to an $i$-equijet $(\EP(\chi)(\vec v_0, \vec v_1), r) \equijet_i (\EP(\chi)(\vec v_0, \vec v'_1), r)$ in $\JEP(U, \dm i : \rival{\jet_i})$.
			\begin{itemize}
				\item If $a_i = \ypolar$, then all $i$-equijets in $\JEP(U, \dm i : \rival{\jet_i})$ are reflexive and all elements of the form $(\vec v_0, r, \vec v_1)$ for fixed $\vec v_0$ and $r$ but variable $\vec v_1$ are $i$-infrajet-connected, so this means that $\EP(\chi)(\vec v_0, \vec v_1)$ is independent of $V_1$.
				Then $\chi$ cannot mention any variables from $V_1$.
				\begin{itemize}
					\item If $V_1$ contains any variables, then we can apply \ruleref{wkn}.
					\item Otherwise, we can apply \ruleref{prism:fwd}.
				\end{itemize}
				
				\item If $a_i = \npolar$, then we can use \ruleref{exchange} to create a morphism from $(V_0, V_1, \dm j : \rival{\edge_i})$ instead, which can be done using \ruleref{prism:fwd} (or equivalently \ruleref{prism:bck}).
			\end{itemize}
			
			If $j > i$, then $\chi$ is necessarily a jet cube morphism $\UFsymcube_i(\UFsymcube_j(V_0), V_1) \to U$, so we can apply \ruleref{companion:fwd}, \ruleref{conjoint:fwd} or \ruleref{equicompanion:fwd}, depending on $R$.
			Note that if $R = {\equijet}$, then $\UFsymcube_j(V_0) = V_0$, justifying the premise of \ruleref{equicompanion:fwd}.
		\end{itemize}
		
		\item We have now covered all cases for the monad $\bipointedsym$.
		In the remaining cases, $e_{\dm i}$ contains conjunction or disjunction symbols.
		If $\dm i : \rival{\tej_i}$, we apply \ruleref{inv:fwd} and push down the introduced negation, after which we do not resort to the induction hypothesis but proceed below.\footnote{Alternatively, we could duplicate and adapt the proof below and the lemmas on which it relies to the case where $\dm i : \rival{\tej_i}$.}
		We now assume that $\dm i : \rival{\jet_i}$.
		
		\begin{itemize}
			\item We first treat the case where $a_i = \npolar$.
			Let $\vfi = (\chi, s \opA t/\dm i)$ where $\opA \in \accol{{\vee}, {\wedge}}$ and $W = (U, \dm i : \rival{\jet_i})$.
			We claim that if $\vfi$ is a jet cube morphism, then so are $(\chi, s/\dm i)$ and $(\chi, t/\dm i)$.
			Indeed, assume $s$ depends on the variables $\dm j_1, \ldots, \dm j_n$.
			Take a bit assignment $\vec v/\vec{\dm j}$ such that $s[\vec v/\vec{\dm j}]$ equals $0$ if $\opA = {\vee}$ and $1$ if $\opA = {\wedge}$.
			Then $\dm i \psub \vfi \psub{\vec v/\vec{\dm j}} = (s \opA t)\psub{\vec v/\vec{\dm j}} = t \psub{\vec v/\vec{\dm j}}$, which thanks to affineness just equals $t$.
			By removing $\vec{\dm j}$ from $V$ and taking opposites in all the right places, we obtain a jet cube $V_1$ such that $(\vec v/\vec{\dm j}) : V_1 \to V$ is a jet cube morphism.
			
			\item \todoi{Directed case.}
			\todoi{We do have to consider $e$ up to boolean equality}
			
			Weakening over all variables but $\dm i$ yields a jet cube morphism $V \to (\dm i : \rival{\jet_i})$ to which we can apply \cref{thm:char-jet-cube-to-line},
			concluding that $\dm i \psub \vfi$ is of the form prescribed there.
			Since we have already dealt with constants and (negations of) variables, the remaining cases are:
			\begin{itemize}
				\item $e$ is of the form $s \opA \lnot^p \dm k$ where $\dm k$ is the last $i$-directed variable of $V$ and $\opA \in \accol{{\vee}, {\wedge}}$.
				It is easy to see that the last operand must be $\dm k'$ which we define to be equal to $\dm k$ if $\dm k : \rival{\jet_i}$ and $\lnot \dm k$ if $\dm k : \rival{\tej_i}$.
			\end{itemize}
		\end{itemize}
		\todoi{Your lemmas don't cover symmetric degrees!! But these are easy.}
		\todoi{Shouldn't you reduce to $(\vfi, s)$ and $(\vfi, t)$? Do you need a cofibration for $s$?}
		
		
		\todoi{Old stuff}
		\begin{itemize}
			\item If $V$ has $i$-directed variables (\cref{def:symmetric-var}), then $a_i = \ypolar$ and the last variable $\dm k$ of $V$ is a non-equijet variable of degree $i$.
			We show that $e_{\dm i}$ is of one of the following forms:
			\begin{itemize}
				\item $r \wedge t$ or $r \vee t$ where $r$ only mentions $i$-symmetric variables,
				\item $s \wedge \dm k'$ or $s \vee \dm k'$ where $\dm k' = \dm k$ if $\dm k : \rival{\jet_i}$ and $\dm k' = \lnot \dm k$ if $\dm k : \rival{\tej_i}$.
			\end{itemize}
			
			We first show this under the assumption that $V$ \emph{only} has $i$-directed variables.
			In that case, the cases $r \wedge t$ and $r \vee t$ can already be ruled out as $r$ would necessarily be a constant, but conjunctions and disjunctions have already been simplified.
			
			If $V$ has only $i$-directed variables, say $n$ of them, then $\JEP(V)$ has a Hamiltonian path of $i$-jets with $2^n$ nodes, which $e_{\dm i}$ must map onto $\accol{0 \jet_i 1}$.
			Such a mapping is determined entirely by the step in the Hamiltonian path where the output flips from $0$ to $1$.
			We remark that the last component of $\vec v \in \JEP(V)$ determines whether $\vec v$ is in the first or in the second half of the Hamiltonian path.
			More precisely, $\vec v$ is in the first half if and only if $\dm k'[\vec v] = 0$.
			We have a priori 5 possible scenarios:
			\begin{itemize}
				\item All nodes are sent to $0$. Then $e_{\dm i} = 0$, but we already handled that case.
				\item All nodes are sent to $1$. Then $e_{\dm i} = 1$, but we already handled that case.
				\item The first half of the nodes is sent to $0$, the second half is sent to $1$. Then $e_{\dm i} = \dm k'$, but we already handled that case.
				\item The output bit flips somewhere in the first half. In that case, $e_{\dm i}$ can be written as an (a priori not affine) boolean expression of the form $s \vee \dm k'$.
				\item The output bit flips somewhere in the first half. In that case, $e_{\dm i}$ can be written as an (a priori not affine) boolean expression of the form $s \vee \dm k'$.
			\end{itemize}
			\todoi{Show this}
			
			\item If $a_i = \npolar$ or all variables of degree $i$ in $V$ are equijet variables, then $V = \UFsym_i V$.
			\todoi{Prove this case.}
		\end{itemize}
		
		\item \todoi{Old version}
		
		If $\dm i : \rival{\jet_i}$ and $e_{\dm i} = s \wedge t$, then by the fact that $e_{\dm i}$ is the output of a reduction process, we know that $s$ and $t$ are not constants.
		By affinity, we know that $s$ depends on variables $\dm j_1, \ldots, \dm j_m$ (which we gather in the set $J$) and $t$ depends on \emph{different} variables $\dm k_1, \ldots, \dm k_n$ (which we gather in $K$).
		Furthermore, writing $\vfi = (\chi, s \wedge t / \dm i) : V \to W = (U, s \wedge t / \dm i)$, we know that $\chi$ depends again on different variables $\dm l_1, \ldots, \dm l_p$ (which we gather in $L$).
		Since each of these variables in $J$ occur at most (and without loss of generality, exactly) once (possibly under a negation) in the leaves of the syntax tree of $s$, there exist constant assignments $\vec \zeta^0/\vec{\dm j}$ and $\vec \zeta^1/\vec{\dm j}$ that make $s$ reduce to 0 and to 1, respectively.
		These constant assignments can be constructively chosen so that they differ by a single bit, which we do.%
		\footnote{Start from assignments $\vec \theta^0/\vec{\dm j}$ and $\vec \theta^1/\vec{\dm j}$ that differ by zero or more bits and yield different outcomes for $s$.
		Toggle bits in $\vec \theta^0$ until you get $\vec \theta^1$.
		As soon as $s[\vec \theta/\vec{\dm j}]$ flips, return the last two assignments encountered.
		When you reach $\vec \theta^1$ and have not returned anything yet, you have a contradiction.}
		Pick similar assignments for $\vec \kappa^0/\vec{\dm k}$ and $\vec \kappa^1/\vec{\dm k}$ for $t$.
	
		We will now prove simultaneously that
		\begin{itemize}
			\item $\chi$ is a jet cube morphism $\UFsym_i V \to U$,
			\item $(\chi, s / \dm j, t / \dm k)$ is a jet cube morphism $V \to (U, \dm j : \rival{\jet_i}, \dm k : \rival{\jet_i})$,
		\end{itemize}
		so that we can apply \ruleref{conj:fwd}.
		
		Pick a jet $\vec v \jet_j \vec v'$ in $V$. Writing $g = \EP(\chi)$, we need to prove that
		\begin{itemize}
			\item $g(\vec v) \jet_j g(\vec v')$ if $j \neq i$ and $g(\vec v) \equijet_i g(\vec v')$ if $j = i$,
			\item $(g(\vec v), s[\vec v], t[\vec v]) \jet_j (g(\vec v'), s[\vec v'], t[\vec v'])$.
		\end{itemize}
		If $\vec v = \vec v'$, then this is trivial.
		Otherwise, these vectors differ by a single bit, which concerns a variable $\dm h$ that is found in exactly one of the sets $J$, $K$ or $L$.
		\begin{description}
			\item[\framebox{$\dm h \in K$}] Then $g(\vec v) = g(\vec v') =: g_0$ and $s[\vec v] = s[\vec v'] =: s_0$.
			Define $\vec w$ and $\vec w'$ by overriding $\vec v$ and $\vec v'$ with $\vec \zeta^1$.
			Then $\vec w \infrajet_j \vec w'$, $g(\vec w) = g(\vec w') = g_0$, $s[\vec w] = s[\vec w'] = 1$, $t[\vec w] = t[\vec v]$ and $t[\vec w'] = t[\vec v']$.
			Write $\jet'$ for the specific direction such that $\vec w \jet'_j \vec w'$, and $\tej'$ for its opposite.
			Since $\vfi$ is a jet cube morphism, writing $f = \EP(\vfi)$, we get
			\[
				f(\vec w) = (g_0, 1 \wedge t[\vec v]) \jet'_j (g_0, 1 \wedge t[\vec v']) = f(\vec w').
			\]
			This implies that $t[\vec v] \jet'_j t[\vec v']$ in $\rival{\jet_i}$.
		\end{description}
		\todoi{Owv conditie op $\vfi$ en owv normaliteit normal form moet ge wel $n$-aire conjuncties/disjuncties beschouwen.}
	\end{itemize}
\end{proof}

\todoi{Use $\jetcubeaff{\booleanalg}{\vec a}$ or $\jetcubecart{\booleanalg}{\vec a}$}

\subsection{Jet Cubes: Separated Semisymmetric Product}

\subsection{Jet Cubes Old}
\todoi{This is all wrong: there is no symmetry, no degradation and no connections/companions/conjoints.}

\begin{corollary} \label{thm:jet-cube-op}
	If $W$ is a jet cube, then $\Op_i(W)$ is isomorphic (in $\jetset{\vec a}$) to a jet cube $\Opcube_i(W)$.
	We have $\Opcube_i \circ \Opcube_i = \Id$.
	\todoi{Do we use this? I guess later on to characterize.}
\end{corollary}
In fact, it happens to be the case that $\Opcube_i(W) = W$, but we will avoid to use this fact as the isomorphism $\Op_i(W) \cong \Opcube_i(W) = W$ is not the identity on objects.
\begin{proof}
	We define recursively:
	\begin{itemize}
		\item $\Opcube_i(\top) := \top = \Op_i(\top)$,
		\item $\Opcube_i(W \multip \rival{\jet_i}) := W \multip \rival{\jet_i} \cong \Op_i(W \multip \rival{\jet_i})$ (by swapping 0 and 1),
		\item $\Opcube_i(W \multip \rival{\jet_j}) := \Opcube_i(W) \multip \rival{\jet_j} \cong \Op_i(W) \multip \rival{\jet_j} = \Op_i(W \multip \rival{\jet_j})$ if $i \neq j$. \qedhere
	\end{itemize}
\end{proof}

\begin{definition} \label{def:jet-cube-cat}
	Let $\vec a$ be a mask.
	We define the category $\jetcube{\vec a}$ of \textbf{jet cubes of mask $\vec a$} as the proof-relevant sub\emph{graph} (a priori; it will be a category after \cref{thm:jet-cube-cat}) of $\jetset{\vec a}$ whose nodes are the jet cubes, and whose edges are generated by:
	\begin{itemize}
		\item $(\vfi, 0) : \Hom_{\jetcube{\vec a}}(V, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, \Opcube_i(W))$,
		\item $(\vfi, 1) : \Hom_{\jetcube{\vec a}}(V, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, W)$,
		\item $\vfi \multip \rival{\jet_i} : \Hom_{\jetcube{\vec a}}(V \multip \rival{\jet_i}, W \multip \rival{\jet_i})$ for $\vfi : \Hom_{\jetcube{\vec a}}(V, W)$,
		\item $() : \Hom_{\jetcube{\vec a}}(V, \top)$.
	\end{itemize}
\end{definition}
Again, every jet cube morphism can be generated by the above steps in only a single way, so we can reason about them inductively.
\begin{corollary} \label{thm:jet-cube-op-ftr}
	Each $\Opcube_i$ extends to a well-defined graph endomorphism (and hence, after \cref{thm:jet-cube-cat}, an endofunctor) on $\jetcube{\vec a}$.
	We have $\Opcube_i \circ \Opcube_i = \Id$.
\end{corollary}
\begin{proof}
	We define recursively:
	\begin{itemize}
		\item $\Opcube_i(\vfi, 0 \in \rival{\jet_i}) := (\Opcube_i(\vfi), 1)$,
		\item $\Opcube_i(\vfi, 0 \in \rival{\jet_j}) := (\Opcube_i(\vfi), 0)$ if $i \neq j$,
		\item $\Opcube_i(\vfi, 1 \in \rival{\jet_i}) := (\Opcube_i(\vfi), 0)$,
		\item $\Opcube_i(\vfi, 1 \in \rival{\jet_j}) := (\Opcube_i(\vfi), 1)$ if $i \neq j$,
		\item $\Opcube_i(\vfi \multip \rival{\jet_i}) = \vfi \multip \rival{\jet_i}$,
		\item $\Opcube_i(\vfi \multip \rival{\jet_j}) = \Opcube_i(\vfi) \multip \rival{\jet_j}$ if $i \neq j$,
		\item $\Opcube_i(()) = ()$. \qedhere
	\end{itemize}
\end{proof}
\begin{corollary} \label{thm:jet-cube-cat}
	$\jetcube{\vec a}$ is a category.
\end{corollary}
\begin{proof}
	Identity and composition can be defined recursively; category laws proven inductively.
\end{proof}

\subsection{Comparison to Pinyo and Kraus's Twisted Cube Category}
\todoi{Conjecture: $\jetcubeaff{\bipointedsym}{[\ypolar]}$ is the twisted cube category \cite{pinyo-twisted}. Symmetries zijn nodig om aan 0-kant te embedden. Moogt ook cartesians pakken, want hebt toch geen diagonalen.}
\todoi{Compare to all the different cube categories they have, I think I have them all included.}
In this section, we discuss how our approach reduces to Pinyo and Kraus's \cite{pinyo-twisted} when $\vec a = [\ypolar]$.
$\jetset{[\ypolar]}$ is the category of proof-irrelevant reflexive graphs.
Pinyo and Kraus use arbitrary proof-irrelevant graphs, but since $\top$ is reflexive and the twisted prism functor \cite[def.\ 4]{pinyo-twisted} restricts to reflexive graphs, all twisted cubes are reflexive graphs anyway.
\todoi{Continue}


Out of the category of jet sets, we will carve the category of jet cubes, in such a way that the category of jet cubes of mask $[\ypolar]$ is isomorphic to the twisted cube category \cite{pinyo-twisted}.


\bibliographystyle{alphaurl}
\bibliography{../refs/refs.bib}

\end{document}